[{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'outcome' is assigned a value but never used.","line":127,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, lazy, Suspense } from 'react';\nimport { BrowserRouter, Routes, Route, Navigate, useNavigate } from 'react-router-dom';\nimport { AuthProvider } from './context/AuthProvider';\nimport { useAuth } from './context/AuthContext';\nimport { logger } from './utils/logger';\nimport { StudyProvider } from './context/StudyProvider';\nimport { ProjectProvider } from './context/ProjectProvider';\nimport { PomodoroProvider } from './context/PomodoroProvider';\nimport { ToastProvider } from './context/ToastProvider';\nimport { ConfirmProvider } from './context/ConfirmProvider';\nimport { UIThemeProvider } from './context/UIThemeProvider';\nimport { SyncStatusWatcher } from './components/SyncStatusWatcher';\nimport { AudioProvider } from './context/AudioProvider';\nimport { MainLayout } from './layouts/MainLayout';\nimport { LoginPage } from './features/auth/LoginPage';\nimport { LoadingSpinner } from './components/ui/LoadingSpinner';\nimport { GlobalSearch } from './components/GlobalSearch';\nimport { NotificationPermissionBanner } from './components/NotificationPermissionBanner';\nimport { OnboardingTour } from './components/onboarding/OnboardingTour';\nimport { PWAPrompt } from './components/PWAPrompt';\nimport { Analytics } from '@vercel/analytics/react';\nimport { SpeedInsights } from '@vercel/speed-insights/react';\n\n// Lazy load pages for better initial bundle size\nconst Dashboard = lazy(() => import('./features/dashboard/Dashboard').then(module => ({ default: module.Dashboard })));\nconst Calendar = lazy(() => import('./features/calendar/Calendar').then(module => ({ default: module.Calendar })));\nconst ThemeList = lazy(() => import('./features/lists/ThemeList').then(module => ({ default: module.ThemeList })));\nconst ProjectList = lazy(() => import('./features/lists/ProjectList').then(module => ({ default: module.ProjectList })));\nconst GoalList = lazy(() => import('./features/lists/GoalList').then(module => ({ default: module.GoalList })));\nconst TaskList = lazy(() => import('./features/lists/TaskList').then(module => ({ default: module.TaskList })));\nconst AnalyticsPage = lazy(() => import('./features/analytics/AnalyticsPage').then(module => ({ default: module.AnalyticsPage })));\nconst Settings = lazy(() => import('./features/settings/Settings').then(module => ({ default: module.Settings })));\nconst SummariesPage = lazy(() => import('./features/summaries/SummariesPage').then(module => ({ default: module.SummariesPage })));\nconst SummaryDemo = lazy(() => import('./pages/SummaryDemo'));\n\n\nfunction LoadingFallback() {\n  return (\n    <div className=\"flex items-center justify-center h-full w-full\">\n      <div className=\"flex flex-col items-center gap-4\">\n        <LoadingSpinner size=\"lg\" variant=\"primary\" />\n        <p className=\"text-slate-400 text-sm animate-pulse\">Carregando...</p>\n      </div>\n    </div>\n  );\n}\n\n// Wrapper to provide navigation prop to Dashboard\nconst DashboardWrapper = ({ setIsSummaryModalOpen, setIsMissionModalOpen }: { setIsSummaryModalOpen: (v: boolean) => void, setIsMissionModalOpen: (v: boolean) => void }) => {\n  const navigate = useNavigate();\n  return (\n    <Dashboard\n      onNavigate={(path) => navigate(`/${path}`)}\n      onOpenSummaryModal={() => setIsSummaryModalOpen(true)}\n      setIsMissionModalOpen={setIsMissionModalOpen}\n    />\n  );\n};\n\nfunction AppContent() {\n  const { user } = useAuth();\n  const [isSummaryModalOpen, setIsSummaryModalOpen] = useState(false);\n  const [isMissionModalOpen, setIsMissionModalOpen] = useState(false);\n  const [isSearchOpen, setIsSearchOpen] = useState(false);\n\n  // Global Search Shortcut (Ctrl+K / Cmd+K)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n        e.preventDefault();\n        setIsSearchOpen(true);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  // --- HARD RESET FOR FRESH START (GUEST ONLY) ---\n  useEffect(() => {\n    // Guest UUID detected or just run once for current session request\n    if (user?.id === '00000000-0000-0000-0000-000000000001') {\n      const hasReset = sessionStorage.getItem('guest_reset_v3');\n      if (!hasReset) {\n        logger.info(\"üßπ Executing Hard Reset for Guest Session...\");\n        // Purge App Data (Preserve 'app_user' to keep login)\n        localStorage.removeItem('study_themes_backup');\n        localStorage.removeItem('deleted_theme_ids');\n        localStorage.removeItem('sync_queue_v1');\n        localStorage.removeItem('daily_unlocked_subthemes');\n        localStorage.removeItem('active_focus_session');\n\n        // Mark as done for this tab session\n        sessionStorage.setItem('guest_reset_v3', 'true');\n\n        // Force Reload to ensure contexts re-initialize empty\n        window.location.reload();\n      }\n    }\n  }, [user]);\n\n  // PWA Install Prompt\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\n  const [showPWAPrompt, setShowPWAPrompt] = useState(false);\n\n  useEffect(() => {\n    const handler = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      // Show prompt after 30s (not immediately)\n      setTimeout(() => {\n        const dismissed = localStorage.getItem('pwa_prompt_dismissed');\n        if (!dismissed) {\n          setShowPWAPrompt(true);\n        }\n      }, 30000);\n    };\n\n    window.addEventListener('beforeinstallprompt', handler);\n    return () => window.removeEventListener('beforeinstallprompt', handler);\n  }, []);\n\n  const handlePWAInstall = async () => {\n    if (!deferredPrompt) return;\n\n    deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n\n    logger.info('PWA installed');\n\n    setDeferredPrompt(null);\n    setShowPWAPrompt(false);\n  };\n\n  const handlePWADismiss = () => {\n    setShowPWAPrompt(false);\n    localStorage.setItem('pwa_prompt_dismissed', 'true');\n  };\n\n  // If not logged in, show Login Page directly (Personal Use Mode)\n  if (!user) {\n    return <LoginPage />;\n  }\n\n  return (\n    <StudyProvider key={user.id}> {/* Key forces reset when user changes */}\n      <ProjectProvider>\n        <PomodoroProvider>\n          {/* Global Search Modal */}\n          <GlobalSearch isOpen={isSearchOpen} onClose={() => setIsSearchOpen(false)} />\n\n          {/* Notification Permission Banner */}\n          <NotificationPermissionBanner />\n\n          {/* Onboarding Tour */}\n          <OnboardingTour />\n\n          {/* PWA Install Prompt */}\n          {showPWAPrompt && (\n            <PWAPrompt\n              onInstall={handlePWAInstall}\n              onDismiss={handlePWADismiss}\n            />\n          )}\n\n          <MainLayout\n            isSummaryModalOpen={isSummaryModalOpen}\n            setIsSummaryModalOpen={setIsSummaryModalOpen}\n            isMissionModalOpen={isMissionModalOpen}\n            setIsMissionModalOpen={setIsMissionModalOpen}\n          >\n            <Suspense fallback={<LoadingFallback />}>\n              <Routes>\n                <Route path=\"/\" element={<Navigate to=\"/dashboard\" replace />} />\n                <Route path=\"/dashboard\" element={<DashboardWrapper setIsSummaryModalOpen={setIsSummaryModalOpen} setIsMissionModalOpen={setIsMissionModalOpen} />} />\n                <Route path=\"/calendar\" element={<Calendar />} />\n                <Route path=\"/summaries\" element={<SummariesPage />} />\n                <Route path=\"/themes\" element={<ThemeList />} />\n                <Route path=\"/projects\" element={<ProjectList />} />\n                <Route path=\"/goals\" element={<GoalList />} />\n                <Route path=\"/tasks\" element={<TaskList />} />\n                <Route path=\"/analytics\" element={<AnalyticsPage />} />\n                <Route path=\"/settings\" element={<Settings />} />\n                <Route path=\"/summary-demo\" element={<SummaryDemo />} />\n                <Route path=\"*\" element={<Navigate to=\"/dashboard\" replace />} />\n              </Routes>\n            </Suspense>\n          </MainLayout>\n        </PomodoroProvider>\n      </ProjectProvider>\n    </StudyProvider>\n  );\n}\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <AuthProvider>\n        <ToastProvider>\n          <ConfirmProvider>\n            <UIThemeProvider>\n              <AudioProvider>\n                <SyncStatusWatcher />\n                <AppContent />\n              </AudioProvider>\n            </UIThemeProvider>\n          </ConfirmProvider>\n        </ToastProvider>\n      </AuthProvider>\n\n      {/* Vercel Analytics & Speed Insights */}\n      <Analytics />\n      <SpeedInsights />\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\__tests__\\startup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\GlobalSearch.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`handleSelectResult` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\GlobalSearch.tsx:44:25\n  42 |                     e.preventDefault();\n  43 |                     if (results[selectedIndex]) {\n> 44 |                         handleSelectResult(results[selectedIndex]);\n     |                         ^^^^^^^^^^^^^^^^^^ `handleSelectResult` accessed before it is declared\n  45 |                     }\n  46 |                     break;\n  47 |                 case 'Escape':\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\GlobalSearch.tsx:63:5\n  61 |     }, [results]);\n  62 |\n> 63 |     const handleSelectResult = (result: SearchResult) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 64 |         onClose();\n     | ^^^^^^^^^^^^^^^^^^\n> 65 |\n     ‚Ä¶\n     | ^^^^^^^^^^^^^^^^^^\n> 81 |         }\n     | ^^^^^^^^^^^^^^^^^^\n> 82 |     };\n     | ^^^^^^^ `handleSelectResult` is declared here\n  83 |\n  84 |     const getResultIcon = (type: SearchResult['type']) => {\n  85 |         switch (type) {","line":44,"column":25,"nodeType":null,"endLine":44,"endColumn":43},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSelectResult'. Either include it or remove the dependency array.","line":56,"column":8,"nodeType":"ArrayExpression","endLine":56,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, results, selectedIndex, onClose, handleSelectResult]","fix":{"range":[1999,2040],"text":"[isOpen, results, selectedIndex, onClose, handleSelectResult]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { Search, X, CheckSquare, Target, BookOpen, FileText, ArrowRight } from 'lucide-react';\r\nimport { useGlobalSearch, type SearchResult } from '../hooks/useGlobalSearch';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ninterface GlobalSearchProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const GlobalSearch: React.FC<GlobalSearchProps> = ({ isOpen, onClose }) => {\r\n    const [query, setQuery] = useState('');\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const results = useGlobalSearch(query);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const navigate = useNavigate();\r\n\r\n    // Focus input when modal opens\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            inputRef.current?.focus();\r\n            setQuery('');\r\n            setSelectedIndex(0);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    // Keyboard navigation\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (!isOpen) return;\r\n\r\n            switch (e.key) {\r\n                case 'ArrowDown':\r\n                    e.preventDefault();\r\n                    setSelectedIndex(prev => Math.min(prev + 1, results.length - 1));\r\n                    break;\r\n                case 'ArrowUp':\r\n                    e.preventDefault();\r\n                    setSelectedIndex(prev => Math.max(prev - 1, 0));\r\n                    break;\r\n                case 'Enter':\r\n                    e.preventDefault();\r\n                    if (results[selectedIndex]) {\r\n                        handleSelectResult(results[selectedIndex]);\r\n                    }\r\n                    break;\r\n                case 'Escape':\r\n                    e.preventDefault();\r\n                    onClose();\r\n                    break;\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isOpen, results, selectedIndex, onClose]);\r\n\r\n    // Reset selected index when results change\r\n    useEffect(() => {\r\n        setSelectedIndex(0);\r\n    }, [results]);\r\n\r\n    const handleSelectResult = (result: SearchResult) => {\r\n        onClose();\r\n\r\n        // Navigate based on result type\r\n        switch (result.type) {\r\n            case 'task':\r\n                navigate('/tasks');\r\n                // TODO: Open task details modal\r\n                break;\r\n            case 'goal':\r\n                navigate('/goals');\r\n                // TODO: Open goal details modal\r\n                break;\r\n            case 'theme':\r\n            case 'subtheme':\r\n                navigate('/themes');\r\n                // TODO: Open theme details modal\r\n                break;\r\n        }\r\n    };\r\n\r\n    const getResultIcon = (type: SearchResult['type']) => {\r\n        switch (type) {\r\n            case 'task':\r\n                return <CheckSquare className=\"w-5 h-5 text-purple-400\" />;\r\n            case 'goal':\r\n                return <Target className=\"w-5 h-5 text-blue-400\" />;\r\n            case 'theme':\r\n                return <BookOpen className=\"w-5 h-5 text-orange-400\" />;\r\n            case 'subtheme':\r\n                return <FileText className=\"w-5 h-5 text-orange-300\" />;\r\n        }\r\n    };\r\n\r\n    const getResultBadge = (type: SearchResult['type']) => {\r\n        const badges = {\r\n            task: { label: 'Tarefa', color: 'bg-purple-500/20 text-purple-300 border-purple-500/30' },\r\n            goal: { label: 'Meta', color: 'bg-blue-500/20 text-blue-300 border-blue-500/30' },\r\n            theme: { label: 'Tema', color: 'bg-orange-500/20 text-orange-300 border-orange-500/30' },\r\n            subtheme: { label: 'Subtema', color: 'bg-orange-500/20 text-orange-200 border-orange-500/20' }\r\n        };\r\n\r\n        const badge = badges[type];\r\n        return (\r\n            <span className={`px-2 py-0.5 text-xs font-medium rounded-full border ${badge.color}`}>\r\n                {badge.label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[9999] flex items-start justify-center pt-[15vh] px-4\">\r\n            {/* Backdrop */}\r\n            <div\r\n                className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                onClick={onClose}\r\n            />\r\n\r\n            {/* Search Modal */}\r\n            <div className=\"relative w-full max-w-2xl bg-slate-800/95 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl overflow-hidden\">\r\n                {/* Search Input */}\r\n                <div className=\"flex items-center gap-3 p-4 border-b border-slate-700/50\">\r\n                    <Search className=\"w-5 h-5 text-slate-400 flex-shrink-0\" />\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar em tarefas, metas, temas...\"\r\n                        value={query}\r\n                        onChange={(e) => setQuery(e.target.value)}\r\n                        className=\"flex-1 bg-transparent text-white placeholder-slate-500 outline-none text-lg\"\r\n                    />\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-1 hover:bg-slate-700/50 rounded-lg transition-colors\"\r\n                    >\r\n                        <X className=\"w-5 h-5 text-slate-400\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Results */}\r\n                <div className=\"max-h-[60vh] overflow-y-auto custom-scrollbar\">\r\n                    {query.trim().length < 2 ? (\r\n                        <div className=\"p-8 text-center text-slate-500\">\r\n                            <Search className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n                            <p className=\"text-sm\">Digite pelo menos 2 caracteres para buscar</p>\r\n                            <p className=\"text-xs mt-2 opacity-70\">Use ‚Üë‚Üì para navegar, Enter para selecionar</p>\r\n                        </div>\r\n                    ) : results.length === 0 ? (\r\n                        <div className=\"p-8 text-center text-slate-500\">\r\n                            <Search className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n                            <p className=\"text-sm\">Nenhum resultado encontrado</p>\r\n                            <p className=\"text-xs mt-2 opacity-70\">Tente buscar por outro termo</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"p-2\">\r\n                            {results.map((result, index) => (\r\n                                <button\r\n                                    key={result.id}\r\n                                    onClick={() => handleSelectResult(result)}\r\n                                    className={`\r\n                                        w-full flex items-start gap-3 p-3 rounded-xl transition-all text-left\r\n                                        ${index === selectedIndex\r\n                                            ? 'bg-slate-700/50 border border-slate-600/50'\r\n                                            : 'hover:bg-slate-700/30 border border-transparent'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    {/* Icon */}\r\n                                    <div className=\"mt-1\">\r\n                                        {getResultIcon(result.type)}\r\n                                    </div>\r\n\r\n                                    {/* Content */}\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"flex items-center gap-2 mb-1\">\r\n                                            <h3 className=\"text-white font-medium truncate\">\r\n                                                {result.title}\r\n                                            </h3>\r\n                                            {getResultBadge(result.type)}\r\n                                        </div>\r\n\r\n                                        {result.description && (\r\n                                            <p className=\"text-sm text-slate-400 line-clamp-1\">\r\n                                                {result.description}\r\n                                            </p>\r\n                                        )}\r\n\r\n                                        <div className=\"flex items-center gap-2 mt-1 text-xs text-slate-500\">\r\n                                            {result.parentTheme && (\r\n                                                <span>em {result.parentTheme}</span>\r\n                                            )}\r\n                                            {result.category && (\r\n                                                <span className=\"capitalize\">{result.category}</span>\r\n                                            )}\r\n                                            {result.date && (\r\n                                                <span>{new Date(result.date).toLocaleDateString('pt-BR')}</span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Arrow indicator */}\r\n                                    {index === selectedIndex && (\r\n                                        <ArrowRight className=\"w-5 h-5 text-slate-400 flex-shrink-0 mt-1\" />\r\n                                    )}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                {results.length > 0 && (\r\n                    <div className=\"px-4 py-2 border-t border-slate-700/50 flex items-center justify-between text-xs text-slate-500\">\r\n                        <span>{results.length} resultado{results.length !== 1 ? 's' : ''} encontrado{results.length !== 1 ? 's' : ''}</span>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"flex items-center gap-1\">\r\n                                <kbd className=\"px-1.5 py-0.5 bg-slate-700/50 rounded text-slate-400\">‚Üë‚Üì</kbd>\r\n                                Navegar\r\n                            </span>\r\n                            <span className=\"flex items-center gap-1\">\r\n                                <kbd className=\"px-1.5 py-0.5 bg-slate-700/50 rounded text-slate-400\">Enter</kbd>\r\n                                Abrir\r\n                            </span>\r\n                            <span className=\"flex items-center gap-1\">\r\n                                <kbd className=\"px-1.5 py-0.5 bg-slate-700/50 rounded text-slate-400\">Esc</kbd>\r\n                                Fechar\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\InstallPWAHint.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\NotificationPermissionBanner.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\NotificationPermissionBanner.tsx:14:13\n  12 |         const dismissed = localStorage.getItem('notification_banner_dismissed');\n  13 |         if (dismissed || hasPermission || !isSupported) {\n> 14 |             setIsDismissed(true);\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  15 |             return;\n  16 |         }\n  17 |","line":14,"column":13,"nodeType":null,"endLine":14,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Bell, X, Check } from 'lucide-react';\r\nimport { useNotifications } from '../hooks/useNotifications';\r\n\r\nexport const NotificationPermissionBanner: React.FC = () => {\r\n    const { isSupported, hasPermission, requestPermission } = useNotifications();\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [isDismissed, setIsDismissed] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Check if user has already dismissed or granted permission\r\n        const dismissed = localStorage.getItem('notification_banner_dismissed');\r\n        if (dismissed || hasPermission || !isSupported) {\r\n            setIsDismissed(true);\r\n            return;\r\n        }\r\n\r\n        // Show banner after 5 seconds\r\n        const timer = setTimeout(() => {\r\n            setIsVisible(true);\r\n        }, 5000);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [hasPermission, isSupported]);\r\n\r\n    const handleAllow = async () => {\r\n        const granted = await requestPermission();\r\n        if (granted) {\r\n            setIsVisible(false);\r\n            localStorage.setItem('notification_banner_dismissed', 'true');\r\n        }\r\n    };\r\n\r\n    const handleDismiss = () => {\r\n        setIsVisible(false);\r\n        setIsDismissed(true);\r\n        localStorage.setItem('notification_banner_dismissed', 'true');\r\n    };\r\n\r\n    if (!isVisible || isDismissed) return null;\r\n\r\n    return (\r\n        <div className=\"fixed bottom-20 left-1/2 -translate-x-1/2 z-[9998] max-w-md w-full px-4 animate-in slide-in-from-bottom-5 fade-in\">\r\n            <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl shadow-2xl border border-white/20 p-5\">\r\n                <div className=\"flex items-start gap-4\">\r\n                    <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0\">\r\n                        <Bell className=\"w-6 h-6 text-white\" />\r\n                    </div>\r\n\r\n                    <div className=\"flex-1\">\r\n                        <h3 className=\"text-white font-bold text-lg mb-1\">\r\n                            Ative as Notifica√ß√µes! üîî\r\n                        </h3>\r\n                        <p className=\"text-white/90 text-sm mb-4\">\r\n                            Receba lembretes de revis√µes espa√ßadas e nunca perca uma tarefa importante.\r\n                        </p>\r\n\r\n                        <div className=\"flex gap-2\">\r\n                            <button\r\n                                onClick={handleAllow}\r\n                                className=\"bg-white text-blue-600 px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-50 transition-all flex items-center gap-2 shadow-lg\"\r\n                            >\r\n                                <Check className=\"w-4 h-4\" />\r\n                                Permitir\r\n                            </button>\r\n                            <button\r\n                                onClick={handleDismiss}\r\n                                className=\"bg-white/10 text-white px-4 py-2 rounded-lg font-medium text-sm hover:bg-white/20 transition-all\"\r\n                            >\r\n                                Agora N√£o\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={handleDismiss}\r\n                        className=\"text-white/70 hover:text-white transition-colors\"\r\n                    >\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\PWAPrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\SyncStatusWatcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ThemeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\__tests__\\ErrorBoundary.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\__tests__\\LoadingSpinner.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\analytics\\ConsistencyHeatmap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\collaboration\\CollaboratorBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\collaboration\\ShareButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'itemId' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Users } from 'lucide-react';\r\nimport { ShareModal } from './ShareModal';\r\nimport type { Collaborator } from '../../types';\r\n\r\ninterface ShareButtonProps {\r\n    itemId: string;\r\n    itemTitle: string;\r\n    itemType: 'theme' | 'project';\r\n    collaborators?: Collaborator[];\r\n    onAddCollaborator?: (email: string, role: Collaborator['role']) => void;\r\n    onRemoveCollaborator?: (userId: string) => void;\r\n}\r\n\r\nexport const ShareButton: React.FC<ShareButtonProps> = ({\r\n    itemId,\r\n    itemTitle,\r\n    itemType,\r\n    collaborators = [],\r\n    onAddCollaborator,\r\n    onRemoveCollaborator,\r\n}) => {\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n    return (\r\n        <>\r\n            <button\r\n                onClick={() => setIsModalOpen(true)}\r\n                className=\"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all text-sm\"\r\n                title=\"Compartilhar\"\r\n            >\r\n                <Users className=\"w-4 h-4\" />\r\n                {collaborators.length > 0 && (\r\n                    <span className=\"text-xs\">{collaborators.length}</span>\r\n                )}\r\n            </button>\r\n\r\n            <ShareModal\r\n                isOpen={isModalOpen}\r\n                onClose={() => setIsModalOpen(false)}\r\n                itemTitle={itemTitle}\r\n                itemType={itemType}\r\n                collaborators={collaborators}\r\n                onAddCollaborator={onAddCollaborator}\r\n                onRemoveCollaborator={onRemoveCollaborator}\r\n            />\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\collaboration\\ShareModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onChangeRole' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Modal } from '../ui/Modal';\r\nimport { X, Mail, UserPlus, Link2, Copy, Check, Shield, Eye, Edit, Crown } from 'lucide-react';\r\nimport type { Collaborator } from '../../types';\r\n\r\ninterface ShareModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    itemTitle: string;\r\n    itemType: 'theme' | 'project';\r\n    collaborators?: Collaborator[];\r\n    onAddCollaborator?: (email: string, role: Collaborator['role']) => void;\r\n    onRemoveCollaborator?: (userId: string) => void;\r\n    onChangeRole?: (userId: string, role: Collaborator['role']) => void;\r\n}\r\n\r\nexport const ShareModal: React.FC<ShareModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    itemTitle,\r\n    itemType,\r\n    collaborators = [],\r\n    onAddCollaborator,\r\n    onRemoveCollaborator,\r\n    onChangeRole,\r\n}) => {\r\n    const [email, setEmail] = useState('');\r\n    const [selectedRole, setSelectedRole] = useState<Collaborator['role']>('viewer');\r\n    const [copied, setCopied] = useState(false);\r\n\r\n    const handleAddCollaborator = () => {\r\n        if (email && onAddCollaborator) {\r\n            onAddCollaborator(email, selectedRole);\r\n            setEmail('');\r\n            setSelectedRole('viewer');\r\n        }\r\n    };\r\n\r\n    const handleCopyLink = () => {\r\n        const shareLink = `${window.location.origin}/share/${itemType}/${Date.now()}`;\r\n        navigator.clipboard.writeText(shareLink);\r\n        setCopied(true);\r\n        setTimeout(() => setCopied(false), 2000);\r\n    };\r\n\r\n    const roleIcons = {\r\n        owner: Crown,\r\n        editor: Edit,\r\n        viewer: Eye,\r\n    };\r\n\r\n    const roleColors = {\r\n        owner: 'text-amber-400',\r\n        editor: 'text-blue-400',\r\n        viewer: 'text-slate-400',\r\n    };\r\n\r\n    const roleLabels = {\r\n        owner: 'Propriet√°rio',\r\n        editor: 'Editor',\r\n        viewer: 'Visualizador',\r\n    };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} maxWidth=\"2xl\">\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-white\">Compartilhar {itemType === 'theme' ? 'Tema' : 'Projeto'}</h2>\r\n                        <p className=\"text-slate-400 text-sm mt-1\">{itemTitle}</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"text-slate-400 hover:text-white transition-colors\"\r\n                    >\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Add Collaborator */}\r\n                <div className=\"mb-6\">\r\n                    <label className=\"block text-sm font-bold text-slate-400 uppercase mb-2\">\r\n                        Convidar Pessoa\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                        <div className=\"relative flex-1\">\r\n                            <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500\" />\r\n                            <input\r\n                                type=\"email\"\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                                placeholder=\"email@exemplo.com\"\r\n                                className=\"w-full bg-slate-900/50 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none\"\r\n                                onKeyPress={(e) => e.key === 'Enter' && handleAddCollaborator()}\r\n                            />\r\n                        </div>\r\n                        <select\r\n                            value={selectedRole}\r\n                            onChange={(e) => setSelectedRole(e.target.value as Collaborator['role'])}\r\n                            className=\"bg-slate-900/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none\"\r\n                        >\r\n                            <option value=\"viewer\">Visualizador</option>\r\n                            <option value=\"editor\">Editor</option>\r\n                        </select>\r\n                        <button\r\n                            onClick={handleAddCollaborator}\r\n                            disabled={!email}\r\n                            className=\"bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-bold transition-all flex items-center gap-2\"\r\n                        >\r\n                            <UserPlus className=\"w-4 h-4\" />\r\n                            Adicionar\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Share Link */}\r\n                <div className=\"mb-6 p-4 bg-slate-900/50 border border-slate-700 rounded-lg\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Link2 className=\"w-4 h-4 text-slate-400\" />\r\n                            <span className=\"text-sm font-bold text-slate-400 uppercase\">Link de Compartilhamento</span>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleCopyLink}\r\n                            className=\"flex items-center gap-2 text-sm text-blue-400 hover:text-blue-300 transition-colors\"\r\n                        >\r\n                            {copied ? (\r\n                                <>\r\n                                    <Check className=\"w-4 h-4\" />\r\n                                    Copiado!\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Copy className=\"w-4 h-4\" />\r\n                                    Copiar\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                        Qualquer pessoa com este link pode visualizar\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Collaborators List */}\r\n                <div>\r\n                    <label className=\"block text-sm font-bold text-slate-400 uppercase mb-3\">\r\n                        Colaboradores ({collaborators.length})\r\n                    </label>\r\n\r\n                    {collaborators.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-slate-500\">\r\n                            <Shield className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\r\n                            <p className=\"text-sm\">Nenhum colaborador ainda</p>\r\n                            <p className=\"text-xs mt-1\">Adicione pessoas para colaborar neste {itemType === 'theme' ? 'tema' : 'projeto'}</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-2 max-h-64 overflow-y-auto custom-scrollbar\">\r\n                            {collaborators.map(collaborator => {\r\n                                const RoleIcon = roleIcons[collaborator.role];\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={collaborator.userId}\r\n                                        className=\"flex items-center justify-between p-3 bg-slate-900/30 border border-slate-700 rounded-lg hover:bg-slate-900/50 transition-colors\"\r\n                                    >\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            {/* Avatar */}\r\n                                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold\">\r\n                                                {collaborator.name.charAt(0).toUpperCase()}\r\n                                            </div>\r\n\r\n                                            {/* Info */}\r\n                                            <div>\r\n                                                <p className=\"text-white font-medium\">{collaborator.name}</p>\r\n                                                <p className=\"text-xs text-slate-500\">{collaborator.email}</p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Role */}\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <RoleIcon className={`w-4 h-4 ${roleColors[collaborator.role]}`} />\r\n                                            <span className=\"text-sm text-slate-400\">{roleLabels[collaborator.role]}</span>\r\n\r\n                                            {collaborator.role !== 'owner' && onRemoveCollaborator && (\r\n                                                <button\r\n                                                    onClick={() => onRemoveCollaborator(collaborator.userId)}\r\n                                                    className=\"ml-2 text-slate-500 hover:text-red-400 transition-colors\"\r\n                                                >\r\n                                                    <X className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Info Footer */}\r\n                <div className=\"mt-6 pt-4 border-t border-white/10\">\r\n                    <div className=\"flex items-start gap-2 text-xs text-slate-500\">\r\n                        <Shield className=\"w-4 h-4 mt-0.5\" />\r\n                        <div>\r\n                            <p><strong>Visualizador:</strong> Pode ver conte√∫do</p>\r\n                            <p><strong>Editor:</strong> Pode editar e adicionar</p>\r\n                            <p><strong>Propriet√°rio:</strong> Controle total</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\ColorPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\DaySelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\DurationStepper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\ImageUpload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\PrioritySelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\SymbolPicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":4,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":29},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\forms\\SymbolPicker.tsx:40:17\n  38 |         if (saved) {\n  39 |             try {\n> 40 |                 setRecentSymbols(JSON.parse(saved));\n     |                 ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  41 |             } catch (e) {\n  42 |                 console.error('Failed to parse recent symbols', e);\n  43 |             }","line":40,"column":17,"nodeType":null,"endLine":40,"endColumn":33}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { Input } from '../ui/Input';\r\nimport { IconRenderer } from '../ui/IconRenderer';\r\nimport { Search, Sparkles, X, ChevronDown } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\n\r\ninterface SymbolPickerProps {\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    placeholder?: string;\r\n    className?: string;\r\n}\r\n\r\nconst POPULAR_ICONS = [\r\n    'Book', 'BookOpen', 'Target', 'CheckSquare', 'Clock', 'Flame', 'Zap', 'Brain',\r\n    'Code', 'GraduationCap', 'Trophy', 'Star', 'Palette', 'Dumbbell', 'Heart',\r\n    'Music', 'Coffee', 'Languages', 'Globe', 'Mountain', 'Stethoscope', 'Wallet',\r\n    'Briefcase', 'Car', 'Plane', 'Map', 'Camera', 'Smartphone', 'Laptop', 'Rocket',\r\n    'Library', 'PenTool', 'Search', 'Bell', 'Calendar', 'Mail', 'MessageCircle',\r\n    'Shield', 'Key', 'Lock', 'User', 'Settings', 'Home', 'Compass'\r\n];\r\n\r\nconst POPULAR_EMOJIS = [\r\n    'üìö', 'üéØ', '‚úÖ', '‚è∞', 'üî•', '‚ö°', 'üß†', 'üíª', 'üéì', 'üèÜ',\r\n    '‚≠ê', 'üé®', 'üí™', '‚ù§Ô∏è', 'üéµ', '‚òï', 'üåç', 'üèîÔ∏è', 'üè•', 'üíº',\r\n    'üöÄ', 'üìù', 'üèÉ', 'üßò', 'üçé', 'üí∞', 'üîë', 'üîí', 'üè†', '‚ú®'\r\n];\r\n\r\nexport const SymbolPicker: React.FC<SymbolPickerProps> = ({ value, onChange, placeholder = '‚ú®', className }) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'icons' | 'emojis' | 'recent'>('icons');\r\n    const [recentSymbols, setRecentSymbols] = useState<string[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem('recent_symbols');\r\n        if (saved) {\r\n            try {\r\n                setRecentSymbols(JSON.parse(saved));\r\n            } catch (e) {\r\n                console.error('Failed to parse recent symbols', e);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n\r\n        if (isOpen) {\r\n            document.addEventListener('mousedown', handleClickOutside);\r\n        }\r\n        return () => {\r\n            document.removeEventListener('mousedown', handleClickOutside);\r\n        };\r\n    }, [isOpen]);\r\n\r\n    const handleSymbolClick = (symbol: string) => {\r\n        onChange(symbol);\r\n        saveRecentSymbol(symbol);\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const saveRecentSymbol = (symbol: string) => {\r\n        if (!symbol.trim()) return;\r\n\r\n        setRecentSymbols(prev => {\r\n            const filtered = prev.filter(e => e !== symbol);\r\n            const updated = [symbol, ...filtered].slice(0, 15);\r\n            localStorage.setItem('recent_symbols', JSON.stringify(updated));\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    const filteredIcons = POPULAR_ICONS.filter(icon =>\r\n        icon.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className={cn(\"relative inline-block w-full\", className)} ref={containerRef}>\r\n            {/* Trigger Button */}\r\n            <button\r\n                type=\"button\"\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className={cn(\r\n                    \"w-full flex items-center justify-between gap-2 px-3 h-10 bg-slate-900/40 hover:bg-slate-800/60 border border-white/10 rounded-xl transition-all group\",\r\n                    isOpen && \"ring-2 ring-blue-500/30 border-blue-500/50\"\r\n                )}\r\n            >\r\n                <div className=\"flex items-center gap-2 overflow-hidden\">\r\n                    <div className=\"w-6 h-6 flex-shrink-0 flex items-center justify-center bg-slate-950/50 rounded-lg group-hover:scale-110 transition-transform\">\r\n                        <IconRenderer icon={value} size={16} className=\"text-blue-400\" />\r\n                    </div>\r\n                    <span className=\"text-xs text-slate-400 truncate font-medium\">\r\n                        {value || placeholder || \"Escolher...\"}\r\n                    </span>\r\n                </div>\r\n                <ChevronDown className={cn(\"w-3.5 h-3.5 text-slate-500 transition-transform\", isOpen && \"rotate-180\")} />\r\n            </button>\r\n\r\n            {/* Popover Picker */}\r\n            {isOpen && (\r\n                <div className=\"absolute left-0 bottom-full mb-2 w-[280px] bg-slate-900 border border-white/10 rounded-2xl shadow-2xl z-[100] animate-in fade-in zoom-in-95 duration-200 origin-bottom-left overflow-hidden\">\r\n                    <div className=\"p-3 space-y-3 bg-slate-950/20\">\r\n                        {/* Search & Custom Input */}\r\n                        <div className=\"relative group p-1\">\r\n                            <Input\r\n                                value={value}\r\n                                onChange={e => onChange(e.target.value)}\r\n                                className=\"text-center h-10 bg-slate-950 border-white/10 text-lg focus:border-blue-500/50\"\r\n                                placeholder={placeholder}\r\n                            />\r\n                            <div className=\"absolute inset-y-0 left-4 flex items-center pointer-events-none opacity-50\">\r\n                                <IconRenderer icon={value} size={18} className=\"text-blue-400\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Tabs */}\r\n                        <div className=\"flex bg-slate-950/50 p-1 rounded-xl border border-white/5\">\r\n                            {[\r\n                                { id: 'icons', label: '√çcones', icon: Sparkles },\r\n                                { id: 'emojis', label: 'Emojis', icon: Sparkles },\r\n                                { id: 'recent', label: 'Recentes', icon: Search }\r\n                            ].map(tab => (\r\n                                <button\r\n                                    key={tab.id}\r\n                                    type=\"button\"\r\n                                    onClick={() => setActiveTab(tab.id as any)}\r\n                                    className={cn(\r\n                                        \"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all\",\r\n                                        activeTab === tab.id\r\n                                            ? \"bg-blue-600 text-white shadow-lg\"\r\n                                            : \"text-slate-500 hover:text-slate-300\"\r\n                                    )}\r\n                                >\r\n                                    {tab.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Content area */}\r\n                        <div className=\"min-h-[160px]\">\r\n                            {activeTab === 'icons' && (\r\n                                <div className=\"space-y-3 animate-in fade-in duration-300\">\r\n                                    <div className=\"relative mx-1\">\r\n                                        <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-500\" />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"Buscar √≠cone...\"\r\n                                            value={searchQuery}\r\n                                            onChange={e => setSearchQuery(e.target.value)}\r\n                                            className=\"w-full bg-slate-950/80 border border-white/5 rounded-lg pl-8 pr-3 py-2 text-[11px] text-white outline-none focus:border-blue-500/30 transition-all\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-6 gap-2 max-h-[160px] overflow-y-auto px-1 custom-scrollbar\">\r\n                                        {filteredIcons.map(iconName => (\r\n                                            <button\r\n                                                key={iconName}\r\n                                                type=\"button\"\r\n                                                onClick={() => handleSymbolClick(iconName)}\r\n                                                className={cn(\r\n                                                    \"aspect-square flex items-center justify-center rounded-lg border transition-all\",\r\n                                                    value === iconName\r\n                                                        ? \"bg-blue-600 border-blue-400 text-white\"\r\n                                                        : \"bg-slate-800/40 border-white/5 text-slate-400 hover:bg-slate-700 hover:text-white\"\r\n                                                )}\r\n                                                title={iconName}\r\n                                            >\r\n                                                <IconRenderer icon={iconName} size={18} />\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeTab === 'emojis' && (\r\n                                <div className=\"grid grid-cols-6 gap-2 max-h-[160px] overflow-y-auto px-1 animate-in fade-in duration-300 custom-scrollbar\">\r\n                                    {POPULAR_EMOJIS.map(emoji => (\r\n                                        <button\r\n                                            key={emoji}\r\n                                            type=\"button\"\r\n                                            onClick={() => handleSymbolClick(emoji)}\r\n                                            className={cn(\r\n                                                \"aspect-square flex items-center justify-center rounded-lg border text-xl transition-all\",\r\n                                                value === emoji\r\n                                                    ? \"bg-blue-600 border-blue-400\"\r\n                                                    : \"bg-slate-800/40 border-white/5 hover:bg-slate-700\"\r\n                                            )}\r\n                                        >\r\n                                            {emoji}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeTab === 'recent' && (\r\n                                <div className=\"animate-in fade-in duration-300 px-1\">\r\n                                    {recentSymbols.length > 0 ? (\r\n                                        <div className=\"grid grid-cols-6 gap-2\">\r\n                                            {recentSymbols.map((symbol, idx) => (\r\n                                                <button\r\n                                                    key={`${symbol}-${idx}`}\r\n                                                    type=\"button\"\r\n                                                    onClick={() => handleSymbolClick(symbol)}\r\n                                                    className={cn(\r\n                                                        \"aspect-square flex items-center justify-center rounded-lg border transition-all\",\r\n                                                        value === symbol\r\n                                                            ? \"bg-blue-600 border-blue-400 text-white\"\r\n                                                            : \"bg-slate-800/40 border-white/5 text-slate-400 hover:bg-slate-700 hover:text-white\"\r\n                                                    )}\r\n                                                >\r\n                                                    <IconRenderer icon={symbol} size={symbol.length > 4 ? 18 : 22} />\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"py-8 text-center\">\r\n                                            <p className=\"text-[10px] text-slate-500 font-bold uppercase tracking-wider\">Nenhum s√≠mbolo recente</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\gamification\\AchievementModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\gamification\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\gamification\\LevelBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\gamification\\XPBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\layout\\GlobalActionBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\layout\\LayoutModals.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\layout\\MobileBottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\onboarding\\OnboardingTour.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\onboarding\\OnboardingTour.tsx:26:17\n  24 |             if (element) {\n  25 |                 const rect = element.getBoundingClientRect();\n> 26 |                 setTargetRect(rect);\n     |                 ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  27 |                 // Scroll into view\n  28 |                 element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n  29 |             } else {","line":26,"column":17,"nodeType":null,"endLine":26,"endColumn":30},{"ruleId":"prefer-const","severity":2,"message":"'style' is never reassigned. Use 'const' instead.","line":58,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":58,"endColumn":39,"fix":{"range":[1856,1962],"text":"const style: React.CSSProperties = {\r\n            position: 'fixed',\r\n            zIndex: 10001,\r\n        };"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { X, ArrowRight, ArrowLeft, CheckCircle } from 'lucide-react';\r\nimport { useOnboarding } from '../../hooks/useOnboarding';\r\n\r\nexport const OnboardingTour: React.FC = () => {\r\n    const {\r\n        isActive,\r\n        currentStep,\r\n        totalSteps,\r\n        currentStepData,\r\n        nextStep,\r\n        prevStep,\r\n        skipOnboarding,\r\n        completeOnboarding,\r\n        progress,\r\n    } = useOnboarding();\r\n\r\n    const [targetRect, setTargetRect] = useState<DOMRect | null>(null);\r\n\r\n    // Update target element position when step changes\r\n    useEffect(() => {\r\n        if (currentStepData?.target) {\r\n            const element = document.querySelector(currentStepData.target);\r\n            if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                setTargetRect(rect);\r\n                // Scroll into view\r\n                element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            } else {\r\n                setTargetRect(null);\r\n            }\r\n        } else {\r\n            setTargetRect(null);\r\n        }\r\n    }, [currentStepData]);\r\n\r\n    if (!isActive) return null;\r\n\r\n    const isFirstStep = currentStep === 0;\r\n    const isLastStep = currentStep === totalSteps - 1;\r\n    const isCenterPlacement = currentStepData?.placement === 'center';\r\n\r\n    // Position calculation for tooltip\r\n    const getTooltipStyle = (): React.CSSProperties => {\r\n        if (isCenterPlacement || !targetRect) {\r\n            return {\r\n                position: 'fixed',\r\n                top: '50%',\r\n                left: '50%',\r\n                transform: 'translate(-50%, -50%)',\r\n                zIndex: 10001,\r\n            };\r\n        }\r\n\r\n        const placement = currentStepData?.placement || 'bottom';\r\n        const offset = 20;\r\n\r\n        let style: React.CSSProperties = {\r\n            position: 'fixed',\r\n            zIndex: 10001,\r\n        };\r\n\r\n        switch (placement) {\r\n            case 'top':\r\n                style.left = targetRect.left + targetRect.width / 2;\r\n                style.top = targetRect.top - offset;\r\n                style.transform = 'translate(-50%, -100%)';\r\n                break;\r\n            case 'bottom':\r\n                style.left = targetRect.left + targetRect.width / 2;\r\n                style.top = targetRect.bottom + offset;\r\n                style.transform = 'translateX(-50%)';\r\n                break;\r\n            case 'left':\r\n                style.left = targetRect.left - offset;\r\n                style.top = targetRect.top + targetRect.height / 2;\r\n                style.transform = 'translate(-100%, -50%)';\r\n                break;\r\n            case 'right':\r\n                style.left = targetRect.right + offset;\r\n                style.top = targetRect.top + targetRect.height / 2;\r\n                style.transform = 'translateY(-50%)';\r\n                break;\r\n        }\r\n\r\n        return style;\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {/* Overlay */}\r\n            <div className=\"fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-[10000] animate-in fade-in duration-300\">\r\n                {/* Spotlight effect */}\r\n                {targetRect && !isCenterPlacement && (\r\n                    <div\r\n                        className=\"absolute border-4 border-blue-500 rounded-2xl animate-pulse\"\r\n                        style={{\r\n                            left: targetRect.left - 8,\r\n                            top: targetRect.top - 8,\r\n                            width: targetRect.width + 16,\r\n                            height: targetRect.height + 16,\r\n                            boxShadow: '0 0 0 4000px rgba(2, 6, 23, 0.8)',\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {/* Tooltip Card */}\r\n            <div\r\n                className=\"max-w-md w-full bg-gradient-to-br from-slate-900 to-slate-800 border-2 border-blue-500 rounded-2xl shadow-2xl p-6 animate-in zoom-in-95 duration-300\"\r\n                style={getTooltipStyle()}\r\n            >\r\n                {/* Header */}\r\n                <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                            <span className=\"text-xs font-bold text-blue-400 uppercase tracking-wider\">\r\n                                Passo {currentStep + 1} de {totalSteps}\r\n                            </span>\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white\">\r\n                            {currentStepData?.title}\r\n                        </h3>\r\n                    </div>\r\n                    <button\r\n                        onClick={skipOnboarding}\r\n                        className=\"text-slate-400 hover:text-white transition-colors ml-2\"\r\n                        title=\"Pular tutorial\"\r\n                    >\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <p className=\"text-slate-300 mb-6 leading-relaxed\">\r\n                    {currentStepData?.description}\r\n                </p>\r\n\r\n                {/* Progress Bar */}\r\n                <div className=\"mb-6\">\r\n                    <div className=\"h-1.5 bg-slate-700 rounded-full overflow-hidden\">\r\n                        <div\r\n                            className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500\"\r\n                            style={{ width: `${progress}%` }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex items-center justify-between gap-3\">\r\n                    {!isFirstStep && (\r\n                        <button\r\n                            onClick={prevStep}\r\n                            className=\"flex items-center gap-2 px-4 py-2 rounded-lg text-slate-400 hover:text-white hover:bg-slate-700 transition-all\"\r\n                        >\r\n                            <ArrowLeft className=\"w-4 h-4\" />\r\n                            Voltar\r\n                        </button>\r\n                    )}\r\n\r\n                    {isFirstStep && (\r\n                        <button\r\n                            onClick={skipOnboarding}\r\n                            className=\"px-4 py-2 rounded-lg text-slate-400 hover:text-white transition-all\"\r\n                        >\r\n                            Pular Tutorial\r\n                        </button>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={isLastStep ? completeOnboarding : nextStep}\r\n                        className=\"ml-auto bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-2 shadow-lg shadow-blue-500/20\"\r\n                    >\r\n                        {isLastStep ? (\r\n                            <>\r\n                                Finalizar\r\n                                <CheckCircle className=\"w-4 h-4\" />\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                Pr√≥ximo\r\n                                <ArrowRight className=\"w-4 h-4\" />\r\n                            </>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\settings\\BackupSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isImporting' is assigned a value but never used.","line":16,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { Save, Upload, FileCheck, AlertTriangle, X } from 'lucide-react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { Card } from '../ui/Card';\r\nimport { exportToJSON, validateBackupData, readJSONFile, formatFileSize, type BackupData } from '../../utils/exportData';\r\nimport { useToast } from '../../context/ToastContext';\r\n\r\nexport const BackupSection: React.FC = () => {\r\n    const { themes, tasks, goals, gamification, zenMode } = useStudy();\r\n    const { profile } = useAuth();\r\n    const { settings } = usePomodoroContext();\r\n    const { showToast } = useToast();\r\n\r\n    const [isImporting, setIsImporting] = useState(false);\r\n    const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n    const [previewData, setPreviewData] = useState<BackupData | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleExport = () => {\r\n        const data: BackupData = {\r\n            timestamp: new Date().toISOString(),\r\n            profile,\r\n            settings,\r\n            themes,\r\n            tasks,\r\n            goals,\r\n            gamification,\r\n            zenMode\r\n        };\r\n\r\n        exportToJSON(data);\r\n        showToast('Backup baixado com sucesso!', 'success');\r\n    };\r\n\r\n    const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setSelectedFile(file);\r\n\r\n        try {\r\n            const data = await readJSONFile(file);\r\n            const validation = validateBackupData(data);\r\n\r\n            if (!validation.valid) {\r\n                showToast(validation.error || 'Arquivo inv√°lido', 'error');\r\n                setSelectedFile(null);\r\n                setPreviewData(null);\r\n                return;\r\n            }\r\n\r\n            setPreviewData(data);\r\n        } catch (error: any) {\r\n            showToast(error.message || 'Erro ao ler o arquivo', 'error');\r\n            setSelectedFile(null);\r\n            setPreviewData(null);\r\n        }\r\n    };\r\n\r\n    const handleImport = () => {\r\n        if (!previewData) return;\r\n\r\n        // TODO: Implement actual import logic\r\n        // This would need to be integrated with the StudyProvider\r\n        // to restore all the data\r\n        console.log('Importing data:', previewData);\r\n\r\n        showToast('‚ö†Ô∏è Funcionalidade em desenvolvimento', 'warning');\r\n\r\n        // Reset\r\n        setSelectedFile(null);\r\n        setPreviewData(null);\r\n        setIsImporting(false);\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        setSelectedFile(null);\r\n        setPreviewData(null);\r\n        setIsImporting(false);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Export Card */}\r\n            <Card className=\"bg-slate-900/50 border-slate-800\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"font-bold text-slate-200 flex items-center gap-2\">\r\n                            <Save className=\"w-5 h-5 text-emerald-400\" />\r\n                            Exportar Dados (JSON)\r\n                        </h3>\r\n                        <p className=\"text-xs text-slate-500 mt-1\">\r\n                            Baixe uma c√≥pia completa dos seus temas, tarefas e progresso.\r\n                        </p>\r\n                        <div className=\"flex items-center gap-4 mt-2 text-xs text-slate-600\">\r\n                            <span>üì¶ {themes.length} temas</span>\r\n                            <span>‚úì {tasks.length} tarefas</span>\r\n                            <span>üéØ {goals.length} metas</span>\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleExport}\r\n                        className=\"bg-emerald-950 hover:bg-emerald-900 text-emerald-400 border border-emerald-800 px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 shadow-lg shadow-emerald-900/20\"\r\n                    >\r\n                        <Save className=\"w-4 h-4\" />\r\n                        Baixar Backup\r\n                    </button>\r\n                </div>\r\n            </Card>\r\n\r\n            {/* Import Card */}\r\n            <Card className=\"bg-slate-900/50 border-slate-800\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex-1\">\r\n                        <h3 className=\"font-bold text-slate-200 flex items-center gap-2\">\r\n                            <Upload className=\"w-5 h-5 text-blue-400\" />\r\n                            Importar Backup\r\n                        </h3>\r\n                        <p className=\"text-xs text-slate-500 mt-1\">\r\n                            Restaure seus dados a partir de um arquivo de backup.\r\n                        </p>\r\n                    </div>\r\n                    <div>\r\n                        <input\r\n                            ref={fileInputRef}\r\n                            type=\"file\"\r\n                            accept=\".json\"\r\n                            onChange={handleFileSelect}\r\n                            className=\"hidden\"\r\n                            id=\"backup-file-input\"\r\n                        />\r\n                        <label\r\n                            htmlFor=\"backup-file-input\"\r\n                            className=\"bg-blue-950 hover:bg-blue-900 text-blue-400 border border-blue-800 px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 cursor-pointer shadow-lg shadow-blue-900/20\"\r\n                        >\r\n                            <Upload className=\"w-4 h-4\" />\r\n                            Selecionar Arquivo\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* File Preview */}\r\n                {selectedFile && previewData && (\r\n                    <div className=\"mt-4 p-4 bg-slate-950/50 border border-blue-500/30 rounded-lg\">\r\n                        <div className=\"flex items-start justify-between mb-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <FileCheck className=\"w-5 h-5 text-blue-400\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-bold text-blue-300\">{selectedFile.name}</p>\r\n                                    <p className=\"text-xs text-slate-500\">{formatFileSize(selectedFile.size)}</p>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={handleCancel}\r\n                                className=\"text-slate-500 hover:text-slate-300 transition-colors\"\r\n                            >\r\n                                <X className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4\">\r\n                            <div className=\"bg-slate-900/50 p-2 rounded-lg\">\r\n                                <p className=\"text-xs text-slate-500\">Temas</p>\r\n                                <p className=\"text-lg font-bold text-orange-400\">{previewData.themes.length}</p>\r\n                            </div>\r\n                            <div className=\"bg-slate-900/50 p-2 rounded-lg\">\r\n                                <p className=\"text-xs text-slate-500\">Tarefas</p>\r\n                                <p className=\"text-lg font-bold text-purple-400\">{previewData.tasks.length}</p>\r\n                            </div>\r\n                            <div className=\"bg-slate-900/50 p-2 rounded-lg\">\r\n                                <p className=\"text-xs text-slate-500\">Metas</p>\r\n                                <p className=\"text-lg font-bold text-blue-400\">{previewData.goals.length}</p>\r\n                            </div>\r\n                            <div className=\"bg-slate-900/50 p-2 rounded-lg\">\r\n                                <p className=\"text-xs text-slate-500\">Backup de</p>\r\n                                <p className=\"text-xs font-bold text-slate-300\">\r\n                                    {new Date(previewData.timestamp).toLocaleDateString('pt-BR')}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-amber-950/30 border border-amber-800/50 rounded-lg p-3 mb-3\">\r\n                            <div className=\"flex items-start gap-2\">\r\n                                <AlertTriangle className=\"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5\" />\r\n                                <p className=\"text-xs text-amber-200\">\r\n                                    <span className=\"font-bold\">Aten√ß√£o:</span> Importar substituir√° todos os seus dados atuais.\r\n                                    Recomendamos fazer um backup antes.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-2\">\r\n                            <button\r\n                                onClick={handleCancel}\r\n                                className=\"px-4 py-2 rounded-lg text-slate-400 hover:text-slate-200 font-medium text-sm transition-colors\"\r\n                            >\r\n                                Cancelar\r\n                            </button>\r\n                            <button\r\n                                onClick={handleImport}\r\n                                className=\"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 shadow-lg shadow-blue-500/20\"\r\n                            >\r\n                                <Upload className=\"w-4 h-4\" />\r\n                                Restaurar Backup\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Card>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\templates\\TemplateCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\templates\\TemplateGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\timeline\\Timeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\timeline\\TimelineItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\timeline\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\AnimatedContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\CommandPalette.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\ConfirmationModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'createContext' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":30},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\ConfirmationModal.tsx:31:9\n  29 |\n  30 |     useEffect(() => {\n> 31 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |         if (isOpen) {\n  33 |             document.body.style.overflow = 'hidden';\n  34 |         } else {","line":31,"column":9,"nodeType":null,"endLine":31,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useState, useEffect } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AlertTriangle, X } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ConfirmationModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onConfirm: () => void;\r\n    title: string;\r\n    description: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    type?: 'danger' | 'warning' | 'info';\r\n}\r\n\r\nexport const ConfirmationModal: React.FC<ConfirmationModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    onConfirm,\r\n    title,\r\n    description,\r\n    confirmText = 'Confirmar',\r\n    cancelText = 'Cancelar',\r\n    type = 'danger'\r\n}) => {\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        if (isOpen) {\r\n            document.body.style.overflow = 'hidden';\r\n        } else {\r\n            document.body.style.overflow = 'unset';\r\n        }\r\n        return () => {\r\n            document.body.style.overflow = 'unset';\r\n        };\r\n    }, [isOpen]);\r\n\r\n    if (!mounted) return null;\r\n\r\n    const colorStyles = {\r\n        danger: {\r\n            icon: 'text-red-500',\r\n            bgIcon: 'bg-red-500/10',\r\n            border: 'border-red-500/20',\r\n            button: 'bg-red-600 hover:bg-red-700',\r\n            buttonRing: 'focus:ring-red-500'\r\n        },\r\n        warning: {\r\n            icon: 'text-amber-500',\r\n            bgIcon: 'bg-amber-500/10',\r\n            border: 'border-amber-500/20',\r\n            button: 'bg-amber-600 hover:bg-amber-700',\r\n            buttonRing: 'focus:ring-amber-500'\r\n        },\r\n        info: {\r\n            icon: 'text-blue-500',\r\n            bgIcon: 'bg-blue-500/10',\r\n            border: 'border-blue-500/20',\r\n            button: 'bg-blue-600 hover:bg-blue-700',\r\n            buttonRing: 'focus:ring-blue-500'\r\n        }\r\n    }[type];\r\n\r\n    return createPortal(\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                    {/* Backdrop */}\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={onClose}\r\n                        className=\"absolute inset-0 bg-slate-950/80 backdrop-blur-sm\"\r\n                    />\r\n\r\n                    {/* Modal Content */}\r\n                    <motion.div\r\n                        initial={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                        animate={{ scale: 1, opacity: 1, y: 0 }}\r\n                        exit={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                        transition={{ type: \"spring\", duration: 0.3 }}\r\n                        className={cn(\r\n                            \"relative w-full max-w-sm bg-slate-900 border rounded-2xl shadow-2xl p-6 overflow-hidden\",\r\n                            colorStyles.border\r\n                        )}\r\n                    >\r\n                        {/* Noise Texture */}\r\n                        <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5 mix-blend-overlay pointer-events-none\" />\r\n\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"flex items-start gap-4\">\r\n                                <div className={cn(\"p-3 rounded-full flex-shrink-0\", colorStyles.bgIcon)}>\r\n                                    <AlertTriangle className={cn(\"w-6 h-6\", colorStyles.icon)} />\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                    <h3 className=\"text-lg font-bold text-white leading-none mb-2 pt-1\">{title}</h3>\r\n                                    <p className=\"text-sm text-slate-400 leading-relaxed\">{description}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-6 flex items-center justify-end gap-3\">\r\n                                <button\r\n                                    onClick={onClose}\r\n                                    className=\"px-4 py-2 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                >\r\n                                    {cancelText}\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        onConfirm();\r\n                                        onClose();\r\n                                    }}\r\n                                    className={cn(\r\n                                        \"px-4 py-2 rounded-xl text-sm font-bold text-white shadow-lg transition-all transform active:scale-95\",\r\n                                        colorStyles.button\r\n                                    )}\r\n                                >\r\n                                    {confirmText}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Close X */}\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors\"\r\n                        >\r\n                            <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                    </motion.div>\r\n                </div>\r\n            )}\r\n        </AnimatePresence>,\r\n        document.body\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\DatePicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\IconRenderer.tsx","messages":[{"ruleId":"no-control-regex","severity":2,"message":"Unexpected control character(s) in regular expression: \\x00.","line":53,"column":49,"nodeType":"Literal","messageId":"unexpected","endLine":53,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport * as LucideIcons from 'lucide-react';\r\nimport type { LucideProps } from 'lucide-react';\r\n\r\ninterface IconRendererProps extends LucideProps {\r\n    icon?: string;\r\n    fallback?: React.ReactNode;\r\n}\r\n\r\nexport const IconRenderer: React.FC<IconRendererProps> = ({ icon, fallback, ...props }) => {\r\n    if (!icon) return fallback || null;\r\n\r\n    // Safety check: if icon is not a string, it might be a React element or other renderable type\r\n    if (typeof icon !== 'string') {\r\n        return (icon as any) || fallback || null;\r\n    }\r\n\r\n    // Type casting to access Lucide icons by string name\r\n    const Icons = LucideIcons as any;\r\n\r\n    // Try to find the icon: check direct export, then check if it's under 'icons' or 'default'\r\n    let LucideIcon = Icons[icon];\r\n\r\n    // Some versions or build setups might put them under .icons or .default\r\n    if (!LucideIcon && Icons.icons) LucideIcon = Icons.icons[icon];\r\n    if (!LucideIcon && Icons.default && Icons.default[icon]) LucideIcon = Icons.default[icon];\r\n\r\n    if (LucideIcon && (typeof LucideIcon === 'function' || typeof LucideIcon === 'object')) {\r\n        return <LucideIcon {...props} />;\r\n    }\r\n\r\n    // Check if it's an image URL\r\n    const isImageUrl = icon.startsWith('http') || icon.startsWith('/');\r\n\r\n    if (isImageUrl) {\r\n        return (\r\n            <img\r\n                src={icon}\r\n                alt=\"icon\"\r\n                className={props.className}\r\n                style={{\r\n                    width: props.size || 24,\r\n                    height: props.size || 24,\r\n                    objectFit: 'cover',\r\n                    borderRadius: '4px'\r\n                }}\r\n            />\r\n        );\r\n    }\r\n\r\n    // Heuristic: If it's a short string (1-3 chars), it's likely an emoji\r\n    // Or if it contains non-ASCII characters\r\n    const isProbablyEmoji = icon.length <= 4 || /[^\\x00-\\x7F]/.test(icon);\r\n\r\n    if (isProbablyEmoji) {\r\n        return (\r\n            <span\r\n                className={props.className}\r\n                style={{\r\n                    fontSize: props.size || '1.5em',\r\n                    lineHeight: 1,\r\n                    display: 'inline-flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center'\r\n                }}\r\n            >\r\n                {icon}\r\n            </span>\r\n        );\r\n    }\r\n\r\n    // Default fallback if icon name not found and not an emoji\r\n    return fallback || <span className={props.className}>{icon}</span>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\OfflineIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle2' is defined but never used.","line":2,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":48},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\OfflineIndicator.tsx:42:13\n  40 |             return () => clearTimeout(timer);\n  41 |         } else {\n> 42 |             setIsVisible(true);\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |         }\n  44 |     }, [status]);\n  45 |","line":42,"column":13,"nodeType":null,"endLine":42,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Wifi, WifiOff, RefreshCw, CheckCircle2 } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\nimport { SyncQueueService } from '../../services/SyncQueueService';\r\n\r\nexport const OfflineIndicator = () => {\r\n    const [status, setStatus] = useState<'synced' | 'syncing' | 'offline' | 'error'>(SyncQueueService.getStatus());\r\n    const [isVisible, setIsVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Subscribe to sync queue updates\r\n        const unsubscribe = SyncQueueService.subscribe((newStatus) => {\r\n            setStatus(newStatus);\r\n        });\r\n\r\n        // Also listen to online/offline events globally\r\n        const handleOnline = () => {\r\n            // Let SyncQueue handle the logic, but trigger update\r\n            setStatus(SyncQueueService.getStatus());\r\n        };\r\n        const handleOffline = () => {\r\n            // Immediate feedback\r\n            setStatus('offline');\r\n        };\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        return () => {\r\n            unsubscribe();\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (status === 'synced') {\r\n            // Show \"Synced\" briefly then hide\r\n            const timer = setTimeout(() => setIsVisible(false), 2000);\r\n            return () => clearTimeout(timer);\r\n        } else {\r\n            setIsVisible(true);\r\n        }\r\n    }, [status]);\r\n\r\n    if (!isVisible && status === 'synced') return null;\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-full font-bold text-xs shadow-2xl transition-all duration-500 transform\",\r\n            isVisible ? \"translate-y-0 opacity-100\" : \"translate-y-10 opacity-0\",\r\n            status === 'offline' && \"bg-slate-900 border border-red-500/20 text-red-400\",\r\n            status === 'syncing' && \"bg-slate-900 border border-blue-500/20 text-blue-400\",\r\n            status === 'synced' && \"bg-slate-900 border border-emerald-500/20 text-emerald-400\",\r\n            status === 'error' && \"bg-red-500 text-white\"\r\n        )}>\r\n            {status === 'offline' && (\r\n                <>\r\n                    <WifiOff className=\"w-3.5 h-3.5\" />\r\n                    <span>OFFLINE - Modo Local</span>\r\n                </>\r\n            )}\r\n            {status === 'syncing' && (\r\n                <>\r\n                    <RefreshCw className=\"w-3.5 h-3.5 animate-spin\" />\r\n                    <span>Sincronizando...</span>\r\n                </>\r\n            )}\r\n            {status === 'synced' && (\r\n                <>\r\n                    <Wifi className=\"w-3.5 h-3.5\" />\r\n                    <span>Online & Sincronizado</span>\r\n                </>\r\n            )}\r\n            {status === 'error' && (\r\n                <>\r\n                    <WifiOff className=\"w-3.5 h-3.5\" />\r\n                    <span>Erro de Sincroniza√ß√£o</span>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\ProgressBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\RichTextEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\SummaryTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\components\\ui\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\config\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\config\\gamification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AppContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AppProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_completed' is assigned a value but never used.","line":92,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { SyncQueueService } from '../services/SyncQueueService';\r\nimport { format } from 'date-fns';\r\nimport { AppContext, type ActiveFocusSession } from './AppContext';\r\n\r\nexport const AppProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    // const { user } = useAuth(); // Removed unused user\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [syncStatus, setSyncStatus] = useState<'synced' | 'syncing' | 'offline' | 'error'>('synced');\r\n\r\n    // Initialize activeFocus from localStorage\r\n    const [activeFocus, setActiveFocus] = useState<ActiveFocusSession | null>(() => {\r\n        try {\r\n            const saved = localStorage.getItem('active_focus_session');\r\n            return saved ? JSON.parse(saved) : null;\r\n        } catch { return null; }\r\n    });\r\n\r\n    // Persist activeFocus changes\r\n    useEffect(() => {\r\n        if (activeFocus) {\r\n            localStorage.setItem('active_focus_session', JSON.stringify(activeFocus));\r\n        } else {\r\n            localStorage.removeItem('active_focus_session');\r\n        }\r\n    }, [activeFocus]);\r\n\r\n    const [activeStudySession, setActiveStudySession] = useState<string | null>(null);\r\n\r\n    // Zen Mode State\r\n    const [zenMode, setZenMode] = useState<boolean>(() => {\r\n        try {\r\n            const saved = localStorage.getItem('zen_mode');\r\n            return saved ? JSON.parse(saved) : false;\r\n        } catch { return false; }\r\n    });\r\n\r\n\r\n\r\n    // Strict Summary Access Logic\r\n    const [unlockedSubthemes] = useState<string[]>(() => {\r\n        const saved = localStorage.getItem('daily_unlocked_subthemes');\r\n        if (saved) {\r\n            try {\r\n                const parsed = JSON.parse(saved);\r\n                if (parsed.date === format(new Date(), 'yyyy-MM-dd')) {\r\n                    return parsed.ids || [];\r\n                }\r\n            } catch (err) { console.error(err); }\r\n        }\r\n        return [];\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('daily_unlocked_subthemes', JSON.stringify({\r\n            date: format(new Date(), 'yyyy-MM-dd'),\r\n            ids: unlockedSubthemes\r\n        }));\r\n    }, [unlockedSubthemes]);\r\n\r\n    // Broadcast Channel for Multi-Tab Sync\r\n    useEffect(() => {\r\n        const channel = new BroadcastChannel('study_sync_channel');\r\n\r\n        channel.onmessage = (event) => {\r\n            const { type, payload } = event.data;\r\n\r\n            if (type === 'FOCUS_UPDATE') {\r\n                console.log('üîÑ Syncing Focus from another tab:', payload);\r\n                // Directly set state, skipping local storage loop if handled there\r\n                setActiveFocus(payload);\r\n            } else if (type === 'ZEN_MODE_UPDATE') {\r\n                console.log('üîÑ Syncing Zen Mode from another tab:', payload);\r\n                setZenMode(payload);\r\n            }\r\n        };\r\n\r\n        return () => channel.close();\r\n    }, []);\r\n\r\n    const startFocus = (id: string, type: 'task' | 'goal' | 'subtheme', title: string, duration: number, reviewNumber?: number, reviewType?: 'review' | 'intro', parentId?: string) => {\r\n        const newSession: ActiveFocusSession = { id, type, title, duration, startTime: Date.now(), reviewNumber, reviewType, parentId };\r\n        setActiveFocus(newSession);\r\n\r\n        // Broadcast\r\n        const channel = new BroadcastChannel('study_sync_channel');\r\n        channel.postMessage({ type: 'FOCUS_UPDATE', payload: newSession });\r\n        channel.close();\r\n    };\r\n\r\n    const endFocus = (_completed: boolean = false, checkId?: string) => {\r\n        setActiveFocus(prev => {\r\n            // Prevent race condition: if we are trying to close a specific session (checkId)\r\n            // but the active session is already different (prev.id !== checkId), \r\n            // then we should NOT clear the current session.\r\n            if (checkId && prev?.id !== checkId) {\r\n                return prev;\r\n            }\r\n\r\n            // Broadcast End\r\n            const channel = new BroadcastChannel('study_sync_channel');\r\n            channel.postMessage({ type: 'FOCUS_UPDATE', payload: null });\r\n            channel.close();\r\n\r\n            return null;\r\n        });\r\n    };\r\n\r\n\r\n\r\n    const toggleZenMode = () => {\r\n        setZenMode(prev => {\r\n            const newValue = !prev;\r\n            localStorage.setItem('zen_mode', JSON.stringify(newValue));\r\n\r\n            // Broadcast Zen Mode\r\n            const channel = new BroadcastChannel('study_sync_channel');\r\n            channel.postMessage({ type: 'ZEN_MODE_UPDATE', payload: newValue });\r\n            channel.close();\r\n\r\n            return newValue;\r\n        });\r\n    };\r\n\r\n    const startStudySession = (subthemeId: string) => {\r\n        setActiveStudySession(subthemeId);\r\n    };\r\n\r\n    const endStudySession = () => {\r\n        setActiveStudySession(null);\r\n    };\r\n\r\n    // Sync status listener\r\n    useEffect(() => {\r\n        SyncQueueService.loadQueue();\r\n\r\n        // Subscribe to real-time sync status\r\n        const unsubscribe = SyncQueueService.subscribe((status) => {\r\n            setSyncStatus(status);\r\n        });\r\n\r\n        // Mock loading finish\r\n        setTimeout(() => setLoading(false), 1000);\r\n\r\n        return () => {\r\n            unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <AppContext.Provider value={{\r\n            activeFocus,\r\n            loading,\r\n            syncStatus,\r\n            startFocus,\r\n            endFocus,\r\n            zenMode,\r\n            toggleZenMode,\r\n            unlockedSubthemes,\r\n            activeStudySession,\r\n            startStudySession,\r\n            endStudySession\r\n        }}>\r\n            {children}\r\n        </AppContext.Provider>\r\n    );\r\n};\r\n\r\n// export const useAppContext = () => {\r\n//     const context = useContext(AppContext);\r\n//     if (!context) throw new Error('useAppContext must be used within AppProvider');\r\n//     return context;\r\n// };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AudioContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AudioProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AuthContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ConfirmContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ConfirmProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\GamificationContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\GamificationProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\GoalContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\GoalProvider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'goalActions'. Either include it or remove the dependency array.","line":92,"column":8,"nodeType":"ArrayExpression","endLine":92,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [goalActions, user]","fix":{"range":[3990,3996],"text":"[goalActions, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { logger } from '../utils/logger';\r\nimport { useAuth } from './AuthContext';\r\nimport { useGamification } from './GamificationContext';\r\nimport { useGoals } from '../hooks/useGoals';\r\nimport type { Goal } from '../types';\r\nimport { supabase } from '../lib/supabase';\r\nimport { GoalContext } from './GoalContext'; // Updated import\r\nimport { filterBlacklisted } from '../utils/deletedItemsBlacklist';\r\n\r\nexport const GoalProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const { user } = useAuth();\r\n    const { gamification, awardXP, updateStats } = useGamification();\r\n\r\n    const goalActions = useGoals({\r\n        user,\r\n        gamification,\r\n        awardXP,\r\n        updateStats\r\n    });\r\n\r\n    // Initial Fetch from Supabase\r\n    useEffect(() => {\r\n        const fetchGoals = async () => {\r\n            if (user) {\r\n                const { data, error } = await supabase\r\n                    .from('goals')\r\n                    .select('*')\r\n                    .eq('user_id', user.id);\r\n\r\n                if (data && !error) {\r\n                    const normalized = data.map(g => ({\r\n                        ...g,\r\n                        createdAt: new Date(g.created_at).getTime(),\r\n                        imageUrl: g.image_url,\r\n                        durationMinutes: g.duration_minutes,\r\n                        timeSpent: g.time_spent || 0,\r\n                        completionHistory: g.completion_history || [],\r\n                        sessions: g.sessions || [],\r\n                        summaries: g.summaries || []\r\n                    }));\r\n\r\n                    // --- ROBUST DELETION PROTECTION ---\r\n                    const pendingDeletes = new Set<string>();\r\n                    try {\r\n                        const queueRaw = localStorage.getItem('sync_queue_v1');\r\n                        if (queueRaw) {\r\n                            const queue = JSON.parse(queueRaw);\r\n                            if (Array.isArray(queue)) {\r\n                                queue.forEach((op: { type: string; table: string; data?: { id?: string } }) => {\r\n                                    if (op.type === 'DELETE' && op.table === 'goals' && op.data?.id) {\r\n                                        pendingDeletes.add(op.data.id);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        logger.error(\"Error reading sync queue for goal protection\", e);\r\n                    }\r\n\r\n                    // üö´ NUCLEAR PROTECTION: Filter permanent blacklist\r\n                    const nonBlacklisted = filterBlacklisted(normalized, 'goal');\r\n                    // ----------------------------------\r\n\r\n                    goalActions.setGoals(prevGoals => {\r\n                        const finalGoals: Goal[] = [];\r\n                        const processedIds = new Set<string>();\r\n\r\n                        // 1. Add/Update from Server (filtered)\r\n                        nonBlacklisted.forEach(serverGoal => {\r\n                            if (pendingDeletes.has(serverGoal.id)) {\r\n                                logger.info(`üõ°Ô∏è Blocked zombie goal resurrecion: ${serverGoal.id}`);\r\n                                return;\r\n                            }\r\n                            finalGoals.push(serverGoal);\r\n                            processedIds.add(serverGoal.id);\r\n                        });\r\n\r\n                        // 2. Preserve Local-Only (Optimistic)\r\n                        prevGoals.forEach(localGoal => {\r\n                            if (!processedIds.has(localGoal.id)) {\r\n                                finalGoals.push(localGoal);\r\n                            }\r\n                        });\r\n\r\n                        return finalGoals;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        fetchGoals();\r\n    }, [user]); // Fixed: removed goalActions to prevent infinite loop\r\n\r\n\r\n    return (\r\n        <GoalContext.Provider value={goalActions}>\r\n            {children}\r\n        </GoalContext.Provider>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\PomodoroContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\PomodoroProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ProjectProvider.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":20,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":20,"endColumn":31},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ProjectProvider.tsx:36:17\n  34 |         if (stored) {\n  35 |             try {\n> 36 |                 setProjects(JSON.parse(stored));\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  37 |             } catch (error) {\n  38 |                 console.error('Error loading projects:', error);\n  39 |             }","line":36,"column":17,"nodeType":null,"endLine":36,"endColumn":28}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\nimport type { Project, ProjectMilestone } from '../types';\r\n\r\ninterface ProjectContextType {\r\n    projects: Project[];\r\n    addProject: (project: Omit<Project, 'id' | 'createdAt' | 'progress' | 'milestones'>) => void;\r\n    updateProject: (id: string, updates: Partial<Project>) => void;\r\n    deleteProject: (id: string) => void;\r\n    addMilestone: (projectId: string, milestone: Omit<ProjectMilestone, 'id' | 'projectId' | 'createdAt'>) => void;\r\n    toggleMilestone: (projectId: string, milestoneId: string) => void;\r\n    deleteMilestone: (projectId: string, milestoneId: string) => void;\r\n    linkTask: (projectId: string, taskId: string) => void;\r\n    unlinkTask: (projectId: string, taskId: string) => void;\r\n    linkGoal: (projectId: string, goalId: string) => void;\r\n    unlinkGoal: (projectId: string, goalId: string) => void;\r\n}\r\n\r\nconst ProjectContext = createContext<ProjectContextType | undefined>(undefined);\r\n\r\nexport const useProjectContext = () => {\r\n    const context = useContext(ProjectContext);\r\n    if (!context) {\r\n        throw new Error('useProjectContext must be used within ProjectProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const ProjectProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [projects, setProjects] = useState<Project[]>([]);\r\n\r\n    // Load from localStorage\r\n    useEffect(() => {\r\n        const stored = localStorage.getItem('study_projects');\r\n        if (stored) {\r\n            try {\r\n                setProjects(JSON.parse(stored));\r\n            } catch (error) {\r\n                console.error('Error loading projects:', error);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // Save to localStorage\r\n    useEffect(() => {\r\n        localStorage.setItem('study_projects', JSON.stringify(projects));\r\n    }, [projects]);\r\n\r\n    // Calculate progress based on milestones\r\n    const calculateProgress = (milestones: ProjectMilestone[]): number => {\r\n        if (milestones.length === 0) return 0;\r\n        const completed = milestones.filter(m => m.completed).length;\r\n        return Math.round((completed / milestones.length) * 100);\r\n    };\r\n\r\n    const addProject = useCallback((projectData: Omit<Project, 'id' | 'createdAt' | 'progress' | 'milestones'>) => {\r\n        const newProject: Project = {\r\n            ...projectData,\r\n            id: `project-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n            createdAt: Date.now(),\r\n            progress: 0,\r\n            milestones: [],\r\n            linkedTaskIds: projectData.linkedTaskIds || [],\r\n            linkedGoalIds: projectData.linkedGoalIds || [],\r\n        };\r\n        setProjects(prev => [...prev, newProject]);\r\n    }, []);\r\n\r\n    const updateProject = useCallback((id: string, updates: Partial<Project>) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== id) return project;\r\n\r\n            const updated = { ...project, ...updates };\r\n            // Recalculate progress if milestones changed\r\n            if (updates.milestones) {\r\n                updated.progress = calculateProgress(updates.milestones);\r\n            }\r\n            return updated;\r\n        }));\r\n    }, []);\r\n\r\n    const deleteProject = useCallback((id: string) => {\r\n        setProjects(prev => prev.filter(p => p.id !== id));\r\n    }, []);\r\n\r\n    const addMilestone = useCallback((projectId: string, milestoneData: Omit<ProjectMilestone, 'id' | 'projectId' | 'createdAt'>) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n\r\n            const newMilestone: ProjectMilestone = {\r\n                ...milestoneData,\r\n                id: `milestone-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n                projectId,\r\n                createdAt: Date.now(),\r\n                completed: milestoneData.completed || false,\r\n            };\r\n\r\n            const updatedMilestones = [...project.milestones, newMilestone];\r\n            return {\r\n                ...project,\r\n                milestones: updatedMilestones,\r\n                progress: calculateProgress(updatedMilestones),\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const toggleMilestone = useCallback((projectId: string, milestoneId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n\r\n            const updatedMilestones = project.milestones.map(milestone => {\r\n                if (milestone.id !== milestoneId) return milestone;\r\n                return {\r\n                    ...milestone,\r\n                    completed: !milestone.completed,\r\n                    completedAt: !milestone.completed ? new Date().toISOString() : undefined,\r\n                };\r\n            });\r\n\r\n            return {\r\n                ...project,\r\n                milestones: updatedMilestones,\r\n                progress: calculateProgress(updatedMilestones),\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const deleteMilestone = useCallback((projectId: string, milestoneId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n\r\n            const updatedMilestones = project.milestones.filter(m => m.id !== milestoneId);\r\n            return {\r\n                ...project,\r\n                milestones: updatedMilestones,\r\n                progress: calculateProgress(updatedMilestones),\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const linkTask = useCallback((projectId: string, taskId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n            if (project.linkedTaskIds.includes(taskId)) return project;\r\n\r\n            return {\r\n                ...project,\r\n                linkedTaskIds: [...project.linkedTaskIds, taskId],\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const unlinkTask = useCallback((projectId: string, taskId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n\r\n            return {\r\n                ...project,\r\n                linkedTaskIds: project.linkedTaskIds.filter(id => id !== taskId),\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const linkGoal = useCallback((projectId: string, goalId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n            if (project.linkedGoalIds.includes(goalId)) return project;\r\n\r\n            return {\r\n                ...project,\r\n                linkedGoalIds: [...project.linkedGoalIds, goalId],\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const unlinkGoal = useCallback((projectId: string, goalId: string) => {\r\n        setProjects(prev => prev.map(project => {\r\n            if (project.id !== projectId) return project;\r\n\r\n            return {\r\n                ...project,\r\n                linkedGoalIds: project.linkedGoalIds.filter(id => id !== goalId),\r\n            };\r\n        }));\r\n    }, []);\r\n\r\n    const value: ProjectContextType = {\r\n        projects,\r\n        addProject,\r\n        updateProject,\r\n        deleteProject,\r\n        addMilestone,\r\n        toggleMilestone,\r\n        deleteMilestone,\r\n        linkTask,\r\n        unlinkTask,\r\n        linkGoal,\r\n        unlinkGoal,\r\n    };\r\n\r\n    return <ProjectContext.Provider value={value}>{children}</ProjectContext.Provider>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\StudyContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\StudyProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\TaskContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\TaskProvider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'taskActions'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [taskActions, user]","fix":{"range":[4255,4261],"text":"[taskActions, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { logger } from '../utils/logger';\r\nimport { useAuth } from './AuthContext';\r\nimport { useGamification } from './GamificationContext';\r\nimport { useTasks } from '../hooks/useTasks';\r\nimport type { Task } from '../types';\r\nimport { supabase } from '../lib/supabase';\r\nimport { TaskContext } from './TaskContext';\r\nimport { filterBlacklisted } from '../utils/deletedItemsBlacklist';\r\n\r\nexport const TaskProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const { user } = useAuth();\r\n    const { gamification, awardXP, updateStats } = useGamification();\r\n\r\n    const taskActions = useTasks({\r\n        user,\r\n        gamification,\r\n        awardXP,\r\n        updateStats\r\n    });\r\n\r\n    // Initial Fetch from Supabase\r\n    useEffect(() => {\r\n        const fetchTasks = async () => {\r\n            if (user) {\r\n                const { data, error } = await supabase\r\n                    .from('tasks')\r\n                    .select('*')\r\n                    .eq('user_id', user.id);\r\n\r\n                if (data && !error) {\r\n                    const normalized = data.map(t => ({\r\n                        ...t,\r\n                        startDate: t.start_date,\r\n                        endDate: t.end_date,\r\n                        createdAt: new Date(t.created_at).getTime(),\r\n                        imageUrl: t.image_url,\r\n                        durationMinutes: t.duration_minutes,\r\n                        timeSpent: t.time_spent || 0,\r\n                        completionHistory: t.completion_history || [],\r\n                        sessions: t.sessions || [],\r\n                        summaries: t.summaries || []\r\n                    }));\r\n\r\n                    // --- ROBUST DELETION PROTECTION ---\r\n                    // Read pending deletions from Sync Queue to prevent 'zombies'\r\n                    const pendingDeletes = new Set<string>();\r\n                    try {\r\n                        const queueRaw = localStorage.getItem('sync_queue_v1');\r\n                        if (queueRaw) {\r\n                            const queue = JSON.parse(queueRaw);\r\n                            if (Array.isArray(queue)) {\r\n                                queue.forEach((op: { type: string; table: string; data?: { id?: string } }) => {\r\n                                    if (op.type === 'DELETE' && op.table === 'tasks' && op.data?.id) {\r\n                                        pendingDeletes.add(op.data.id);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        logger.error(\"Error reading sync queue for protection\", e);\r\n                    }\r\n\r\n                    // üö´ NUCLEAR PROTECTION: Filter permanent blacklist\r\n                    // This is the FINAL line of defense against zombie resurrection\r\n                    const nonBlacklisted = filterBlacklisted(normalized, 'task');\r\n                    // ----------------------------------\r\n\r\n                    taskActions.setTasks(prevTasks => {\r\n                        const finalTasks: Task[] = [];\r\n                        const processedIds = new Set<string>();\r\n\r\n                        // 1. Add/Update from Server (filtered)\r\n                        nonBlacklisted.forEach(serverTask => {\r\n                            if (pendingDeletes.has(serverTask.id)) {\r\n                                logger.info(`üõ°Ô∏è Blocked zombie task resurrecion: ${serverTask.id} `);\r\n                                return; // Skip deleted item\r\n                            }\r\n                            finalTasks.push(serverTask);\r\n                            processedIds.add(serverTask.id);\r\n                        });\r\n\r\n                        // 2. Preserve Local-Only (Optimistic)\r\n                        prevTasks.forEach(localTask => {\r\n                            if (!processedIds.has(localTask.id)) {\r\n                                finalTasks.push(localTask);\r\n                            }\r\n                        });\r\n\r\n                        return finalTasks;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        fetchTasks();\r\n    }, [user]); // Fixed: removed taskActions to prevent infinite loop\r\n\r\n\r\n    return (\r\n        <TaskContext.Provider value={taskActions}>\r\n            {children}\r\n        </TaskContext.Provider>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ThemeContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ThemeProvider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'themeActions'. Either include it or remove the dependency array.","line":150,"column":8,"nodeType":"ArrayExpression","endLine":150,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [user, themeActions.setThemes, themeActions]","fix":{"range":[7734,7764],"text":"[user, themeActions.setThemes, themeActions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { logger } from '../utils/logger';\r\nimport { useAuth } from './AuthContext';\r\nimport { useGamification } from './GamificationContext';\r\nimport { useThemes } from '../hooks/useThemes';\r\nimport type { Theme, Subtheme } from '../types';\r\nimport { supabase } from '../lib/supabase';\r\nimport { useAudio } from './AudioContext';\r\nimport { ThemeContext } from './ThemeContext';\r\n\r\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const { user } = useAuth();\r\n    const { gamification, awardXP, updateStats } = useGamification();\r\n    const { playSFX } = useAudio();\r\n\r\n    const themeActions = useThemes({\r\n        user,\r\n        gamification,\r\n        awardXP,\r\n        updateStats,\r\n        playSFX\r\n    });\r\n\r\n    // Initial Fetch from Supabase\r\n    useEffect(() => {\r\n        const fetchThemes = async () => {\r\n            if (user) {\r\n                const { data: themesData, error: themesError } = await supabase\r\n                    .from('themes')\r\n                    .select('*, subthemes(*)')\r\n                    .eq('user_id', user.id)\r\n                    .order('order_index', { foreignTable: 'subthemes', ascending: true });\r\n\r\n                if (themesData && !themesError) {\r\n                    const normalized = themesData.map(t => ({\r\n                        ...t,\r\n                        createdAt: new Date(t.created_at).getTime(),\r\n                        imageUrl: t.image_url,\r\n                        startDate: t.start_date,\r\n                        summaries: t.summaries || [],\r\n                        subthemes: t.subthemes.map((st: Subtheme & { theme_id: string; duration_minutes: number; time_spent: number }) => ({\r\n                            ...st,\r\n                            themeId: st.theme_id,\r\n                            durationMinutes: st.duration_minutes,\r\n                            timeSpent: st.time_spent || 0,\r\n                            summaries: st.summaries || []\r\n                        }))\r\n                    }));\r\n\r\n                    // --- ROBUST DELETION PROTECTION ---\r\n                    const pendingDeletes = new Set<string>();\r\n                    const pendingSubthemeDeletes = new Set<string>();\r\n                    let deletedIds = new Set<string>();\r\n\r\n                    try {\r\n                        const storedDeleted = localStorage.getItem('deleted_theme_ids');\r\n                        if (storedDeleted) {\r\n                            deletedIds = new Set(JSON.parse(storedDeleted));\r\n                        }\r\n\r\n\r\n                        const queueRaw = localStorage.getItem('sync_queue_v1');\r\n                        if (queueRaw) {\r\n                            const queue = JSON.parse(queueRaw);\r\n                            if (Array.isArray(queue)) {\r\n                                queue.forEach((op: { type: string; table: string; data?: { id?: string } }) => {\r\n                                    if (op.type === 'DELETE' && op.data?.id) {\r\n                                        if (op.table === 'themes') pendingDeletes.add(op.data.id);\r\n                                        if (op.table === 'subthemes') pendingSubthemeDeletes.add(op.data.id);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        logger.error(\"Error reading sync queue for theme protection\", e);\r\n                    }\r\n                    // ----------------------------------\r\n\r\n                    themeActions.setThemes(prevThemes => {\r\n                        // Create a map of current themes for easy lookup\r\n                        const currentThemesMap = new Map(prevThemes.map(t => [t.id, t]));\r\n                        const finalThemes: Theme[] = [];\r\n                        const processedIds = new Set<string>();\r\n\r\n                        // 1. Process Server Themes (Merge with Local)\r\n                        normalized.forEach(serverTheme => {\r\n                            if (pendingDeletes.has(serverTheme.id) || deletedIds.has(serverTheme.id)) {\r\n                                logger.info(`üõ°Ô∏è Blocked zombie theme resurrecion: ${serverTheme.id}`);\r\n                                return;\r\n                            }\r\n\r\n                            processedIds.add(serverTheme.id);\r\n                            const localTheme = currentThemesMap.get(serverTheme.id);\r\n\r\n                            let finalSubthemes = serverTheme.subthemes;\r\n\r\n                            // Filter Server Subthemes against pending deletes\r\n                            finalSubthemes = finalSubthemes.filter((st: Subtheme) => !pendingSubthemeDeletes.has(st.id));\r\n\r\n\r\n                            if (localTheme) {\r\n                                // --- SMART SUBTHEME MERGE ---\r\n                                // 1. If server has 0 subthemes but local has them, this is likely a sync glitch or latency.\r\n                                //    KEEP local subthemes to prevent \"zeroing\".\r\n                                if (serverTheme.subthemes.length === 0 && localTheme.subthemes.length > 0) {\r\n                                    logger.warn(`[SmartMerge] Preserving ${localTheme.subthemes.length} local subthemes for theme ${serverTheme.title} (Server returned 0)`);\r\n                                    finalSubthemes = localTheme.subthemes;\r\n                                }\r\n                                else {\r\n                                    // 2. Union Merge: Keep local-only items (optimistic adds) + Server updates\r\n                                    const subthemeMap = new Map<string, Subtheme>();\r\n\r\n                                    // Start with Local (preserves un-synced added items)\r\n                                    // But ignore if they are pending delete locally (already handled by useThemes deleteSubtheme logic which updates state)\r\n                                    localTheme.subthemes.forEach(st => subthemeMap.set(st.id, st));\r\n\r\n                                    // Overlay Server (Source of Truth for synced items)\r\n                                    // serverTheme.subthemes are technically arrays from server.\r\n                                    // We must check if any server subtheme is in pendingSubthemeDeletes (already filtered above in finalSubthemes assignment)\r\n                                    // So we overlay the filtered server subthemes.\r\n                                    serverTheme.subthemes.forEach((st: Subtheme) => {\r\n                                        if (!pendingSubthemeDeletes.has(st.id)) {\r\n                                            subthemeMap.set(st.id, st);\r\n                                        }\r\n                                    });\r\n\r\n                                    finalSubthemes = Array.from(subthemeMap.values());\r\n                                }\r\n                            }\r\n\r\n                            finalThemes.push({\r\n                                ...serverTheme,\r\n                                subthemes: finalSubthemes\r\n                            });\r\n                        });\r\n\r\n                        // 2. Preserve Local-Only Themes (Optimistic Adds not yet on server)\r\n                        prevThemes.forEach(localTheme => {\r\n                            if (!processedIds.has(localTheme.id)) {\r\n                                finalThemes.push(localTheme);\r\n                            }\r\n                        });\r\n\r\n                        return finalThemes;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        fetchThemes();\r\n    }, [user, themeActions.setThemes]);\r\n\r\n    return (\r\n        <ThemeContext.Provider value={themeActions}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ToastContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\ToastProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\UIThemeProvider.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":13,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":13,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\ntype UITheme = 'light' | 'dark';\r\n\r\ninterface UIThemeContextType {\r\n    theme: UITheme;\r\n    toggleTheme: () => void;\r\n    setTheme: (theme: UITheme) => void;\r\n}\r\n\r\nconst UIThemeContext = createContext<UIThemeContextType | undefined>(undefined);\r\n\r\nexport const useUITheme = () => {\r\n    const context = useContext(UIThemeContext);\r\n    if (!context) {\r\n        throw new Error('useUITheme must be used within UIThemeProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const UIThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [theme, setThemeState] = useState<UITheme>(() => {\r\n        // Check localStorage first\r\n        const saved = localStorage.getItem('ui_theme');\r\n        if (saved === 'light' || saved === 'dark') {\r\n            return saved;\r\n        }\r\n\r\n        // Check system preference\r\n        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {\r\n            return 'light';\r\n        }\r\n\r\n        return 'dark'; // Default\r\n    });\r\n\r\n    useEffect(() => {\r\n        // Apply theme to document\r\n        document.documentElement.setAttribute('data-theme', theme);\r\n\r\n        // Apply Tailwind dark class\r\n        if (theme === 'dark') {\r\n            document.documentElement.classList.add('dark');\r\n        } else {\r\n            document.documentElement.classList.remove('dark');\r\n        }\r\n\r\n        // Save to localStorage\r\n        localStorage.setItem('ui_theme', theme);\r\n    }, [theme]);\r\n\r\n    const setTheme = (newTheme: UITheme) => {\r\n        setThemeState(newTheme);\r\n    };\r\n\r\n    const toggleTheme = () => {\r\n        setThemeState(prev => prev === 'dark' ? 'light' : 'dark');\r\n    };\r\n\r\n    return (\r\n        <UIThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\r\n            {children}\r\n        </UIThemeContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\useAppContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\useAudio.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\useAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\useConfirm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\context\\useGamification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\AnalyticsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\AchievementsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\CategoryDistributionChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'eachDayOfInterval' is defined but never used.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subWeeks' is defined but never used.","line":3,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":45}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } from 'recharts';\r\nimport { format, eachDayOfInterval, subWeeks } from 'date-fns';\r\nimport type { Theme, Task, Goal } from '../../../types';\r\n\r\ninterface CategoryDistributionChartProps {\r\n    themes: Theme[];\r\n    tasks: Task[];\r\n    goals: Goal[];\r\n}\r\n\r\nexport const CategoryDistributionChart: React.FC<CategoryDistributionChartProps> = ({ themes, tasks, goals }) => {\r\n    // Process categories\r\n    const categories: Record<string, number> = {};\r\n\r\n    // From Themes/Subthemes\r\n    themes.forEach(theme => {\r\n        const cat = theme.category || 'Estudos';\r\n        const minutes = theme.subthemes.reduce((acc, st) => acc + (st.timeSpent || 0), 0);\r\n        categories[cat] = (categories[cat] || 0) + minutes;\r\n    });\r\n\r\n    // From Tasks\r\n    tasks.forEach(task => {\r\n        const cat = 'Tarefas';\r\n        categories[cat] = (categories[cat] || 0) + (task.timeSpent || 0);\r\n    });\r\n\r\n    // From Goals\r\n    goals.forEach(goal => {\r\n        const cat = goal.category || 'Metas';\r\n        categories[cat] = (categories[cat] || 0) + (goal.timeSpent || 0);\r\n    });\r\n\r\n    const data = Object.entries(categories)\r\n        .filter(([, value]) => value > 0)\r\n        .map(([name, value]) => ({ name, value }));\r\n\r\n    // Fallback if no data\r\n    if (data.length === 0) {\r\n        data.push({ name: 'Sem dados', value: 1 });\r\n    }\r\n\r\n    const COLORS = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#6366f1'];\r\n\r\n    return (\r\n        <div className=\"bg-slate-900/40 border border-white/5 rounded-[2.5rem] p-8 backdrop-blur-xl relative overflow-hidden group h-full flex flex-col\">\r\n            <div className=\"absolute top-0 right-0 w-64 h-64 bg-pink-500/5 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none\" />\r\n\r\n            <h3 className=\"text-xl font-bold text-white mb-6 relative z-10 flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-pink-500/10 text-pink-400 border border-pink-500/20\">\r\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-pink-400\" />\r\n                </div>\r\n                Distribui√ß√£o de Foco\r\n            </h3>\r\n\r\n            <div className=\"flex-1 min-h-[300px] relative z-10\">\r\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                    <PieChart>\r\n                        <Pie\r\n                            data={data}\r\n                            innerRadius={80}\r\n                            outerRadius={100}\r\n                            paddingAngle={8}\r\n                            dataKey=\"value\"\r\n                            stroke=\"none\"\r\n                        >\r\n                            {data.map((_, index) => (\r\n                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                            ))}\r\n                        </Pie>\r\n                        <Tooltip\r\n                            contentStyle={{\r\n                                backgroundColor: 'rgba(15, 23, 42, 0.9)',\r\n                                border: '1px solid rgba(255,255,255,0.1)',\r\n                                borderRadius: '16px',\r\n                                boxShadow: '0 10px 40px -10px rgba(0,0,0,0.5)',\r\n                                padding: '12px 16px',\r\n                                color: '#f8fafc'\r\n                            }}\r\n                            itemStyle={{ color: '#e2e8f0', fontSize: '13px', fontWeight: 'bold' }}\r\n                            formatter={(value: number) => [`${value} min`, 'Tempo']}\r\n                        />\r\n                        <Legend\r\n                            verticalAlign=\"bottom\"\r\n                            align=\"center\"\r\n                            iconType=\"circle\"\r\n                            formatter={(value) => <span className=\"text-slate-400 text-xs font-bold uppercase tracking-wider ml-1\">{value}</span>}\r\n                        />\r\n                    </PieChart>\r\n                </ResponsiveContainer>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\DetailedStatsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\HeatmapWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\RetentionChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\WeeklyFocusChart.tsx","messages":[{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\WeeklyFocusChart.tsx:115:39\n  113 |                         />\n  114 |                         <Tooltip\n> 115 |                             content={<CustomTooltip />}\n      |                                       ^^^^^^^^^^^^^ This component is created during render\n  116 |                             cursor={{ fill: 'rgba(255,255,255,0.03)', radius: 8 }}\n  117 |                         />\n  118 |                         <Bar\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\WeeklyFocusChart.tsx:26:27\n  24 |     });\n  25 |\n> 26 |     const CustomTooltip = ({ active, payload }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 27 |         if (active && payload && payload.length) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |             return (\n     ‚Ä¶\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 38 |         return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 39 |     };\n     | ^^^^^^ The component is created during render here\n  40 |\n  41 |     return (\n  42 |         <div className=\"relative overflow-hidden bg-slate-900/40 border border-white/5 rounded-3xl p-6 backdrop-blur-xl hover:bg-slate-800/40 transition-colors group\">","line":115,"column":39,"nodeType":null,"endLine":115,"endColumn":52}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';\r\nimport { format, subDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\ninterface WeeklyFocusChartProps {\r\n    dailyHistory: Record<string, number>; // date \"yyyy-MM-dd\": minutes\r\n}\r\n\r\nexport const WeeklyFocusChart: React.FC<WeeklyFocusChartProps> = ({ dailyHistory }) => {\r\n    // Generate last 7 days data\r\n    const today = format(new Date(), 'yyyy-MM-dd');\r\n    const data = Array.from({ length: 7 }).map((_, i) => {\r\n        const date = subDays(new Date(), 6 - i); // Last 7 days including today\r\n        const dateStr = format(date, 'yyyy-MM-dd');\r\n        const isToday = dateStr === today;\r\n        return {\r\n            name: format(date, 'EEE', { locale: ptBR }), // Mon, Tue...\r\n            fullDate: format(date, \"d 'de' MMMM\", { locale: ptBR }),\r\n            minutes: dailyHistory[dateStr] || 0,\r\n            originalDate: date,\r\n            isToday\r\n        };\r\n    });\r\n\r\n    const CustomTooltip = ({ active, payload }: any) => {\r\n        if (active && payload && payload.length) {\r\n            return (\r\n                <div className=\"bg-slate-900/90 border border-slate-700 p-4 rounded-2xl shadow-2xl backdrop-blur-xl ring-1 ring-white/10\">\r\n                    <p className=\"text-xs font-bold text-slate-400 mb-1 uppercase tracking-wider\">{payload[0].payload.fullDate}</p>\r\n                    <p className=\"text-2xl font-bold text-white tabular-nums\">\r\n                        {Math.floor(payload[0].value / 60)}<span className=\"text-sm font-medium text-slate-500 ml-0.5 mr-2\">h</span>\r\n                        {payload[0].value % 60}<span className=\"text-sm font-medium text-slate-500 ml-0.5\">m</span>\r\n                    </p>\r\n                </div>\r\n            );\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative overflow-hidden bg-slate-900/40 border border-white/5 rounded-3xl p-6 backdrop-blur-xl hover:bg-slate-800/40 transition-colors group\">\r\n            {/* Ambient Background */}\r\n            <div className=\"absolute top-0 right-0 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none\" />\r\n\r\n            <div className=\"flex items-center justify-between mb-8 relative z-10\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold text-white flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-lg bg-blue-500/10 text-blue-400 ring-1 ring-blue-500/20\">\r\n                            <span className=\"w-1.5 h-1.5 rounded-full bg-blue-400 animate-pulse\" />\r\n                        </div>\r\n                        Foco nos √öltimos 7 Dias\r\n                    </h3>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"h-72 w-full relative z-10\">\r\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                    <BarChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\r\n                        <defs>\r\n                            <linearGradient id=\"barGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"0%\" stopColor=\"#3b82f6\" stopOpacity={0.8} />\r\n                                <stop offset=\"100%\" stopColor=\"#3b82f6\" stopOpacity={0.2} />\r\n                            </linearGradient>\r\n                            <linearGradient id=\"barGradientHover\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"0%\" stopColor=\"#60a5fa\" stopOpacity={1} />\r\n                                <stop offset=\"100%\" stopColor=\"#3b82f6\" stopOpacity={0.4} />\r\n                            </linearGradient>\r\n                        </defs>\r\n                        <XAxis\r\n                            dataKey=\"name\"\r\n                            axisLine={false}\r\n                            tickLine={false}\r\n                            tick={(props) => {\r\n                                const { x, y, payload, index } = props;\r\n                                const entry = data[index];\r\n                                return (\r\n                                    <g transform={`translate(${x},${y})`}>\r\n                                        <text\r\n                                            x={0}\r\n                                            y={0}\r\n                                            dy={-10}\r\n                                            textAnchor=\"middle\"\r\n                                            fill={entry?.isToday ? '#60a5fa' : '#e2e8f0'}\r\n                                            fontSize={14}\r\n                                            fontWeight={entry?.isToday ? 700 : 600}\r\n                                        >\r\n                                            {payload.value}\r\n                                        </text>\r\n                                        {entry?.isToday && (\r\n                                            <text\r\n                                                x={0}\r\n                                                y={0}\r\n                                                dy={8}\r\n                                                textAnchor=\"middle\"\r\n                                                fill=\"#60a5fa\"\r\n                                                fontSize={10}\r\n                                                fontWeight={700}\r\n                                            >\r\n                                                HOJE\r\n                                            </text>\r\n                                        )}\r\n                                    </g>\r\n                                );\r\n                            }}\r\n                        />\r\n                        <YAxis\r\n                            hide={false}\r\n                            axisLine={false}\r\n                            tickLine={false}\r\n                            tick={{ fill: '#475569', fontSize: 11, fontWeight: 500 }}\r\n                            tickFormatter={(value) => `${Math.floor(value / 60)}h`}\r\n                        />\r\n                        <Tooltip\r\n                            content={<CustomTooltip />}\r\n                            cursor={{ fill: 'rgba(255,255,255,0.03)', radius: 8 }}\r\n                        />\r\n                        <Bar\r\n                            dataKey=\"minutes\"\r\n                            radius={[8, 8, 8, 8]}\r\n                            className=\"transition-all duration-300\"\r\n                        >\r\n                            {data.map((entry, index) => (\r\n                                <Cell\r\n                                    key={`cell-${index}`}\r\n                                    fill={entry.isToday ? \"url(#barGradientHover)\" : \"url(#barGradient)\"}\r\n                                    className=\"hover:opacity-100 opacity-80 transition-all cursor-pointer hover:filter hover:drop-shadow-[0_0_10px_rgba(59,130,246,0.5)]\"\r\n                                />\r\n                            ))}\r\n                        </Bar>\r\n                    </BarChart>\r\n                </ResponsiveContainer>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\XPProgressionChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'LineChart' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Line' is defined but never used.","line":2,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'maxXP' is assigned a value but never used.","line":68,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":16},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\XPProgressionChart.tsx:116:40\n  114 |                         tickFormatter={(value) => `${(value / 1000).toFixed(0)}k`}\n  115 |                     />\n> 116 |                     <Tooltip content={<CustomTooltip />} />\n      |                                        ^^^^^^^^^^^^^ This component is created during render\n  117 |                     <Area\n  118 |                         type=\"monotone\"\n  119 |                         dataKey=\"xp\"\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\analytics\\components\\XPProgressionChart.tsx:54:27\n  52 |     }, [dailyHistory]);\n  53 |\n> 54 |     const CustomTooltip = ({ active, payload }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 55 |         if (active && payload && payload.length) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 56 |             return (\n     ‚Ä¶\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 65 |         return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 66 |     };\n     | ^^^^^^ The component is created during render here\n  67 |\n  68 |     const maxXP = Math.max(...chartData.map(d => d.xp), currentXP);\n  69 |     const growthRate = chartData.length > 1","line":116,"column":40,"nodeType":null,"endLine":116,"endColumn":53}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid, Area, AreaChart } from 'recharts';\r\nimport { TrendingUp } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\ninterface XPProgressionChartProps {\r\n    dailyHistory: Record<string, number>;\r\n    currentXP: number;\r\n    currentLevel: number;\r\n}\r\n\r\nexport const XPProgressionChart: React.FC<XPProgressionChartProps> = ({ dailyHistory, currentXP, currentLevel }) => {\r\n    const chartData = useMemo(() => {\r\n        // Get last 30 days\r\n        const data: { date: string; xp: number; displayDate: string }[] = [];\r\n        const today = new Date();\r\n        let cumulativeXP = 0;\r\n\r\n        // Sort dates to accumulate XP correctly\r\n        const sortedDates = Object.keys(dailyHistory).sort();\r\n\r\n        // Get only last 30 entries\r\n        const last30Dates = sortedDates.slice(-30);\r\n\r\n        last30Dates.forEach(dateStr => {\r\n            const minutes = dailyHistory[dateStr] || 0;\r\n            // XP calculation: 10 XP per focused minute\r\n            const dailyXP = minutes * 10;\r\n            cumulativeXP += dailyXP;\r\n\r\n            data.push({\r\n                date: dateStr,\r\n                xp: cumulativeXP,\r\n                displayDate: format(new Date(dateStr), \"d 'de' MMM\", { locale: ptBR })\r\n            });\r\n        });\r\n\r\n        // If we don't have 30 days of data, fill backwards\r\n        const daysToFill = 30 - data.length;\r\n        for (let i = daysToFill; i > 0; i--) {\r\n            const date = new Date(today);\r\n            date.setDate(date.getDate() - (30 - i));\r\n            data.unshift({\r\n                date: format(date, 'yyyy-MM-dd'),\r\n                xp: 0,\r\n                displayDate: format(date, \"d 'de' MMM\", { locale: ptBR })\r\n            });\r\n        }\r\n\r\n        return data;\r\n    }, [dailyHistory]);\r\n\r\n    const CustomTooltip = ({ active, payload }: any) => {\r\n        if (active && payload && payload.length) {\r\n            return (\r\n                <div className=\"bg-slate-900/95 border border-slate-700 rounded-lg p-3 backdrop-blur-sm shadow-xl\">\r\n                    <p className=\"text-white font-bold text-sm mb-1\">{payload[0].payload.displayDate}</p>\r\n                    <p className=\"text-blue-400 font-black text-lg\">\r\n                        {payload[0].value.toLocaleString()} XP\r\n                    </p>\r\n                </div>\r\n            );\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const maxXP = Math.max(...chartData.map(d => d.xp), currentXP);\r\n    const growthRate = chartData.length > 1\r\n        ? ((chartData[chartData.length - 1].xp - chartData[0].xp) / Math.max(chartData[0].xp, 1) * 100).toFixed(1)\r\n        : '0';\r\n\r\n    return (\r\n        <div className=\"bg-white/5 border border-white/5 rounded-2xl p-6 backdrop-blur-sm\">\r\n            <div className=\"flex items-start justify-between mb-6\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                        <span className=\"w-1 h-6 bg-blue-500 rounded-full\" />\r\n                        Evolu√ß√£o de XP (√öltimos 30 Dias)\r\n                    </h3>\r\n                    <p className=\"text-sm text-slate-400 mt-1 ml-4\">\r\n                        Crescimento total: {currentXP.toLocaleString()} XP\r\n                    </p>\r\n                </div>\r\n                <div className=\"bg-blue-500/10 border border-blue-500/20 rounded-xl px-4 py-2\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <TrendingUp className=\"w-4 h-4 text-blue-400\" />\r\n                        <span className=\"text-blue-400 font-bold\">+{growthRate}%</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-slate-500 mt-0.5\">√∫ltimos 30 dias</p>\r\n                </div>\r\n            </div>\r\n\r\n            <ResponsiveContainer width=\"100%\" height={300}>\r\n                <AreaChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\r\n                    <defs>\r\n                        <linearGradient id=\"xpGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                            <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                        </linearGradient>\r\n                    </defs>\r\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#334155\" opacity={0.2} />\r\n                    <XAxis\r\n                        dataKey=\"displayDate\"\r\n                        stroke=\"#64748b\"\r\n                        tick={{ fill: '#64748b', fontSize: 12 }}\r\n                        tickLine={false}\r\n                        interval=\"preserveStartEnd\"\r\n                    />\r\n                    <YAxis\r\n                        stroke=\"#64748b\"\r\n                        tick={{ fill: '#64748b', fontSize: 12 }}\r\n                        tickLine={false}\r\n                        tickFormatter={(value) => `${(value / 1000).toFixed(0)}k`}\r\n                    />\r\n                    <Tooltip content={<CustomTooltip />} />\r\n                    <Area\r\n                        type=\"monotone\"\r\n                        dataKey=\"xp\"\r\n                        stroke=\"#3b82f6\"\r\n                        strokeWidth={3}\r\n                        fill=\"url(#xpGradient)\"\r\n                        dot={{ fill: '#3b82f6', r: 4, strokeWidth: 2, stroke: '#1e40af' }}\r\n                        activeDot={{ r: 6, strokeWidth: 2 }}\r\n                    />\r\n                </AreaChart>\r\n            </ResponsiveContainer>\r\n\r\n            {/* Level Indicator */}\r\n            <div className=\"mt-4 flex items-center gap-3\">\r\n                <div className=\"flex-1 h-2 bg-slate-800 rounded-full overflow-hidden\">\r\n                    <div\r\n                        className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500\"\r\n                        style={{ width: `${Math.min((currentXP % 1000) / 10, 100)}%` }}\r\n                    />\r\n                </div>\r\n                <span className=\"text-sm font-bold text-slate-400\">\r\n                    N√≠vel {currentLevel}\r\n                </span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\auth\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\auth\\components\\ForgotPasswordModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\Calendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronLeft' is defined but never used.","line":3,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":4,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":6,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSameMonth' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSameDay' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleTask' is assigned a value but never used.","line":50,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoal' is assigned a value but never used.","line":51,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoalItem' is assigned a value but never used.","line":52,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":23}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\r\nimport {\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    PlayCircle,\r\n    Clock,\r\n    Loader2\r\n} from 'lucide-react';\r\nimport {\r\n    format,\r\n    addMonths,\r\n    subMonths,\r\n    startOfMonth,\r\n    endOfMonth,\r\n    eachDayOfInterval,\r\n    isSameMonth,\r\n    isToday,\r\n    addDays,\r\n    isSameDay\r\n} from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useCalendarEvents } from './hooks/useCalendarEvents';\r\nimport { CalendarHeader } from './components/CalendarHeader';\r\nimport { CalendarGrid } from './components/CalendarGrid';\r\nimport { CalendarDay } from './components/CalendarDay';\r\nimport { DayDetails } from './components/DayDetails';\r\nimport { Modal } from '../../components/ui/Modal';\r\nimport { UpcomingReviewsSidebar } from './components/UpcomingReviewsSidebar';\r\nimport { cn } from '../../lib/utils';\r\nimport { parseLocalDate } from '../../utils/dateHelpers';\r\nimport type { Review } from '../../types';\r\n\r\nimport { useProjectContext } from '../../context/ProjectProvider';\r\n\r\nexport const Calendar = () => {\r\n    const [currentMonth, setCurrentMonth] = useState(new Date());\r\n    const [selectedDate, setSelectedDate] = useState<Date | null>(null);\r\n    const { projects } = useProjectContext(); // Get projects\r\n    const {\r\n        themes,\r\n        tasks,\r\n        goals,\r\n        completeReview,\r\n        startStudySession,\r\n        activeFocus,\r\n        endFocus,\r\n        startFocus,\r\n        toggleTask,\r\n        toggleGoal,\r\n        toggleGoalItem,\r\n        deleteGoal,\r\n        deleteTask\r\n    } = useStudy();\r\n\r\n    const { startFocusSession, resetTimer } = usePomodoroContext();\r\n    const { getEventsForDay, upcomingList, now } = useCalendarEvents({ themes, tasks, goals, projects }); // Pass projects\r\n\r\n    const calendarDays = useMemo(() => {\r\n        const start = startOfMonth(currentMonth);\r\n        const end = endOfMonth(currentMonth);\r\n        return eachDayOfInterval({ start, end });\r\n    }, [currentMonth]);\r\n\r\n    const nextMonth = () => setCurrentMonth(addMonths(currentMonth, 1));\r\n    const prevMonth = () => setCurrentMonth(subMonths(currentMonth, 1));\r\n\r\n\r\n    const [selectedSubthemeSchedule, setSelectedSubthemeSchedule] = useState<{\r\n        subthemeTitle: string;\r\n        themeTitle: string;\r\n        schedule: (Review | { number: number; date: string; status: 'simulated' })[];\r\n        introDate: string;\r\n        type: string;\r\n        id: string;\r\n        color?: string;\r\n    } | null>(null);\r\n\r\n    const handleSubthemeClick = (e: React.MouseEvent, item: any, isProjected: boolean, date: Date) => {\r\n        e.stopPropagation();\r\n\r\n        let schedule: (Review | { number: number; date: string; status: 'simulated' })[] = [];\r\n        let introDate = '';\r\n\r\n        if (isProjected) {\r\n            const baseDate = item.introDate ? parseLocalDate(item.introDate) : new Date(date);\r\n            introDate = format(baseDate, \"d/MM\");\r\n            const offsets = [1, 3, 10, 18, 33];\r\n            schedule = offsets.map((off, i) => ({\r\n                number: i + 1,\r\n                date: format(addDays(baseDate, off), 'yyyy-MM-dd'),\r\n                status: 'simulated'\r\n            }));\r\n        } else {\r\n            const theme = themes.find(t => t.title === item.themeTitle);\r\n            const subtheme = theme?.subthemes.find(st => st.title === item.subthemeTitle);\r\n            if (subtheme && subtheme.reviews) {\r\n                schedule = subtheme.reviews;\r\n                introDate = subtheme.introductionDate || '';\r\n            }\r\n        }\r\n\r\n        setSelectedSubthemeSchedule({\r\n            ...item,\r\n            schedule,\r\n            introDate,\r\n            type: isProjected ? 'projected' : 'active'\r\n        });\r\n    };\r\n\r\n    const handleStartFocus = (item: any) => {\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        if (item.date > todayStr) return;\r\n\r\n        startFocus(item.id, 'subtheme', item.subthemeTitle, 25);\r\n        startFocusSession(item.id, 25);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 relative pb-20 fade-in\">\r\n            <div className=\"fixed top-20 left-1/4 w-96 h-96 bg-blue-600/10 rounded-full blur-[128px] pointer-events-none -z-10\" />\r\n            <div className=\"fixed bottom-20 right-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[128px] pointer-events-none -z-10\" />\r\n\r\n            <CalendarHeader\r\n                currentMonth={currentMonth}\r\n                onPrevMonth={prevMonth}\r\n                onNextMonth={nextMonth}\r\n                onToday={() => setCurrentMonth(new Date())}\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\r\n                <div className=\"lg:col-span-3\">\r\n                    <CalendarGrid>\r\n                        {calendarDays.map((day) => (\r\n                            <CalendarDay\r\n                                key={day.toString()}\r\n                                day={day}\r\n                                currentMonth={currentMonth}\r\n                                events={getEventsForDay(day)}\r\n                                onClick={() => {\r\n                                    const d = new Date(day);\r\n                                    d.setHours(12, 0, 0, 0);\r\n                                    setSelectedDate(d);\r\n                                }}\r\n                                onEventClick={(e, item, isProjected) => handleSubthemeClick(e, item, isProjected, day)}\r\n                            />\r\n                        ))}\r\n                    </CalendarGrid>\r\n                </div>\r\n\r\n                <UpcomingReviewsSidebar\r\n                    upcomingList={upcomingList}\r\n                    now={now}\r\n                    activeFocus={activeFocus}\r\n                    onStartFocus={handleStartFocus}\r\n                />\r\n            </div>\r\n\r\n            <Modal\r\n                isOpen={!!selectedDate}\r\n                onClose={() => setSelectedDate(null)}\r\n                title={selectedDate ? format(selectedDate, \"EEEE, d 'de' MMMM\", { locale: ptBR }) : ''}\r\n            >\r\n                {selectedDate && (\r\n                    <DayDetails\r\n                        key={selectedDate.toISOString()}\r\n                        date={selectedDate}\r\n                        events={getEventsForDay(selectedDate)}\r\n                        onCompleteReview={completeReview}\r\n                        onStartStudy={(id: string) => {\r\n                            const dayEvents = getEventsForDay(selectedDate);\r\n                            const review = dayEvents.reviews.find((r: any) => r.id === id);\r\n                            if (review) startStudySession(review.id);\r\n                        }}\r\n                        onDeleteGoal={deleteGoal}\r\n                        onDeleteTask={deleteTask}\r\n                    />\r\n                )}\r\n            </Modal>\r\n\r\n            <Modal\r\n                isOpen={!!selectedSubthemeSchedule}\r\n                onClose={() => setSelectedSubthemeSchedule(null)}\r\n                title={selectedSubthemeSchedule?.subthemeTitle || 'Cronograma'}\r\n            >\r\n                {selectedSubthemeSchedule && (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"relative overflow-hidden rounded-2xl bg-slate-900 border border-slate-800 p-6\">\r\n                            <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2 pointer-events-none\" />\r\n\r\n                            <div className=\"flex items-center gap-3 mb-6 relative z-10\">\r\n                                <div className={cn(\r\n                                    \"px-3 py-1 rounded-lg text-xs font-bold uppercase tracking-wider shadow-lg\",\r\n                                    selectedSubthemeSchedule.type.includes('projected')\r\n                                        ? \"bg-amber-500/10 text-amber-400 border border-amber-500/20\"\r\n                                        : \"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\"\r\n                                )}>\r\n                                    {selectedSubthemeSchedule.type.includes('projected') ? 'Simula√ß√£o' : 'Ativo'}\r\n                                </div>\r\n                                <span className=\"text-slate-400 text-sm font-medium\">{selectedSubthemeSchedule.themeTitle}</span>\r\n                            </div>\r\n\r\n                            <h3 className=\"text-sm font-bold text-white mb-4 flex items-center gap-2\">\r\n                                <PlayCircle className=\"w-4 h-4 text-blue-400\" />\r\n                                Pr√≥ximas Revis√µes (SRS)\r\n                            </h3>\r\n\r\n                            <div className=\"space-y-2 relative z-10\">\r\n                                {selectedSubthemeSchedule.schedule.map((rev: Review | { number: number; date: string; status: 'simulated' | 'pending' | 'completed' }, idx: number) => (\r\n                                    <div key={idx} className=\"group flex justify-between items-center p-3 bg-black/20 hover:bg-black/40 rounded-xl border border-white/5 hover:border-white/10 transition-all\">\r\n                                        <div className=\"flex items-center gap-4\">\r\n                                            <div className=\"w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-400 border border-white/5 group-hover:border-white/10 group-hover:text-white transition-colors\">\r\n                                                <span>#{rev.number}</span>\r\n                                            </div>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className={cn(\r\n                                                    \"text-sm font-medium\",\r\n                                                    rev.status === 'completed' ? \"text-slate-500 line-through decoration-slate-700\" : \"text-slate-200\"\r\n                                                )}>\r\n                                                    {format(parseLocalDate(rev.date), \"d 'de' MMMM\", { locale: ptBR })}\r\n                                                </span>\r\n                                                {rev.status === 'pending' && !selectedSubthemeSchedule.type.includes('projected') && (() => {\r\n                                                    const today = new Date();\r\n                                                    today.setHours(0, 0, 0, 0);\r\n                                                    const revDate = parseLocalDate(rev.date);\r\n\r\n                                                    const isTodayDate = revDate.getTime() === today.getTime();\r\n                                                    const isOverdue = revDate < today;\r\n\r\n                                                    if (isTodayDate) {\r\n                                                        return (\r\n                                                            <span className=\"text-[10px] text-rose-400 flex items-center gap-1 animate-pulse\">\r\n                                                                <div className=\"w-1.5 h-1.5 rounded-full bg-rose-500\" />\r\n                                                                Em andamento\r\n                                                            </span>\r\n                                                        );\r\n                                                    }\r\n\r\n                                                    if (isOverdue) {\r\n                                                        return (\r\n                                                            <span className=\"text-[10px] text-red-500 flex items-center gap-1 font-bold\">\r\n                                                                <div className=\"w-1.5 h-1.5 rounded-full bg-red-500\" />\r\n                                                                Atrasado\r\n                                                            </span>\r\n                                                        );\r\n                                                    }\r\n\r\n                                                    return null;\r\n                                                })()}\r\n                                                {rev.status === 'completed' && (\r\n                                                    <span className=\"text-[10px] text-emerald-400 font-medium\">Conclu√≠do</span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            {rev.status === 'pending' && !selectedSubthemeSchedule.type.includes('projected') && (\r\n                                                activeFocus?.id === selectedSubthemeSchedule.id && isToday(parseLocalDate(rev.date)) ? (\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            if (confirm('Cancelar o foco?')) {\r\n                                                                endFocus(false);\r\n                                                                resetTimer();\r\n                                                            }\r\n                                                        }}\r\n                                                        className=\"flex items-center gap-2 text-xs bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 px-3 py-1.5 rounded-lg border border-rose-500/20 transition-all\"\r\n                                                    >\r\n                                                        <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                                                        <span className=\"font-bold\">Focando</span>\r\n                                                    </button>\r\n                                                ) : (\r\n                                                    isToday(parseLocalDate(rev.date)) ? (\r\n                                                        <button\r\n                                                            onClick={() => {\r\n                                                                if (activeFocus) return;\r\n                                                                startFocus(selectedSubthemeSchedule.id, 'subtheme', selectedSubthemeSchedule.subthemeTitle, 25);\r\n                                                                startFocusSession(selectedSubthemeSchedule.id, 25);\r\n                                                            }}\r\n                                                            disabled={!!activeFocus}\r\n                                                            className={cn(\r\n                                                                \"flex items-center gap-2 text-xs px-3 py-1.5 rounded-lg border transition-all shadow-lg active:scale-95\",\r\n                                                                activeFocus\r\n                                                                    ? \"opacity-50 cursor-not-allowed border-slate-700 text-slate-600 bg-transparent\"\r\n                                                                    : \"bg-blue-600 hover:bg-blue-500 text-white border-blue-500 hover:border-blue-400 shadow-blue-500/20\"\r\n                                                            )}\r\n                                                        >\r\n                                                            <PlayCircle className=\"w-3.5 h-3.5\" />\r\n                                                            <span className=\"font-bold\">Iniciar</span>\r\n                                                        </button>\r\n                                                    ) : (\r\n                                                        (() => {\r\n                                                            const today = new Date();\r\n                                                            today.setHours(0, 0, 0, 0);\r\n                                                            const revDate = parseLocalDate(rev.date);\r\n                                                            const isOverdue = rev.status === 'pending' && revDate < today;\r\n\r\n                                                            return (\r\n                                                                <span className={cn(\r\n                                                                    \"text-[10px] font-medium px-2 py-1 rounded border opacity-80\",\r\n                                                                    isOverdue\r\n                                                                        ? \"text-red-400 bg-red-500/10 border-red-500/20 animate-pulse\"\r\n                                                                        : \"text-slate-500 bg-slate-800/50 border-white/5\"\r\n                                                                )}>\r\n                                                                    {isOverdue ? 'Atrasado' : 'Agendado'}\r\n                                                                </span>\r\n                                                            );\r\n                                                        })()\r\n                                                    )\r\n                                                )\r\n                                            )}\r\n                                            <div className={cn(\r\n                                                \"w-2 h-2 rounded-full ml-2\",\r\n                                                rev.status === 'completed' ? \"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]\" : \"bg-slate-700\"\r\n                                            )} />\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {selectedSubthemeSchedule.type.includes('projected') && (\r\n                            <p className=\"text-xs text-slate-500 text-center bg-slate-900/50 py-2 rounded-lg border border-white/5\">\r\n                                <span className=\"text-amber-500/80 mr-1\">*</span>\r\n                                Datas simuladas com in√≠cio em <span className=\"text-slate-300 font-medium\">{selectedSubthemeSchedule.introDate}</span>\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\CalendarDay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\CalendarEventItem.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Flag' is defined but never used.","line":2,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'id' is defined but never used.","line":27,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isFuture' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":13}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { CheckSquare, Flag, PlayCircle, Loader2, Trash2, Clock } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Priority } from '../../../types';\r\n\r\ninterface CalendarEventItemProps {\r\n    id: string;\r\n    title: string;\r\n    subtitle?: string;\r\n    type: 'task' | 'goal' | 'subtheme';\r\n    isDone: boolean;\r\n    isFuture: boolean;\r\n    priority?: Priority;\r\n    durationMinutes?: number;\r\n    completionTime?: string | null;\r\n    onFocus: () => void;\r\n    onDelete?: () => void;\r\n    onOpenDetails?: () => void;\r\n    isActive?: boolean;\r\n    isSomeoneElseFocused?: boolean;\r\n    lockReason?: string;\r\n    children?: React.ReactNode; // For extra content like progress bars\r\n    colorTheme?: 'indigo' | 'blue' | 'purple' | 'pink';\r\n}\r\n\r\nexport const CalendarEventItem: React.FC<CalendarEventItemProps> = ({\r\n    id,\r\n    title,\r\n    subtitle,\r\n    type,\r\n    isDone,\r\n    isFuture,\r\n    priority,\r\n    durationMinutes,\r\n    completionTime,\r\n    onFocus,\r\n    onDelete,\r\n    onOpenDetails,\r\n    isActive = false,\r\n    isSomeoneElseFocused = false,\r\n    lockReason,\r\n    children,\r\n    colorTheme = 'blue'\r\n}) => {\r\n\r\n    const themeStyles = {\r\n        indigo: \"hover:border-indigo-500/30 bg-indigo-950/20\",\r\n        blue: \"hover:border-blue-500/30 bg-blue-950/20\",\r\n        purple: \"hover:border-purple-500/30 bg-purple-950/20\",\r\n        pink: \"hover:border-pink-500/30 bg-pink-950/20\"\r\n    };\r\n\r\n    const getPriorityBorderColor = (p?: string) => {\r\n        switch (p) {\r\n            case 'high': return 'border-l-red-500';\r\n            case 'medium': return 'border-l-amber-500';\r\n            case 'low': return 'border-l-emerald-500';\r\n            default: return 'border-l-slate-700';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className={cn(\r\n                \"group relative p-4 rounded-xl border transition-all duration-300 border-l-4\",\r\n                getPriorityBorderColor(priority),\r\n                isDone\r\n                    ? \"bg-slate-900/30 border-slate-800 opacity-50 grayscale-[0.5] border-l-slate-800\"\r\n                    : cn(\r\n                        \"bg-slate-900/60 backdrop-blur-md border-white/5 shadow-lg\",\r\n                        themeStyles[colorTheme]\r\n                    )\r\n            )}\r\n        >\r\n            <div className=\"flex items-start gap-4\">\r\n                {/* Visual Checkbox Indicator (Manual Blocked) */}\r\n                <div\r\n                    className={cn(\r\n                        \"w-6 h-6 rounded-lg border-2 flex items-center justify-center shrink-0 transition-all mt-1\",\r\n                        isDone\r\n                            ? \"bg-emerald-500 border-emerald-400 shadow-[0_0_12px_rgba(16,185,129,0.5)]\"\r\n                            : \"border-slate-600 bg-slate-950/50 opacity-40 cursor-not-allowed\"\r\n                    )}\r\n                    title={isDone ? \"Conclu√≠do\" : \"Utilize o Pomodoro para concluir\"}\r\n                >\r\n                    <CheckSquare className={cn(\"w-3.5 h-3.5 text-white transition-all\", isDone ? \"scale-100\" : \"scale-0\")} />\r\n                </div>\r\n\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                        <div className=\"space-y-1\">\r\n                            <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                <span\r\n                                    onClick={onOpenDetails}\r\n                                    className={cn(\r\n                                        \"font-bold text-sm transition-colors\",\r\n                                        isDone ? \"text-slate-500 line-through decoration-slate-700\" : \"text-white cursor-pointer hover:underline\"\r\n                                    )}\r\n                                >\r\n                                    {title}\r\n                                </span>\r\n                                {isDone && (\r\n                                    <span className=\"text-[9px] px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-300 border border-emerald-500/30 font-bold uppercase tracking-wider\">\r\n                                        ‚úì Feito\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            {subtitle && (\r\n                                <p className=\"text-[10px] text-slate-500 flex items-center gap-2\">\r\n                                    {subtitle}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2 shrink-0 ml-2\">\r\n                            {/* Actions Column */}\r\n                            <div className=\"flex items-center justify-end gap-2 flex-wrap\">\r\n                                {durationMinutes !== undefined && (\r\n                                    <span className=\"flex items-center gap-1 text-[10px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded border border-slate-700 whitespace-nowrap\" title=\"Tempo Estimado\">\r\n                                        <Clock className=\"w-2.5 h-2.5\" />\r\n                                        {durationMinutes} min\r\n                                    </span>\r\n                                )}\r\n\r\n                                {!isDone && (\r\n                                    <>\r\n                                        {isSomeoneElseFocused ? null : (\r\n                                            lockReason ? (\r\n                                                <span className=\"text-[10px] text-slate-500 italic px-2 flex items-center gap-1 whitespace-nowrap\">\r\n                                                    <span className=\"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse\" />\r\n                                                    {lockReason}\r\n                                                </span>\r\n                                            ) : isActive ? (\r\n                                                <button\r\n                                                    className=\"flex items-center gap-1 text-[10px] bg-rose-500/20 text-rose-400 px-1.5 py-0.5 rounded border border-rose-500/50 animate-pulse cursor-default whitespace-nowrap\"\r\n                                                    title=\"Foco Ativo\"\r\n                                                >\r\n                                                    <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                                                    <span>Focando...</span>\r\n                                                </button>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={(e) => { e.stopPropagation(); onFocus(); }}\r\n                                                    disabled={false}\r\n                                                    className={cn(\r\n                                                        \"flex items-center gap-1 text-[10px] px-2 py-0.5 rounded border transition-all whitespace-nowrap\",\r\n                                                        \"bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 border-rose-500/20 group hover:border-rose-500/40\"\r\n                                                    )}\r\n                                                    title=\"Iniciar Pomodoro\"\r\n                                                >\r\n                                                    <PlayCircle className=\"w-3 h-3\" />\r\n                                                    <span>Focar</span>\r\n                                                </button>\r\n                                            )\r\n                                        )}\r\n\r\n                                        {onDelete && (\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={(e) => { e.stopPropagation(); onDelete(); }}\r\n                                                className=\"p-1.5 text-slate-400 hover:text-red-400 hover:bg-red-500/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100 duration-300\"\r\n                                                title=\"Excluir\"\r\n                                                aria-label={`Excluir ${type === 'task' ? 'tarefa' : type === 'goal' ? 'meta' : 't√≥pico'}`}\r\n                                            >\r\n                                                <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                            </button>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n\r\n                                {isDone && completionTime && (\r\n                                    <span className=\"text-[10px] font-mono text-emerald-500/80 bg-emerald-500/10 px-1.5 py-0.5 rounded border border-emerald-500/20 whitespace-nowrap\">\r\n                                        {completionTime}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {children}\r\n                </div>\r\n            </div>\r\n            {/* Active Highlight Line */}\r\n            {!isDone && <div className={cn(\r\n                \"absolute left-0 top-3 bottom-3 w-0.5 rounded-r-full opacity-0 group-hover:opacity-100 transition-opacity\",\r\n                colorTheme === 'indigo' ? \"bg-indigo-500\" : colorTheme === 'purple' ? \"bg-purple-500\" : colorTheme === 'pink' ? \"bg-pink-500\" : \"bg-blue-500\"\r\n            )} />}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\CalendarGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\CalendarHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\DayDetails.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PlayCircle' is defined but never used.","line":2,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Loader2' is defined but never used.","line":2,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash2' is defined but never used.","line":2,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Review' is defined but never used.","line":10,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onCompleteReview' is defined but never used.","line":36,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleStopFocus' is assigned a value but never used.","line":84,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":26}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { BrainCircuit, CheckSquare, Flag, PlayCircle, Loader2, Trash2 } from 'lucide-react';\r\nimport { format, isToday, differenceInCalendarDays } from 'date-fns';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { usePomodoroContext } from '../../../context/PomodoroContext';\r\nimport { useAudio } from '../../../context/AudioContext';\r\nimport { useConfirm } from '../../../context/ConfirmContext';\r\nimport { cn } from '../../../lib/utils';\r\nimport { parseLocalDate } from '../../../utils/dateHelpers';\r\nimport type { Review, Task, Goal, Priority, CalendarIntroItem, CalendarReviewItem, CalendarGoalItem, CalendarTaskItem, Subtheme } from '../../../types';\r\nimport { CalendarEventItem } from './CalendarEventItem';\r\nimport { TaskDetailsModal } from '../../tasks/components/TaskDetailsModal';\r\nimport { GoalDetailsModal } from '../../goals/components/GoalDetailsModal';\r\nimport { ProgressBar } from '../../../components/ui/ProgressBar';\r\n// Lazy load\r\n\r\n\r\ninterface DayDetailsProps {\r\n    date: Date | null;\r\n    events: {\r\n        reviews: CalendarReviewItem[];\r\n        tasks: CalendarTaskItem[];\r\n        goals: CalendarGoalItem[];\r\n        intros?: CalendarIntroItem[];\r\n        projected?: { subthemeTitle: string; themeTitle: string; priority: Priority; description: string }[];\r\n    };\r\n    onStartStudy?: (id: string) => void;\r\n    onCompleteReview?: (subthemeId: string, reviewNumber?: number, type?: 'review' | 'intro', difficulty?: 'easy' | 'medium' | 'hard', summary?: string) => Promise<void>;\r\n    onDeleteGoal: (id: string) => void;\r\n    onDeleteTask?: (id: string) => void;\r\n}\r\n\r\n\r\nconst StudyContentModal = React.lazy(() => import('../../themes/components/StudyContentModal').then(m => ({ default: m.StudyContentModal })));\r\n\r\nexport const DayDetails = ({ events, onStartStudy, onCompleteReview, onDeleteGoal, onDeleteTask, date }: DayDetailsProps) => {\r\n    const { reviews, tasks, goals } = events;\r\n    const { activeFocus, startFocus, endFocus, themes, goals: allGoals, tasks: allTasks, updateSubthemeContent } = useStudy();\r\n    const { startFocusSession, resetTimer } = usePomodoroContext();\r\n    const { stopAudio } = useAudio();\r\n    const { confirm: confirmAction } = useConfirm();\r\n\r\n    // --- DETAIL MODALS STATE ---\r\n    const [selectedTask, setSelectedTask] = useState<Task | null>(null);\r\n    const [selectedGoal, setSelectedGoal] = useState<Goal | null>(null);\r\n    const [selectedSubtheme, setSelectedSubtheme] = useState<Subtheme | null>(null);\r\n\r\n    const handleOpenDetails = (id: string, type: 'task' | 'goal' | 'subtheme') => {\r\n        if (type === 'task') {\r\n            const task = allTasks.find(t => t.id === id);\r\n            if (task) setSelectedTask(task);\r\n        } else if (type === 'goal') {\r\n            const goal = allGoals.find(g => g.id === id);\r\n            if (goal) setSelectedGoal(goal);\r\n        } else if (type === 'subtheme') {\r\n            const subtheme = themes.flatMap(t => t.subthemes).find(st => st.id === id);\r\n            if (subtheme) setSelectedSubtheme(subtheme);\r\n        }\r\n    };\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const targetDate = date ? new Date(date) : today;\r\n    const isFuture = targetDate > today;\r\n    const isPast = targetDate < today;\r\n    const isDateToday = isToday(targetDate);\r\n    const todayStr = format(today, 'yyyy-MM-dd');\r\n    const dateStr = date ? format(targetDate, 'yyyy-MM-dd') : todayStr;\r\n\r\n    const handleStartFocus = (id: string, type: 'task' | 'goal' | 'subtheme', title: string, duration?: number, parentId?: string) => {\r\n        // Apenas bloquear se j√° houver OUTRO item em foco (n√£o o mesmo)\r\n        if (activeFocus && activeFocus.id !== id) {\r\n            console.warn(`‚ö†Ô∏è Outro item j√° est√° em foco: ${activeFocus.id}`);\r\n            return;\r\n        }\r\n\r\n        console.log(`‚ñ∂Ô∏è Iniciando foco para: ${title} (${id})`);\r\n\r\n        startFocus(id, type, title, duration || 25, undefined, undefined, parentId);\r\n        startFocusSession(id, duration || 25); // Start Timer\r\n    };\r\n\r\n    const handleStopFocus = async () => {\r\n        const confirmed = await confirmAction({ message: 'Deseja cancelar o foco atual?', isDangerous: true });\r\n        if (confirmed) {\r\n            endFocus(false); // End without completing\r\n            resetTimer();\r\n            stopAudio(); // Stop background audio\r\n        }\r\n    };\r\n\r\n    if ((!reviews || reviews.length === 0) && (!tasks || tasks.length === 0) && (!goals || goals.length === 0)) {\r\n        return (\r\n            <div className=\"text-center py-8 text-slate-500\">\r\n                <p>Nada agendado para este dia.</p>\r\n                <p className=\"text-sm\">Aproveite para descansar ou adiantar estudos!</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const isSomethingFocused = !!activeFocus;\r\n\r\n    // Sorting Logic\r\n    const getPriorityScore = (p?: string) => {\r\n        switch (p) {\r\n            case 'high': return 3;\r\n            case 'medium': return 2;\r\n            case 'low': return 1;\r\n            default: return 0;\r\n        }\r\n    };\r\n\r\n    interface SortableItem {\r\n        status?: string;\r\n        isCompletedToday?: boolean;\r\n        time?: string;\r\n        scheduledTime?: string;\r\n        priority?: Priority;\r\n        durationMinutes?: number;\r\n    }\r\n\r\n    const sortItems = <T extends SortableItem>(items: T[]) => {\r\n        if (!items) return [];\r\n        return [...items].sort((a, b) => {\r\n            // 1. Status: Pending first (Active > Done)\r\n            const aDone = a.status === 'completed' || a.isCompletedToday;\r\n            const bDone = b.status === 'completed' || b.isCompletedToday;\r\n            if (aDone !== bDone) return aDone ? 1 : -1;\r\n\r\n            // 2. Check if items have scheduled time\r\n            const timeA = a.time || a.scheduledTime || '';\r\n            const timeB = b.time || b.scheduledTime || '';\r\n            const hasTimeA = !!timeA;\r\n            const hasTimeB = !!timeB;\r\n\r\n            // If BOTH have time defined: order by time\r\n            if (hasTimeA && hasTimeB) {\r\n                return timeA.localeCompare(timeB);\r\n            }\r\n\r\n            // If ONLY ONE has time: the one with time comes first\r\n            if (hasTimeA && !hasTimeB) return -1;\r\n            if (!hasTimeA && hasTimeB) return 1;\r\n\r\n            // If NEITHER has time: order by priority (importance)\r\n            const pA = getPriorityScore(a.priority);\r\n            const pB = getPriorityScore(b.priority);\r\n            if (pA !== pB) return pB - pA; // Higher priority first\r\n\r\n            // Fallback: Duration (shorter first for \"quick wins\")\r\n            const durA = a.durationMinutes || 0;\r\n            const durB = b.durationMinutes || 0;\r\n            return durA - durB;\r\n        });\r\n    };\r\n\r\n    const sortedReviews = sortItems(reviews);\r\n    const sortedTasks = sortItems(tasks);\r\n    const sortedGoals = sortItems(goals);\r\n\r\n    // Helper to get completion time\r\n    const getCompletionTime = (item: { completionHistory?: string[] }) => {\r\n        if (!item.completionHistory) return null;\r\n        const entry = item.completionHistory.find((h: string) => h.startsWith(dateStr));\r\n        if (!entry) return null;\r\n        try {\r\n            return format(new Date(entry), 'HH:mm');\r\n        } catch {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={cn(\"space-y-8 w-full overflow-x-hidden relative p-1\", isSomethingFocused && \"opacity-90\")}>\r\n\r\n            {/* SE√á√ÉO 1: INTRODU√á√ïES (NOVOS T√ìPICOS) - INDIGO */}\r\n            {events.intros && events.intros.length > 0 && (\r\n                <div className=\"space-y-3 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                    <h3 className=\"text-[10px] font-bold text-indigo-400 uppercase tracking-widest pl-1 flex items-center gap-2\">\r\n                        <BrainCircuit className=\"w-3 h-3\" />\r\n                        Novos T√≥picos ({events.intros.length})\r\n                    </h3>\r\n                    <div className=\"bg-slate-950/40 border border-white/5 rounded-2xl p-2 space-y-2 relative overflow-hidden group/section\">\r\n                        {events.intros.map((intro: CalendarIntroItem) => (\r\n                            <CalendarEventItem\r\n                                key={intro.id}\r\n                                id={intro.id}\r\n                                title={intro.subthemeTitle}\r\n                                subtitle={intro.themeTitle}\r\n                                type=\"subtheme\"\r\n                                isDone={false}\r\n                                isFuture={isFuture}\r\n                                priority={intro.priority}\r\n                                durationMinutes={intro.durationMinutes}\r\n                                colorTheme=\"indigo\"\r\n                                onFocus={() => handleStartFocus(intro.id, 'subtheme', intro.subthemeTitle, intro.durationMinutes)}\r\n                                onOpenDetails={() => handleOpenDetails(intro.id, 'subtheme')}\r\n                                isActive={activeFocus?.id === intro.id}\r\n                                isSomeoneElseFocused={isSomethingFocused && activeFocus?.id !== intro.id}\r\n                                lockReason={(!isDateToday && !isPast) ? (isFuture ? `Faltam ${differenceInCalendarDays(targetDate, today)} dias` : 'Passado') : undefined}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* SE√á√ÉO 2: REVIS√ïES SRS - BLUE */}\r\n            {sortedReviews && sortedReviews.length > 0 && (\r\n                <div className=\"space-y-3 animate-in fade-in slide-in-from-bottom-5 duration-500\">\r\n                    <h3 className=\"text-[10px] font-bold text-blue-500 uppercase tracking-widest pl-1 flex items-center gap-2\">\r\n                        <BrainCircuit className=\"w-3 h-3\" />\r\n                        Revis√µes SRS ({sortedReviews.length})\r\n                    </h3>\r\n                    <div className=\"bg-slate-950/40 border border-white/5 rounded-2xl p-2 space-y-2\">\r\n                        {sortedReviews.map((r: CalendarReviewItem) => (\r\n                            <CalendarEventItem\r\n                                key={r.id}\r\n                                id={r.id}\r\n                                title={r.subthemeTitle}\r\n                                subtitle={`Revis√£o #${r.number} ‚Ä¢ ${r.themeTitle}`}\r\n                                type=\"subtheme\"\r\n                                isDone={r.status === 'completed'}\r\n                                isFuture={isFuture}\r\n                                priority={r.priority}\r\n                                durationMinutes={r.durationMinutes}\r\n                                completionTime={getCompletionTime(r)}\r\n                                colorTheme=\"blue\"\r\n                                onFocus={() => onStartStudy?.(r.id)}\r\n                                onOpenDetails={() => handleOpenDetails(r.id, 'subtheme')}\r\n                                isActive={activeFocus?.id === r.id}\r\n                                isSomeoneElseFocused={isSomethingFocused && activeFocus?.id !== r.id}\r\n                                lockReason={(!isDateToday && !isPast) ? (isFuture ? `Faltam ${differenceInCalendarDays(targetDate, today)} dias` : 'Passado') : undefined}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* SE√á√ÉO 3: TAREFAS - ROXO */}\r\n            {sortedTasks && sortedTasks.length > 0 && (\r\n                <div className=\"space-y-3 animate-in fade-in slide-in-from-bottom-6 duration-500\">\r\n                    <h3 className=\"text-[10px] font-bold text-purple-400 uppercase tracking-widest pl-1 flex items-center gap-2\">\r\n                        <CheckSquare className=\"w-3 h-3\" />\r\n                        Tarefas ({sortedTasks.length})\r\n                    </h3>\r\n                    <div className=\"bg-slate-950/40 border border-white/5 rounded-2xl p-2 space-y-2\">\r\n                        {sortedTasks.map((t: CalendarTaskItem) => {\r\n                            // Calculate task progress if checklist/subtasks exist, or fallback to status\r\n                            let progress = 0;\r\n                            if (t.progress && t.progress.total > 0) {\r\n                                progress = (t.progress.current / t.progress.total) * 100;\r\n                            } else if (t.status === 'completed') {\r\n                                progress = 100;\r\n                            }\r\n\r\n                            return (\r\n                                <CalendarEventItem\r\n                                    key={t.id}\r\n                                    id={t.id}\r\n                                    title={t.title}\r\n                                    subtitle={\r\n                                        t.type === 'period' && t.startDate && t.endDate\r\n                                            ? `In√≠cio: ${format(parseLocalDate(t.startDate), 'dd/MM/yyyy')} ‚Ä¢ T√©rmino: ${format(parseLocalDate(t.endDate), 'dd/MM/yyyy')}`\r\n                                            : ((t.endDate || t.date) ? `Prazo: ${format(parseLocalDate(t.endDate || t.date || todayStr), 'dd/MM/yyyy')}` : undefined)\r\n                                    }\r\n                                    type=\"task\"\r\n                                    isDone={t.status === 'completed'}\r\n                                    isFuture={isFuture}\r\n                                    priority={t.priority}\r\n                                    durationMinutes={t.durationMinutes}\r\n                                    completionTime={getCompletionTime(t)}\r\n                                    colorTheme=\"purple\"\r\n                                    onFocus={() => handleStartFocus(t.id, 'task', t.title, t.durationMinutes)}\r\n                                    onOpenDetails={() => handleOpenDetails(t.id, 'task')}\r\n                                    onDelete={async () => {\r\n                                        const confirmed = await confirmAction({\r\n                                            message: `Excluir a tarefa \"${t.title}\"?`,\r\n                                            isDangerous: true,\r\n                                            confirmText: \"Excluir\",\r\n                                            cancelText: \"Cancelar\"\r\n                                        });\r\n                                        if (confirmed && onDeleteTask) onDeleteTask(t.id);\r\n                                    }}\r\n                                    isActive={activeFocus?.id === t.id}\r\n                                    isSomeoneElseFocused={isSomethingFocused && activeFocus?.id !== t.id}\r\n                                    lockReason={(!isDateToday && !isPast) ? (isFuture ? `Faltam ${differenceInCalendarDays(targetDate, today)} dias` : 'Passado') : undefined}\r\n                                >\r\n                                    {/* Task Progress Bar */}\r\n                                    {!t.status || t.status !== 'completed' ? (\r\n                                        <div className=\"mt-3\">\r\n                                            <ProgressBar progress={progress} color=\"bg-purple-500\" showLabel height=\"h-1.5\" />\r\n                                        </div>\r\n                                    ) : null}\r\n                                </CalendarEventItem>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* SE√á√ÉO 4: METAS & PROJETOS - ROSA */}\r\n            {sortedGoals && sortedGoals.length > 0 && (\r\n                <div className=\"space-y-3 animate-in fade-in slide-in-from-bottom-7 duration-500\">\r\n                    <h3 className=\"text-[10px] font-bold text-pink-400 uppercase tracking-widest pl-1 flex items-center gap-2\">\r\n                        <Flag className=\"w-3 h-3\" />\r\n                        Metas & Projetos ({sortedGoals.length})\r\n                    </h3>\r\n                    <div className=\"bg-slate-950/40 border border-white/5 rounded-2xl p-2 space-y-2\">\r\n                        {sortedGoals.map((g: CalendarGoalItem) => {\r\n                            const isStep = g.type === 'goal-step' || g.type === 'goal-phase';\r\n                            const eventId = (g.checklist_item_id || g.id) as string;\r\n                            const isProject = g.type.startsWith('project');\r\n\r\n                            // Determine Progress\r\n                            let progress = g.progress || 0;\r\n                            if (g.phaseProgress !== undefined) progress = g.phaseProgress;\r\n\r\n                            // Label logic\r\n                            let label = g.label || (g.deadline ? `Prazo: ${format(parseLocalDate(g.deadline), 'dd/MM/yyyy')}` : g.type);\r\n                            if (g.startDate && g.deadline) {\r\n                                label = `In√≠cio: ${format(parseLocalDate(g.startDate), 'dd/MM/yyyy')} ‚Ä¢ T√©rmino: ${format(parseLocalDate(g.deadline), 'dd/MM/yyyy')}`;\r\n                            }\r\n                            if (isStep) label = `${g.parentGoalTitle} ‚Ä¢ Etapa`;\r\n\r\n                            return (\r\n                                <CalendarEventItem\r\n                                    key={`${g.id}-${g.checklist_item_id || 'main'}`}\r\n                                    id={eventId}\r\n                                    title={g.title}\r\n                                    subtitle={label}\r\n                                    type=\"goal\"\r\n                                    isDone={g.isCompletedToday || false}\r\n                                    isFuture={isFuture}\r\n                                    priority={g.priority}\r\n                                    durationMinutes={g.durationMinutes}\r\n                                    completionTime={getCompletionTime(g)}\r\n                                    colorTheme={isProject ? \"indigo\" : \"pink\"} // Differentiate projects visually if desired, or keep pink\r\n                                    onFocus={() => handleStartFocus(eventId, 'goal', g.title, g.durationMinutes, g.parentGoalId)}\r\n                                    onOpenDetails={() => handleOpenDetails(g.id, 'goal')}\r\n                                    onDelete={async () => {\r\n                                        const idToDelete = (g.parentGoalId || g.id) as string;\r\n                                        const message = isStep ? 'Excluir este projeto COMPLETO (todas as etapas)?' : (isProject ? 'Excluir Projeto?' : 'Excluir Meta?');\r\n                                        const confirmed = await confirmAction({\r\n                                            message,\r\n                                            isDangerous: true,\r\n                                            confirmText: \"Excluir\",\r\n                                            cancelText: \"Cancelar\"\r\n                                        });\r\n                                        if (confirmed && onDeleteGoal) onDeleteGoal(idToDelete);\r\n                                    }}\r\n                                    isActive={activeFocus?.id === eventId}\r\n                                    isSomeoneElseFocused={isSomethingFocused && activeFocus?.id !== eventId}\r\n                                    lockReason={(!isDateToday && !isPast) ? (isFuture ? `Faltam ${differenceInCalendarDays(targetDate, today)} dias` : 'Passado') : undefined}\r\n                                >\r\n                                    {/* Goal/Project Progress Bar */}\r\n                                    {!g.isCompletedToday && (\r\n                                        <div className=\"mt-3\">\r\n                                            <ProgressBar\r\n                                                progress={progress}\r\n                                                color={isProject ? \"bg-indigo-500\" : \"bg-pink-500\"}\r\n                                                showLabel\r\n                                                height=\"h-1.5\"\r\n                                            />\r\n                                        </div>\r\n                                    )}\r\n                                </CalendarEventItem>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* SE√á√ÉO 5: PREVISTOS/SIMULA√á√ÉO */}\r\n            {events.projected && events.projected.length > 0 && (\r\n                <div className=\"pt-6 border-t border-white/5 mt-4 opacity-50\">\r\n                    <h3 className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest pl-1 mb-3\">\r\n                        Simula√ß√£o Futura\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-1 gap-2\">\r\n                        {events.projected.map((p, idx) => (\r\n                            <div key={idx} className=\"p-3 border border-dashed border-slate-700/50 rounded-xl bg-slate-900/30 flex justify-between items-center\">\r\n                                <div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <p className=\"font-medium text-slate-400 text-sm\">{p.subthemeTitle}</p>\r\n                                        <Flag className={cn(\"w-3 h-3 fill-current\", p.priority === 'high' ? 'text-red-500' : p.priority === 'medium' ? 'text-amber-500' : 'text-emerald-500')} />\r\n                                    </div>\r\n                                    <p className=\"text-[10px] text-slate-600\">{p.themeTitle} ‚Ä¢ {p.description}</p>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Modals for Details */}\r\n            <TaskDetailsModal\r\n                isOpen={!!selectedTask}\r\n                onClose={() => setSelectedTask(null)}\r\n                task={selectedTask}\r\n            />\r\n\r\n            <GoalDetailsModal\r\n                isOpen={!!selectedGoal}\r\n                onClose={() => setSelectedGoal(null)}\r\n                goal={selectedGoal}\r\n            />\r\n\r\n            <React.Suspense fallback={null}>\r\n                <StudyContentModal\r\n                    isOpen={!!selectedSubtheme}\r\n                    onClose={() => setSelectedSubtheme(null)}\r\n                    subtheme={selectedSubtheme}\r\n                    onSave={(content: string) => {\r\n                        if (selectedSubtheme) {\r\n                            updateSubthemeContent(selectedSubtheme.id, content);\r\n                        }\r\n                    }}\r\n                />\r\n            </React.Suspense>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\UpcomingReviewsSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isBlueDefault' is assigned a value but never used.","line":53,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":48}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { PlayCircle } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport { Button } from '../../../components/ui/Button';\r\n\r\ninterface UpcomingReviewsSidebarProps {\r\n    upcomingList: {\r\n        id: string;\r\n        number: number;\r\n        date: string;\r\n        themeTitle: string;\r\n        subthemeTitle: string;\r\n        type: 'active' | 'projected';\r\n        status: 'pending' | 'completed';\r\n        originalDate: Date;\r\n        color?: string;\r\n    }[];\r\n    now: Date;\r\n    activeFocus: { id: string } | null;\r\n    onStartFocus: (item: any) => void;\r\n}\r\n\r\nexport const UpcomingReviewsSidebar: React.FC<UpcomingReviewsSidebarProps> = ({\r\n    upcomingList,\r\n    now,\r\n    activeFocus,\r\n    onStartFocus\r\n}) => {\r\n    return (\r\n        <div className=\"lg:col-span-1 space-y-6\">\r\n            <div className=\"bg-slate-900/50 border border-white/5 rounded-2xl p-6 backdrop-blur-xl\">\r\n                <h3 className=\"text-lg font-bold text-white mb-4 flex items-center gap-2\">\r\n                    <PlayCircle className=\"w-5 h-5 text-blue-400\" />\r\n                    Cronograma\r\n                </h3>\r\n\r\n                <div className=\"space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\r\n                    {upcomingList.length === 0 ? (\r\n                        <p className=\"text-slate-500 text-sm text-center py-4\">Nenhuma revis√£o pr√≥xima encontrada.</p>\r\n                    ) : (\r\n                        upcomingList.map((item: any, idx: number) => {\r\n                            const isProjected = item.type === 'projected';\r\n                            const todayTime = new Date(now);\r\n                            todayTime.setHours(0, 0, 0, 0);\r\n\r\n                            const isTodayItem = item.originalDate.getTime() === todayTime.getTime();\r\n                            const isOverdue = !isProjected && item.originalDate < todayTime;\r\n\r\n                            // Dynamic styling based on item color\r\n                            const themeColor = item.color || '#3b82f6';\r\n                            const isBlueDefault = themeColor === '#3b82f6'; // Check if default to avoid overpowering blue if random wasn't used?\r\n\r\n                            return (\r\n                                <div\r\n                                    key={`${item.id}-${item.number}-${idx}`}\r\n                                    style={{\r\n                                        borderColor: isProjected ? undefined : `${themeColor}40`, // 25% opacity\r\n                                        background: isProjected\r\n                                            ? undefined\r\n                                            : `linear-gradient(to right, ${themeColor}08, transparent)` // 5% opacity from left\r\n                                    }}\r\n                                    className={cn(\r\n                                        \"relative p-3 rounded-xl border transition-all group hover:scale-[1.02] overflow-hidden\",\r\n                                        isProjected\r\n                                            ? \"bg-slate-800/30 border-dashed border-slate-700/50 opacity-70 hover:opacity-100\"\r\n                                            : \"bg-slate-900/40 hover:bg-slate-900/60 shadow-lg\",\r\n                                        // Overrides for Overdue/Today\r\n                                        isOverdue && !isProjected && \"ring-1 ring-red-500/50 border-red-500/50 bg-red-950/20\",\r\n                                        isTodayItem && !isOverdue && !isProjected && \"ring-1 ring-blue-500/50 border-blue-500/50 bg-blue-950/20\"\r\n                                    )}\r\n                                >\r\n                                    {/* Accent Bar on Left */}\r\n                                    {!isProjected && (\r\n                                        <div\r\n                                            className=\"absolute left-0 top-0 bottom-0 w-1\"\r\n                                            style={{ backgroundColor: themeColor }}\r\n                                        />\r\n                                    )}\r\n\r\n                                    <div className=\"flex justify-between items-start mb-1 pl-2\">\r\n                                        <span className={cn(\r\n                                            \"text-[10px] font-bold uppercase tracking-wider\",\r\n                                            isProjected ? \"text-slate-500\" : \"text-slate-300\",\r\n                                            isOverdue && \"text-red-400 animate-pulse\",\r\n                                            isTodayItem && !isOverdue && \"text-blue-400\"\r\n                                        )}>\r\n                                            {isOverdue ? 'Atrasado' : (isTodayItem ? 'Hoje' : format(item.originalDate, \"d 'de' MMM\", { locale: ptBR }))}\r\n                                        </span>\r\n                                        <div\r\n                                            className=\"px-1.5 py-0.5 rounded text-[10px] bg-slate-950 border border-white/5\"\r\n                                            style={{ color: isProjected ? undefined : themeColor }}\r\n                                        >\r\n                                            #{item.number}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <h4 className={cn(\r\n                                        \"font-bold text-sm truncate mb-1 pl-2\",\r\n                                        isProjected ? \"text-slate-400\" : \"text-white\"\r\n                                    )}>\r\n                                        {item.subthemeTitle}\r\n                                    </h4>\r\n\r\n                                    <div className=\"flex items-center gap-2 text-[10px] text-slate-500 pl-2\">\r\n                                        <div\r\n                                            className=\"w-1.5 h-1.5 rounded-full\"\r\n                                            style={{ backgroundColor: themeColor }}\r\n                                        />\r\n                                        <span className=\"truncate\">{item.themeTitle}</span>\r\n                                    </div>\r\n\r\n                                    {(isTodayItem || isOverdue) && !isProjected && !activeFocus && (\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            style={{\r\n                                                backgroundColor: isOverdue ? undefined : themeColor,\r\n                                                borderColor: isOverdue ? undefined : themeColor\r\n                                            }}\r\n                                            className={cn(\r\n                                                \"w-full mt-3 h-7 text-xs border-0 text-white shadow-lg\",\r\n                                                isOverdue ? \"bg-red-600 hover:bg-red-500\" : \"hover:brightness-110\"\r\n                                            )}\r\n                                            onClick={() => onStartFocus(item)}\r\n                                        >\r\n                                            {isOverdue ? 'Revisar Agora' : 'Iniciar'}\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\__tests__\\CalendarEventItem.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\components\\__tests__\\DayDetails.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\calendar\\hooks\\useCalendarEvents.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'addDays' is defined but never used.","line":4,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSameMonth' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validGoalIds' is assigned a value but never used.","line":177,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":177,"endColumn":27}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useEffect } from 'react';\r\nimport {\r\n    format,\r\n    addDays,\r\n    addMonths,\r\n    subMonths,\r\n    startOfMonth,\r\n    endOfMonth,\r\n    startOfWeek,\r\n    endOfWeek,\r\n    eachDayOfInterval,\r\n    isSameMonth\r\n} from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { getAllProjectedReviews } from '../../../lib/srs';\r\nimport { parseLocalDate } from '../../../utils/dateHelpers';\r\nimport type { Theme, Task, Goal, Project } from '../../../types';\r\n\r\ninterface UseCalendarEventsProps {\r\n    themes: Theme[];\r\n    tasks: Task[];\r\n    goals: Goal[];\r\n    projects: Project[];\r\n}\r\n\r\ninterface DayEvents {\r\n    reviews: any[];\r\n    intros: any[];\r\n    projected: any[];\r\n    tasks: any[];\r\n    goals: any[];\r\n}\r\n\r\nexport const useCalendarEvents = ({ themes, tasks, goals, projects }: UseCalendarEventsProps) => {\r\n    const [currentMonth, setCurrentMonth] = useState(new Date());\r\n    const [now, setNow] = useState(new Date());\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => setNow(new Date()), 60000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const nextMonth = () => setCurrentMonth(addMonths(currentMonth, 1));\r\n    const prevMonth = () => setCurrentMonth(subMonths(currentMonth, 1));\r\n\r\n    const { calendarDays } = useMemo(() => {\r\n        const monthStart = startOfMonth(currentMonth);\r\n        const monthEnd = endOfMonth(monthStart);\r\n        const startDate = startOfWeek(monthStart);\r\n        const endDate = endOfWeek(monthEnd);\r\n        const calendarDays = eachDayOfInterval({ start: startDate, end: endDate });\r\n        return { calendarDays };\r\n    }, [currentMonth]);\r\n\r\n    const allProjectedReviews = useMemo(() => getAllProjectedReviews(themes), [themes]);\r\n\r\n    const eventsMap = useMemo(() => {\r\n        const map = new Map<string, DayEvents>();\r\n\r\n        const getDay = (dateStr: string): DayEvents => {\r\n            if (!map.has(dateStr)) {\r\n                map.set(dateStr, { reviews: [], intros: [], projected: [], tasks: [], goals: [] });\r\n            }\r\n            return map.get(dateStr)!;\r\n        };\r\n\r\n        themes.forEach(t => {\r\n            // Handling for PROJECTS in Calendar\r\n            if (t.category === 'project') {\r\n                // For projects, we want to show modules.\r\n                // If they have explicit dates (not yet standard in subtheme, but maybe via 'introductionDate' used as 'deadline' or 'start'?)\r\n                // Currently subthemes have 'introductionDate'. We can use that as the \"Schedule Date\".\r\n                (t.subthemes || []).forEach(st => {\r\n                    if (st.status !== 'completed' && st.introductionDate) {\r\n                        const d = getDay(st.introductionDate); // Or fallback to today if \"Active\"?\r\n                        // Projects act like Tasks.\r\n                        d.tasks.push({\r\n                            id: st.id,\r\n                            title: `${st.title} (${t.title})`,\r\n                            type: 'project-step', // Custom type to distinguish\r\n                            date: st.introductionDate,\r\n                            status: 'pending',\r\n                            priority: t.priority,\r\n                            color: t.color || '#8b5cf6', // Violet for projects\r\n                            isCompletedToday: false\r\n                        });\r\n                    } else if (st.status === 'completed' && st.introductionDate) {\r\n                        // Show completed project steps too?\r\n                        const d = getDay(st.introductionDate);\r\n                        d.tasks.push({\r\n                            id: st.id,\r\n                            title: `${st.title} (${t.title})`,\r\n                            type: 'project-step',\r\n                            date: st.introductionDate,\r\n                            status: 'completed',\r\n                            priority: t.priority,\r\n                            color: t.color || '#8b5cf6',\r\n                            isCompletedToday: true // Assume done on intro date for now or we need completion timestamp\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Standard SRS Logic for Study Themes\r\n            if (t.category !== 'project') {\r\n                (t.subthemes || []).forEach(st => {\r\n                    (st.reviews || []).forEach(r => {\r\n                        const dateKey = r.date.includes('T') ? r.date.split('T')[0] : r.date;\r\n                        const d = getDay(dateKey);\r\n                        d.reviews.push({ ...r, themeTitle: t.title, subthemeTitle: st.title, type: 'review', id: st.id, durationMinutes: st.durationMinutes, priority: t.priority, timeSpent: st.timeSpent, color: t.color || '#3b82f6' });\r\n                    });\r\n                    if (st.introductionDate) {\r\n                        const d = getDay(st.introductionDate);\r\n                        d.intros.push({ themeTitle: t.title, subthemeTitle: st.title, type: 'intro', durationMinutes: st.durationMinutes, priority: t.priority, timeSpent: st.timeSpent, id: st.id, color: t.color || '#f59e0b' });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        allProjectedReviews.forEach((p: any) => {\r\n            const d = getDay(p.date);\r\n            d.projected.push(p);\r\n        });\r\n\r\n        console.log('üìÖ === BUILDING EVENTS MAP ===');\r\n        console.log('üìÖ Total tasks in system:', tasks.length);\r\n        console.log('üìÖ Total goals in system:', goals.length);\r\n\r\n        tasks.forEach(t => {\r\n            console.log(`  üìã Task: \"${t.title}\" | type: ${t.type} | date: ${t.date} | startDate: ${t.startDate} | endDate: ${t.endDate}`);\r\n            if (t.type === 'day' && t.date) {\r\n                console.log(`    ‚úÖ DAY task - adding to ${t.date}`);\r\n                const d = getDay(t.date);\r\n                d.tasks.push({ ...t, color: t.color, isCompletedToday: t.status === 'completed' });\r\n            } else if (t.type === 'period' && t.startDate && t.endDate) {\r\n                console.log(`    ‚úÖ PERIOD task - adding from ${t.startDate} to ${t.endDate}`);\r\n                eachDayOfInterval({\r\n                    start: parseLocalDate(t.startDate),\r\n                    end: parseLocalDate(t.endDate)\r\n                }).forEach(date => {\r\n                    const dateStr = format(date, 'yyyy-MM-dd');\r\n                    const d = getDay(dateStr);\r\n                    const isCompleted = t.completionHistory?.some(h => h.startsWith(dateStr)) || false;\r\n\r\n                    let label: string | undefined;\r\n                    const start = t.startDate ? t.startDate.split('T')[0] : '';\r\n                    const end = t.endDate ? t.endDate.split('T')[0] : '';\r\n\r\n                    if (dateStr === start) label = 'In√≠cio';\r\n                    else if (dateStr === end) label = 'Prazo';\r\n                    else label = 'Em andamento';\r\n\r\n                    d.tasks.push({ ...t, color: t.color, isCompletedToday: isCompleted, label });\r\n                });\r\n            } else if (t.type === 'recurring' && t.recurrence) {\r\n                console.log(`    ‚úÖ RECURRING task - recurrence: ${t.recurrence}`);\r\n                calendarDays.forEach(day => {\r\n                    const dateStr = format(day, 'yyyy-MM-dd');\r\n                    const dayOfWeek = day.getDay();\r\n                    const taskStart = new Date(t.createdAt).setHours(0, 0, 0, 0);\r\n                    if (day.getTime() < taskStart) return;\r\n                    if (t.endDate && dateStr > t.endDate) return;\r\n\r\n                    if (t.recurrence?.includes(dayOfWeek)) {\r\n                        const d = getDay(dateStr);\r\n                        const isCompleted = t.completionHistory?.some(h => h.startsWith(dateStr)) || false;\r\n                        d.tasks.push({ ...t, color: t.color, isCompletedToday: isCompleted });\r\n                    }\r\n                });\r\n            } else {\r\n                console.log(`    ‚ùå Task did NOT match any filter`);\r\n            }\r\n        });\r\n        console.log('üìÖ === EVENTS MAP BUILT ===');\r\n\r\n        // Create a Set of valid goal IDs for quick lookup\r\n        const validGoalIds = new Set(goals.map(g => g.id));\r\n\r\n        goals.forEach(g => {\r\n            // Extra safety: skip if goal doesn't have required fields\r\n            if (!g || !g.id) return;\r\n\r\n            if (g.type === 'checklist' && g.checklist) {\r\n                const steps = [...g.checklist].sort((a: any, b: any) => a.order - b.order);\r\n                let currentPhaseStart = g.startDate ? parseLocalDate(g.startDate) : new Date(g.createdAt);\r\n\r\n                steps.forEach((item: any) => {\r\n                    if (!item.deadline) return;\r\n                    const phaseStart = new Date(currentPhaseStart);\r\n                    phaseStart.setHours(0, 0, 0, 0);\r\n\r\n                    const itemDeadlineKey = item.deadline.includes('T') ? item.deadline.split('T')[0] : item.deadline;\r\n                    const inputs = itemDeadlineKey.split('-').map(Number);\r\n                    const phaseEnd = new Date(inputs[0], inputs[1] - 1, inputs[2]);\r\n                    phaseEnd.setHours(0, 0, 0, 0);\r\n\r\n                    const iterDate = new Date(phaseStart);\r\n                    while (iterDate <= phaseEnd) {\r\n                        const dateKey = format(iterDate, 'yyyy-MM-dd');\r\n                        const d = getDay(dateKey);\r\n                        const history = item.completionHistory || [];\r\n                        const isCompletedToday = history.some((h: string) => h.startsWith(dateKey));\r\n                        const windowDays = Math.ceil((phaseEnd.getTime() - phaseStart.getTime()) / (1000 * 60 * 60 * 24)) + 1;\r\n                        const uniqueChecks = new Set(history.map((h: string) => h.split('T')[0])).size;\r\n                        const progress = Math.min(100, Math.round((uniqueChecks / windowDays) * 100));\r\n\r\n                        d.goals.push({\r\n                            id: item.id,\r\n                            type: 'goal-phase',\r\n                            title: item.title,\r\n                            parentGoalId: g.id,\r\n                            parentGoalTitle: g.title,\r\n                            checklist_item_id: item.id,\r\n                            isCompletedToday: isCompletedToday,\r\n                            color: g.color || '#ec4899',\r\n                            priority: g.priority,\r\n                            deadline: item.deadline,\r\n                            durationMinutes: parseInt(item.estimatedTime) || 0,\r\n                            phaseProgress: progress,\r\n                            currentDay: Math.ceil((iterDate.getTime() - phaseStart.getTime()) / (1000 * 60 * 60 * 24)) + 1,\r\n                            totalDays: windowDays\r\n                        });\r\n                        iterDate.setDate(iterDate.getDate() + 1);\r\n                    }\r\n                    currentPhaseStart = new Date(phaseEnd);\r\n                    currentPhaseStart.setDate(currentPhaseStart.getDate() + 1);\r\n                });\r\n            }\r\n\r\n            if (g.type === 'habit') {\r\n                calendarDays.forEach(day => {\r\n                    const dateStr = format(day, 'yyyy-MM-dd');\r\n                    const dayOfWeek = day.getDay();\r\n                    const goalStart = g.createdAt ? new Date(g.createdAt).setHours(0, 0, 0, 0) : 0;\r\n                    if (day.getTime() < goalStart) return;\r\n                    if (g.deadline && dateStr > g.deadline) return;\r\n\r\n                    if (!g.recurrence || g.recurrence.length === 0 || g.recurrence.includes(dayOfWeek)) {\r\n                        const d = getDay(dateStr);\r\n                        const isCompleted = g.completionHistory?.some(h => h.startsWith(dateStr)) || false;\r\n                        d.goals.push({ ...g, color: g.color, isCompletedToday: isCompleted, isParent: true });\r\n                    }\r\n                });\r\n            } else if (g.deadline) {\r\n                // Duration Logic\r\n                const start = g.startDate ? g.startDate.split('T')[0] : null;\r\n                const end = g.deadline.split('T')[0];\r\n\r\n                if (start && end) {\r\n                    eachDayOfInterval({\r\n                        start: parseLocalDate(start),\r\n                        end: parseLocalDate(end)\r\n                    }).forEach(date => {\r\n                        const dateStr = format(date, 'yyyy-MM-dd');\r\n                        const d = getDay(dateStr);\r\n                        const isEnd = dateStr === end;\r\n                        const isStart = dateStr === start;\r\n                        const isCompleted = g.progress === 100;\r\n\r\n                        d.goals.push({\r\n                            ...g,\r\n                            color: g.color || '#3b82f6',\r\n                            isCompletedToday: isEnd ? isCompleted : false,\r\n                            isParent: true,\r\n                            label: isEnd ? 'Prazo' : (isStart ? 'In√≠cio' : 'Em andamento')\r\n                        });\r\n                    });\r\n                } else {\r\n                    // Single deadline fallback\r\n                    const dDeadline = getDay(end);\r\n                    const isCompleted = g.progress === 100;\r\n                    dDeadline.goals.push({ ...g, color: g.color, isCompletedToday: isCompleted, isParent: true, label: 'Prazo' });\r\n                }\r\n            }\r\n        });\r\n\r\n        // === PROJECTS ===\r\n        projects.forEach(p => {\r\n            const start = p.startDate;\r\n            const end = p.deadline;\r\n\r\n            // Duration Logic for Projects\r\n            if (start && end) {\r\n                eachDayOfInterval({\r\n                    start: parseLocalDate(start),\r\n                    end: parseLocalDate(end)\r\n                }).forEach(date => {\r\n                    const dateStr = format(date, 'yyyy-MM-dd');\r\n                    const d = getDay(dateStr);\r\n                    const isEnd = dateStr === end;\r\n                    const isStart = dateStr === start;\r\n\r\n                    d.goals.push({\r\n                        id: p.id,\r\n                        title: p.title,\r\n                        type: isEnd ? 'project-deadline' : (isStart ? 'project-start' : 'project-step'),\r\n                        date: dateStr,\r\n                        color: p.color || '#8b5cf6', // Violet\r\n                        priority: isEnd ? 'high' : 'medium',\r\n                        isParent: true,\r\n                        label: isEnd ? 'Prazo Projeto' : (isStart ? 'In√≠cio Projeto' : 'Projeto em Andamento'),\r\n                        isCompletedToday: isEnd ? p.progress === 100 : false\r\n                    });\r\n                });\r\n            }\r\n            // Fallback for single deadline\r\n            else if (end) {\r\n                const d = getDay(end);\r\n                const isCompleted = p.progress === 100;\r\n                d.goals.push({\r\n                    id: p.id,\r\n                    title: p.title,\r\n                    type: 'project-deadline',\r\n                    date: end,\r\n                    color: p.color || '#8b5cf6',\r\n                    priority: 'high',\r\n                    isParent: true,\r\n                    label: 'Prazo Final',\r\n                    isCompletedToday: isCompleted\r\n                });\r\n            }\r\n\r\n            // 3. Milestones\r\n            if (p.milestones && p.milestones.length > 0) {\r\n                p.milestones.forEach(m => {\r\n                    if (m.dueDate) {\r\n                        const d = getDay(m.dueDate);\r\n                        d.goals.push({\r\n                            id: m.id,\r\n                            title: m.title,\r\n                            parentGoalTitle: p.title, // Use parent context\r\n                            type: 'project-milestone',\r\n                            date: m.dueDate,\r\n                            color: p.color || '#8b5cf6',\r\n                            priority: 'medium',\r\n                            isCompletedToday: m.completed,\r\n                            label: 'Marco'\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return map;\r\n    }, [themes, allProjectedReviews, tasks, goals, projects, calendarDays]);\r\n\r\n    // Create Sets of valid IDs for filtering (outside useMemo so they're always fresh)\r\n    const currentGoalIds = new Set(goals.map(g => g.id));\r\n    const currentTaskIds = new Set(tasks.map(t => t.id));\r\n    const currentSubthemeIds = new Set(\r\n        themes.flatMap(t => t.subthemes.map(st => st.id))\r\n    );\r\n\r\n    const getEventsForDay = (date: Date) => {\r\n        const dateStr = format(date, 'yyyy-MM-dd');\r\n        const dayEvents = eventsMap.get(dateStr) || { reviews: [], intros: [], projected: [], tasks: [], goals: [] };\r\n\r\n        // Filter out goals that reference deleted parent goals\r\n        const filteredGoals = (dayEvents.goals || []).filter((g: any) => {\r\n            // If it's a goal-phase (step), check if parent goal still exists\r\n            if (g.parentGoalId) {\r\n                return currentGoalIds.has(g.parentGoalId);\r\n            }\r\n            // If it's a regular goal, check if it still exists\r\n            if (g.id) {\r\n                return currentGoalIds.has(g.id);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        // Filter out tasks that have been deleted\r\n        const filteredTasks = (dayEvents.tasks || []).filter((t: any) => {\r\n            if (t.id) {\r\n                return currentTaskIds.has(t.id);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        // Filter out reviews/intros for deleted subthemes\r\n        const filteredReviews = (dayEvents.reviews || []).filter((r: any) => {\r\n            if (r.subthemeId) {\r\n                return currentSubthemeIds.has(r.subthemeId);\r\n            }\r\n            if (r.id) {\r\n                return currentSubthemeIds.has(r.id);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        const filteredIntros = (dayEvents.intros || []).filter((i: any) => {\r\n            if (i.subthemeId) {\r\n                return currentSubthemeIds.has(i.subthemeId);\r\n            }\r\n            if (i.id) {\r\n                return currentSubthemeIds.has(i.id);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        const filteredProjected = (dayEvents.projected || []).filter((p: any) => {\r\n            if (p.subthemeId) {\r\n                return currentSubthemeIds.has(p.subthemeId);\r\n            }\r\n            if (p.id) {\r\n                return currentSubthemeIds.has(p.id);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        return {\r\n            reviews: filteredReviews,\r\n            intros: filteredIntros,\r\n            projected: filteredProjected,\r\n            tasks: filteredTasks,\r\n            goals: filteredGoals\r\n        };\r\n    };\r\n\r\n    const upcomingList = useMemo(() => {\r\n        const today = new Date(now);\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        const activeReviews: any[] = [];\r\n        themes.forEach(t => {\r\n            t.subthemes.forEach(st => {\r\n                st.reviews.forEach(r => {\r\n                    if (r.status === 'pending') {\r\n                        activeReviews.push({\r\n                            ...r,\r\n                            themeTitle: t.title,\r\n                            subthemeTitle: st.title,\r\n                            id: st.id,\r\n                            type: 'active',\r\n                            originalDate: new Date(r.date),\r\n                            color: t.color || '#3b82f6'\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        const projected = allProjectedReviews\r\n            .filter((p: any) => parseLocalDate(p.date) >= today)\r\n            .map((p: any) => ({\r\n                ...p,\r\n                type: 'projected',\r\n                status: 'pending',\r\n                originalDate: parseLocalDate(p.date),\r\n                number: parseInt(p.description.match(/#(\\d+)/)?.[1] || '0')\r\n            }));\r\n\r\n        const combined = [...activeReviews, ...projected].sort((a, b) => a.originalDate.getTime() - b.originalDate.getTime());\r\n        return combined.slice(0, 15);\r\n    }, [themes, allProjectedReviews, now]);\r\n\r\n    return {\r\n        currentMonth,\r\n        now,\r\n        calendarDays,\r\n        nextMonth,\r\n        prevMonth,\r\n        setCurrentMonth,\r\n        getEventsForDay,\r\n        upcomingList\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\AnalyticsWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Zap' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useStudy } from '../../context/StudyContext';\r\nimport { Zap, Clock, Target } from 'lucide-react';\r\nimport { RetentionChart } from './RetentionChart';\r\n\r\nexport const AnalyticsWidget = () => {\r\n    const { gamification, goals } = useStudy();\r\n    const defaultStats = { reviewsCompleted: 0, tasksCompleted: 0, habitsCompleted: 0, totalFocusMinutes: 0, dailyXp: 0, lastXpDate: '', dailyHistory: {} };\r\n    const stats = { ...defaultStats, ...(gamification?.stats || {}) };\r\n\r\n    // Calculate Stats\r\n    const totalHours = (stats.totalFocusMinutes / 60).toFixed(1);\r\n    const completedGoals = goals.filter(g => g.progress === 100).length;\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\r\n            {/* Chart Section - New Advanced Retention Chart */}\r\n            <div className=\"lg:col-span-2\">\r\n                <RetentionChart />\r\n            </div>\r\n\r\n            {/* Metrics Section */}\r\n            <div className=\"space-y-6\">\r\n                <div className=\"bg-slate-900/40 backdrop-blur-xl border border-white/10 rounded-[2rem] p-8 relative overflow-hidden group hover:bg-slate-800/40 transition-all duration-500 shadow-2xl\">\r\n                    <div className=\"absolute top-0 right-0 -mr-4 -mt-4 w-32 h-32 bg-yellow-500/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700\" />\r\n\r\n                    <div className=\"relative z-10\">\r\n                        <div className=\"flex items-center gap-3 mb-4\">\r\n                            <div className=\"p-2.5 rounded-xl bg-yellow-500/10 text-yellow-500 border border-yellow-500/20\">\r\n                                <Clock className=\"w-5 h-5\" />\r\n                            </div>\r\n                            <span className=\"text-sm font-bold text-slate-400 uppercase tracking-widest\">Tempo Total</span>\r\n                        </div>\r\n                        <div className=\"flex items-baseline gap-1\">\r\n                            <div className=\"text-5xl font-black text-white tracking-tighter drop-shadow-lg\">\r\n                                {totalHours}\r\n                            </div>\r\n                            <span className=\"text-xl font-medium text-slate-500\">horas</span>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 pt-4 border-t border-white/5 flex items-center justify-between text-xs font-medium text-slate-400\">\r\n                            <span>{stats.totalFocusMinutes} minutos totais</span>\r\n                            <span className=\"text-yellow-500 bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20\">Foco Vital√≠cio</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-slate-900/40 backdrop-blur-xl border border-white/10 rounded-[2rem] p-8 relative overflow-hidden group hover:bg-slate-800/40 transition-all duration-500 shadow-2xl\">\r\n                    <div className=\"absolute top-0 right-0 -mr-4 -mt-4 w-32 h-32 bg-purple-500/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700\" />\r\n\r\n                    <div className=\"relative z-10\">\r\n                        <div className=\"flex items-center gap-3 mb-4\">\r\n                            <div className=\"p-2.5 rounded-xl bg-purple-500/10 text-purple-500 border border-purple-500/20\">\r\n                                <Target className=\"w-5 h-5\" />\r\n                            </div>\r\n                            <span className=\"text-sm font-bold text-slate-400 uppercase tracking-widest\">Conquistas</span>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <div className=\"text-4xl font-black text-white tracking-tighter\">{completedGoals}</div>\r\n                                <div className=\"text-xs font-bold text-emerald-400 mt-1 flex items-center gap-1\">\r\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-500\" />\r\n                                    METAS\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"pl-4 border-l border-white/10\">\r\n                                <div className=\"text-4xl font-black text-white tracking-tighter\">{stats.tasksCompleted}</div>\r\n                                <div className=\"text-xs font-bold text-blue-400 mt-1 flex items-center gap-1\">\r\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-blue-500\" />\r\n                                    TAREFAS\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\CalendarWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Task' is defined but never used.","line":23,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleTask' is assigned a value but never used.","line":26,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":80},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoal' is assigned a value but never used.","line":26,"column":82,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":92},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoalItem' is assigned a value but never used.","line":26,"column":94,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":108}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { useProjectContext } from '../../context/ProjectProvider';\r\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\r\nimport {\r\n    format,\r\n    startOfMonth,\r\n    endOfMonth,\r\n    startOfWeek,\r\n    endOfWeek,\r\n    eachDayOfInterval,\r\n    addMonths,\r\n    subMonths,\r\n    isSameMonth,\r\n    isToday\r\n} from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { cn } from '../../lib/utils';\r\nimport { Card } from '../../components/ui/Card';\r\nimport { Modal } from '../../components/ui/Modal';\r\nimport { DayDetails } from '../calendar/components/DayDetails';\r\nimport { getAllProjectedReviews } from '../../lib/srs';\r\nimport type { Task, CalendarReviewItem, CalendarGoalItem, CalendarTaskItem } from '../../types';\r\n\r\nexport const CalendarWidget = () => {\r\n    const { themes, tasks, goals, completeReview, startStudySession, toggleTask, toggleGoal, toggleGoalItem, deleteTask, deleteGoal } = useStudy();\r\n    const { projects } = useProjectContext();\r\n    const [currentMonth, setCurrentMonth] = useState(new Date());\r\n    const [selectedDate, setSelectedDate] = useState<Date | null>(null);\r\n\r\n    // Navigation\r\n    const nextMonth = () => setCurrentMonth(addMonths(currentMonth, 1));\r\n    const prevMonth = () => setCurrentMonth(subMonths(currentMonth, 1));\r\n\r\n    // Calendar Generation\r\n    const monthStart = startOfMonth(currentMonth);\r\n    const monthEnd = endOfMonth(monthStart);\r\n    const startDate = startOfWeek(monthStart);\r\n    const endDate = endOfWeek(monthEnd);\r\n\r\n    const calendarDays = eachDayOfInterval({ start: startDate, end: endDate });\r\n\r\n    // Pre-calculate expensive projections\r\n    const allProjected = useMemo(() => getAllProjectedReviews(themes), [themes]);\r\n\r\n    // OTIMIZA√á√ÉO: Gerar mapa de eventos uma √∫nica vez para o intervalo vis√≠vel\r\n    const eventsMap = useMemo(() => {\r\n        const map: Record<string, { reviews: CalendarReviewItem[], tasks: CalendarTaskItem[], goals: CalendarGoalItem[], projected: any[] }> = {};\r\n\r\n        calendarDays.forEach(day => {\r\n            const dateStr = format(day, 'yyyy-MM-dd');\r\n            const dayOfWeek = day.getDay();\r\n\r\n            // Reviews\r\n            const dayReviews: CalendarReviewItem[] = themes.flatMap(t =>\r\n                t.subthemes.flatMap(st =>\r\n                    st.reviews\r\n                        .filter(r => r.date === dateStr)\r\n                        .map(r => ({ ...r, id: `${st.id}-${r.date}`, themeTitle: t.title, subthemeTitle: st.title }))\r\n                )\r\n            );\r\n\r\n            // Tasks\r\n            const dayTasks: CalendarTaskItem[] = [];\r\n            tasks.forEach(t => {\r\n                let matchesDay = false;\r\n                if (t.type === 'recurring') {\r\n                    const taskCreationDay = new Date(t.createdAt).setHours(0, 0, 0, 0);\r\n                    if (day.getTime() >= taskCreationDay) {\r\n                        if (t.endDate && dateStr > t.endDate) {\r\n                            matchesDay = false;\r\n                        } else {\r\n                            matchesDay = t.recurrence?.includes(dayOfWeek) || false;\r\n                        }\r\n                    }\r\n                } else if (t.type === 'day') {\r\n                    matchesDay = t.date ? t.date.split('T')[0] === dateStr : false;\r\n                } else if (t.type === 'period' && t.startDate && t.endDate) {\r\n                    const start = t.startDate.split('T')[0];\r\n                    const end = t.endDate.split('T')[0];\r\n                    matchesDay = dateStr >= start && dateStr <= end;\r\n                }\r\n\r\n                if (matchesDay) {\r\n                    let isCompletedToday = false;\r\n                    if (t.type === 'day') {\r\n                        isCompletedToday = t.status === 'completed';\r\n                    } else if (t.completionHistory) {\r\n                        isCompletedToday = t.completionHistory.some(h => h.startsWith(dateStr));\r\n                    }\r\n\r\n                    let label: string | undefined;\r\n                    if (t.type === 'period' && t.startDate && t.endDate) {\r\n                        const start = t.startDate.split('T')[0];\r\n                        const end = t.endDate.split('T')[0];\r\n                        if (start === dateStr) label = 'In√≠cio';\r\n                        else if (end === dateStr) label = 'Prazo';\r\n                        else label = 'Em andamento';\r\n                    }\r\n\r\n                    dayTasks.push({ ...t, isCompletedToday, label });\r\n                }\r\n            });\r\n\r\n            // Goals\r\n            const dayGoals: CalendarGoalItem[] = [];\r\n            goals.forEach(g => {\r\n                // 1. Habit Goal\r\n                if (g.type === 'habit') {\r\n                    let matchesHabit = true;\r\n                    if (g.createdAt) {\r\n                        const goalCreationDay = new Date(g.createdAt).setHours(0, 0, 0, 0);\r\n                        if (day.getTime() < goalCreationDay) matchesHabit = false;\r\n                    }\r\n                    if (g.deadline && dateStr > g.deadline) matchesHabit = false;\r\n                    if (g.recurrence && g.recurrence.length > 0 && !g.recurrence.includes(dayOfWeek)) matchesHabit = false;\r\n\r\n                    if (matchesHabit) {\r\n                        const isCompleted = g.completionHistory?.some(h => h.startsWith(dateStr)) || false;\r\n                        dayGoals.push({ ...g, isCompletedToday: isCompleted } as CalendarGoalItem);\r\n                    }\r\n                }\r\n                // 2. Duration Goals (Start -> Deadline)\r\n                else {\r\n                    const start = g.startDate ? g.startDate.split('T')[0] : null;\r\n                    const end = g.deadline ? g.deadline.split('T')[0] : null;\r\n\r\n                    if (start && end && dateStr >= start && dateStr <= end) {\r\n                        const isStart = dateStr === start;\r\n                        const isEnd = dateStr === end;\r\n                        const isCompleted = g.progress === 100;\r\n\r\n                        dayGoals.push({\r\n                            ...g,\r\n                            label: isEnd ? 'Prazo' : (isStart ? 'In√≠cio' : 'Em andamento'),\r\n                            priority: isEnd ? 'high' : 'medium',\r\n                            isCompletedToday: isEnd ? isCompleted : false,\r\n                            // Ensure we don't spam identical IDs if mapping relies on them\r\n                            // but here we just push to array for display\r\n                        } as CalendarGoalItem);\r\n                    }\r\n                    // Fallback for single deadline if no start date\r\n                    else if (!start && end && end === dateStr) {\r\n                        const isCompleted = g.progress === 100;\r\n                        dayGoals.push({ ...g, label: 'Prazo', priority: 'high', isCompletedToday: isCompleted } as CalendarGoalItem);\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Projects (Duration Coverage)\r\n            projects.forEach(p => {\r\n                const start = p.startDate;\r\n                const end = p.deadline;\r\n\r\n                // Duration Checks\r\n                if (start && end && dateStr >= start && dateStr <= end) {\r\n                    const isStart = dateStr === start;\r\n                    const isEnd = dateStr === end;\r\n\r\n                    dayGoals.push({\r\n                        id: p.id,\r\n                        title: p.title,\r\n                        type: isEnd ? 'project-deadline' : (isStart ? 'project-start' : 'project-step'),\r\n                        isParent: true,\r\n                        label: isEnd ? 'Prazo Projeto' : (isStart ? 'In√≠cio Projeto' : 'Projeto em Andamento'),\r\n                        color: p.color || '#8b5cf6',\r\n                        priority: isEnd ? 'high' : 'medium',\r\n                        isCompletedToday: isEnd ? p.progress === 100 : false\r\n                    } as any);\r\n                }\r\n                // Fallback singles\r\n                else if (!start && end && end === dateStr) {\r\n                    dayGoals.push({\r\n                        id: p.id,\r\n                        title: p.title,\r\n                        type: 'project-deadline' as any,\r\n                        isParent: true,\r\n                        label: 'Prazo Projeto',\r\n                        color: p.color || '#8b5cf6',\r\n                        priority: 'high',\r\n                        isCompletedToday: p.progress === 100\r\n                    } as any);\r\n                }\r\n\r\n                // Milestones (Keep explicit)\r\n                p.milestones.forEach(m => {\r\n                    if (m.dueDate === dateStr) {\r\n                        dayGoals.push({\r\n                            id: m.id,\r\n                            title: m.title,\r\n                            parentGoalTitle: p.title,\r\n                            type: 'project-milestone' as any,\r\n                            label: 'Marco: ' + m.title,\r\n                            color: p.color || '#8b5cf6',\r\n                            priority: 'medium',\r\n                            isCompletedToday: m.completed\r\n                        } as any);\r\n                    }\r\n                });\r\n            });\r\n\r\n            // Projected\r\n            const dayProjected = allProjected\r\n                .filter((p: { date: string }) => p.date === dateStr)\r\n                .map((p: any) => ({ ...p, priority: 'medium' as const }));\r\n\r\n            map[dateStr] = { reviews: dayReviews, tasks: dayTasks, goals: dayGoals, projected: dayProjected };\r\n        });\r\n\r\n        return map;\r\n    }, [themes, tasks, goals, projects, calendarDays, allProjected]);\r\n\r\n    const getEventsForDay = (date: Date) => {\r\n        const dateStr = format(date, 'yyyy-MM-dd');\r\n        const data = eventsMap[dateStr] || { reviews: [], tasks: [], goals: [], projected: [] };\r\n        return data;\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"relative overflow-hidden p-4 md:p-6 rounded-3xl bg-slate-900/40 border border-white/5 shadow-2xl backdrop-blur-md group\">\r\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 mix-blend-overlay pointer-events-none\" />\r\n                {/* Ambient Glow */}\r\n                <div className=\"absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none transition-all group-hover:bg-indigo-500/20\" />\r\n\r\n                <div className=\"flex items-center justify-between mb-6 relative z-10\">\r\n                    <h2 className=\"text-lg font-bold text-white tracking-tight flex items-center gap-2\">\r\n                        Calend√°rio\r\n                    </h2>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-xs font-medium text-slate-400 capitalize mr-2\">\r\n                            {format(currentMonth, 'MMMM yyyy', { locale: ptBR })}\r\n                        </span>\r\n                        <div className=\"flex bg-slate-800/50 rounded-lg border border-white/5 p-0.5\">\r\n                            <button onClick={prevMonth} className=\"p-1 hover:bg-slate-800/50 rounded-md text-slate-400 hover:text-white transition-colors\">\r\n                                <ChevronLeft className=\"w-4 h-4\" />\r\n                            </button>\r\n                            <button onClick={nextMonth} className=\"p-1 hover:bg-slate-800/50 rounded-md text-slate-400 hover:text-white transition-colors\">\r\n                                <ChevronRight className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-7 text-center mb-2\">\r\n                    {['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].map((d, i) => (\r\n                        <div key={i} className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider py-2\">{d}</div>\r\n                    ))}\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-7 gap-1.5 relative z-10\">\r\n                    {calendarDays.map((day, idx) => {\r\n                        const { reviews, tasks, goals } = getEventsForDay(day);\r\n                        const isCurrentMonth = isSameMonth(day, currentMonth);\r\n                        const isDayToday = isToday(day);\r\n\r\n                        // Dots calculation\r\n                        const pendingReviews = reviews.filter((r: { status: string }) => r.status === 'pending').length;\r\n                        const completedReviews = reviews.filter((r: { status: string }) => r.status === 'completed').length;\r\n                        const hasGoals = goals.some((g: { isCompletedToday?: boolean }) => !g.isCompletedToday);\r\n                        const hasTasks = tasks.some((t: { isCompletedToday?: boolean }) => !t.isCompletedToday);\r\n\r\n                        return (\r\n                            <div\r\n                                key={idx}\r\n                                onClick={() => setSelectedDate(day)}\r\n                                className={cn(\r\n                                    \"aspect-square rounded-xl flex flex-col items-center justify-center relative cursor-pointer transition-all duration-300 border border-transparent\",\r\n                                    isCurrentMonth\r\n                                        ? \"bg-slate-800/20 hover:bg-slate-800/50 hover:border-white/10 hover:scale-105 hover:shadow-lg\"\r\n                                        : \"opacity-20 text-slate-600 grayscale\",\r\n                                    isDayToday && \"bg-blue-600 shadow-[0_4px_12px_rgba(37,99,235,0.4)] text-white scale-110 z-10 border-blue-500/50\"\r\n                                )}\r\n                            >\r\n                                <span className={cn(\r\n                                    \"text-xs font-bold\",\r\n                                    !isDayToday && \"text-slate-400 group-hover:text-white\"\r\n                                )}>\r\n                                    {format(day, 'd')}\r\n                                </span>\r\n\r\n                                {/* Micro Indicators */}\r\n                                <div className=\"flex gap-0.5 mt-1\">\r\n                                    {pendingReviews > 0 && <div className={cn(\"w-1 h-1 rounded-full\", isDayToday ? \"bg-white\" : \"bg-blue-500\")} />}\r\n                                    {pendingReviews === 0 && completedReviews > 0 && <div className={cn(\"w-1 h-1 rounded-full\", isDayToday ? \"bg-white/60\" : \"bg-emerald-500\")} />}\r\n\r\n                                    {/* Start Date Dot */}\r\n                                    {[...tasks, ...goals].some((i: any) => i.label === 'In√≠cio') && (\r\n                                        <div className={cn(\"w-1 h-1 rounded-full\", isDayToday ? \"bg-indigo-400\" : \"bg-indigo-500\")} title=\"In√≠cio Hoje!\" />\r\n                                    )}\r\n\r\n                                    {/* Deadline Dot */}\r\n                                    {[...tasks, ...goals].some((i: any) => i.label === 'Prazo') && (\r\n                                        <div className={cn(\"w-1 h-1 rounded-full animate-pulse\", isDayToday ? \"bg-red-400\" : \"bg-red-500\")} title=\"Prazo Hoje!\" />\r\n                                    )}\r\n\r\n                                    {hasGoals && <div className={cn(\"w-1 h-1 rounded-full\", isDayToday ? \"bg-white/60\" : \"bg-emerald-500\")} />}\r\n                                    {hasTasks && <div className={cn(\"w-1 h-1 rounded-full\", isDayToday ? \"bg-white/60\" : \"bg-amber-500\")} />}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            <Modal\r\n                isOpen={!!selectedDate}\r\n                onClose={() => setSelectedDate(null)}\r\n                title={selectedDate ? format(selectedDate, \"d 'de' MMMM\", { locale: ptBR }) : ''}\r\n            >\r\n                {selectedDate && (\r\n                    <DayDetails\r\n                        events={getEventsForDay(selectedDate)}\r\n                        date={selectedDate}\r\n                        onCompleteReview={completeReview}\r\n                        onStartStudy={startStudySession}\r\n                        onDeleteTask={deleteTask}\r\n                        onDeleteGoal={deleteGoal}\r\n                    />\r\n                )}\r\n            </Modal>\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":4,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startFocusSession' is assigned a value but never used.","line":53,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":30}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useProjectContext } from '../../context/ProjectProvider';\r\nimport { Target, CheckCircle2, Clock, TrendingUp, FolderKanban } from 'lucide-react';\r\nimport { CalendarWidget } from './CalendarWidget';\r\n// Lazy Load\r\n\r\nimport { ProfessionalHero } from './ProfessionalHero';\r\nimport { GamificationModal } from '../gamification/GamificationModal';\r\nimport { RealisticKPICard } from './components/RealisticKPICard';\r\nimport { ActiveGoalsWidget } from './components/ActiveGoalsWidget';\r\nimport { MissionPreviewWidget } from './components/MissionPreviewWidget';\r\nimport { AchievementsSummaryWidget } from './components/AchievementsSummaryWidget';\r\nimport { LeaderboardWidget } from './components/LeaderboardWidget';\r\nimport { useDashboardData } from '../../hooks/useDashboardData';\r\n\r\ninterface DashboardProps {\r\n    onNavigate: (tab: string) => void;\r\n    onOpenSummaryModal: () => void;\r\n    setIsMissionModalOpen: (isOpen: boolean) => void;\r\n}\r\n\r\n\r\n// Lazy Load Chart\r\nconst ConsistencyHeatmap = React.lazy(() => import('../../components/analytics/ConsistencyHeatmap').then(m => ({ default: m.ConsistencyHeatmap })));\r\n\r\nexport const Dashboard: React.FC<DashboardProps> = ({ onNavigate, onOpenSummaryModal, setIsMissionModalOpen }) => {\r\n    // ... existing hook calls ...\r\n\r\n    const {\r\n        zenMode,\r\n        gamification,\r\n        goals,\r\n        themes,\r\n        activeGoals,\r\n        dueReviews,\r\n        progressPercent,\r\n        isAllDone,\r\n        completedCount,\r\n        totalCount\r\n    } = useDashboardData();\r\n\r\n    const { projects } = useProjectContext();\r\n\r\n    // Calculate project count using the same logic as MainLayout\r\n    const projectCount = React.useMemo(() => {\r\n        const themeProjectIds = themes.filter(t => t.category === 'project').map(t => t.id);\r\n        const linkedGoalsCount = goals.filter(g => g.relatedThemeId && themeProjectIds.includes(g.relatedThemeId)).length;\r\n        const standaloneProjectsCount = projects.length;\r\n        return linkedGoalsCount + standaloneProjectsCount;\r\n    }, [themes, goals, projects]);\r\n\r\n    const { startFocusSession } = usePomodoroContext();\r\n    const [isGamificationModalOpen, setIsGamificationModalOpen] = React.useState(false);\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-500 pt-6\">\r\n\r\n            {/* Professional Gamification Hero */}\r\n            {!zenMode && <ProfessionalHero onClick={() => setIsGamificationModalOpen(true)} />}\r\n\r\n            {/* Gamification Modal */}\r\n            <GamificationModal\r\n                isOpen={isGamificationModalOpen}\r\n                onClose={() => setIsGamificationModalOpen(false)}\r\n            />\r\n\r\n            {/* KPI Cards (Realistic 3D Glass) */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6\">\r\n                <RealisticKPICard\r\n                    title=\"Dias Seguidos\"\r\n                    value={gamification?.streak?.current?.toString() || \"0\"}\r\n                    icon={TrendingUp}\r\n                    gradient=\"from-purple-600 to-indigo-600\"\r\n                    shadowColor=\"purple\"\r\n                    onClick={() => setIsGamificationModalOpen(true)}\r\n                />\r\n                <RealisticKPICard\r\n                    title=\"Metas Ativas\"\r\n                    value={activeGoals.toString()}\r\n                    icon={Target}\r\n                    gradient=\"from-emerald-500 to-teal-600\"\r\n                    shadowColor=\"emerald\"\r\n                    onClick={() => onNavigate('goals')}\r\n                />\r\n                <RealisticKPICard\r\n                    title=\"Revis√µes Hoje\"\r\n                    value={dueReviews.toString()}\r\n                    icon={CheckCircle2}\r\n                    gradient=\"from-blue-500 to-cyan-500\"\r\n                    shadowColor=\"blue\"\r\n                    onClick={() => setIsMissionModalOpen(true)}\r\n                    alert={dueReviews > 0}\r\n                />\r\n                <RealisticKPICard\r\n                    title=\"Projetos\"\r\n                    value={projectCount.toString()}\r\n                    icon={FolderKanban}\r\n                    gradient=\"from-amber-500 to-orange-600\"\r\n                    shadowColor=\"amber\"\r\n                    onClick={onOpenSummaryModal}\r\n                />\r\n            </div>\r\n\r\n            {/* Analytics Section (Chart) - Hide in Zen Mode */}\r\n            {!zenMode && (\r\n                <div className=\"relative group\">\r\n                    {/* Decoration */}\r\n                    <div className=\"absolute -inset-1 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-emerald-500/10 rounded-3xl blur-xl opacity-50 group-hover:opacity-100 transition-opacity\" />\r\n                    <React.Suspense fallback={<div className=\"h-[280px] w-full bg-slate-900/50 rounded-3xl animate-pulse\" />}>\r\n                        <ConsistencyHeatmap />\r\n                    </React.Suspense>\r\n                </div>\r\n            )}\r\n\r\n            {/* Main Grid: Goals & Tasks */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left Column (2/3): Active Goals List (Detailed) */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    <ActiveGoalsWidget goals={goals} onNavigate={onNavigate} />\r\n                </div>\r\n\r\n                {/* Right Column (1/3): Widgets */}\r\n                <div className=\"space-y-6\">\r\n                    <CalendarWidget />\r\n\r\n                    {/* Today's Mission Preview (Refined) */}\r\n                    <MissionPreviewWidget\r\n                        progressPercent={progressPercent}\r\n                        isAllDone={isAllDone}\r\n                        completedCount={completedCount}\r\n                        totalCount={totalCount}\r\n                        setIsMissionModalOpen={setIsMissionModalOpen}\r\n                    />\r\n\r\n                    {/* Achievements Summary */}\r\n                    <AchievementsSummaryWidget\r\n                        unlockedAchievements={gamification?.achievements || []}\r\n                        onNavigate={onNavigate}\r\n                    />\r\n\r\n                    {/* Global Leaderboard (Gamification) */}\r\n                    <LeaderboardWidget\r\n                        userXp={gamification?.level?.totalXp || 0}\r\n                        userLevel={gamification?.level?.level || 1}\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\ProfessionalHero.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Crown' is defined but never used.","line":3,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":3,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Star' is defined but never used.","line":3,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":3,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":60}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { Trophy, Zap, Crown, ChevronRight, Star, TrendingUp } from 'lucide-react';\r\nimport { getTitleForLevel, getNextTitleForLevel } from '../../config/gamification';\r\nimport { cn } from '../../lib/utils'; // Assuming this exists\r\n\r\ninterface ProfessionalHeroProps {\r\n    onClick?: () => void;\r\n}\r\n\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nexport const ProfessionalHero: React.FC<ProfessionalHeroProps> = ({ onClick }) => {\r\n    const { gamification } = useStudy();\r\n    const { user } = useAuth();\r\n    // Default to level 1 if data is missing to prevent crashes\r\n    const level = gamification?.level || { level: 1, currentXp: 0, nextLevelXp: 500, totalXp: 0 };\r\n    const [isHovered, setIsHovered] = useState(false);\r\n\r\n    // Memoize expensive calculations\r\n    const { percentage, currentTitle, nextTitle, remainingXp } = useMemo(() => {\r\n        const pct = Math.min(100, Math.max(0, (level.currentXp / level.nextLevelXp) * 100));\r\n        return {\r\n            percentage: pct,\r\n            currentTitle: getTitleForLevel(level.level),\r\n            nextTitle: getNextTitleForLevel(level.level),\r\n            remainingXp: level.nextLevelXp - level.currentXp\r\n        };\r\n    }, [level.currentXp, level.nextLevelXp, level.level]);\r\n\r\n    return (\r\n        <div\r\n            onClick={onClick}\r\n            className={cn(\r\n                \"group relative w-full overflow-hidden rounded-[2rem] bg-slate-950 border border-slate-800/60 shadow-2xl transition-all duration-500 hover:border-blue-500/30 hover:shadow-blue-900/20\",\r\n                onClick && \"cursor-pointer\"\r\n            )}\r\n            onMouseEnter={() => setIsHovered(true)}\r\n            onMouseLeave={() => setIsHovered(false)}\r\n        >\r\n            {/* Optimized Background - CSS gradients instead of heavy images */}\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-950 to-black\" />\r\n\r\n            {/* Subtle Noise (CSS-based if possible, or very light overlay) */}\r\n            <div className=\"absolute inset-0 opacity-[0.03] bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAiLz4KPC9zdmc+')] pointer-events-none\" />\r\n\r\n            {/* Ambient Lighting - Reduced blur radius for performance */}\r\n            <div className=\"absolute top-0 right-0 w-96 h-96 bg-blue-600/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none transition-opacity duration-700\" style={{ opacity: isHovered ? 0.2 : 0.1 }} />\r\n            <div className=\"absolute bottom-0 left-0 w-96 h-96 bg-indigo-600/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none transition-opacity duration-700\" style={{ opacity: isHovered ? 0.2 : 0.1 }} />\r\n\r\n            <div className=\"relative z-10 p-5 md:p-8 flex flex-col md:flex-row items-center gap-6 md:gap-12\">\r\n\r\n                {/* 1. Identity Section */}\r\n                <div className=\"flex-1 flex items-center gap-6\">\r\n                    {/* 3D Glass Badge */}\r\n                    <div className=\"relative w-24 h-24 flex-shrink-0 perspective-1000\">\r\n                        <div className=\"w-full h-full rounded-2xl bg-gradient-to-br from-slate-800 to-slate-900 border border-white/10 shadow-xl flex items-center justify-center transform transition-transform duration-500 group-hover:rotate-y-12 overflow-hidden\">\r\n                            <div className=\"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent rounded-2xl pointer-events-none z-20\" />\r\n\r\n                            {user?.avatar ? (\r\n                                <img\r\n                                    src={user.avatar}\r\n                                    alt=\"Profile\"\r\n                                    className=\"w-full h-full object-cover\"\r\n                                    fetchPriority=\"high\"\r\n                                    loading=\"eager\"\r\n                                    decoding=\"sync\"\r\n                                />\r\n                            ) : (\r\n                                <Trophy className=\"w-10 h-10 text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.5)]\" />\r\n                            )}\r\n\r\n                            <div className=\"absolute -bottom-2 px-3 py-1 bg-slate-950 border border-slate-800 rounded-full text-[10px] font-bold text-white shadow-lg z-30\">\r\n                                Lvl {level.level}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col text-center md:text-left\">\r\n                        <div className=\"flex items-center gap-2 justify-center md:justify-start mb-1\">\r\n                            <span className=\"px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-widest bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\">\r\n                                Patente Atual\r\n                            </span>\r\n                        </div>\r\n                        <h2 className=\"text-3xl font-black text-white tracking-tight mb-1\">\r\n                            {currentTitle}\r\n                        </h2>\r\n                        <p className=\"text-sm text-slate-400 max-w-[280px]\">\r\n                            Pr√≥xima patente: <span className=\"text-slate-200 font-semibold\">{nextTitle}</span>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 2. Stats & Progress */}\r\n                <div className=\"flex-1 w-full md:w-auto bg-slate-900/40 rounded-2xl p-6 border border-white/5 backdrop-blur-sm\">\r\n                    <div className=\"flex items-end justify-between mb-4\">\r\n                        <div>\r\n                            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-1\">Total Experience</p>\r\n                            <div className=\"text-2xl font-mono font-bold text-white tracking-tight\">\r\n                                {(level.currentXp || 0).toLocaleString()} <span className=\"text-sm text-slate-600 font-normal\">/ {(level.nextLevelXp || 500).toLocaleString()} XP</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <p className=\"text-xs font-bold text-indigo-400 mb-1\">+{Math.round(percentage || 0)}%</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* High-Performance Progress Bar */}\r\n                    <div className=\"relative h-2.5 w-full bg-slate-950 rounded-full overflow-hidden border border-white/5\">\r\n                        <div\r\n                            className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-600 to-indigo-500 shadow-[0_0_10px_rgba(79,70,229,0.4)] transition-all duration-1000 ease-out\"\r\n                            style={{ width: `${percentage || 0}%` }}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"mt-4 flex items-center justify-between text-xs text-slate-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Zap className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                            <span>{(remainingXp || 0).toLocaleString()} XP to go</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\RetentionChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMemo' is defined but never used.","line":1,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\RetentionChart.tsx:46:9\n  44 |\n  45 |     useEffect(() => {\n> 46 |         setData(generateData(timeRange === 'week' ? 7 : 14));\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  47 |     }, [timeRange]);\n  48 |\n  49 |     return (","line":46,"column":9,"nodeType":null,"endLine":46,"endColumn":16}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useEffect } from 'react';\r\nimport {\r\n    AreaChart,\r\n    Area,\r\n    XAxis,\r\n    YAxis,\r\n    CartesianGrid,\r\n    Tooltip,\r\n    ResponsiveContainer\r\n} from 'recharts';\r\nimport { format, subDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { Brain } from 'lucide-react';\r\n\r\n// Mock Data Generation for Visuals\r\n// In real app, this would query 'reviews' table for pass/fail rates per day\r\nconst generateData = (days: number) => {\r\n    const data: { date: string; fullDate: string; retention: number; reviews: number }[] = [];\r\n    const today = new Date();\r\n    let retentionBase = 85;\r\n\r\n    for (let i = days; i >= 0; i--) {\r\n        const date = subDays(today, i);\r\n        // Simulate realistic fluctuation\r\n        const randomFlux = (Math.random() - 0.5) * 5;\r\n        retentionBase = Math.min(100, Math.max(70, retentionBase + randomFlux));\r\n\r\n        data.push({\r\n            date: format(date, 'MMM dd', { locale: ptBR }),\r\n            fullDate: format(date, 'ddMMM yyyy', { locale: ptBR }),\r\n            retention: Math.round(retentionBase),\r\n            reviews: Math.floor(Math.random() * 20) + 5\r\n        });\r\n    }\r\n    return data;\r\n};\r\n\r\nexport const RetentionChart = () => {\r\n    const [timeRange, setTimeRange] = useState<'week' | 'month'>('week');\r\n\r\n\r\n\r\n    const [data, setData] = useState<{ date: string; fullDate: string; retention: number; reviews: number }[]>([]);\r\n\r\n    useEffect(() => {\r\n        setData(generateData(timeRange === 'week' ? 7 : 14));\r\n    }, [timeRange]);\r\n\r\n    return (\r\n        <div className=\"bg-slate-950/50 backdrop-blur-xl border border-white/10 rounded-[2rem] p-8 relative overflow-hidden shadow-2xl group transition-all duration-500 hover:border-purple-500/20\">\r\n            {/* Realistic Glossy Highlight */}\r\n            <div className=\"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/5 to-transparent pointer-events-none\" />\r\n\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-8 relative z-10\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center text-purple-400 border border-white/5 shadow-inner\">\r\n                        <Brain className=\"w-6 h-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"text-xl font-bold text-white tracking-tight\">Qualidade da Mem√≥ria</h3>\r\n                        <p className=\"text-sm text-slate-400 font-medium\">√çndice de reten√ß√£o neural</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex bg-slate-900/80 rounded-xl p-1 border border-white/10 shadow-inner\">\r\n                    <button\r\n                        onClick={() => setTimeRange('week')}\r\n                        className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all duration-300 ${timeRange === 'week' ? 'bg-purple-500/20 text-purple-300 shadow-sm' : 'text-slate-500 hover:text-slate-300'}`}\r\n                    >\r\n                        7 DIAS\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setTimeRange('month')}\r\n                        className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all duration-300 ${timeRange === 'month' ? 'bg-purple-500/20 text-purple-300 shadow-sm' : 'text-slate-500 hover:text-slate-300'}`}\r\n                    >\r\n                        30 DIAS\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Chart */}\r\n            <div className=\"h-[280px] w-full relative z-10\">\r\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                    <AreaChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\r\n                        <defs>\r\n                            <linearGradient id=\"colorRetention\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"5%\" stopColor=\"#c084fc\" stopOpacity={0.4} /> {/* Purple-400 */}\r\n                                <stop offset=\"95%\" stopColor=\"#c084fc\" stopOpacity={0} />\r\n                            </linearGradient>\r\n                        </defs>\r\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" vertical={false} />\r\n                        <XAxis\r\n                            dataKey=\"date\"\r\n                            stroke=\"#64748b\"\r\n                            fontSize={11}\r\n                            tickLine={false}\r\n                            axisLine={false}\r\n                            dy={15}\r\n                            fontFamily=\"Inter, sans-serif\"\r\n                        />\r\n                        <YAxis\r\n                            stroke=\"#64748b\"\r\n                            fontSize={11}\r\n                            tickLine={false}\r\n                            axisLine={false}\r\n                            domain={[60, 100]}\r\n                            fontFamily=\"Inter, sans-serif\"\r\n                        />\r\n                        <Tooltip\r\n                            contentStyle={{\r\n                                backgroundColor: 'rgba(15, 23, 42, 0.9)',\r\n                                border: '1px solid rgba(255,255,255,0.1)',\r\n                                borderRadius: '16px',\r\n                                boxShadow: '0 10px 40px -10px rgba(0,0,0,0.5)',\r\n                                padding: '12px 16px',\r\n                                color: '#f8fafc'\r\n                            }}\r\n                            itemStyle={{ color: '#e2e8f0', fontSize: '13px', fontWeight: 'bold' }}\r\n                            labelStyle={{ color: '#94a3b8', fontSize: '11px', marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '0.05em' }}\r\n                            cursor={{ stroke: '#c084fc', strokeWidth: 2, strokeDasharray: '4 4' }}\r\n                        />\r\n                        <Area\r\n                            type=\"monotone\"\r\n                            dataKey=\"retention\"\r\n                            stroke=\"#c084fc\"\r\n                            strokeWidth={4}\r\n                            fillOpacity={1}\r\n                            fill=\"url(#colorRetention)\"\r\n                        />\r\n                    </AreaChart>\r\n                </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Stat Footer */}\r\n            <div className=\"flex items-center gap-8 mt-8 pt-6 border-t border-white/5 relative z-10\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)]\" />\r\n                        <span className=\"text-xs text-slate-400 uppercase tracking-widest font-bold\">M√©dia Atual</span>\r\n                    </div>\r\n                    <div className=\"text-3xl font-black text-white flex items-baseline gap-2\">\r\n                        {Math.round(data[data.length - 1].retention)}%\r\n                        <span className=\"text-xs font-bold px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\">+2.4%</span>\r\n                    </div>\r\n                </div>\r\n                <div>\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-slate-600\" />\r\n                        <span className=\"text-xs text-slate-400 uppercase tracking-widest font-bold\">Revis√µes</span>\r\n                    </div>\r\n                    <div className=\"text-3xl font-black text-white\">\r\n                        {data.reduce((acc, cur) => acc + cur.reviews, 0)}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Ambient Background Decoration */}\r\n            <div className=\"absolute -bottom-20 -right-20 w-80 h-80 bg-purple-600/10 rounded-full blur-[100px] pointer-events-none\" />\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay pointer-events-none\" />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\SummaryModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isOpen' is defined but never used.","line":22,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":38}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { BookOpen, Target, Layout } from 'lucide-react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { differenceInDays } from 'date-fns';\r\n\r\nimport { ProjectsHeader } from './components/projects/ProjectsHeader';\r\nimport { ProjectsFilter } from './components/projects/ProjectsFilter';\r\nimport type { ProjectFilterType } from './components/projects/ProjectsFilter';\r\nimport { ThemeProjectCard } from './components/projects/ThemeProjectCard';\r\nimport { GoalProjectCard } from './components/projects/GoalProjectCard';\r\n\r\ninterface SummaryModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onOpenGoalModal: (type?: 'simple' | 'checklist' | 'habit') => void;\r\n    onOpenThemeModal: () => void;\r\n    onEditGoal: (goal: any) => void;\r\n    onEditTheme: (theme: any) => void;\r\n    onAddGoalToTheme: (themeId: string) => void;\r\n}\r\n\r\nexport const SummaryModal = ({ isOpen, onClose, onOpenGoalModal, onOpenThemeModal, onEditGoal, onEditTheme, onAddGoalToTheme }: SummaryModalProps) => {\r\n    const { goals, themes, deleteGoal, deleteTheme } = useStudy();\r\n    const [filter, setFilter] = React.useState<ProjectFilterType>('all');\r\n    const [expandedThemeId, setExpandedThemeId] = React.useState<string | null>(null);\r\n\r\n    // Transform Goals and Themes\r\n    const { themeProjects, orphanGoalProjects } = useMemo(() => {\r\n        // 1. Process Themes\r\n        const themeProjs = themes.map(t => {\r\n            const total = t.subthemes.length;\r\n            const completed = t.subthemes.filter(s => s.status === 'completed').length;\r\n            const progress = total > 0 ? (completed / total) * 100 : 0;\r\n            const daysLeft = t.deadline ? differenceInDays(new Date(t.deadline), new Date()) : null;\r\n\r\n            return {\r\n                id: t.id,\r\n                title: t.title,\r\n                type: 'Tema' as const,\r\n                progress,\r\n                deadline: t.deadline,\r\n                itemCount: t.subthemes.length,\r\n                daysLeft,\r\n                color: t.color || '#a855f7', // Purple\r\n                icon: <BookOpen className=\"w-5 h-5 text-purple-400\" />,\r\n                isExpanded: expandedThemeId === t.id\r\n            };\r\n        });\r\n\r\n        // 2. Process Goals (Checklists) - Find Orphans\r\n        const goalProjs = goals.filter(g => !g.relatedThemeId).map(g => {\r\n            const daysLeft = g.deadline ? differenceInDays(new Date(g.deadline), new Date()) : null;\r\n            return {\r\n                id: g.id,\r\n                title: g.title,\r\n                type: 'Meta' as const,\r\n                progress: g.progress,\r\n                deadline: g.deadline,\r\n                itemCount: g.checklist?.length || 0,\r\n                daysLeft,\r\n                color: g.color || '#10b981', // Emerald\r\n                icon: <Target className=\"w-5 h-5 text-emerald-400\" />,\r\n                relatedThemeTitle: undefined\r\n            };\r\n        });\r\n\r\n        // Filter Application\r\n        let filteredThemes = themeProjs.filter(p => {\r\n            const fullTheme = themes.find(t => t.id === p.id);\r\n            return fullTheme?.category === 'project';\r\n        });\r\n        let filteredGoals = goalProjs;\r\n\r\n        if (filter === 'completed') {\r\n            filteredThemes = themeProjs.filter(p => p.progress === 100);\r\n            filteredGoals = goalProjs.filter(p => p.progress === 100);\r\n        } else if (filter === 'overdue') {\r\n            filteredThemes = themeProjs.filter(p => p.daysLeft !== null && p.daysLeft < 0 && p.progress < 100);\r\n            filteredGoals = goalProjs.filter(p => p.daysLeft !== null && p.daysLeft < 0 && p.progress < 100);\r\n        } else if (filter === 'active') {\r\n            filteredThemes = themeProjs.filter(p => p.progress < 100 && (p.daysLeft === null || p.daysLeft >= 0));\r\n            filteredGoals = goalProjs.filter(p => p.progress < 100 && (p.daysLeft === null || p.daysLeft >= 0));\r\n        }\r\n\r\n        return { themeProjects: filteredThemes, orphanGoalProjects: filteredGoals };\r\n    }, [goals, themes, filter, expandedThemeId]);\r\n\r\n    // Helper to get linked projects for a theme\r\n    const getLinkedProjects = (themeId: string) => {\r\n        return goals.filter(g => g.relatedThemeId === themeId).map(g => {\r\n            const daysLeft = g.deadline ? differenceInDays(new Date(g.deadline), new Date()) : null;\r\n            return {\r\n                id: g.id,\r\n                title: g.title,\r\n                type: 'Meta' as const,\r\n                progress: g.progress,\r\n                deadline: g.deadline,\r\n                itemCount: g.checklist?.length || 0,\r\n                daysLeft,\r\n                color: g.color || '#10b981',\r\n                icon: <Target className=\"w-4 h-4 text-emerald-400\" />\r\n            };\r\n        });\r\n    };\r\n\r\n    const combinedList = [...themeProjects, ...orphanGoalProjects];\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n            <div className=\"bg-slate-900 border border-slate-800 rounded-3xl w-full max-w-3xl max-h-[85vh] flex flex-col shadow-2xl relative overflow-hidden\">\r\n\r\n                <ProjectsHeader\r\n                    onClose={onClose}\r\n                    onOpenGoalModal={onOpenGoalModal}\r\n                    onOpenThemeModal={onOpenThemeModal}\r\n                />\r\n\r\n                <div className=\"mt-8\">\r\n                    <ProjectsFilter filter={filter} setFilter={setFilter} />\r\n                </div>\r\n\r\n                {/* List Content */}\r\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6\">\r\n                    {combinedList.length === 0 ? (\r\n                        <div className=\"text-center py-20 text-slate-500\">\r\n                            <Layout className=\"w-16 h-16 mx-auto mb-4 opacity-20\" />\r\n                            <p>Nenhum projeto ativo.</p>\r\n                            <p className=\"text-sm text-slate-600\">Crie uma Meta ou Tema para come√ßar.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex flex-col gap-4\">\r\n                            {/* Render Themes First (as containers) */}\r\n                            {themeProjects.map((theme) => (\r\n                                <ThemeProjectCard\r\n                                    key={theme.id}\r\n                                    theme={theme}\r\n                                    linkedProjects={getLinkedProjects(theme.id)}\r\n                                    isExpanded={!!theme.isExpanded}\r\n                                    onToggleExpand={() => setExpandedThemeId(theme.isExpanded ? null : theme.id)}\r\n                                    onEditTheme={(t) => {\r\n                                        const fullTheme = themes.find(ft => ft.id === t.id);\r\n                                        if (fullTheme) onEditTheme(fullTheme);\r\n                                    }}\r\n                                    onDeleteTheme={deleteTheme}\r\n                                    onAddGoalToTheme={onAddGoalToTheme}\r\n                                    allGoals={goals}\r\n                                    onEditGoal={onEditGoal}\r\n                                    onDeleteGoal={deleteGoal}\r\n                                />\r\n                            ))}\r\n\r\n                            {/* Divider if we have both */}\r\n                            {themeProjects.length > 0 && orphanGoalProjects.length > 0 && (\r\n                                <div className=\"flex items-center gap-4 py-2\">\r\n                                    <div className=\"h-px bg-slate-800/50 flex-1\" />\r\n                                    <span className=\"text-xs font-bold text-slate-600 uppercase tracking-widest\">Outros Projetos</span>\r\n                                    <div className=\"h-px bg-slate-800/50 flex-1\" />\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Render Orphan Projects (Grid) */}\r\n                            {orphanGoalProjects.length > 0 && (\r\n                                <div className=\"grid grid-cols-1 grid-cols-[repeat(auto-fill,minmax(300px,1fr))] gap-4\">\r\n                                    {orphanGoalProjects.map((project) => (\r\n                                        <GoalProjectCard\r\n                                            key={project.id}\r\n                                            project={project}\r\n                                            onEdit={(p) => {\r\n                                                const fullGoal = goals.find(g => g.id === p.id);\r\n                                                if (fullGoal) onEditGoal(fullGoal);\r\n                                            }}\r\n                                            onDelete={deleteGoal}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\TodayMissionModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PlayCircle' is defined but never used.","line":8,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Lock' is defined but never used.","line":8,"column":72,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronDown' is defined but never used.","line":8,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":89},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'differenceInCalendarDays' is defined but never used.","line":9,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":94},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Theme' is defined but never used.","line":15,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":96,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":111,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleToday' is assigned a value but never used.","line":196,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":196,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleStopFocus' is assigned a value but never used.","line":226,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'isGoalOverdue'. Either include it or remove the dependency array.","line":310,"column":8,"nodeType":"ArrayExpression","endLine":310,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [habits, habitOrder, today, isGoalOverdue]","fix":{"range":[12972,12999],"text":"[habits, habitOrder, today, isGoalOverdue]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'isReviewOverdue'. Either include it or remove the dependency array.","line":316,"column":8,"nodeType":"ArrayExpression","endLine":316,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [uniqueDueReviews, reviewOrder, today, isReviewOverdue]","fix":{"range":[13272,13310],"text":"[uniqueDueReviews, reviewOrder, today, isReviewOverdue]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'isTaskOverdue'. Either include it or remove the dependency array.","line":322,"column":8,"nodeType":"ArrayExpression","endLine":322,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [uniqueDueTasks, taskOrder, today, isTaskOverdue]","fix":{"range":[13571,13605],"text":"[uniqueDueTasks, taskOrder, today, isTaskOverdue]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Icon' is defined but never used.","line":344,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":344,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getPeriodProgress' is assigned a value but never used.","line":372,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":372,"endColumn":28},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\TodayMissionModal.tsx:517:125\n  515 |                                     }\n  516 |\n> 517 |                                     const start = habit.startDate ? new Date(habit.startDate) : new Date(habit.createdAt || Date.now());\n      |                                                                                                                             ^^^^^^^^^^ Cannot call impure function\n  518 |                                     const todayDate = new Date();\n  519 |                                     const diffTime = Math.abs(todayDate.getTime() - start.getTime());\n  520 |                                     const expectedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));","line":517,"column":125,"nodeType":null,"endLine":517,"endColumn":135},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\TodayMissionModal.tsx:527:135\n  525 |                                     if (habit.deadline) {\n  526 |                                         const end = parseLocalDate(habit.deadline);\n> 527 |                                         const start = habit.startDate ? parseLocalDate(habit.startDate) : new Date(habit.createdAt || Date.now());\n      |                                                                                                                                       ^^^^^^^^^^ Cannot call impure function\n  528 |                                         const now = new Date();\n  529 |\n  530 |                                         // Reset all to midnight for accurate day calculation","line":527,"column":135,"nodeType":null,"endLine":527,"endColumn":145},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updated' is defined but never used.","line":780,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":780,"endColumn":37}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Reorder, useDragControls } from 'framer-motion';\r\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\r\nimport React from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { useCalendarEvents } from '../../features/calendar/hooks/useCalendarEvents';\r\nimport { useProjectContext } from '../../context/ProjectProvider';\r\nimport { Modal } from '../../components/ui/Modal';\r\nimport { BrainCircuit, CheckSquare, Target, Flag, PlayCircle, Loader2, Lock, ChevronDown, ChevronLeft, ChevronRight, Calendar as CalendarIcon, GripVertical, Save } from 'lucide-react';\r\nimport { format, parseISO, isToday as isDateToday, addDays, subDays, differenceInCalendarDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { cn } from '../../lib/utils';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { MissionCard } from './components/MissionCard';\r\nimport { parseLocalDate } from '../../utils/dateHelpers';\r\nimport type { Priority, Review, SessionLog, Subtheme, Task, Goal, Theme } from '../../types';\r\nimport { TaskDetailsModal } from '../tasks/components/TaskDetailsModal';\r\nimport { GoalDetailsModal } from '../goals/components/GoalDetailsModal';\r\n\r\n// Draggable Item Wrapper\r\nconst DraggableMissionItem = ({ item, children }: { item: { id: string }, children: React.ReactNode }) => {\r\n    const dragControls = useDragControls();\r\n\r\n    return (\r\n        <Reorder.Item\r\n            value={item}\r\n            dragListener={false} // Disable default drag to use handle\r\n            dragControls={dragControls}\r\n            className=\"touch-none relative\"\r\n            style={{ listStyle: 'none' }} // Remove list dots\r\n        >\r\n            <div className=\"flex items-center gap-2\">\r\n                {/* Drag Handle */}\r\n                <div\r\n                    onPointerDown={(e) => dragControls.start(e)}\r\n                    className=\"cursor-grab active:cursor-grabbing p-1.5 -ml-2 text-slate-600 hover:text-slate-400 transition-colors touch-none select-none flex items-center justify-center shrink-0\"\r\n                >\r\n                    <GripVertical className=\"w-5 h-5\" />\r\n                </div>\r\n                {/* Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                    {children}\r\n                </div>\r\n            </div>\r\n        </Reorder.Item>\r\n    );\r\n};\r\n\r\n\r\n\r\nconst PriorityIcon = ({ priority }: { priority?: Priority }) => {\r\n    switch (priority) {\r\n        case 'high': return <div className=\"text-rose-500 bg-rose-500/10 p-1 rounded\"><Flag className=\"w-3 h-3\" /></div>;\r\n        case 'medium': return <div className=\"text-amber-500 bg-amber-500/10 p-1 rounded\"><Target className=\"w-3 h-3\" /></div>;\r\n        case 'low': return <div className=\"text-blue-500 bg-blue-500/10 p-1 rounded\"><CheckSquare className=\"w-3 h-3\" /></div>;\r\n        default: return null;\r\n    }\r\n};\r\n\r\n\r\n\r\ninterface ReviewItem extends Subtheme {\r\n    dueReview: Review;\r\n    themeTitle: string;\r\n    themeIcon?: string; // Icon from parent theme\r\n    priority?: Priority;\r\n    notificationTime?: string;\r\n    isProjectStep?: boolean;\r\n    mastery?: number;\r\n    deadline?: string;\r\n    type?: string;\r\n    icon?: string; // Add icon property\r\n}\r\n\r\ninterface TodayMissionModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\n// ... rest of helpers ...\r\n\r\n// Helper to get session times\r\nconst getSessionTimes = (sessions: SessionLog[] | undefined, datePrefix: string) => {\r\n    if (!sessions || sessions.length === 0) return { start: null, end: null };\r\n    const todaysSessions = sessions.filter(s => s.start && s.start.startsWith(datePrefix));\r\n\r\n    if (todaysSessions.length === 0) return { start: null, end: null };\r\n\r\n    // Use the latest one\r\n    const lastSession = todaysSessions[todaysSessions.length - 1];\r\n\r\n    try {\r\n        return {\r\n            start: format(parseISO(lastSession.start), 'HH:mm'),\r\n            end: format(parseISO(lastSession.end), 'HH:mm')\r\n        };\r\n    } catch (e) {\r\n        return { start: null, end: null };\r\n    }\r\n};\r\n\r\nconst calculateEndTime = (startTime: string | null | undefined, durationMinutes: number | undefined) => {\r\n    if (!startTime) return null;\r\n    if (!durationMinutes) return startTime;\r\n\r\n    try {\r\n        const [hours, minutes] = startTime.split(':').map(Number);\r\n        const date = new Date();\r\n        date.setHours(hours, minutes, 0, 0);\r\n        date.setMinutes(date.getMinutes() + durationMinutes);\r\n        return format(date, 'HH:mm');\r\n    } catch (e) {\r\n        return startTime;\r\n    }\r\n};\r\n\r\n// Helper to sort items based on ID list\r\nconst sortWithOrder = <T extends { id: string }>(items: T[], order: string[]): T[] => {\r\n    if (!order || order.length === 0) return items;\r\n\r\n    // Create a map for O(1) lookup of order index\r\n    const orderMap = new Map(order.map((id, index) => [id, index]));\r\n\r\n    return [...items].sort((a, b) => {\r\n        const indexA = orderMap.get(a.id);\r\n        const indexB = orderMap.get(b.id);\r\n\r\n        // If both exist, sort by index\r\n        if (indexA !== undefined && indexB !== undefined) return indexA - indexB;\r\n\r\n        // If only one exists, the existing one comes first\r\n        if (indexA !== undefined) return -1;\r\n        if (indexB !== undefined) return 1;\r\n\r\n        // If neither exists, maintain original relative order (stable sort fallback) or simple compare\r\n        return 0;\r\n    });\r\n};\r\n\r\nconst priorityValue = (p?: Priority) => {\r\n    switch (p) {\r\n        case 'high': return 3;\r\n        case 'medium': return 2;\r\n        case 'low': return 1;\r\n        default: return 0;\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\n// Lazy Load Heavy Modal\r\nconst StudyContentModal = React.lazy(() => import('../themes/components/StudyContentModal').then(m => ({ default: m.StudyContentModal })));\r\n\r\nexport const TodayMissionModal: React.FC<TodayMissionModalProps> = ({ isOpen, onClose }) => {\r\n    // ... existing code ...\r\n\r\n    const { themes, tasks, goals, startFocus, activeFocus, endFocus, toggleTask, toggleGoal, completeReview } = useStudy();\r\n    const { startFocusSession, resetTimer } = usePomodoroContext();\r\n\r\n\r\n    // --- DRAG AND DROP STATE ---\r\n    const [habitOrder, setHabitOrder] = useLocalStorage<string[]>('mission_habit_order', []);\r\n    const [reviewOrder, setReviewOrder] = useLocalStorage<string[]>('mission_review_order', []);\r\n    const [taskOrder, setTaskOrder] = useLocalStorage<string[]>('mission_task_order', []);\r\n\r\n    const [orderedHabits, setOrderedHabits] = React.useState<Goal[]>([]);\r\n    const [orderedReviews, setOrderedReviews] = React.useState<ReviewItem[]>([]);\r\n    const [orderedTasks, setOrderedTasks] = React.useState<Task[]>([]);\r\n\r\n    // State for selected date\r\n    const [selectedDate, setSelectedDate] = React.useState(new Date());\r\n    const today = format(selectedDate, 'yyyy-MM-dd'); // This represents the VIEWED date\r\n    const isToday = isDateToday(selectedDate);\r\n\r\n    // Strict Date Locking Logic\r\n    const realTodayStr = format(new Date(), 'yyyy-MM-dd');\r\n    const isFutureContext = today > realTodayStr;\r\n\r\n    // --- USE CALENDAR EVENTS HOOK FOR LOGIC ---\r\n    const { projects } = useProjectContext();\r\n    const { getEventsForDay } = useCalendarEvents({ themes, tasks, goals, projects });\r\n\r\n    const todayEvents = React.useMemo(() => {\r\n        return getEventsForDay(selectedDate);\r\n    }, [selectedDate, getEventsForDay]);\r\n\r\n    // Navigation handlers\r\n    const handlePreviousDay = () => {\r\n        setSelectedDate(prev => subDays(prev, 1));\r\n    };\r\n\r\n    const handleNextDay = () => {\r\n        setSelectedDate(prev => addDays(prev, 1));\r\n    };\r\n\r\n    const handleToday = () => {\r\n        setSelectedDate(new Date());\r\n    };\r\n\r\n    const handleStartFocus = React.useCallback((id: string, type: 'task' | 'goal' | 'subtheme', title: string, duration?: number, reviewNumber?: number, reviewType?: 'review' | 'intro') => {\r\n        console.log(\"handleStartFocus called for:\", id);\r\n\r\n        // Prevent clicking strict future items with feedback\r\n        if (isFutureContext) {\r\n            console.warn(\"Attempted to focus on future item\");\r\n            // You might want to add a toast here if you have a toast system\r\n            alert(\"Voc√™ n√£o pode iniciar uma miss√£o agendada para o futuro.\");\r\n            return;\r\n        }\r\n\r\n        // If clicking the SAME item that is active, ensure widget is visible\r\n        if (activeFocus?.id === id) {\r\n            console.log(\"Task already active, reopening widget\");\r\n            startFocusSession(id, duration || 25); // This will trigger setIsWidgetVisible(true) in the provider\r\n            return;\r\n        }\r\n\r\n        console.log(\"Starting new focus session:\", id); // Debug log\r\n\r\n        // Simply overwrite any existing session. Use fire-and-forget style.\r\n        startFocus(id, type, title, duration || 25, reviewNumber, reviewType);\r\n        startFocusSession(id, duration || 25);\r\n    }, [isFutureContext, activeFocus, startFocus, startFocusSession]);\r\n\r\n\r\n    const handleStopFocus = () => {\r\n        if (confirm('Deseja cancelar o foco atual?')) {\r\n            endFocus(false);\r\n            resetTimer();\r\n        }\r\n    };\r\n\r\n    // 1. TASKS (mapped from calendar tasks)\r\n    const dueTasks = React.useMemo(() => {\r\n        return todayEvents.tasks.map((t: any) => ({\r\n            ...t,\r\n            // Ensure compatibility with Modal's expected Task structure\r\n            status: t.isCompletedToday ? 'completed' : t.status\r\n        })).sort((a: any, b: any) => priorityValue(b.priority) - priorityValue(a.priority));\r\n    }, [todayEvents]);\r\n\r\n    // 2. HABITS & GOALS (mapped from calendar goals)\r\n    const habits = React.useMemo(() => {\r\n        return todayEvents.goals.map((g: any) => ({\r\n            ...g,\r\n            status: g.isCompletedToday ? 'completed' : 'pending'\r\n        })).sort((a: any, b: any) => priorityValue(b.priority) - priorityValue(a.priority));\r\n    }, [todayEvents]);\r\n\r\n    // 3. REVIEWS & PROJECTS (mapped from calendar reviews/intros/intros/projected)\r\n    // We need to Enrich these items with the full Subtheme data (especially 'reviews' array for progress bar)\r\n    const dueReviews = React.useMemo(() => {\r\n        // Create a lookup map for fast access\r\n        const subthemeMap = new Map();\r\n        themes.forEach((t: any) => {\r\n            t.subthemes.forEach((st: any) => {\r\n                subthemeMap.set(st.id, { ...st, themeTitle: t.title });\r\n            });\r\n        });\r\n\r\n        const reviews = [\r\n            ...todayEvents.reviews.map((r: any) => {\r\n                const fullSubtheme = subthemeMap.get(r.subthemeId || r.id);\r\n                return {\r\n                    ...fullSubtheme, // Spread full subtheme first (provides Default properties + reviews array)\r\n                    ...r, // Override with specific event details\r\n                    // Reconstruct the nested dueReview object expected by components\r\n                    dueReview: { number: r.number, date: r.date, status: r.status || 'pending' },\r\n                    id: r.id || r.subthemeId\r\n                };\r\n            }),\r\n            ...todayEvents.intros.map((i: any) => {\r\n                const fullSubtheme = subthemeMap.get(i.subthemeId || i.id);\r\n                return {\r\n                    ...fullSubtheme,\r\n                    ...i,\r\n                    dueReview: { number: 0, date: i.date || today, status: 'pending' },\r\n                    isIntro: true,\r\n                    id: i.id || i.subthemeId\r\n                };\r\n            }),\r\n        ];\r\n\r\n        return reviews.sort((a: any, b: any) => priorityValue(b.priority) - priorityValue(a.priority));\r\n    }, [todayEvents, today, themes]);\r\n\r\n    // Deduplicate Reviews by ID to prevent multiple cards for same subtheme\r\n    const uniqueDueReviews = React.useMemo(() =>\r\n        Array.from(new Map(dueReviews.map(item => [item.id, item])).values())\r\n        , [dueReviews]);\r\n\r\n    // Deduplicate Tasks\r\n    const uniqueDueTasks = React.useMemo(() =>\r\n        Array.from(new Map(dueTasks.map(item => [item.id, item])).values())\r\n        , [dueTasks]);\r\n\r\n    const hasItems = uniqueDueTasks.length > 0 || habits.length > 0 || uniqueDueReviews.length > 0;\r\n\r\n    // --- OVERDUE HELPERS ---\r\n    const isTaskOverdue = (t: Task) => t.status === 'pending' && ((t.date && t.date < today) || (t.endDate && t.endDate < today));\r\n    const isGoalOverdue = (g: Goal) => g.deadline && g.deadline < today && g.progress < 100;\r\n    const isReviewOverdue = (r: ReviewItem) => r.dueReview.status === 'pending' && r.dueReview.date < today;\r\n\r\n    // --- SYNC & SORTING EFFECTS ---\r\n    React.useEffect(() => {\r\n        const overdue = habits.filter(h => isGoalOverdue(h));\r\n        const others = habits.filter(h => !isGoalOverdue(h));\r\n        // Sort others by custom order, overdue items stick to top (sorted by priority from useMemo)\r\n        setOrderedHabits([...overdue, ...sortWithOrder(others, habitOrder)]);\r\n    }, [habits, habitOrder, today]);\r\n\r\n    React.useEffect(() => {\r\n        const overdue = uniqueDueReviews.filter(r => isReviewOverdue(r));\r\n        const others = uniqueDueReviews.filter(r => !isReviewOverdue(r));\r\n        setOrderedReviews([...overdue, ...sortWithOrder(others, reviewOrder)]);\r\n    }, [uniqueDueReviews, reviewOrder, today]);\r\n\r\n    React.useEffect(() => {\r\n        const overdue = uniqueDueTasks.filter(t => isTaskOverdue(t));\r\n        const others = uniqueDueTasks.filter(t => !isTaskOverdue(t));\r\n        setOrderedTasks([...overdue, ...sortWithOrder(others, taskOrder)]);\r\n    }, [uniqueDueTasks, taskOrder, today]);\r\n\r\n    const handleReorderHabits = (newOrder: Goal[]) => {\r\n        // Optimistic update\r\n        setOrderedHabits(newOrder);\r\n        // We only save the ID order. \r\n        // Note: This saves the order of *everything*. \r\n        // On next reload, the effect will force overdue to top again.\r\n        // This creates distinct \"Overdue\" and \"Normal\" zones implicitly.\r\n        setHabitOrder(newOrder.map(h => h.id));\r\n    };\r\n\r\n    const handleReorderReviews = (newOrder: ReviewItem[]) => {\r\n        setOrderedReviews(newOrder);\r\n        setReviewOrder(newOrder.map(r => r.id));\r\n    };\r\n\r\n    const handleReorderTasks = (newOrder: Task[]) => {\r\n        setOrderedTasks(newOrder);\r\n        setTaskOrder(newOrder.map(t => t.id));\r\n    };\r\n\r\n    const SectionBox = ({ title, icon: Icon, count, children }: { title: string; icon: React.ElementType; colorClass?: string; count: number; children: React.ReactNode }) => (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between px-1 border-l-2 border-slate-700 pl-3\">\r\n                <h3 className=\"text-xs font-bold uppercase tracking-widest text-slate-400\">\r\n                    {title}\r\n                </h3>\r\n                <div className=\"w-5 h-5 rounded-full bg-slate-800 flex items-center justify-center text-[10px] font-bold text-slate-400 border border-slate-700\">\r\n                    {count}\r\n                </div>\r\n            </div>\r\n            <div className=\"space-y-3\">\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    // Calculate Progress\r\n    // Calculate Progress\r\n    // Use uniqueDueReviews to reflect exactly what is on screen (including overdue if valid)\r\n    // We filter for 'review' type or just count all reviews shown\r\n\r\n    const totalReviewsCount = uniqueDueReviews.length;\r\n    const completedReviewsCount = uniqueDueReviews.filter(r => r.dueReview.status === 'completed').length;\r\n\r\n    const score = totalReviewsCount > 0\r\n        ? Math.round((completedReviewsCount / totalReviewsCount) * 100)\r\n        : hasItems ? 0 : 100;\r\n\r\n    const getPeriodProgress = (item: Task | Goal, type: 'task' | 'goal') => {\r\n        if (type === 'task') {\r\n            if (item.type !== 'period' || !item.startDate || !item.endDate) return null;\r\n            const start = new Date(item.startDate);\r\n            const end = new Date(item.endDate);\r\n            const now = new Date();\r\n            const totalDays = Math.max(1, Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n            const currentDay = Math.max(1, Math.ceil((now.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n            const day = Math.min(currentDay, totalDays);\r\n            return `${day}/${totalDays}`;\r\n        }\r\n        if (type === 'goal') {\r\n            const goal = item as Goal;\r\n            if (!goal.deadline) return null;\r\n            const start = new Date(goal.createdAt || Date.now());\r\n            const end = new Date(goal.deadline);\r\n            const now = new Date();\r\n            const totalDays = Math.max(1, Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n            const currentDay = Math.max(1, Math.ceil((now.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n            const day = Math.min(currentDay, totalDays);\r\n            return totalDays > 1 ? `${day}/${totalDays}` : null;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    // --- COMPLETION SUMMARY STATE ---\r\n    const [completionItem, setCompletionItem] = React.useState<{\r\n        id: string;\r\n        title: string;\r\n        onConfirm: (summary: string) => void;\r\n    } | null>(null);\r\n    const [summaryText, setSummaryText] = React.useState('');\r\n\r\n    // --- DETAIL MODALS STATE ---\r\n    const [selectedTask, setSelectedTask] = React.useState<Task | null>(null);\r\n    const [selectedGoal, setSelectedGoal] = React.useState<Goal | null>(null);\r\n    const [selectedSubtheme, setSelectedSubtheme] = React.useState<Subtheme | null>(null);\r\n\r\n    const handleOpenDetails = (id: string, type: 'task' | 'goal' | 'subtheme') => {\r\n        if (type === 'task') {\r\n            const task = tasks.find(t => t.id === id);\r\n            if (task) setSelectedTask(task);\r\n        } else if (type === 'goal') {\r\n            const goal = goals.find(g => g.id === id);\r\n            if (goal) setSelectedGoal(goal);\r\n        } else if (type === 'subtheme') {\r\n            const subtheme = themes.flatMap(t => t.subthemes).find(st => st.id === id);\r\n            if (subtheme) setSelectedSubtheme(subtheme);\r\n        }\r\n    };\r\n\r\n    const requestCompletion = (id: string, title: string, onConfirm: (s: string) => void) => {\r\n        setCompletionItem({ id, title, onConfirm });\r\n        setSummaryText('');\r\n    };\r\n\r\n    const confirmCompletion = () => {\r\n        if (completionItem) {\r\n            completionItem.onConfirm(summaryText);\r\n            setCompletionItem(null);\r\n        }\r\n    };\r\n\r\n    const skipSummary = () => {\r\n        if (completionItem) {\r\n            completionItem.onConfirm(''); // Empty string = no summary (standard completion)\r\n            setCompletionItem(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title={null}>\r\n            <div className=\"space-y-5 px-4 mt-6 relative min-h-[500px]\">\r\n                {/* Header Section */}\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between px-2\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center\">\r\n                                <Target className=\"w-5 h-5 text-blue-400\" />\r\n                            </div>\r\n                            <h2 className=\"text-xl font-bold text-white\">Sua Miss√£o</h2>\r\n                        </div>\r\n                        <div className=\"flex flex-col items-end\">\r\n                            <span className=\"text-[10px] uppercase font-bold text-slate-500 tracking-wider\">Progresso</span>\r\n                            <span className=\"text-xl font-black text-blue-400\">{score}%</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between py-2 border-t border-slate-800/50 border-b border-slate-800/50 mb-6\">\r\n                        <button onClick={handlePreviousDay} className=\"p-2 text-slate-500 hover:text-white transition-colors\">\r\n                            <ChevronLeft className=\"w-5 h-5\" />\r\n                        </button>\r\n\r\n\r\n                        <div className=\"flex flex-col items-center\">\r\n                            <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-0.5\">\r\n                                {isToday ? 'HOJE' : format(selectedDate, 'EEEE', { locale: ptBR })}\r\n                            </span>\r\n                            <div className=\"flex items-center gap-2 text-slate-200\">\r\n                                <CalendarIcon className=\"w-4 h-4 text-slate-400\" />\r\n                                <span className=\"font-bold text-lg capitalize\">{format(selectedDate, 'd \\'de\\' MMMM', { locale: ptBR })}</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button onClick={handleNextDay} className=\"p-2 text-slate-500 hover:text-white transition-colors\">\r\n                            <ChevronRight className=\"w-5 h-5\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"h-1.5 bg-slate-800 rounded-full overflow-hidden w-full mb-6\">\r\n                        <div\r\n                            className=\"h-full bg-gradient-to-r from-blue-600 to-emerald-400 transition-all duration-1000\"\r\n                            style={{ width: `${score}%` }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 1. H√°bitos & Rotina */}\r\n                {orderedHabits.length > 0 && (\r\n                    <div className=\"border-t border-blue-500/10 pt-4\">\r\n                        <SectionBox title=\"H√ÅBITOS & ROTINA\" icon={Target} colorClass=\"text-orange-400\" count={orderedHabits.length}>\r\n                            <Reorder.Group axis=\"y\" values={orderedHabits} onReorder={handleReorderHabits} className=\"space-y-3\">\r\n                                {orderedHabits.map((habit) => {\r\n                                    const isCompletedToday = habit.completionHistory?.some((d: string) => d.startsWith(today));\r\n                                    const isItemOptimistic = completionItem?.id === habit.id;\r\n                                    const isChecked = isCompletedToday || habit.progress === 100 || isItemOptimistic;\r\n                                    const isBlocked = isFutureContext;\r\n                                    const sessionTimes = getSessionTimes(habit.sessions, today);\r\n\r\n                                    let daysElapsed: number | undefined;\r\n                                    let daysRemaining: number | undefined;\r\n\r\n                                    if (habit.completionHistory && habit.completionHistory.length > 0) {\r\n                                        daysElapsed = habit.completionHistory.length;\r\n                                    }\r\n\r\n                                    if (habit.deadline) {\r\n                                        const end = parseLocalDate(habit.deadline);\r\n                                        const now = new Date();\r\n                                        now.setHours(0, 0, 0, 0); // Reset to midnight\r\n                                        end.setHours(0, 0, 0, 0); // Reset to midnight\r\n                                        const totalDays = Math.max(0, Math.ceil((end.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)));\r\n                                        daysRemaining = totalDays;\r\n                                    }\r\n\r\n                                    const start = habit.startDate ? new Date(habit.startDate) : new Date(habit.createdAt || Date.now());\r\n                                    const todayDate = new Date();\r\n                                    const diffTime = Math.abs(todayDate.getTime() - start.getTime());\r\n                                    const expectedDays = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));\r\n                                    const progressTotal = habit.deadline ? expectedDays : (habit.completionHistory?.length || 0) + 1;\r\n\r\n                                    let timeCurrent: number | undefined;\r\n                                    let timeTotal: number | undefined;\r\n                                    if (habit.deadline) {\r\n                                        const end = parseLocalDate(habit.deadline);\r\n                                        const start = habit.startDate ? parseLocalDate(habit.startDate) : new Date(habit.createdAt || Date.now());\r\n                                        const now = new Date();\r\n\r\n                                        // Reset all to midnight for accurate day calculation\r\n                                        end.setHours(0, 0, 0, 0);\r\n                                        start.setHours(0, 0, 0, 0);\r\n                                        now.setHours(0, 0, 0, 0);\r\n\r\n                                        timeTotal = Math.max(1, Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n                                        timeCurrent = Math.max(0, Math.min(timeTotal, Math.ceil((now.getTime() - start.getTime()) / (1000 * 60 * 60 * 24))));\r\n                                    }\r\n\r\n                                    return (\r\n                                        <DraggableMissionItem key={habit.id} item={habit}>\r\n                                            <MissionCard\r\n                                                id={habit.id}\r\n                                                title={habit.title}\r\n                                                icon={habit.icon || \"Flame\"}\r\n                                                colorClass=\"from-orange-500 to-rose-600 shadow-orange-500/20\"\r\n                                                type=\"habit\"\r\n                                                isCompleted={isChecked}\r\n                                                isBlocked={isBlocked}\r\n                                                actualStartTime={isChecked ? sessionTimes.start : null}\r\n                                                actualEndTime={isChecked ? sessionTimes.end : null}\r\n                                                daysElapsed={daysElapsed}\r\n                                                daysRemaining={daysRemaining}\r\n                                                startDate={habit.startDate}\r\n                                                endDate={habit.deadline}\r\n                                                progressCurrent={habit.completionHistory?.length || 0}\r\n                                                progressTotal={progressTotal}\r\n                                                timeCurrent={timeCurrent}\r\n                                                timeTotal={timeTotal}\r\n                                                onFocus={() => handleStartFocus(habit.id, 'goal', habit.title, habit.durationMinutes)}\r\n                                                isActive={activeFocus?.id === habit.id}\r\n                                                onToggle={() => {\r\n                                                    const action = (s?: string) => {\r\n                                                        if (habit.type === 'habit') {\r\n                                                            toggleGoal(habit.id, today, s);\r\n                                                        } else {\r\n                                                            toggleGoal(habit.id, undefined, s);\r\n                                                        }\r\n                                                    };\r\n\r\n                                                    if (isChecked && !isItemOptimistic) {\r\n                                                        action();\r\n                                                    } else {\r\n                                                        requestCompletion(habit.id, habit.title, action);\r\n                                                    }\r\n                                                }}\r\n                                                onOpenDetails={() => handleOpenDetails(habit.id, 'goal')}\r\n                                            >\r\n                                                <PriorityIcon priority={habit.priority} />\r\n                                            </MissionCard>\r\n                                        </DraggableMissionItem>\r\n                                    );\r\n                                })}\r\n                            </Reorder.Group>\r\n                        </SectionBox>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 2. Revis√µes & Estudos */}\r\n                {orderedReviews.length > 0 && (\r\n                    <div className=\"border-t border-blue-500/10 pt-4\">\r\n                        <SectionBox title=\"REVIS√ïES & ESTUDOS\" icon={BrainCircuit} colorClass=\"text-emerald-400\" count={orderedReviews.length}>\r\n                            <Reorder.Group axis=\"y\" values={orderedReviews} onReorder={handleReorderReviews} className=\"space-y-3\">\r\n                                {orderedReviews.map((item: ReviewItem) => {\r\n                                    const reviewNum = item.dueReview.number || 0;\r\n                                    const level = reviewNum;\r\n                                    const domain = item.mastery ? Math.round(item.mastery * 100) : 0;\r\n                                    const sessionTimes = getSessionTimes(item.sessions, today);\r\n                                    const isItemOptimistic = completionItem?.id === item.id;\r\n                                    const isCompleted = item.dueReview.status === 'completed' || isItemOptimistic;\r\n\r\n                                    return (\r\n                                        <DraggableMissionItem key={item.id} item={item}>\r\n                                            <MissionCard\r\n                                                id={item.id}\r\n                                                title={item.title}\r\n                                                themeTitle={item.themeTitle}\r\n\r\n                                                reviewNumber={item.dueReview.number}\r\n                                                icon={item.icon || \"BrainCircuit\"}\r\n                                                colorClass=\"from-emerald-500 to-teal-600 shadow-emerald-500/20\"\r\n                                                type=\"review\"\r\n                                                isCompleted={isCompleted}\r\n                                                isBlocked={isFutureContext}\r\n                                                actualStartTime={sessionTimes.start || item.notificationTime}\r\n                                                actualEndTime={(item.dueReview.status === 'completed' ? sessionTimes.end : null) || calculateEndTime(item.notificationTime, item.durationMinutes)}\r\n                                                level={`${level}/5`}\r\n                                                domain={domain}\r\n                                                startDate={item.introductionDate}\r\n                                                endDate={item.deadline}\r\n                                                progressCurrent={item.reviews.filter((r: Review) => r.status === 'completed').length}\r\n                                                progressTotal={item.reviews.length}\r\n                                                schedule={item.reviews}\r\n                                                onFocus={() => handleStartFocus(item.id, 'subtheme', item.title, item.durationMinutes, item.dueReview.number, (item.type as 'review' | 'intro') || 'review')}\r\n                                                isActive={activeFocus?.id === item.id}\r\n                                                onToggle={() => {\r\n                                                    const action = (s?: string) => completeReview(item.id, item.dueReview.number, (item.type as 'review' | 'intro') || 'review', 'medium', s);\r\n                                                    if (isCompleted && !isItemOptimistic) {\r\n                                                        action();\r\n                                                    } else {\r\n                                                        requestCompletion(item.id, item.title, action);\r\n                                                    }\r\n                                                }}\r\n                                                onOpenDetails={() => handleOpenDetails(item.id, 'subtheme')}\r\n                                            >\r\n                                                <PriorityIcon priority={item.priority} />\r\n                                            </MissionCard>\r\n                                        </DraggableMissionItem>\r\n                                    );\r\n                                })}\r\n                            </Reorder.Group>\r\n                        </SectionBox>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 3. Tarefas & Miss√µes */}\r\n                {orderedTasks.length > 0 && (\r\n                    <div className=\"border-t border-blue-500/10 pt-4\">\r\n                        <SectionBox title=\"TAREFAS & MISS√ïES\" icon={CheckSquare} colorClass=\"text-blue-400\" count={orderedTasks.length}>\r\n                            <Reorder.Group axis=\"y\" values={orderedTasks} onReorder={handleReorderTasks} className=\"space-y-3\">\r\n                                {orderedTasks.map((task) => {\r\n                                    const isCompletedToday = task.type === 'day' ? task.status === 'completed' : (task.completionHistory?.some((d: string) => d.startsWith(today)) ?? false);\r\n                                    const isItemOptimistic = completionItem?.id === task.id;\r\n                                    const isChecked = isCompletedToday || isItemOptimistic;\r\n                                    const isBlocked = isFutureContext;\r\n                                    const sessionTimes = getSessionTimes(task.sessions, today);\r\n\r\n                                    let timeCurrent: number | undefined;\r\n                                    let timeTotal: number | undefined;\r\n                                    if (task.type === 'period' && task.startDate && task.endDate) {\r\n                                        const start = new Date(task.startDate);\r\n                                        const end = new Date(task.endDate);\r\n                                        const now = new Date();\r\n                                        timeTotal = Math.max(1, Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n                                        timeCurrent = Math.max(0, Math.min(timeTotal, Math.ceil((now.getTime() - start.getTime()) / (1000 * 60 * 60 * 24))));\r\n                                    }\r\n\r\n                                    return (\r\n                                        <DraggableMissionItem key={task.id} item={task}>\r\n                                            <MissionCard\r\n                                                id={task.id}\r\n                                                title={task.title}\r\n                                                icon={task.icon || \"ClipboardList\"}\r\n                                                type=\"task\"\r\n                                                isCompleted={isChecked}\r\n                                                isBlocked={isBlocked}\r\n                                                actualStartTime={isChecked ? sessionTimes.start : task.notificationTime}\r\n                                                actualEndTime={isChecked ? sessionTimes.end : calculateEndTime(task.notificationTime, task.durationMinutes)}\r\n                                                startDate={task.startDate || task.date}\r\n                                                endDate={task.endDate || task.date}\r\n                                                progressCurrent={'progress' in task && task.progress ? task.progress.current : (task.status === 'completed' ? 1 : 0)}\r\n                                                progressTotal={'progress' in task && task.progress ? (task.progress.total || 1) : 1}\r\n                                                timeCurrent={timeCurrent}\r\n                                                timeTotal={timeTotal}\r\n                                                onFocus={() => handleStartFocus(task.id, 'task', task.title, task.durationMinutes)}\r\n                                                isActive={activeFocus?.id === task.id}\r\n                                                onToggle={() => {\r\n                                                    const action = (s?: string) => toggleTask(task.id, today, s);\r\n                                                    if (isChecked && !isItemOptimistic) action();\r\n                                                    else requestCompletion(task.id, task.title, action);\r\n                                                }}\r\n                                                onOpenDetails={() => handleOpenDetails(task.id, 'task')}\r\n                                            >\r\n                                                <PriorityIcon priority={task.priority} />\r\n                                            </MissionCard>\r\n                                        </DraggableMissionItem>\r\n                                    );\r\n                                })}\r\n                            </Reorder.Group>\r\n                        </SectionBox>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Empty State */}\r\n                {!hasItems && (\r\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center space-y-4 opacity-50 animate-in fade-in duration-500\">\r\n                        <div className=\"w-20 h-20 rounded-full bg-slate-800/50 flex items-center justify-center mb-2 shadow-inner border border-slate-700/50\">\r\n                            <CalendarIcon className=\"w-10 h-10 text-slate-600\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-slate-400 font-bold text-sm\">Nada agendado para este dia</p>\r\n                            <p className=\"text-slate-600 text-xs mt-1 max-w-[200px] mx-auto leading-relaxed\">Aproveite para descansar ou adiantar estudos de outros dias!</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Completion Modal Overlay */}\r\n                {completionItem && (\r\n                    <div className=\"absolute inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm rounded-[2rem] animate-in fade-in duration-200\">\r\n                        <div className=\"bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-sm shadow-2xl relative animate-in zoom-in-95 duration-200\">\r\n                            <div className=\"flex items-center gap-3 mb-4\">\r\n                                <div className=\"p-2 bg-emerald-500/10 rounded-lg text-emerald-400\">\r\n                                    <CheckSquare className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-bold text-white\">Concluir Miss√£o</h3>\r\n                                    <p className=\"text-xs text-slate-400 line-clamp-1\">{completionItem.title}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <p className=\"text-slate-300 text-sm mb-3\">O que voc√™ aprendeu ou realizou?</p>\r\n\r\n                            <textarea\r\n                                value={summaryText}\r\n                                onChange={e => setSummaryText(e.target.value)}\r\n                                className=\"w-full h-24 bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm resize-none focus:ring-2 focus:ring-blue-500 outline-none mb-4 placeholder:text-slate-600\"\r\n                                placeholder=\"Adicione um resumo (opcional)...\"\r\n                                autoFocus\r\n                            />\r\n\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={skipSummary}\r\n                                    className=\"flex-1 py-3 text-slate-400 font-bold hover:text-white hover:bg-white/5 rounded-xl transition-colors text-sm\"\r\n                                >\r\n                                    Pular\r\n                                </button>\r\n                                <button\r\n                                    onClick={confirmCompletion}\r\n                                    className=\"flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm\"\r\n                                >\r\n                                    <Save className=\"w-4 h-4\" />\r\n                                    Salvar\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Task Details Modal */}\r\n            <TaskDetailsModal\r\n                isOpen={!!selectedTask}\r\n                onClose={() => setSelectedTask(null)}\r\n                task={selectedTask}\r\n            />\r\n\r\n            {/* Goal Details Modal */}\r\n            <GoalDetailsModal\r\n                isOpen={!!selectedGoal}\r\n                onClose={() => setSelectedGoal(null)}\r\n                goal={selectedGoal}\r\n            />\r\n\r\n            {/* Subtheme Details Modal */}\r\n            <React.Suspense fallback={<div className=\"p-4 flex justify-center\"><Loader2 className=\"w-6 h-6 animate-spin text-blue-500\" /></div>}>\r\n                <StudyContentModal\r\n                    isOpen={!!selectedSubtheme}\r\n                    onClose={() => setSelectedSubtheme(null)}\r\n                    subtheme={selectedSubtheme}\r\n                    onSave={(updated) => { /* handle save if needed */ }}\r\n                />\r\n            </React.Suspense>\r\n\r\n        </Modal >\r\n    );\r\n};\r\n\r\nexport default TodayMissionModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\TodayMissionWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\__tests__\\MissionItem.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\AchievementsSummaryWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Trophy, Star, Lock, ChevronRight } from 'lucide-react';\r\nimport { ACHIEVEMENTS_LIST } from '../../../config/gamification';\r\nimport type { Achievement } from '../../../types/gamification';\r\nimport * as Icons from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\n\r\ninterface AchievementsSummaryWidgetProps {\r\n    unlockedAchievements: Achievement[];\r\n    onNavigate: (tab: string) => void;\r\n}\r\n\r\nexport const AchievementsSummaryWidget: React.FC<AchievementsSummaryWidgetProps> = ({ unlockedAchievements, onNavigate }) => {\r\n    const totalCount = ACHIEVEMENTS_LIST.length;\r\n    const unlockedCount = unlockedAchievements.length;\r\n\r\n    // Get last 3 unlocked in reverse chronological order\r\n    const recentAchievements = [...unlockedAchievements]\r\n        .sort((a, b) => new Date(b.unlockedAt || 0).getTime() - new Date(a.unlockedAt || 0).getTime())\r\n        .slice(0, 3);\r\n\r\n    // Fill with locked if empty? No, just show what we have.\r\n\r\n    return (\r\n        <div className=\"bg-gradient-to-br from-slate-900/50 via-slate-900/40 to-slate-950/50 backdrop-blur-md border border-white/10 rounded-3xl p-5 shadow-2xl relative overflow-hidden group/achievements\">\r\n            {/* Ambient Lighting */}\r\n            <div className=\"absolute top-0 right-0 w-32 h-32 bg-yellow-500/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none\" />\r\n            <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-500/60 via-orange-500/60 to-transparent opacity-60\" />\r\n\r\n            <div className=\"relative z-10\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"p-1.5 rounded-lg bg-yellow-500/10 ring-1 ring-yellow-500/20\">\r\n                            <Trophy className=\"w-4 h-4 text-yellow-500\" />\r\n                        </div>\r\n                        <h3 className=\"font-bold text-white text-base tracking-tight\">Conquistas</h3>\r\n                    </div>\r\n                    <span className=\"text-[10px] font-black text-yellow-500/80 bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20\">\r\n                        {unlockedCount}/{totalCount}\r\n                    </span>\r\n                </div>\r\n\r\n                {/* Progress Bar (Radial or linear?) Let's go linear for a compact widget */}\r\n                <div className=\"mb-6\">\r\n                    <div className=\"flex justify-between text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1.5\">\r\n                        <span>Minhas Medalhas</span>\r\n                        <span>{Math.round((unlockedCount / totalCount) * 100)}%</span>\r\n                    </div>\r\n                    <div className=\"h-1.5 w-full bg-slate-950 rounded-full overflow-hidden border border-white/5 p-[1px]\">\r\n                        <div\r\n                            className=\"h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(234,179,8,0.3)]\"\r\n                            style={{ width: `${(unlockedCount / totalCount) * 100}%` }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Recent Unlocks List */}\r\n                <div className=\"space-y-3\">\r\n                    {recentAchievements.length > 0 ? (\r\n                        recentAchievements.map((achievement) => {\r\n                            const Icon = (Icons as any)[achievement.iconName] || Trophy;\r\n                            return (\r\n                                <div key={achievement.id} className=\"flex items-center gap-3 p-2 bg-slate-800/40 rounded-xl border border-white/5 hover:bg-slate-800/60 transition-colors\">\r\n                                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-yellow-500 to-orange-600 flex items-center justify-center shrink-0 shadow-lg\">\r\n                                        <Icon className=\"w-5 h-5 text-white\" />\r\n                                    </div>\r\n                                    <div className=\"min-w-0\">\r\n                                        <p className=\"text-xs font-bold text-white truncate\">{achievement.title}</p>\r\n                                        <p className=\"text-[10px] text-slate-500 truncate\">{achievement.description}</p>\r\n                                    </div>\r\n                                    <Star className=\"w-3 h-3 text-yellow-500 ml-auto fill-yellow-500\" />\r\n                                </div>\r\n                            );\r\n                        })\r\n                    ) : (\r\n                        <div className=\"flex flex-col items-center justify-center py-4 bg-slate-800/20 rounded-2xl border border-dashed border-slate-700\">\r\n                            <Lock className=\"w-6 h-6 text-slate-600 mb-2\" />\r\n                            <p className=\"text-[10px] text-slate-500 font-medium\">Continue focado!</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* View All Button */}\r\n                <button\r\n                    onClick={() => onNavigate('analytics')}\r\n                    className=\"mt-4 w-full py-2.5 bg-slate-800/50 hover:bg-slate-800 border border-white/5 hover:border-white/10 rounded-xl text-[10px] font-bold text-slate-300 hover:text-white transition-all flex items-center justify-center gap-2 group/btn\"\r\n                >\r\n                    GALERIA DE TROF√âUS\r\n                    <ChevronRight className=\"w-3 h-3 group-hover/btn:translate-x-1 transition-transform\" />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\ActiveGoalsWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\LeaderboardWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trophy' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isTop3' is assigned a value but never used.","line":54,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":37}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Trophy, Medal, Crown, TrendingUp, Users } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\n\r\ninterface LeaderboardUser {\r\n    id: string;\r\n    name: string;\r\n    avatar?: string;\r\n    xp: number;\r\n    level: number;\r\n    isMe?: boolean;\r\n    trend: 'up' | 'down' | 'stable';\r\n}\r\n\r\ninterface LeaderboardWidgetProps {\r\n    userXp?: number;\r\n    userLevel?: number;\r\n}\r\n\r\nexport const LeaderboardWidget: React.FC<LeaderboardWidgetProps> = ({ userXp = 0, userLevel = 1 }) => {\r\n    // Mock Data for \"Global/Friend Rankings\" (Merged with real user data)\r\n    const competitors: LeaderboardUser[] = [\r\n        { id: '1', name: 'Alex M.', xp: 15420, level: 24, trend: 'up' as const },\r\n        { id: '2', name: 'Sarah Dr.', xp: 12850, level: 20, trend: 'stable' as const },\r\n        { id: 'me', name: 'Voc√™', xp: userXp, level: userLevel, isMe: true, trend: 'up' as const },\r\n        { id: '4', name: 'Gustavo K.', xp: 8200, level: 12, trend: 'down' as const },\r\n        { id: '5', name: 'Elena V.', xp: 7500, level: 11, trend: 'stable' as const },\r\n    ].sort((a, b) => b.xp - a.xp);\r\n\r\n    return (\r\n        <div className=\"bg-gradient-to-br from-slate-900/50 via-slate-900/40 to-slate-950/50 backdrop-blur-md border border-white/10 rounded-3xl p-5 shadow-2xl relative overflow-hidden group/leaderboard\">\r\n            {/* Ambient Lighting */}\r\n            <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none\" />\r\n            <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-indigo-500/5 rounded-full blur-3xl -ml-16 -mb-16 pointer-events-none\" />\r\n\r\n            <div className=\"relative z-10\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-5\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"p-1.5 rounded-lg bg-indigo-500/10 ring-1 ring-indigo-500/20\">\r\n                            <Users className=\"w-4 h-4 text-indigo-400\" />\r\n                        </div>\r\n                        <h3 className=\"font-bold text-white text-base tracking-tight\">Ranking Global</h3>\r\n                    </div>\r\n                    <span className=\"text-[10px] font-black text-indigo-400 bg-indigo-500/10 px-2 py-0.5 rounded border border-indigo-500/20\">\r\n                        LIGA OURO\r\n                    </span>\r\n                </div>\r\n\r\n                {/* Rankings List */}\r\n                <div className=\"space-y-2\">\r\n                    {competitors.map((user, idx) => {\r\n                        const rank = idx + 1;\r\n                        const isTop3 = rank <= 3;\r\n\r\n                        return (\r\n                            <div\r\n                                key={user.id}\r\n                                className={cn(\r\n                                    \"flex items-center gap-3 p-2.5 rounded-2xl transition-all border\",\r\n                                    user.isMe\r\n                                        ? \"bg-indigo-500/10 border-indigo-500/30 scale-[1.02] shadow-lg shadow-indigo-500/10\"\r\n                                        : \"bg-slate-800/30 border-white/5 hover:border-white/10\"\r\n                                )}\r\n                            >\r\n                                {/* Rank Icon/Number */}\r\n                                <div className=\"w-6 flex justify-center shrink-0\">\r\n                                    {rank === 1 && <Crown className=\"w-4 h-4 text-yellow-500 fill-yellow-500\" />}\r\n                                    {rank === 2 && <Medal className=\"w-4 h-4 text-slate-300 fill-slate-300\" />}\r\n                                    {rank === 3 && <Medal className=\"w-4 h-4 text-amber-600 fill-amber-600\" />}\r\n                                    {rank > 3 && <span className=\"text-[10px] font-black text-slate-600\">{rank}</span>}\r\n                                </div>\r\n\r\n                                {/* Avatar */}\r\n                                <div className=\"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center border border-white/10 shrink-0 overflow-hidden\">\r\n                                    <span className=\"text-[10px] font-bold text-white uppercase\">{user.name.substring(0, 2)}</span>\r\n                                </div>\r\n\r\n                                {/* Name & Level */}\r\n                                <div className=\"min-w-0 flex-1\">\r\n                                    <p className={cn(\r\n                                        \"text-xs font-bold truncate\",\r\n                                        user.isMe ? \"text-white\" : \"text-slate-300\"\r\n                                    )}>\r\n                                        {user.name}\r\n                                    </p>\r\n                                    <p className=\"text-[9px] text-slate-500 font-medium\">N√≠vel {user.level}</p>\r\n                                </div>\r\n\r\n                                {/* XP */}\r\n                                <div className=\"text-right\">\r\n                                    <p className=\"text-[10px] font-mono font-black text-white\">{user.xp.toLocaleString()}</p>\r\n                                    <p className=\"text-[8px] text-slate-600 font-bold tracking-tighter uppercase\">XP TOTAL</p>\r\n                                </div>\r\n\r\n                                {/* Trend */}\r\n                                <div className=\"ml-1\">\r\n                                    {user.trend === 'up' && <TrendingUp className=\"w-3 h-3 text-emerald-500\" />}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* View Full Ranking */}\r\n                <button className=\"mt-4 w-full py-2 text-[10px] font-black text-slate-500 hover:text-indigo-400 transition-colors uppercase tracking-widest border border-dashed border-slate-800 rounded-xl hover:bg-indigo-500/5 hover:border-indigo-500/20\">\r\n                    Ver Ranking Completo\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'id' is defined but never used.","line":73,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'progressInfo' is defined but never used.","line":82,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'domainInfo' is defined but never used.","line":83,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'duration' is assigned a value but never used.","line":88,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'progressCurrent' is defined but never used.","line":91,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'progressTotal' is defined but never used.","line":92,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":18}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Lock, Play, CheckCircle2, Clock, CheckSquare, Loader2 } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport { format, isToday, isTomorrow, isYesterday } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface MissionCardProps {\r\n    id: string;\r\n    title: string;\r\n    icon: string;\r\n    type: 'habit' | 'review' | 'task';\r\n    isCompleted: boolean;\r\n    isBlocked: boolean;\r\n    actualStartTime?: string | null;\r\n    actualEndTime?: string | null;\r\n    themeTitle?: string;\r\n    progressInfo?: string;\r\n    domainInfo?: string;\r\n    level?: string;\r\n    domain?: number;\r\n    daysElapsed?: number;\r\n    daysRemaining?: number;\r\n    duration?: number; // Pomodoro duration in minutes\r\n    startDate?: string; // Format: YYYY-MM-DD\r\n    endDate?: string; // Format: YYYY-MM-DD\r\n    progressCurrent?: number; // How many completed\r\n    progressTotal?: number; // Total expected\r\n    timeCurrent?: number; // Days elapsed\r\n    timeTotal?: number; // Total days duration\r\n    schedule?: { number: number; date: string; status: 'completed' | 'pending' | 'projected' }[];\r\n    onFocus?: () => void;\r\n    onToggle?: () => void;\r\n    onOpenDetails?: () => void;\r\n    isActive?: boolean;\r\n    children?: React.ReactNode;\r\n    reviewNumber?: number;\r\n    isLoading?: boolean;\r\n    colorClass?: string;\r\n}\r\n\r\nconst colorSchemes = {\r\n    habit: {\r\n        gradient: 'from-slate-700 to-slate-600',\r\n        glow: 'shadow-orange-500/20',\r\n        text: 'text-orange-400',\r\n        border: 'border-slate-700/40',\r\n        bgHover: 'hover:bg-slate-800/50',\r\n        accent: 'bg-orange-500/20 border-orange-500/30',\r\n        bg: 'bg-gradient-to-br from-orange-500 to-amber-500 text-white shadow-lg shadow-orange-500/20'\r\n    },\r\n    review: {\r\n        gradient: 'from-slate-700 to-slate-600',\r\n        glow: 'shadow-emerald-500/20',\r\n        text: 'text-emerald-400',\r\n        border: 'border-slate-700/40',\r\n        bgHover: 'hover:bg-slate-800/50',\r\n        accent: 'bg-emerald-500/20 border-emerald-500/30',\r\n        bg: 'bg-gradient-to-br from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20'\r\n    },\r\n    task: {\r\n        gradient: 'from-slate-700 to-slate-600',\r\n        glow: 'shadow-blue-500/20',\r\n        text: 'text-blue-400',\r\n        border: 'border-slate-700/40',\r\n        bgHover: 'hover:bg-slate-800/50',\r\n        accent: 'bg-blue-500/20 border-blue-500/30',\r\n        bg: 'bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/20'\r\n    }\r\n};\r\n\r\nconst MissionCardBase: React.FC<MissionCardProps> = ({\r\n    id,\r\n    title,\r\n    themeTitle,\r\n    icon,\r\n    type,\r\n    isCompleted,\r\n    isBlocked: propIsBlocked,\r\n    actualStartTime,\r\n    actualEndTime,\r\n    progressInfo,\r\n    domainInfo,\r\n    level,\r\n    domain,\r\n    daysElapsed,\r\n    daysRemaining,\r\n    duration = 25,\r\n    startDate,\r\n    endDate,\r\n    progressCurrent,\r\n    progressTotal,\r\n    timeCurrent,\r\n    timeTotal,\r\n    schedule,\r\n    reviewNumber,\r\n    onFocus,\r\n    onToggle,\r\n    onOpenDetails,\r\n    children,\r\n    isActive = false,\r\n    isLoading = false,\r\n    colorClass\r\n}) => {\r\n    const scheme = colorSchemes[type];\r\n    const isBlocked = propIsBlocked;\r\n\r\n    // Check if item is overdue\r\n    const now = new Date();\r\n    const isOverdue = !isCompleted && endDate && new Date(endDate + 'T23:59:59') < now;\r\n\r\n    const getIconBackground = () => {\r\n        if (isCompleted) return \"bg-emerald-500/20 text-emerald-400 ring-1 ring-emerald-500/30\";\r\n        if (isBlocked) return \"bg-slate-800/40 text-slate-500 ring-1 ring-white/5 grayscale\";\r\n\r\n        // Use custom color class if provided, else use scheme default\r\n        if (colorClass) {\r\n            // Check if it's already a full gradient string or just classes\r\n            if (colorClass.includes('from-')) return `bg-gradient-to-br ${colorClass} text-white shadow-lg ring-1 ring-white/10`;\r\n            return `bg-${colorClass}-500 text-white shadow-lg shadow-${colorClass}-500/20 ring-1 ring-white/10`;\r\n        }\r\n\r\n        return `bg-gradient-to-br ${scheme?.bg || 'from-blue-600 to-indigo-700'} text-white shadow-lg shadow-blue-900/40 ring-1 ring-white/20`;\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className={cn(\r\n                \"relative group rounded-2xl p-4 transition-all duration-300\",\r\n                \"bg-[#0F172A] border\",\r\n                isActive\r\n                    ? \"border-rose-500/50 shadow-[0_0_15px_-3px_rgba(244,63,94,0.3)]\"\r\n                    : isOverdue\r\n                        ? \"border-red-500/70 bg-gradient-to-br from-red-900/20 to-orange-900/10 shadow-lg shadow-red-500/20\"\r\n                        : \"border-blue-900/30\",\r\n                isBlocked ? \"opacity-50 grayscale pointer-events-none select-none\" : isCompleted ? \"opacity-75 cursor-default border-emerald-500/20 bg-emerald-500/5 transition-none\" : \"hover:bg-slate-800/40 cursor-pointer\"\r\n            )}\r\n            onClick={onOpenDetails}\r\n        >\r\n            {/* Overdue glow effect */}\r\n            {isOverdue && !isCompleted && (\r\n                <div className=\"absolute top-0 right-0 p-12 bg-red-500/10 blur-[40px] rounded-full pointer-events-none animate-pulse\" />\r\n            )}\r\n            {/* Main Content Grid */}\r\n            <div className=\"flex items-start gap-4\">\r\n                {/* Icon Container */}\r\n                <div className={cn(\r\n                    \"w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 relative group-hover:scale-110 group-hover:rotate-3\",\r\n                    getIconBackground()\r\n                )}>\r\n                    {/* Inner Glow/Reflection */}\r\n                    <div className=\"absolute inset-0 rounded-2xl bg-gradient-to-tr from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                    <div className=\"absolute inset-[1px] rounded-[15px] bg-gradient-to-b from-white/10 to-transparent pointer-events-none\" />\r\n\r\n                    <IconRenderer icon={icon} size={24} className=\"text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)] z-10\" />\r\n                </div>\r\n\r\n                {/* Text Content */}\r\n                <div className=\"flex-1 min-w-0 pt-0.5\">\r\n                    {themeTitle && (\r\n                        <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-0.5 line-clamp-1 flex items-center gap-1\">\r\n                            {themeTitle}\r\n                            {reviewNumber !== undefined && (\r\n                                <span className={cn(\r\n                                    \"px-1 rounded text-[9px]\",\r\n                                    \"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\"\r\n                                )}>\r\n                                    #{reviewNumber}\r\n                                </span>\r\n                            )}\r\n                        </p>\r\n                    )}\r\n                    <div className=\"flex items-center gap-2 mb-0.5\">\r\n                        {isOverdue && !isCompleted && (\r\n                            <span className=\"text-[8px] font-black uppercase tracking-wider px-1.5 py-0.5 rounded bg-red-500/20 text-red-400 border border-red-500/40 whitespace-nowrap animate-pulse\">\r\n                                ‚ö† Atrasado\r\n                            </span>\r\n                        )}\r\n                        <h3 className={cn(\r\n                            \"text-base font-bold text-white truncate transition-colors flex-1\",\r\n                            isCompleted && \"line-through text-slate-500\",\r\n                            isOverdue && !isCompleted && \"text-red-400 font-extrabold\"\r\n                        )}>\r\n                            {title}\r\n                        </h3>\r\n                    </div>\r\n\r\n                    {/* Subtitle / Status */}\r\n                    {(actualStartTime || actualEndTime) && (\r\n                        <div className=\"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-lg bg-blue-500/10 border border-blue-500/20 text-blue-300 text-xs font-bold\">\r\n                            <Clock className=\"w-3 h-3\" />\r\n                            <span>\r\n                                {actualStartTime || '--:--'} - {actualEndTime || '--:--'}\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n                    {!actualStartTime && (\r\n                        <p className={cn(\r\n                            \"text-xs font-bold uppercase tracking-wider\",\r\n                            isOverdue && !isCompleted ? \"text-red-500 animate-pulse\" : \"text-slate-500\"\r\n                        )}>\r\n                            {isOverdue && !isCompleted\r\n                                ? \"ATRASADO\"\r\n                                : (type === 'review' ? 'REVISAR AGORA' : 'PENDENTE')}\r\n                        </p>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right Actions */}\r\n                <div className=\"flex items-center gap-2\" onClick={e => e.stopPropagation()}>\r\n                    {/* Play Button */}\r\n                    {!isCompleted && (\r\n                        isActive ? (\r\n                            <div className=\"h-9 px-4 rounded-full bg-rose-500/10 border border-rose-500/30 flex items-center justify-center gap-2 animate-pulse\">\r\n                                <Loader2 className=\"w-3.5 h-3.5 text-rose-400 animate-spin\" />\r\n                                <span className=\"text-[10px] font-bold text-rose-400 uppercase tracking-wider\">Focando</span>\r\n                            </div>\r\n                        ) : (\r\n                            <button\r\n                                className={cn(\r\n                                    \"relative z-50 w-10 h-10 rounded-full flex items-center justify-center transition-all group/btn shadow-lg hover:scale-105 active:scale-95\",\r\n                                    isLoading\r\n                                        ? \"cursor-wait opacity-50 bg-slate-800\"\r\n                                        : \"bg-slate-800 hover:bg-emerald-500 border border-slate-700 hover:border-emerald-500 text-slate-400 hover:text-white\"\r\n                                )}\r\n                                onPointerDown={(e) => e.stopPropagation()}\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    if (isBlocked) {\r\n                                        // Feedback explicit para o usu√°rio entender por que n√£o inicia\r\n                                        alert(\"Esta miss√£o est√° bloqueada (data futura ou restri√ß√£o).\");\r\n                                        return;\r\n                                    }\r\n                                    onFocus?.();\r\n                                }}\r\n                                disabled={isBlocked}\r\n                                title=\"Iniciar Foco Imediatamente\"\r\n                            >\r\n                                {isLoading ? (\r\n                                    <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                ) : isBlocked ? (\r\n                                    <Lock className=\"w-4 h-4 text-slate-600\" />\r\n                                ) : (\r\n                                    <Play className=\"w-4 h-4 fill-current ml-0.5\" />\r\n                                )}\r\n                            </button>\r\n                        )\r\n                    )}\r\n                    {isCompleted && (\r\n                        <div className=\"w-8 h-8 rounded-full border border-emerald-500/30 bg-emerald-500/10 flex items-center justify-center\">\r\n                            <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Secondary Action (Stop or Details) */}\r\n                    {type === 'task' ? (\r\n                        <button\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                if (!isCompleted) onToggle?.();\r\n                            }}\r\n                            disabled={isCompleted}\r\n                            className={cn(\r\n                                \"w-8 h-8 rounded-full flex items-center justify-center transition-all border group/btn\",\r\n                                isCompleted ? \"bg-blue-600 border-blue-400 cursor-default\" : \"bg-blue-600 hover:bg-blue-500 border-blue-400\"\r\n                            )}\r\n                        >\r\n                            <CheckSquare className=\"w-4 h-4 text-white\" />\r\n                        </button>\r\n                    ) : (\r\n                        <button\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                if (!isCompleted) onToggle?.();\r\n                            }}\r\n                            disabled={isCompleted}\r\n                            className={cn(\r\n                                \"w-8 h-8 rounded-full border border-slate-600 flex items-center justify-center transition-all\",\r\n                                isCompleted ? \"cursor-default border-slate-600\" : \"hover:bg-slate-700 hover:border-slate-500\"\r\n                            )}\r\n                        >\r\n                            {/* Checkbox style for non-tasks (Habits/Goals visual cue) */}\r\n                            <div className={cn(\"w-3 h-3 rounded-sm transition-colors\", isCompleted ? \"bg-emerald-500\" : \"bg-slate-400\")} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bottom Progress Section */}\r\n            <div className=\"mt-4 space-y-2\">\r\n                {/* Labels Row */}\r\n                <div className=\"flex justify-between items-center text-xs font-bold text-slate-400\">\r\n                    {level && (\r\n                        <span className=\"text-slate-300\">{type === 'review' ? `N√≠vel ${level}` : `${daysElapsed}/${timeTotal}`}</span>\r\n                    ) || (\r\n                            <span>{timeCurrent !== undefined && timeTotal ? `${timeCurrent}/${timeTotal}` : ''}</span>\r\n                        )}\r\n\r\n                    {type === 'review' && domain && (\r\n                        <span className=\"text-emerald-500\">{domain}% Dom√≠nio</span>\r\n                    ) || (daysRemaining !== undefined && (\r\n                        <span className=\"text-blue-400\">{daysRemaining} dias restantes</span>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Progress Bar */}\r\n                {type === 'review' ? (\r\n                    // Segmented Bar for Reviews\r\n                    <div className=\"flex gap-1 h-1.5\">\r\n                        {[1, 2, 3, 4, 5].map((seg) => {\r\n                            const currentLevel = parseInt(level?.split('/')[0] || '0');\r\n                            const reviewInfo = schedule?.find(s => s.number === seg);\r\n\r\n                            return (\r\n                                <div key={seg} className=\"relative group/tooltip flex-1 h-full\">\r\n                                    <div\r\n                                        className={cn(\r\n                                            \"w-full h-full rounded-full transition-all cursor-help\",\r\n                                            seg <= currentLevel ? \"bg-emerald-500\" : \"bg-slate-800\",\r\n                                            reviewInfo?.status === 'pending' && new Date(reviewInfo.date) <= new Date() ? \"bg-emerald-500/50\" : \"\"\r\n                                        )}\r\n                                    />\r\n                                    {/* Custom Premium Tooltip */}\r\n                                    <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 hidden group-hover/tooltip:block z-[60] pointer-events-none min-w-[120px]\">\r\n                                        <div className=\"bg-slate-900/90 backdrop-blur-md text-white rounded-lg border border-slate-700/50 shadow-xl overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\r\n                                            {/* Header */}\r\n                                            <div className={cn(\r\n                                                \"px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider border-b border-slate-700/50\",\r\n                                                seg <= currentLevel ? \"bg-emerald-500/10 text-emerald-400\" : \"bg-slate-800/50 text-slate-400\"\r\n                                            )}>\r\n                                                N√≠vel {seg}\r\n                                            </div>\r\n\r\n                                            {/* Content */}\r\n                                            <div className=\"px-3 py-2 space-y-1\">\r\n                                                {reviewInfo ? (\r\n                                                    <>\r\n                                                        <div className=\"text-xs font-medium text-slate-200\">\r\n                                                            {(() => {\r\n                                                                try {\r\n                                                                    const d = new Date(reviewInfo.date + 'T00:00:00');\r\n                                                                    if (isToday(d)) return \"Hoje\";\r\n                                                                    if (isTomorrow(d)) return \"Amanh√£\";\r\n                                                                    if (isYesterday(d)) return \"Ontem\";\r\n                                                                    return format(d, \"d 'de' MMM\", { locale: ptBR });\r\n                                                                } catch {\r\n                                                                    return reviewInfo.date;\r\n                                                                }\r\n                                                            })()}\r\n                                                        </div>\r\n                                                        <div className={cn(\r\n                                                            \"text-[10px] uppercase font-bold\",\r\n                                                            reviewInfo.status === 'completed' ? \"text-emerald-400\" :\r\n                                                                (reviewInfo.status === 'pending' ? \"text-amber-400\" : \"text-slate-500\")\r\n                                                        )}>\r\n                                                            {reviewInfo.status === 'completed' ? 'Conclu√≠do' :\r\n                                                                (reviewInfo.status === 'pending' ? 'Pendente' : 'Futuro')}\r\n                                                        </div>\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <span className=\"text-xs text-slate-500 italic\">N√£o agendado</span>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Arrow */}\r\n                                            <div className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-900/90 border-r border-b border-slate-700/50 rotate-45 backdrop-blur-md\"></div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : (\r\n                    // Linear Bar for others\r\n                    <div className=\"h-1.5 bg-slate-800 rounded-full overflow-hidden w-full relative\">\r\n                        <div\r\n                            className=\"h-full bg-blue-500 rounded-full\"\r\n                            style={{ width: timeCurrent && timeTotal ? `${(timeCurrent / timeTotal) * 100}%` : '0%' }}\r\n                        />\r\n                        {/* Optional marker if needed */}\r\n                        {timeCurrent && timeTotal && (\r\n                            <div\r\n                                className=\"absolute top-0 h-full w-2 bg-white rounded-full shadow-lg transform -translate-x-1/2\"\r\n                                style={{ left: `${(timeCurrent / timeTotal) * 100}%` }}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Dates below progress */}\r\n            {(startDate || endDate) && !isBlocked && (\r\n                <div className=\"flex items-center gap-3 text-[10px] text-slate-500 mt-3 font-medium border-t border-slate-800/50 pt-2\">\r\n                    {startDate && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <span className=\"uppercase text-[9px] font-bold text-slate-600\">In√≠cio:</span>\r\n                            <span>{new Date(startDate + 'T00:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}</span>\r\n                        </div>\r\n                    )}\r\n                    {startDate && endDate && <span className=\"text-slate-700 mx-1\">‚Ä¢</span>}\r\n                    {endDate && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <span className=\"uppercase text-[9px] font-bold text-slate-600\">Fim:</span>\r\n                            <span>{new Date(endDate + 'T00:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const MissionCard = React.memo(MissionCardBase, (prev, next) => {\r\n    return (\r\n        prev.id === next.id &&\r\n        prev.title === next.title &&\r\n        prev.isCompleted === next.isCompleted &&\r\n        prev.isBlocked === next.isBlocked &&\r\n        prev.isActive === next.isActive &&\r\n        prev.isLoading === next.isLoading &&\r\n        prev.actualStartTime === next.actualStartTime &&\r\n        prev.actualEndTime === next.actualEndTime &&\r\n        prev.progressCurrent === next.progressCurrent &&\r\n        prev.timeCurrent === next.timeCurrent &&\r\n        prev.daysRemaining === next.daysRemaining &&\r\n        prev.reviewNumber === next.reviewNumber\r\n    );\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCurrentDay' is defined but never used.","line":43,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Reorder } from 'framer-motion';\r\n\r\n\r\nimport { ChevronLeft, ChevronRight, ChevronUp, Calendar as CalendarIcon, Trophy } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport { format, isToday, addDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { MissionItem } from './MissionItem';\r\n\r\ninterface MissionListProps {\r\n    selectedDate: Date;\r\n    setSelectedDate: (d: Date) => void;\r\n    handlePrevDay: () => void;\r\n    handleNextDay: () => void;\r\n    onCollapse: () => void;\r\n\r\n    // Lists\r\n    allHabits: any[];\r\n    allReviews: any[];\r\n    allTasks: any[]; // Using any to avoid complex type import for now (should be fixed later)\r\n\r\n    // Logic\r\n    isCurrentDay: boolean;\r\n    dateStr: string;\r\n    hasOverdueItems: boolean;\r\n    dailySchedule: Record<string, string>;\r\n    missionProgress: Record<string, { startedAt?: number }>;\r\n    activeFocusId?: string;\r\n\r\n    // Handlers\r\n    handleSetTime: (id: string, time: string) => void;\r\n    handleFocusItem: (item: any, type: string) => void;\r\n    handleToggleItem: (item: any, type: string) => void;\r\n\r\n    // Stats\r\n    isAllDone: boolean;\r\n}\r\n\r\nexport const MissionList = ({\r\n    selectedDate, setSelectedDate, handlePrevDay, handleNextDay, onCollapse,\r\n    allHabits, allReviews, allTasks,\r\n    isCurrentDay, dateStr, hasOverdueItems, dailySchedule, missionProgress, activeFocusId,\r\n    handleSetTime, handleFocusItem, handleToggleItem,\r\n    isAllDone\r\n}: MissionListProps) => {\r\n    const [showCalendar, setShowCalendar] = useState(false);\r\n\r\n    // --- DRAG AND DROP PERSISTENCE LOGIC ---\r\n    // Single consolidated key: 'mission_list_order' -> { habit: [ids], review: [ids], task: [ids] }\r\n    const [itemOrder, setItemOrder] = useState<{ [key: string]: string[] }>(() => {\r\n        try {\r\n            return JSON.parse(localStorage.getItem('mission_list_order') || '{}');\r\n        } catch { return {}; }\r\n    });\r\n\r\n    const handleReorder = (type: string, newOrder: string[]) => {\r\n        const updated = { ...itemOrder, [type]: newOrder };\r\n        setItemOrder(updated);\r\n        localStorage.setItem('mission_list_order', JSON.stringify(updated));\r\n    };\r\n\r\n    // Helper to sort items based on persisted ID list + overdue priority\r\n    const sortItems = (items: any[], type: string) => {\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n\r\n        // Separate overdue and non-overdue items\r\n        const overdueItems: any[] = [];\r\n        const normalItems: any[] = [];\r\n\r\n        items.forEach(item => {\r\n            const itemDateStr = item.date || (item.deadline ? item.deadline.split('T')[0] : undefined);\r\n            const isDone = item.isDone || item.status === 'completed';\r\n            const isOverdue = !isDone && itemDateStr && itemDateStr < todayStr;\r\n\r\n            if (isOverdue) {\r\n                overdueItems.push({ ...item, isOverdue: true });\r\n            } else {\r\n                normalItems.push(item);\r\n            }\r\n        });\r\n\r\n        // Sort overdue items by date (oldest first)\r\n        overdueItems.sort((a, b) => {\r\n            const dateA = a.date || (a.deadline ? a.deadline.split('T')[0] : '9999-99-99');\r\n            const dateB = b.date || (b.deadline ? b.deadline.split('T')[0] : '9999-99-99');\r\n            return dateA.localeCompare(dateB);\r\n        });\r\n\r\n        // Sort normal items using persisted order\r\n        const order = itemOrder[type] || [];\r\n        const map = new Map(normalItems.map(i => [i.id || i.subthemeId, i]));\r\n        const sortedNormal: any[] = [];\r\n\r\n        // 1. Add items in explicit order\r\n        order.forEach(id => {\r\n            if (map.has(id)) {\r\n                sortedNormal.push(map.get(id));\r\n                map.delete(id);\r\n            }\r\n        });\r\n\r\n        // 2. Append new/remaining items (maintain original relative order)\r\n        normalItems.forEach(i => {\r\n            const id = i.id || i.subthemeId;\r\n            if (map.has(id)) {\r\n                sortedNormal.push(i);\r\n            }\r\n        });\r\n\r\n        // Return overdue items first, then normal items\r\n        return [...overdueItems, ...sortedNormal];\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {/* Date Navigation & Calendar Toggle */}\r\n            <div className=\"px-4 py-3 bg-slate-900/30 border-b border-slate-800/50 flex items-center justify-between shrink-0\">\r\n                <button onClick={handlePrevDay} className=\"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 transition-colors\"><ChevronLeft className=\"w-4 h-4\" /></button>\r\n\r\n                <div className=\"flex flex-col items-center cursor-pointer group\" onClick={() => setShowCalendar(!showCalendar)}>\r\n                    <span className=\"text-[10px] text-slate-500 font-bold uppercase tracking-widest group-hover:text-blue-400 transition-colors\">\r\n                        {isToday(selectedDate) ? 'Hoje' : format(selectedDate, 'EEEE', { locale: ptBR })}\r\n                    </span>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <CalendarIcon className=\"w-3.5 h-3.5 text-slate-400 group-hover:text-blue-400 transition-colors\" />\r\n                        <span className=\"text-sm font-bold text-slate-200 group-hover:text-white transition-colors\">\r\n                            {format(selectedDate, \"d 'de' MMMM\", { locale: ptBR })}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-1\">\r\n                    <button onClick={handleNextDay} className=\"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 transition-colors\"><ChevronRight className=\"w-4 h-4\" /></button>\r\n                    <button onClick={onCollapse} className=\"p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 transition-colors ml-1\" title=\"Minimizar\">\r\n                        <ChevronUp className=\"w-4 h-4\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Calendar Popover */}\r\n            {showCalendar && (\r\n                <div className=\"p-4 bg-slate-900 border-b border-slate-800 animate-in fade-in slide-in-from-top-2\">\r\n                    <div className=\"grid grid-cols-7 gap-1 text-center mb-2\">\r\n                        {['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].map(d => <span key={d} className=\"text-[10px] text-slate-500 font-bold\">{d}</span>)}\r\n                    </div>\r\n                    <div className=\"grid grid-cols-7 gap-1\">\r\n                        {Array.from({ length: 14 }).map((_, i) => {\r\n                            const d = addDays(selectedDate, i - 7);\r\n                            const isSel = d.toDateString() === selectedDate.toDateString();\r\n                            return (\r\n                                <button\r\n                                    key={i}\r\n                                    onClick={() => { setSelectedDate(d); setShowCalendar(false); }}\r\n                                    className={cn(\r\n                                        \"h-8 rounded-lg text-xs font-bold flex items-center justify-center transition-all\",\r\n                                        isSel ? \"bg-slate-800 text-blue-400 ring-2 ring-blue-500 shadow-lg shadow-blue-500/20 scale-110 z-10\" : \"text-slate-400 hover:bg-slate-800 hover:text-slate-200\",\r\n                                        isToday(d) && !isSel && \"text-blue-400 font-extrabold\"\r\n                                    )}\r\n                                >\r\n                                    {format(d, 'd')}\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Scrollable List */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar max-h-[60vh] select-none\">\r\n                <div className=\"space-y-6\">\r\n                    {[\r\n                        { title: 'H√°bitos & Rotina', rawItems: allHabits, type: 'habit' },\r\n                        { title: 'Revis√µes & Estudos', rawItems: allReviews, type: 'review' },\r\n                        { title: 'Tarefas & Miss√µes', rawItems: allTasks, type: 'task' }\r\n                    ].map(group => {\r\n                        if (group.rawItems.length === 0) return null;\r\n\r\n                        // Sort items for this render\r\n                        const sortedItems = sortItems(group.rawItems, group.type);\r\n\r\n                        return (\r\n                            <div key={group.title} className=\"space-y-3\">\r\n                                <h4 className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest pl-2 border-l-2 border-slate-800 flex items-center justify-between\">\r\n                                    {group.title}\r\n                                    <span className=\"text-[9px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded-full\">{group.rawItems.length}</span>\r\n                                </h4>\r\n\r\n                                <Reorder.Group\r\n                                    values={sortedItems.map(i => i.id || i.subthemeId)}\r\n                                    onReorder={(newOrder) => handleReorder(group.type, newOrder)}\r\n                                    className=\"space-y-4\"\r\n                                    axis=\"y\"\r\n                                >\r\n                                    {sortedItems.map((item: any) => {\r\n                                        const itemId = item.id || item.subthemeId;\r\n                                        const isDone = item.isDone || item.status === 'completed';\r\n\r\n                                        // ROBUST DATE CHECK V2 (date-fns)\r\n                                        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n                                        const isFutureContext = dateStr > todayStr;\r\n                                        const isGlobalLocked = isFutureContext;\r\n\r\n                                        const itemDateStr = item.date || (item.deadline ? item.deadline.split('T')[0] : undefined);\r\n                                        const isItemOverdue = !isDone && itemDateStr && itemDateStr < dateStr;\r\n\r\n                                        let isItemLocked = isGlobalLocked;\r\n                                        let lockReason = item.lockReason || (isGlobalLocked ? \"Agendado para o futuro\" : \"\");\r\n\r\n                                        if (!isItemLocked && hasOverdueItems && !isItemOverdue) {\r\n                                            isItemLocked = true;\r\n                                            lockReason = \"Prioridade: Conclua as atividades atrasadas primeiro!\";\r\n                                        }\r\n\r\n                                        if (itemDateStr && itemDateStr > todayStr) {\r\n                                            isItemLocked = true;\r\n                                            lockReason = `Agendado para ${format(new Date(itemDateStr + 'T00:00:00'), 'dd/MM')}`;\r\n                                        }\r\n\r\n                                        if (item.startDate && item.startDate > todayStr) {\r\n                                            isItemLocked = true;\r\n                                            lockReason = `Inicia em ${format(new Date(item.startDate + 'T00:00:00'), 'dd/MM')}`;\r\n                                        }\r\n\r\n                                        return (\r\n                                            <Reorder.Item\r\n                                                key={itemId}\r\n                                                value={itemId}\r\n                                                dragListener={true}\r\n                                                className=\"cursor-move touch-none\"\r\n                                                whileDrag={{ scale: 1.02, zIndex: 50 }}\r\n                                            >\r\n                                                <MissionItem\r\n                                                    item={item}\r\n                                                    type={group.type as any}\r\n                                                    isDone={isDone}\r\n                                                    onToggle={() => {\r\n                                                        if (isItemLocked) return;\r\n                                                        handleToggleItem(item, group.type);\r\n                                                    }}\r\n                                                    onFocus={() => {\r\n                                                        if (isItemLocked) return;\r\n                                                        handleFocusItem(item, group.type);\r\n                                                    }}\r\n                                                    activeFocusId={activeFocusId}\r\n                                                    activeStartTime={undefined}\r\n                                                    isLocked={isItemLocked}\r\n                                                    lockReason={lockReason}\r\n                                                    scheduledTime={dailySchedule[itemId]}\r\n                                                    onSetTime={(time) => handleSetTime(itemId, time)}\r\n                                                    startedAt={missionProgress[itemId]?.startedAt}\r\n                                                />\r\n                                            </Reorder.Item>\r\n                                        );\r\n                                    })}\r\n                                </Reorder.Group>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {isAllDone && (\r\n                    <div className=\"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl text-center mt-6\">\r\n                        <div className=\"w-12 h-12 bg-emerald-500/20 text-emerald-400 rounded-full flex items-center justify-center mx-auto mb-2 animate-bounce\">\r\n                            <Trophy className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <h3 className=\"text-emerald-400 font-bold\">Miss√£o Completa!</h3>\r\n                        <p className=\"text-emerald-500/70 text-xs text-center\">Voc√™ dominou o dia.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionPreviewWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isAllDone' is defined but never used.","line":12,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":66}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Target, ChevronRight, Clock, CheckCircle2 } from 'lucide-react';\r\n\r\ninterface MissionPreviewWidgetProps {\r\n    progressPercent: number;\r\n    isAllDone: boolean;\r\n    completedCount: number;\r\n    totalCount: number;\r\n    setIsMissionModalOpen: (isOpen: boolean) => void;\r\n}\r\n\r\nexport const MissionPreviewWidget = ({ progressPercent, isAllDone, completedCount, totalCount, setIsMissionModalOpen }: MissionPreviewWidgetProps) => {\r\n    const pendingCount = totalCount - completedCount;\r\n\r\n    return (\r\n        <div className=\"bg-gradient-to-br from-slate-900/50 via-slate-900/40 to-slate-950/50 backdrop-blur-md border border-white/10 rounded-3xl p-4 shadow-2xl relative overflow-hidden group/mission\">\r\n            {/* Gradient top bar */}\r\n            <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-500 via-blue-500 to-emerald-500 opacity-60\" />\r\n\r\n            {/* Ambient glow effects */}\r\n            <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none\" />\r\n            <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-3xl -ml-16 -mb-16 pointer-events-none\" />\r\n\r\n            <div className=\"relative z-10\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"p-1.5 rounded-lg bg-gradient-to-br from-blue-500/20 to-indigo-500/20 ring-1 ring-blue-500/30\">\r\n                            <Target className=\"w-4 h-4 text-blue-400\" />\r\n                        </div>\r\n                        <h3 className=\"font-bold text-white text-base\">Sua Miss√£o</h3>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setIsMissionModalOpen(true)}\r\n                        className=\"text-[10px] font-bold text-blue-400 hover:text-blue-300 transition-colors uppercase tracking-wider px-2 py-1 rounded-lg hover:bg-blue-500/10\"\r\n                    >\r\n                        Abrir Tudo\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Progress Overview */}\r\n                <div className=\"mb-3 px-3 py-2 bg-slate-800/40 rounded-xl border border-white/5\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs font-medium text-slate-300\">Progresso</span>\r\n                        <span className=\"text-xl font-bold text-white tabular-nums\">{progressPercent}%</span>\r\n                    </div>\r\n                    <div className=\"mt-1.5 h-1.5 bg-slate-900/60 rounded-full overflow-hidden ring-1 ring-white/5\">\r\n                        <div\r\n                            className=\"h-full bg-gradient-to-r from-blue-500 to-emerald-500 rounded-full transition-all duration-1000 shadow-lg relative overflow-hidden\"\r\n                            style={{ width: `${progressPercent}%` }}\r\n                        >\r\n                            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Mission Stats - Two Circles */}\r\n                <div\r\n                    onClick={() => setIsMissionModalOpen(true)}\r\n                    className=\"grid grid-cols-2 gap-3 cursor-pointer\"\r\n                >\r\n                    {/* Pending Activities Circle */}\r\n                    <div className=\"group relative bg-gradient-to-br from-slate-800/60 to-slate-900/40 rounded-2xl p-3 border border-white/5 hover:border-amber-500/30 transition-all duration-300 hover:shadow-xl hover:shadow-amber-500/10\">\r\n                        <div className=\"flex flex-col items-center\">\r\n                            {/* Icon */}\r\n                            <div className=\"mb-2 p-1.5 rounded-lg bg-amber-500/10 ring-1 ring-amber-500/20 group-hover:ring-amber-500/40 transition-all\">\r\n                                <Clock className=\"w-4 h-4 text-amber-400\" />\r\n                            </div>\r\n\r\n                            {/* Circle */}\r\n                            <div className=\"relative w-16 h-16 mb-2\">\r\n                                <svg className=\"w-full h-full transform -rotate-90\">\r\n                                    <circle\r\n                                        cx=\"32\"\r\n                                        cy=\"32\"\r\n                                        r=\"28\"\r\n                                        stroke=\"currentColor\"\r\n                                        strokeWidth=\"5\"\r\n                                        fill=\"transparent\"\r\n                                        className=\"text-slate-800\"\r\n                                    />\r\n                                    <circle\r\n                                        cx=\"32\"\r\n                                        cy=\"32\"\r\n                                        r=\"28\"\r\n                                        stroke=\"currentColor\"\r\n                                        strokeWidth=\"5\"\r\n                                        fill=\"transparent\"\r\n                                        strokeDasharray={175.9}\r\n                                        strokeDashoffset={175.9 * (1 - (pendingCount / Math.max(totalCount, 1)))}\r\n                                        className=\"text-amber-500 drop-shadow-[0_0_10px_rgba(245,158,11,0.6)] transition-all duration-1000\"\r\n                                        strokeLinecap=\"round\"\r\n                                    />\r\n                                </svg>\r\n                                <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                    <span className=\"text-xl font-bold text-amber-400 font-mono\">{pendingCount}</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Label */}\r\n                            <p className=\"text-[10px] font-semibold text-amber-400 uppercase tracking-wide\">Pendentes</p>\r\n                            <p className=\"text-[9px] text-slate-500 mt-0.5\">Para fazer</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Completed Activities Circle */}\r\n                    <div className=\"group relative bg-gradient-to-br from-slate-800/60 to-slate-900/40 rounded-2xl p-3 border border-white/5 hover:border-emerald-500/30 transition-all duration-300 hover:shadow-xl hover:shadow-emerald-500/10\">\r\n                        <div className=\"flex flex-col items-center\">\r\n                            {/* Icon */}\r\n                            <div className=\"mb-2 p-1.5 rounded-lg bg-emerald-500/10 ring-1 ring-emerald-500/20 group-hover:ring-emerald-500/40 transition-all\">\r\n                                <CheckCircle2 className=\"w-4 h-4 text-emerald-400\" />\r\n                            </div>\r\n\r\n                            {/* Circle */}\r\n                            <div className=\"relative w-16 h-16 mb-2\">\r\n                                <svg className=\"w-full h-full transform -rotate-90\">\r\n                                    <circle\r\n                                        cx=\"32\"\r\n                                        cy=\"32\"\r\n                                        r=\"28\"\r\n                                        stroke=\"currentColor\"\r\n                                        strokeWidth=\"5\"\r\n                                        fill=\"transparent\"\r\n                                        className=\"text-slate-800\"\r\n                                    />\r\n                                    <circle\r\n                                        cx=\"32\"\r\n                                        cy=\"32\"\r\n                                        r=\"28\"\r\n                                        stroke=\"currentColor\"\r\n                                        strokeWidth=\"5\"\r\n                                        fill=\"transparent\"\r\n                                        strokeDasharray={175.9}\r\n                                        strokeDashoffset={175.9 * (1 - (completedCount / Math.max(totalCount, 1)))}\r\n                                        className=\"text-emerald-500 drop-shadow-[0_0_10px_rgba(16,185,129,0.6)] transition-all duration-1000\"\r\n                                        strokeLinecap=\"round\"\r\n                                    />\r\n                                </svg>\r\n                                <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                    <span className=\"text-xl font-bold text-emerald-400 font-mono\">{completedCount}</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Label */}\r\n                            <p className=\"text-[10px] font-semibold text-emerald-400 uppercase tracking-wide\">Conclu√≠das</p>\r\n                            <p className=\"text-[9px] text-slate-500 mt-0.5\">Finalizadas</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* View Details Button */}\r\n                <button\r\n                    onClick={() => setIsMissionModalOpen(true)}\r\n                    className=\"mt-3 w-full py-2 text-xs text-blue-400 font-bold hover:text-blue-300 transition-all flex items-center justify-center gap-2 hover:bg-blue-500/5 rounded-xl group/btn\"\r\n                >\r\n                    VER DETALHES\r\n                    <ChevronRight className=\"w-3 h-3 group-hover/btn:translate-x-1 transition-transform\" />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\MissionSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\RealisticKPICard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\projects\\GoalProjectCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\projects\\LinkedProjectCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\projects\\ProjectsFilter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\projects\\ProjectsHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\components\\projects\\ThemeProjectCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\hooks\\useMissionLogic.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\hooks\\useMissionLogic.ts:29:19\n  27 |         const savedSchedule = localStorage.getItem(`daily_schedule_${dateStr}`);\n  28 |         if (savedSchedule) {\n> 29 |             try { setDailySchedule(JSON.parse(savedSchedule)); } catch (e) { console.error(\"Failed to parse daily schedule\", e); }\n     |                   ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |         } else {\n  31 |             setDailySchedule({});\n  32 |         }","line":29,"column":19,"nodeType":null,"endLine":29,"endColumn":35},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\dashboard\\hooks\\useMissionLogic.ts:56:17\n  54 |                 const now = Date.now();\n  55 |                 const newProgress = { ...missionProgress, [id]: { ...missionProgress[id], startedAt: now } };\n> 56 |                 setMissionProgress(newProgress);\n     |                 ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  57 |                 localStorage.setItem(`mission_progress_${dateStr}`, JSON.stringify(newProgress));\n  58 |             }\n  59 |         }","line":56,"column":17,"nodeType":null,"endLine":56,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCompletedToday' is assigned a value but never used.","line":179,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'overdueTasks' is assigned a value but never used.","line":299,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":299,"endColumn":27}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { useStudy } from '../../../context/StudyContext'; // Correct relative path\r\nimport { usePomodoroContext } from '../../../context/PomodoroContext';\r\nimport { format, addDays, isToday } from 'date-fns';\r\nimport { useToast } from '../../../context/ToastContext';\r\n\r\nexport const useMissionLogic = () => {\r\n    const { themes, tasks, goals, startFocus, activeFocus, toggleTask, toggleGoal, toggleGoalItem, completeReview } = useStudy();\r\n    const { startFocusSession } = usePomodoroContext();\r\n    const { showToast } = useToast();\r\n\r\n    // Date Navigation State\r\n    const [selectedDate, setSelectedDate] = useState(new Date());\r\n    const dateStr = format(selectedDate, 'yyyy-MM-dd');\r\n    const isCurrentDay = isToday(selectedDate);\r\n    const dayOfWeek = selectedDate.getDay();\r\n\r\n    const handlePrevDay = () => setSelectedDate(prev => addDays(prev, -1));\r\n    const handleNextDay = () => setSelectedDate(prev => addDays(prev, 1));\r\n\r\n    // --- Daily Schedule Logic (Local Storage) ---\r\n    const [dailySchedule, setDailySchedule] = useState<Record<string, string>>({});\r\n    // --- Start Time Persistence (Local Storage) ---\r\n    const [missionProgress, setMissionProgress] = useState<Record<string, { startedAt?: number }>>({});\r\n\r\n    useEffect(() => {\r\n        const savedSchedule = localStorage.getItem(`daily_schedule_${dateStr}`);\r\n        if (savedSchedule) {\r\n            try { setDailySchedule(JSON.parse(savedSchedule)); } catch (e) { console.error(\"Failed to parse daily schedule\", e); }\r\n        } else {\r\n            setDailySchedule({});\r\n        }\r\n\r\n        const savedProgress = localStorage.getItem(`mission_progress_${dateStr}`);\r\n        if (savedProgress) {\r\n            try { setMissionProgress(JSON.parse(savedProgress)); } catch (e) { console.error(\"Failed to parse mission progress\", e); }\r\n        } else {\r\n            setMissionProgress({});\r\n        }\r\n    }, [dateStr]);\r\n\r\n    const handleSetTime = (id: string, time: string) => {\r\n        const newSchedule = { ...dailySchedule, [id]: time };\r\n        if (!time) delete newSchedule[id];\r\n        setDailySchedule(newSchedule);\r\n        localStorage.setItem(`daily_schedule_${dateStr}`, JSON.stringify(newSchedule));\r\n    };\r\n\r\n    // Track Start Time when Active Focus changes\r\n    useEffect(() => {\r\n        if (activeFocus && activeFocus.id) {\r\n            const id = activeFocus.id;\r\n            if (!missionProgress[id]?.startedAt) {\r\n                const now = Date.now();\r\n                const newProgress = { ...missionProgress, [id]: { ...missionProgress[id], startedAt: now } };\r\n                setMissionProgress(newProgress);\r\n                localStorage.setItem(`mission_progress_${dateStr}`, JSON.stringify(newProgress));\r\n            }\r\n        }\r\n    }, [activeFocus, missionProgress, dateStr]);\r\n\r\n    // --- DATA FILTERING ---\r\n\r\n    const allData = useMemo(() => {\r\n        // ... Logic from TodayMissionWidget ...\r\n\r\n        // 1. REVIEWS & INTROS\r\n        const reviewsOfInterest = themes.flatMap(t =>\r\n            t.subthemes.flatMap(st => {\r\n                return st.reviews\r\n                    .filter(r => {\r\n                        if (isCurrentDay) {\r\n                            if (r.status === 'pending' && r.date <= dateStr) return true;\r\n                            if (r.completedAt) {\r\n                                const completedDate = format(new Date(r.completedAt), 'yyyy-MM-dd');\r\n                                if (completedDate === dateStr) return true;\r\n                            }\r\n                            return false;\r\n                        }\r\n                        if (r.date === dateStr) return true;\r\n                        if (r.completedAt) {\r\n                            const completedDate = format(new Date(r.completedAt), 'yyyy-MM-dd');\r\n                            if (completedDate === dateStr) return true;\r\n                        }\r\n                        return false;\r\n                    })\r\n                    .map(r => ({\r\n                        ...r,\r\n                        subthemeId: st.id,\r\n                        themeTitle: t.title,\r\n                        subthemeTitle: st.title,\r\n                        reviewNumber: r.number,\r\n                        type: 'review',\r\n                        completedAt: r.completedAt,\r\n                        color: t.color,\r\n                        imageUrl: t.imageUrl,\r\n                        currentReviewNum: r.number,\r\n                        totalReviews: st.reviews.length,\r\n                        completedReviewCount: st.reviews.filter(rev => rev.status === 'completed').length,\r\n                        subthemeReviews: st.reviews\r\n                    }));\r\n            })\r\n        );\r\n\r\n        const introsOfInterest = themes.flatMap(t =>\r\n            t.subthemes\r\n                .filter(st => st.introductionDate === dateStr)\r\n                .map(st => ({\r\n                    number: 0,\r\n                    date: st.introductionDate!,\r\n                    status: st.status === 'active' ? 'completed' : 'pending',\r\n                    subthemeId: st.id,\r\n                    themeTitle: t.title,\r\n                    subthemeTitle: st.title,\r\n                    reviewNumber: 0,\r\n                    type: 'intro',\r\n                    subthemeReviews: st.reviews,\r\n                    color: t.color\r\n                }))\r\n        );\r\n\r\n        const activeSubthemes = themes.flatMap(t =>\r\n            t.subthemes.filter(st => st.status === 'active').map(st => ({\r\n                ...st, themeTitle: t.title, color: t.color, imageUrl: t.imageUrl\r\n            }))\r\n        );\r\n\r\n        // \"Active but not reviewed today\" Logic\r\n        const activeSubthemesWithoutReview = activeSubthemes.filter(st =>\r\n            !reviewsOfInterest.some(r => r.subthemeId === st.id)\r\n        ).map(st => {\r\n            let isLocked = false;\r\n            let lockReason = \"\";\r\n            const nextReview = st.reviews.find((r: any) => r.status === 'pending');\r\n            const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n\r\n            if (nextReview && nextReview.date > todayStr) {\r\n                isLocked = true;\r\n                lockReason = `Pr√≥xima revis√£o: ${format(new Date(nextReview.date), 'dd/MM')}`;\r\n            }\r\n\r\n            return {\r\n                ...st,\r\n                subthemeId: st.id,\r\n                subthemeTitle: st.title,\r\n                type: 'review',\r\n                status: 'active',\r\n                currentReviewNum: 0,\r\n                reviewNumber: 0,\r\n                isLocked,\r\n                lockReason\r\n            };\r\n        });\r\n\r\n        const allReviews = [...introsOfInterest, ...reviewsOfInterest.map(r => {\r\n            const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n            let isLocked = false;\r\n            let lockReason = \"\";\r\n            if (r.date > todayStr) {\r\n                isLocked = true;\r\n                lockReason = `Agendado para ${format(new Date(r.date), 'dd/MM')}`;\r\n            }\r\n            return { ...r, isLocked, lockReason };\r\n        }), ...activeSubthemesWithoutReview].sort((a, b) => {\r\n            if (a.status === 'completed' && b.status === 'pending') return 1;\r\n            if (a.status === 'pending' && b.status === 'completed') return -1;\r\n            return 0;\r\n        });\r\n\r\n        // 2. TASKS\r\n        const todaysTasks = tasks.filter(t => {\r\n            const taskCreationDay = new Date(t.createdAt).setHours(0, 0, 0, 0);\r\n            const targetDateObj = new Date(dateStr + 'T00:00:00');\r\n            if (targetDateObj.getTime() < taskCreationDay) return false;\r\n\r\n            if (t.type === 'day') {\r\n                const isOverdue = !!t.date && t.date < dateStr;\r\n                const isPendingOverdue = isCurrentDay && isOverdue && !t.status.includes('completed');\r\n                const isCompletedToday = isOverdue && t.completionHistory && t.completionHistory.some(h => h.startsWith(dateStr));\r\n                return (t.date === dateStr) || isPendingOverdue || (t.completionHistory && t.completionHistory.some(h => h.startsWith(dateStr)));\r\n            }\r\n            if (t.type === 'recurring' && t.recurrence) {\r\n                if (t.endDate && dateStr > t.endDate) return false;\r\n                return t.recurrence.includes(dayOfWeek);\r\n            }\r\n            if (t.type === 'period' && t.startDate && t.endDate) {\r\n                return dateStr >= t.startDate && dateStr <= t.endDate;\r\n            }\r\n            return false;\r\n        }).map(t => {\r\n            let isDone = t.status === 'completed';\r\n            let completedAt: string | undefined = undefined;\r\n            if (t.completionHistory) {\r\n                const entry = t.completionHistory.find(h => h.startsWith(dateStr));\r\n                if (entry) {\r\n                    isDone = true;\r\n                    completedAt = entry;\r\n                }\r\n            }\r\n            return { ...t, isDone, completedAt };\r\n        });\r\n\r\n        // 3. HABITS & GOALS\r\n        const todaysHabits = goals.filter(g => {\r\n            if (g.createdAt) {\r\n                const goalCreationDay = new Date(g.createdAt).setHours(0, 0, 0, 0);\r\n                const targetDateObj = new Date(dateStr + 'T00:00:00');\r\n                if (targetDateObj.getTime() < goalCreationDay) return false;\r\n            }\r\n            if (g.type === 'habit') {\r\n                if (g.deadline && dateStr > g.deadline) return false;\r\n                if (g.recurrence && g.recurrence.length > 0) return g.recurrence.includes(dayOfWeek);\r\n                return true;\r\n            }\r\n            if (g.deadline === dateStr) return true;\r\n            return false;\r\n        }).map(g => {\r\n            let isDone = false;\r\n            let completedAt: string | undefined = undefined;\r\n            if (g.completionHistory) {\r\n                const entry = g.completionHistory.find(h => h.startsWith(dateStr));\r\n                if (entry) {\r\n                    isDone = true;\r\n                    completedAt = entry;\r\n                }\r\n            } else if (g.type !== 'habit') {\r\n                isDone = g.progress === 100;\r\n            }\r\n            return { ...g, isDone, completedAt };\r\n        });\r\n\r\n        const todaysSteps = goals.flatMap(g => {\r\n            if (!g.checklist) return [];\r\n            return g.checklist.filter(item => {\r\n                if (!item.deadline) return false;\r\n                const itemDeadline = item.deadline.split('T')[0];\r\n                if (isCurrentDay) {\r\n                    if (item.completed) return itemDeadline === dateStr;\r\n                    return itemDeadline <= dateStr;\r\n                }\r\n                return itemDeadline === dateStr;\r\n            }).map(item => ({\r\n                ...item,\r\n                id: item.id,\r\n                title: `${item.title} (${g.title})`,\r\n                goalId: g.id,\r\n                isDone: item.completed,\r\n                type: 'step',\r\n                color: g.color,\r\n                priority: g.priority || 'medium'\r\n            }));\r\n        });\r\n\r\n        const allTasks = [...todaysTasks, ...todaysSteps].map(t => {\r\n            const taskDateStr = (t as any).date || ((t as any).deadline ? (t as any).deadline.split('T')[0] : undefined);\r\n            const isOverdue = !t.isDone && taskDateStr && taskDateStr < dateStr;\r\n            return { ...t, isOverdue };\r\n        }).sort((a, b) => {\r\n            // 1. Overdue items first (not done)\r\n            if (a.isOverdue && !b.isOverdue) return -1;\r\n            if (!a.isOverdue && b.isOverdue) return 1;\r\n\r\n            // 2. Then incomplete before complete\r\n            if (a.isDone && !b.isDone) return 1;\r\n            if (!a.isDone && b.isDone) return -1;\r\n\r\n            // 3. Among overdue or among normal, sort by priority\r\n            const pMap: Record<string, number> = { high: 3, medium: 2, low: 1 };\r\n            const pA = a.priority ? pMap[a.priority as string] : 1;\r\n            const pB = b.priority ? pMap[b.priority as string] : 1;\r\n\r\n            if (pA !== pB) return pB - pA;\r\n\r\n            // 4. Finally, for overdue items, oldest first\r\n            if (a.isOverdue && b.isOverdue) {\r\n                const dateA = (a as any).date || ((a as any).deadline ? (a as any).deadline.split('T')[0] : '9999-99-99');\r\n                const dateB = (b as any).date || ((b as any).deadline ? (b as any).deadline.split('T')[0] : '9999-99-99');\r\n                return dateA.localeCompare(dateB);\r\n            }\r\n\r\n            return 0;\r\n        });\r\n\r\n        return { allHabits: todaysHabits, allReviews, allTasks, todaysTasks, todaysSteps }; // Return sub-lists if needed\r\n    }, [themes, tasks, goals, dateStr, isCurrentDay, dayOfWeek]);\r\n\r\n    // Stats\r\n    const totalCount = allData.allReviews.length + allData.allTasks.length + allData.allHabits.length;\r\n    const completedCount =\r\n        allData.allReviews.filter(r => r.status === 'completed').length +\r\n        allData.allTasks.filter(t => t.isDone).length +\r\n        allData.allHabits.filter(g => g.isDone).length;\r\n\r\n    const progressPercent = totalCount === 0 ? 0 : Math.round((completedCount / totalCount) * 100);\r\n    const isAllDone = totalCount > 0 && completedCount === totalCount;\r\n\r\n    // Overdue Check\r\n    const hasOverdueItems = useMemo(() => {\r\n        const overdueTasks = tasks.filter(t => t.type === 'day' && t.date && t.date < dateStr && t.status !== 'completed'); // Simplified check\r\n        // Ideally we re-use the exact filtered lists logic but simplified.\r\n        // Actually, we can check 'allTasks' for items that are overdue.\r\n        // 'allTasks' includes overdue tasks if in 'Today' mode.\r\n        return allData.allTasks.some((t: any) => {\r\n            const tDate = t.date || (t.deadline ? t.deadline.split('T')[0] : undefined);\r\n            return !t.isDone && tDate && tDate < dateStr;\r\n        });\r\n    }, [allData.allTasks, dateStr, tasks]);\r\n\r\n\r\n    // Handlers\r\n    const handleFocusItem = (item: any, groupType: string) => {\r\n        // PRIORIDADE M√ÅXIMA: Bloquear dias futuros\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        if (dateStr > todayStr) {\r\n            showToast(\"Voc√™ n√£o pode focar em atividades agendadas para o futuro!\", \"error\");\r\n            return;\r\n        }\r\n\r\n        // Shared Focus Logic\r\n        const focusType = groupType === 'habit' ? 'goal' : groupType === 'review' ? 'subtheme' : 'task';\r\n        const id = item.id || item.subthemeId;\r\n        const duration = item.durationMinutes || 25;\r\n        const parentId = item.goalId;\r\n\r\n        startFocus(id, focusType, item.title || item.subthemeTitle || item.themeTitle, duration, item.reviewNumber, item.type, parentId);\r\n        startFocusSession(id, duration);\r\n    };\r\n\r\n    const handleToggleItem = (item: any, groupType: string) => {\r\n        const id = item.id || item.subthemeId;\r\n\r\n        if (groupType === 'task') {\r\n            if (item.type === 'step') {\r\n                toggleGoalItem(item.goalId, id, dateStr);\r\n            } else {\r\n                toggleTask(id, dateStr);\r\n            }\r\n        } else if (groupType === 'habit') {\r\n            toggleGoal(id, dateStr);\r\n        } else if (groupType === 'review') {\r\n            const difficulty = 'medium'; // Default difficulty for quick toggle\r\n            completeReview(id, item.reviewNumber, item.type, difficulty);\r\n        }\r\n    };\r\n\r\n    return {\r\n        // Date\r\n        selectedDate,\r\n        setSelectedDate,\r\n        handlePrevDay,\r\n        handleNextDay,\r\n        isCurrentDay,\r\n        dateStr,\r\n\r\n        // Data\r\n        allHabits: allData.allHabits,\r\n        allReviews: allData.allReviews,\r\n        allTasks: allData.allTasks,\r\n\r\n        // Stats\r\n        totalCount,\r\n        completedCount,\r\n        progressPercent,\r\n        isAllDone,\r\n        hasOverdueItems,\r\n\r\n        // State & Actions\r\n        dailySchedule,\r\n        handleSetTime,\r\n        missionProgress,\r\n\r\n        // Handlers\r\n        handleFocusItem,\r\n        handleToggleItem\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\debug\\SyncDebugWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle' is defined but never used.","line":6,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'XCircle' is defined but never used.","line":6,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'readData' is assigned a value but never used.","line":33,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'themeError' is assigned a value but never used.","line":88,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":125,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":19}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useEffect } from 'react';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { Button } from '../../components/ui/Button';\r\nimport { RefreshCw, AlertTriangle, CheckCircle, XCircle } from 'lucide-react';\r\n\r\nexport const SyncDebugWidget: React.FC = () => {\r\n    const { user } = useAuth();\r\n    const [status, setStatus] = useState<'idle' | 'testing' | 'success' | 'failure'>('idle');\r\n    const [logs, setLogs] = useState<string[]>([]);\r\n\r\n    const addLog = (msg: string, type: 'info' | 'error' | 'success' = 'info') => {\r\n        const timestamp = new Date().toLocaleTimeString();\r\n        setLogs(prev => [`[${timestamp}] ${type.toUpperCase()}: ${msg}`, ...prev]);\r\n    };\r\n\r\n    const runDiagnostics = async () => {\r\n        setStatus('testing');\r\n        setLogs([]);\r\n        addLog(\"Iniciando diagn√≥stico...\", 'info');\r\n\r\n        if (!user) {\r\n            addLog(\"ERRO: Usu√°rio n√£o autenticado no AuthContext.\", 'error');\r\n            setStatus('failure');\r\n            return;\r\n        }\r\n        addLog(`Usu√°rio detectado: ${user.email} (${user.id})`, 'success');\r\n\r\n        try {\r\n            // Test 1: Connection & Read\r\n            addLog(\"Teste 1: Conex√£o e Leitura (Tasks)...\", 'info');\r\n            const { data: readData, error: readError } = await supabase\r\n                .from('tasks')\r\n                .select('id')\r\n                .limit(1);\r\n\r\n            if (readError) {\r\n                addLog(`FALHA LEITURA: ${readError.message} (Code: ${readError.code})`, 'error');\r\n                if (readError.code === 'PGRST301') addLog(\"Dica: Row Level Security (RLS) pode estar bloqueando.\", 'info');\r\n                throw readError;\r\n            }\r\n            addLog(\"Leitura OK.\", 'success');\r\n\r\n            // Test 2: Write Task\r\n            addLog(\"Teste 2: Escrita (Tasks)...\", 'info');\r\n            const dummyId = crypto.randomUUID();\r\n            const { error: taskError } = await supabase.from('tasks').insert({\r\n                id: dummyId,\r\n                title: 'DIAGNOSTIC_TASK_' + Date.now(),\r\n                user_id: user.id,\r\n                created_at: new Date().toISOString(),\r\n                status: 'pending',\r\n                priority: 'low',\r\n                type: 'day'\r\n            });\r\n            if (taskError) {\r\n                addLog(`FALHA TASKS: ${taskError.message}`, 'error');\r\n                throw taskError;\r\n            } else {\r\n                await supabase.from('tasks').delete().eq('id', dummyId);\r\n                addLog(\"Tasks OK.\", 'success');\r\n            }\r\n\r\n            // Test 3: Write Goal\r\n            addLog(\"Teste 3: Escrita (Goals)...\", 'info');\r\n            const goalId = crypto.randomUUID();\r\n            const { error: goalError } = await supabase.from('goals').insert({\r\n                id: goalId,\r\n                title: 'DIAGNOSTIC_GOAL',\r\n                user_id: user.id,\r\n                created_at: new Date().toISOString(),\r\n                type: 'simple',\r\n                category: 'test',\r\n                progress: 0\r\n            });\r\n            if (goalError) {\r\n                addLog(`FALHA GOALS: ${goalError.message}`, 'error');\r\n                // Don't throw, try next\r\n            } else {\r\n                await supabase.from('goals').delete().eq('id', goalId);\r\n                addLog(\"Goals OK.\", 'success');\r\n            }\r\n\r\n            // Test 4: Write Theme\r\n            addLog(\"Teste 4: Escrita (Themes)...\", 'info');\r\n            const themeId = crypto.randomUUID();\r\n            const { error: themeError } = await supabase.from('themes').insert({\r\n                id: themeId,\r\n                title: 'DIAGNOSTIC_THEME',\r\n                user_id: user.id,\r\n                created_at: new Date().toISOString(),\r\n                color: '#000000'\r\n            });\r\n            // Test 5: Write Subtheme\r\n            addLog(\"Teste 5: Escrita (Subthemes)...\", 'info');\r\n            const subId = crypto.randomUUID();\r\n            // Need a valid parent theme for FK constraint? \r\n            // If we use the previous themeId... but we deleted it.\r\n            // Let's create a temporary theme just for this test\r\n            const tempThemeId = crypto.randomUUID();\r\n            await supabase.from('themes').insert({ id: tempThemeId, title: 'TEMP_PARENT', user_id: user.id, color: '#000' });\r\n\r\n            const { error: subError } = await supabase.from('subthemes').insert({\r\n                id: subId,\r\n                theme_id: tempThemeId,\r\n                title: 'DIAGNOSTIC_SUBTHEME',\r\n                status: 'queue'\r\n                // user_id removed\r\n            });\r\n\r\n            if (subError) {\r\n                addLog(`FALHA SUBTHEMES: ${subError.message}`, 'error');\r\n            } else {\r\n                addLog(\"Subthemes OK.\", 'success');\r\n            }\r\n            // Cleanup All\r\n            await supabase.from('subthemes').delete().eq('id', subId);\r\n            await supabase.from('themes').delete().eq('id', tempThemeId);\r\n\r\n\r\n            addLog(\"Diagn√≥stico Completo: TUDO VERDE! üü¢\", 'success');\r\n            setStatus('success');\r\n\r\n        } catch (e: any) {\r\n            setStatus('failure');\r\n            addLog(`Diagn√≥stico finalizado com ERROS.`, 'error');\r\n        }\r\n    };\r\n\r\n    const forceReset = () => {\r\n        localStorage.removeItem('sync_queue_v1');\r\n        localStorage.removeItem('sync_queue_v2'); // Just in case\r\n        window.location.reload();\r\n    };\r\n\r\n    if (import.meta.env.PROD) return null; // Safety\r\n\r\n    return (\r\n        <div className=\"fixed bottom-4 right-4 z-50 p-4 bg-slate-900 border border-slate-700 rounded-lg shadow-2xl w-96 max-h-[500px] overflow-hidden flex flex-col\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-white font-bold flex items-center gap-2\">\r\n                    <AlertTriangle className=\"w-4 h-4 text-amber-500\" /> Diagn√≥stico de Sync\r\n                </h3>\r\n                <div className=\"flex gap-2\">\r\n                    <Button size=\"sm\" variant=\"ghost\" onClick={forceReset} className=\"text-red-400 hover:text-red-300\">\r\n                        <AlertTriangle className=\"w-3 h-3 mr-1\" /> Resetar\r\n                    </Button>\r\n                    <Button size=\"sm\" onClick={runDiagnostics} disabled={status === 'testing'}>\r\n                        {status === 'testing' ? <RefreshCw className=\"w-3 h-3 animate-spin\" /> : 'Testar Agora'}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <div className=\"flex-1 overflow-y-auto bg-black/50 p-2 rounded text-xs font-mono space-y-1 h-64\">\r\n                {logs.length === 0 && <span className=\"text-slate-500\">Aguardando execu√ß√£o...</span>}\r\n                {logs.map((log, i) => (\r\n                    <div key={i} className={\r\n                        log.includes('INFO') ? 'text-blue-300' :\r\n                            log.includes('SUCCESS') ? 'text-emerald-300' :\r\n                                log.includes('ERROR') ? 'text-red-400 font-bold' : 'text-slate-300'\r\n                    }>\r\n                        {log}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {status === 'failure' && (\r\n                <div className=\"mt-2 p-2 bg-red-500/10 border border-red-500/20 rounded text-red-200 text-xs\">\r\n                    Por favor, tire um print desta tela e me mostre os erros em vermelho.\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\forms\\AddTaskModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'addDays' is defined but never used.","line":8,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { z } from 'zod';\r\nimport { Modal } from '../../components/ui/Modal';\r\nimport { Input } from '../../components/ui/Input';\r\nimport { Select } from '../../components/ui/Select';\r\nimport { Button } from '../../components/ui/Button';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { format, addDays, addMonths } from 'date-fns';\r\nimport { DaySelector } from '../../components/forms/DaySelector';\r\nimport { ImageUpload } from '../../components/forms/ImageUpload';\r\nimport { ColorPicker } from '../../components/forms/ColorPicker';\r\nimport { PrioritySelector } from '../../components/forms/PrioritySelector';\r\nimport { DurationStepper } from '../../components/forms/DurationStepper';\r\nimport { DatePicker } from '../../components/ui/DatePicker';\r\nimport { SymbolPicker } from '../../components/forms/SymbolPicker';\r\nimport { cn } from '../../lib/utils';\r\nimport type { Task } from '../../types';\r\n\r\ninterface AddTaskModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    taskToEdit?: Task; // Optional prop for edit mode\r\n}\r\n\r\nconst taskSchema = z.object({\r\n    title: z.string().min(3, 'O nome da miss√£o deve ter pelo menos 3 caracteres'),\r\n    type: z.enum(['day', 'period', 'recurring', 'goal']),\r\n    date: z.string().optional(),\r\n    startDate: z.string().optional(),\r\n    endDate: z.string().optional(),\r\n    recurrence: z.array(z.number()).optional()\r\n}).refine(data => {\r\n    if (data.type === 'day') return !!data.date;\r\n    if (data.type === 'period' || data.type === 'goal') return !!data.startDate;\r\n    return true;\r\n}, {\r\n    message: \"Data √© obrigat√≥ria para este tipo de miss√£o\",\r\n    path: [\"date\"]\r\n});\r\n\r\nexport const AddTaskModal: React.FC<AddTaskModalProps> = ({ isOpen, onClose, taskToEdit }) => {\r\n    const { addTask, updateTask, themes, tasks, goals, addGoal } = useStudy();\r\n\r\n    const usedColors = [\r\n        ...themes.map(t => t.color),\r\n        ...tasks.map(t => t.color),\r\n        ...goals.map(g => g.color)\r\n    ].filter(Boolean) as string[];\r\n\r\n    // Initialize state properly when modal opens/changes\r\n    const [title, setTitle] = useState(taskToEdit?.title || '');\r\n    const [priority, setPriority] = useState(taskToEdit?.priority || 'medium');\r\n    const [type, setType] = useState(taskToEdit?.type || 'day');\r\n    const [date, setDate] = useState(taskToEdit?.date || format(new Date(), 'yyyy-MM-dd'));\r\n    const [startDate, setStartDate] = useState(taskToEdit?.startDate || format(new Date(), 'yyyy-MM-dd'));\r\n    const [endDate, setEndDate] = useState(taskToEdit?.endDate || '');\r\n    const [recurrence, setRecurrence] = useState<number[]>(taskToEdit?.recurrence || []);\r\n    const [icon, setIcon] = useState(taskToEdit?.icon || '');\r\n    const [color, setColor] = useState(taskToEdit?.color || '');\r\n    const [imageUrl, setImageUrl] = useState(taskToEdit?.imageUrl || '');\r\n    const [duration, setDuration] = useState(taskToEdit?.durationMinutes?.toString() || '');\r\n\r\n    const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n    // Reset or Set values when taskToEdit changes\r\n    React.useEffect(() => {\r\n        if (isOpen) {\r\n            setErrors({}); // Reset errors\r\n            setTitle(taskToEdit?.title || '');\r\n            setPriority(taskToEdit?.priority || 'medium');\r\n            setType(taskToEdit?.type || 'day');\r\n            setDate(taskToEdit?.date || format(new Date(), 'yyyy-MM-dd'));\r\n            setStartDate(taskToEdit?.startDate || format(new Date(), 'yyyy-MM-dd'));\r\n            setEndDate(taskToEdit?.endDate || '');\r\n            setRecurrence(taskToEdit?.recurrence || []);\r\n            setIcon(taskToEdit?.icon || '');\r\n            setColor(taskToEdit?.color || '');\r\n            setImageUrl(taskToEdit?.imageUrl || '');\r\n            setDuration(taskToEdit?.durationMinutes?.toString() || '');\r\n        }\r\n    }, [isOpen, taskToEdit]);\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setErrors({});\r\n\r\n        // Validate\r\n        const result = taskSchema.safeParse({\r\n            title,\r\n            type,\r\n            date,\r\n            startDate,\r\n            endDate,\r\n            recurrence\r\n        });\r\n\r\n        if (!result.success) {\r\n            const newErrors: Record<string, string> = {};\r\n            result.error.issues.forEach(err => {\r\n                const path = err.path[0];\r\n                if (path) newErrors[path.toString()] = err.message;\r\n            });\r\n            setErrors(newErrors);\r\n            return;\r\n        }\r\n\r\n        if (!title) return;\r\n\r\n        const taskData = {\r\n            title,\r\n            status: taskToEdit?.status || 'pending',\r\n            priority: priority as any,\r\n            type: type as any,\r\n            date: type === 'day' ? date : undefined,\r\n            startDate: type === 'period' ? startDate : undefined,\r\n            endDate: (type === 'period' || type === 'recurring') ? endDate : undefined,\r\n            recurrence: type === 'recurring' ? recurrence : undefined,\r\n            icon: icon || undefined,\r\n            color: color || undefined,\r\n            imageUrl: imageUrl || undefined,\r\n            durationMinutes: duration ? parseInt(duration) : undefined\r\n        };\r\n\r\n        if (taskToEdit) {\r\n            updateTask(taskToEdit.id, taskData);\r\n        } else {\r\n            if ((type as any) === 'goal') {\r\n                const goalData = {\r\n                    title,\r\n                    type: 'simple',\r\n                    category: 'Geral', // Default category\r\n                    priority: priority as any,\r\n                    startDate: startDate || format(new Date(), 'yyyy-MM-dd'),\r\n                    deadline: endDate || format(addMonths(new Date(), 1), 'yyyy-MM-dd'),\r\n                    icon: icon || undefined,\r\n                    color: color || undefined,\r\n                    imageUrl: imageUrl || undefined,\r\n                    durationMinutes: duration ? parseInt(duration) : undefined\r\n                };\r\n                addGoal(goalData as any);\r\n            } else {\r\n                addTask(taskData as any);\r\n            }\r\n        }\r\n\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title=\"\" maxWidth=\"xl\">\r\n            <div className=\"relative overflow-hidden p-5 sm:p-6\">\r\n                {/* Subtle Background Ambiance */}\r\n                <div className=\"absolute top-[-20%] right-[-20%] w-[400px] h-[400px] bg-blue-600/5 rounded-full blur-[100px] pointer-events-none\" />\r\n                <div className=\"absolute bottom-[-20%] left-[-20%] w-[300px] h-[300px] bg-indigo-600/5 rounded-full blur-[80px] pointer-events-none\" />\r\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay pointer-events-none\" />\r\n\r\n                <form onSubmit={handleSubmit} className=\"relative z-10 font-sans\">\r\n\r\n                    {/* Header Row */}\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-xl border border-slate-800/50 flex items-center justify-center shadow-inner\">\r\n                                <span className=\"text-xl\">‚ú®</span>\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-lg font-bold text-white tracking-tight leading-none\">\r\n                                    {taskToEdit ? \"Editar Miss√£o\" : \"Nova Miss√£o\"}\r\n                                </h2>\r\n                                <p className=\"text-[11px] text-slate-500 font-medium px-0.5\">Defina seu pr√≥ximo objetivo</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-5 px-6\">\r\n                        {/* Main Input */}\r\n                        <div className=\"relative group\">\r\n                            <div className=\"absolute -inset-0.5 bg-gradient-to-r from-blue-500/20 to-indigo-500/20 rounded-xl opacity-0 group-focus-within:opacity-100 blur transition duration-500\" />\r\n                            <input\r\n                                placeholder=\"Digite o nome da miss√£o...\"\r\n                                value={title}\r\n                                onChange={e => {\r\n                                    setTitle(e.target.value);\r\n                                    if (errors.title) setErrors(prev => ({ ...prev, title: '' }));\r\n                                }}\r\n                                autoFocus\r\n                                className={cn(\r\n                                    \"relative w-full bg-slate-950/80 text-white placeholder-slate-600 border rounded-xl px-4 py-3 text-base font-medium focus:ring-1 transition-all shadow-sm\",\r\n                                    errors.title\r\n                                        ? \"border-red-500/50 focus:border-red-500 focus:ring-red-500/20\"\r\n                                        : \"border-slate-800/50 focus:ring-blue-500/50 focus:border-blue-500/50\"\r\n                                )}\r\n                            />\r\n                            {errors.title && (\r\n                                <span className=\"text-red-400 text-[10px] font-bold absolute -bottom-4 left-1 animate-in slide-in-from-top-1\">\r\n                                    {errors.title}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Frequency Selector (Tabs Style) */}\r\n                        <div className=\"bg-slate-950/60 p-1 rounded-xl border border-slate-800/50 flex gap-1\">\r\n                            {[\r\n                                { value: 'day', label: 'Hoje', icon: '‚ö°' },\r\n                                { value: 'period', label: 'Ciclo', icon: '‚è≥' },\r\n                                { value: 'recurring', label: 'Rotina', icon: 'üîÑ' },\r\n                                { value: 'goal', label: 'Meta', icon: 'üéØ' },\r\n                            ].map((opt) => (\r\n                                <button\r\n                                    key={opt.value}\r\n                                    type=\"button\"\r\n                                    onClick={() => {\r\n                                        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n                                        setType(opt.value as any);\r\n                                        if (opt.value === 'day') setDate(todayStr);\r\n                                        if (opt.value === 'period' || opt.value === 'goal') setStartDate(todayStr);\r\n                                    }}\r\n                                    className={`\r\n                                        flex-1 py-2 px-3 rounded-lg text-xs font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2\r\n                                        ${type === opt.value\r\n                                            ? 'bg-blue-600/10 text-blue-400 shadow-sm border border-blue-500/20'\r\n                                            : 'text-slate-500 hover:text-slate-300 hover:bg-white/5 border border-transparent'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    <span className=\"text-sm\">{opt.icon}</span>\r\n                                    {opt.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Date & Details Container */}\r\n                        <div className=\"bg-slate-900/40 rounded-xl border border-slate-800/50 p-4 space-y-4\">\r\n                            {/* Dynamic Date Fields */}\r\n                            <div>\r\n                                {type === 'day' && (\r\n                                    <div className=\"animate-in fade-in zoom-in-95 duration-200 grid grid-cols-[auto_1fr] gap-4 items-center\">\r\n                                        <label className=\"text-xs font-medium text-slate-400\">Data:</label>\r\n                                        <DatePicker\r\n                                            value={date}\r\n                                            onChange={setDate}\r\n                                            className=\"w-full\"\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n                                {(type === 'period' || (type as any) === 'goal') && (\r\n                                    <div className=\"animate-in fade-in zoom-in-95 duration-200 space-y-3\">\r\n                                        <div className=\"flex gap-3\">\r\n                                            <div className=\"flex-1 space-y-1\">\r\n                                                <label className=\"text-[10px] uppercase font-bold text-slate-500\">In√≠cio</label>\r\n                                                <DatePicker\r\n                                                    value={startDate}\r\n                                                    onChange={setStartDate}\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"flex items-end pb-3 opacity-30 text-slate-400\">‚Üí</div>\r\n                                            <div className=\"flex-1 space-y-1\">\r\n                                                <label className=\"text-[10px] uppercase font-bold text-slate-500\">{(type as any) === 'goal' ? 'Prazo' : 'Fim'}</label>\r\n                                                <DatePicker\r\n                                                    value={endDate}\r\n                                                    onChange={setEndDate}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                {/* Period/Cycle/Goal Dates */}\r\n                                {type === 'recurring' && (\r\n                                    <div className=\"animate-in fade-in zoom-in-95 duration-200 space-y-3\">\r\n                                        {type === 'recurring' && (\r\n                                            <DaySelector selectedDays={recurrence} onChange={setRecurrence} />\r\n                                        )}\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 shrink-0\">At√©:</label>\r\n                                            <div className=\"flex-1\">\r\n                                                <DatePicker\r\n                                                    value={endDate}\r\n                                                    onChange={setEndDate}\r\n                                                    placeholder=\"Sem data final\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Quick Deadlines */}\r\n                            <div className=\"flex items-center gap-2 overflow-x-auto pb-1\">\r\n                                <span className=\"text-[10px] font-bold text-slate-500 uppercase shrink-0\">Prazos:</span>\r\n                                {[\r\n                                    { label: '+1 M√™s', months: 1 },\r\n                                    { label: '+3 Meses', months: 3 },\r\n                                    { label: '+6 Meses', months: 6 },\r\n                                    { label: '+1 Ano', months: 12 },\r\n                                ].map((opt) => (\r\n                                    <button\r\n                                        key={opt.label}\r\n                                        type=\"button\"\r\n                                        onClick={() => {\r\n                                            const baseDate = new Date();\r\n                                            const targetDate = addMonths(baseDate, opt.months);\r\n                                            const formatted = format(targetDate, 'yyyy-MM-dd');\r\n\r\n                                            if (type === 'day') setDate(formatted);\r\n                                            else setEndDate(formatted);\r\n                                        }}\r\n                                        className=\"h-7 px-2.5 rounded bg-white/5 hover:bg-white/10 border border-slate-800/50 text-[10px] font-medium text-slate-400 hover:text-white transition-colors whitespace-nowrap\"\r\n                                    >\r\n                                        {opt.label}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"h-px bg-white/5 w-full my-4\" />\r\n\r\n                            {/* Attributes Grid */}\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Dura√ß√£o (Min)</label>\r\n                                    <div className=\"bg-slate-950/50 rounded-lg border border-slate-800/50 p-0.5\">\r\n                                        <DurationStepper value={duration} onChange={setDuration} step={15} />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Prioridade</label>\r\n                                    <PrioritySelector value={priority} onChange={setPriority} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-[60px_1fr] gap-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">√çcone</label>\r\n                                    <div className=\"relative\">\r\n                                        <SymbolPicker\r\n                                            value={icon}\r\n                                            onChange={setIcon}\r\n                                            placeholder=\"‚ú®\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Cor</label>\r\n                                    <ColorPicker\r\n                                        value={color}\r\n                                        onChange={setColor}\r\n                                        disabledColors={taskToEdit ? usedColors.filter(c => c !== taskToEdit.color) : usedColors}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Image */}\r\n                        <div className=\"bg-slate-900/20 rounded-xl\">\r\n                            <ImageUpload label=\"Capa da Miss√£o (Opcional)\" value={imageUrl} onChange={setImageUrl} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer Actions */}\r\n                    <div className=\"flex items-center justify-end gap-3 pt-4 border-t border-white/5 mt-6 px-6\">\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"ghost\"\r\n                            onClick={onClose}\r\n                            className=\"text-slate-400 hover:text-white text-xs h-9 px-4\"\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            className=\"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/20 text-xs font-bold uppercase tracking-wide h-9 px-6 rounded-lg transition-all active:scale-95\"\r\n                        >\r\n                            {taskToEdit ? \"Salvar\" : \"Criar Miss√£o\"}\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\AchievementsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\DailyRewardModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":5,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useGamification } from '../../context/GamificationContext';\r\nimport { Modal } from '../../components/ui/Modal';\r\nimport { Button } from '../../components/ui/Button';\r\nimport { Flame, Gift, X } from 'lucide-react';\r\nimport confetti from 'canvas-confetti';\r\n\r\nexport const DailyRewardModal: React.FC = () => {\r\n    const { gamification, awardXP } = useGamification();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!gamification.streak) return; // Wait for load\r\n\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const lastLogin = gamification.streak.lastLoginDate;\r\n        const claimedKey = `daily_reward_${today}`;\r\n        const isClaimed = localStorage.getItem(claimedKey);\r\n\r\n        // Verify if streak is active for today and not claimed\r\n        if (lastLogin === today && !isClaimed) {\r\n            // Small delay to ensure UI is ready and it's not jarring\r\n            const timer = setTimeout(() => setIsOpen(true), 1500);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [gamification.streak]);\r\n\r\n    const handleClaim = () => {\r\n        confetti({\r\n            particleCount: 100,\r\n            spread: 70,\r\n            origin: { y: 0.6 },\r\n            colors: ['#F59E0B', '#EF4444', '#10B981']\r\n        });\r\n\r\n        awardXP(50);\r\n\r\n        const today = new Date().toISOString().split('T')[0];\r\n        localStorage.setItem(`daily_reward_${today}`, 'true');\r\n        setIsOpen(false);\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={() => { }} title=\"\" maxWidth=\"sm\">\r\n            <div className=\"relative p-6 pt-10 pb-8 flex flex-col items-center text-center overflow-hidden\">\r\n                {/* Background Effects */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 to-slate-950\" />\r\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 mix-blend-overlay pointer-events-none\" />\r\n                <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-orange-500/10 rounded-full blur-[80px] pointer-events-none animate-pulse\" />\r\n\r\n                <div className=\"relative z-10 flex flex-col items-center gap-4\">\r\n                    <div className=\"w-20 h-20 bg-gradient-to-br from-orange-400 to-red-600 rounded-3xl flex items-center justify-center shadow-2xl shadow-orange-500/30 ring-4 ring-orange-500/20 rotate-3 animate-bounce-slow\">\r\n                        <Flame className=\"w-10 h-10 text-white fill-white drop-shadow-md\" />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1 mt-2\">\r\n                        <h2 className=\"text-2xl font-black text-white tracking-tight\">\r\n                            Ofensiva em Chamas!\r\n                        </h2>\r\n                        <p className=\"text-slate-400 font-medium\">\r\n                            Voc√™ entrou por <span className=\"text-orange-400 font-bold text-lg\">{gamification.streak.current} dias</span> seguidos.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-slate-800/50 p-4 rounded-xl border border-white/5 w-full mt-2\">\r\n                        <div className=\"flex items-center justify-between mb-1\">\r\n                            <span className=\"text-xs font-bold text-slate-500 uppercase tracking-wider\">Recompensa Di√°ria</span>\r\n                            <Gift className=\"w-4 h-4 text-emerald-400\" />\r\n                        </div>\r\n                        <div className=\"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-green-500\">\r\n                            +50 XP\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Button\r\n                        size=\"lg\"\r\n                        onClick={handleClaim}\r\n                        className=\"w-full mt-4 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-400 hover:to-red-500 border-none shadow-lg shadow-orange-900/20 group\"\r\n                    >\r\n                        <span className=\"font-bold text-white group-hover:scale-105 transition-transform\">Resgatar Recompensa</span>\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\GamificationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\LeaderboardTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":2,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used.","line":16,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\LeaderboardTab.tsx:20:9\n  18 |     // Simulate fetch\n  19 |     useEffect(() => {\n> 20 |         setLoading(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |         setTimeout(() => setLoading(false), 800);\n  22 |     }, []);\n  23 |","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Trophy, Medal, User, Crown } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\n\r\n// Mock Data for now (replace with Supabase query later)\r\nconst MOCK_LEADERBOARD = [\r\n    { id: '1', name: 'Mestre Jedi', xp: 12500, level: 42, avatar: 'M' },\r\n    { id: '2', name: 'Padawan Focado', xp: 8900, level: 25, avatar: 'P' },\r\n    { id: '3', name: 'Viajante do Tempo', xp: 7200, level: 18, avatar: 'V' },\r\n    { id: '4', name: 'Estudante Pro', xp: 6500, level: 15, avatar: 'E' },\r\n    { id: '5', name: 'Novato Curioso', xp: 3200, level: 8, avatar: 'N' },\r\n];\r\n\r\nexport const LeaderboardTab = () => {\r\n    // const { user } = useAuth(); // If we want to highlight current user\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Simulate fetch\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        setTimeout(() => setLoading(false), 800);\r\n    }, []);\r\n\r\n    const getRankIcon = (index: number) => {\r\n        if (index === 0) return <Crown className=\"w-5 h-5 text-yellow-400 drop-shadow-[0_0_8px_rgba(250,204,21,0.6)]\" />;\r\n        if (index === 1) return <Medal className=\"w-5 h-5 text-slate-300\" />;\r\n        if (index === 2) return <Medal className=\"w-5 h-5 text-amber-600\" />;\r\n        return <span className=\"text-slate-500 font-bold ml-1.5\">{index + 1}</span>;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"bg-slate-900/50 rounded-2xl p-4 border border-white/5\">\r\n                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2\">\r\n                    <Trophy className=\"w-4 h-4 text-yellow-500\" />\r\n                    Top 5 Global\r\n                </h3>\r\n\r\n                <div className=\"space-y-2\">\r\n                    {MOCK_LEADERBOARD.map((player, index) => (\r\n                        <motion.div\r\n                            key={player.id}\r\n                            initial={{ opacity: 0, x: -20 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            transition={{ delay: index * 0.1 }}\r\n                            className={`flex items-center gap-4 p-3 rounded-xl border transition-all ${index === 0\r\n                                    ? 'bg-gradient-to-r from-yellow-500/10 to-transparent border-yellow-500/20 shadow-[0_0_15px_rgba(234,179,8,0.1)]'\r\n                                    : 'bg-white/5 border-white/5 hover:bg-white/10'\r\n                                }`}\r\n                        >\r\n                            <div className=\"w-8 flex justify-center\">\r\n                                {getRankIcon(index)}\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3 flex-1\">\r\n                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs shadow-inner ring-2 ${index === 0 ? 'bg-yellow-600 ring-yellow-500/50 text-white' : 'bg-slate-700 ring-white/10 text-slate-300'\r\n                                    }`}>\r\n                                    {player.avatar}\r\n                                </div>\r\n                                <div>\r\n                                    <div className={`text-sm font-bold ${index === 0 ? 'text-yellow-100' : 'text-slate-200'}`}>\r\n                                        {player.name}\r\n                                    </div>\r\n                                    <div className=\"text-[10px] text-slate-500 font-medium\">\r\n                                        N√≠vel {player.level}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"text-right\">\r\n                                <div className=\"text-sm font-bold text-slate-100 font-mono\">\r\n                                    {player.xp.toLocaleString()}\r\n                                </div>\r\n                                <div className=\"text-[10px] text-slate-500 uppercase tracking-wider font-bold\">XP</div>\r\n                            </div>\r\n                        </motion.div>\r\n                    ))}\r\n                </div>\r\n\r\n                <div className=\"mt-4 p-3 rounded-xl bg-blue-500/10 border border-blue-500/20 text-center\">\r\n                    <p className=\"text-xs text-blue-300\">\r\n                        Voc√™ est√° no top <strong>15%</strong> dos estudantes essa semana!\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\OverviewTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\XPTableTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\gamification\\achievements.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\components\\AddGoalModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Target, Trash2 } from 'lucide-react';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { Input } from '../../../components/ui/Input';\r\nimport { Button } from '../../../components/ui/Button';\r\nimport { ImageUpload } from '../../../components/forms/ImageUpload';\r\nimport { ColorPicker } from '../../../components/forms/ColorPicker';\r\nimport { PrioritySelector } from '../../../components/forms/PrioritySelector';\r\nimport { DurationStepper } from '../../../components/forms/DurationStepper';\r\nimport { SymbolPicker } from '../../../components/forms/SymbolPicker';\r\nimport type { Goal } from '../../../types';\r\nimport { cn } from '../../../lib/utils'; // Import cn\r\n\r\nimport { useGoalFormLogic } from '../hooks/useGoalFormLogic';\r\nimport { GoalTypeSelector } from './GoalTypeSelector';\r\nimport { ChecklistBuilder } from './ChecklistBuilder';\r\nimport { ScheduleFields } from './ScheduleFields';\r\n\r\ninterface AddGoalModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    goalToEdit?: Goal;\r\n    defaultThemeId?: string;\r\n    defaultType?: 'simple' | 'checklist' | 'habit';\r\n}\r\n\r\nexport const AddGoalModal: React.FC<AddGoalModalProps> = (props) => {\r\n    const {\r\n        title, setTitle,\r\n        type, setType,\r\n        category, setCategory,\r\n        priority, setPriority,\r\n        relatedThemeId, setRelatedThemeId,\r\n        startDate, setStartDate,\r\n        deadline, setDeadline,\r\n        recurrence, setRecurrence,\r\n        icon, setIcon,\r\n        color, setColor,\r\n        imageUrl, setImageUrl,\r\n        duration, setDuration,\r\n        checklist, setChecklist,\r\n        errors, setErrors, // Destructure errors\r\n        usedColors,\r\n        themes,\r\n        handleSubmit,\r\n        handleDelete,\r\n        recalculateSchedule\r\n    } = useGoalFormLogic(props);\r\n\r\n    const { isOpen, onClose, goalToEdit, defaultThemeId } = props;\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title=\"\" maxWidth=\"xl\">\r\n            <div className=\"relative overflow-hidden p-5 sm:p-6\">\r\n                {/* Subtle Background Ambiance */}\r\n                <div className=\"absolute top-[-20%] right-[-20%] w-[400px] h-[400px] bg-blue-600/5 rounded-full blur-[100px] pointer-events-none\" />\r\n                <div className=\"absolute bottom-[-20%] left-[-20%] w-[300px] h-[300px] bg-indigo-600/5 rounded-full blur-[80px] pointer-events-none\" />\r\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay pointer-events-none\" />\r\n\r\n                <form onSubmit={handleSubmit} className=\"relative z-10 font-sans\">\r\n\r\n                    {/* Header Row */}\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-xl border border-white/5 flex items-center justify-center shadow-inner\">\r\n                                <span className=\"text-xl\">üéØ</span>\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-lg font-bold text-white tracking-tight leading-none\">\r\n                                    {goalToEdit ? \"Editar Meta\" : \"Nova Meta\"}\r\n                                </h2>\r\n                                <p className=\"text-[11px] text-slate-500 font-medium px-0.5\">Defina seus objetivos futuros</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-5 px-6\">\r\n                        {/* Main Input */}\r\n                        <div className=\"relative group\">\r\n                            <div className=\"absolute -inset-0.5 bg-gradient-to-r from-blue-500/20 to-indigo-500/20 rounded-xl opacity-0 group-focus-within:opacity-100 blur transition duration-500\" />\r\n                            <input\r\n                                placeholder=\"Digite o nome da meta...\"\r\n                                value={title}\r\n                                onChange={e => {\r\n                                    setTitle(e.target.value);\r\n                                    if (errors.title) setErrors(prev => ({ ...prev, title: '' }));\r\n                                }}\r\n                                autoFocus\r\n                                className={cn(\r\n                                    \"relative w-full bg-slate-950/80 text-white placeholder-slate-600 border rounded-xl px-4 py-3 text-base font-medium focus:ring-1 transition-all shadow-sm\",\r\n                                    errors.title\r\n                                        ? \"border-red-500/50 focus:border-red-500 focus:ring-red-500/20\"\r\n                                        : \"border-white/5 focus:ring-blue-500/50 focus:border-blue-500/50\"\r\n                                )}\r\n                            />\r\n                            {errors.title && (\r\n                                <span className=\"text-red-400 text-[10px] font-bold absolute -bottom-4 left-1 animate-in slide-in-from-top-1\">\r\n                                    {errors.title}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Type Selector (Tabs Style) */}\r\n                        <GoalTypeSelector type={type} onChange={setType} />\r\n\r\n                        {/* Checklist Builder */}\r\n                        {type === 'checklist' && (\r\n                            <div className=\"mt-4\">\r\n                                <ChecklistBuilder\r\n                                    checklist={checklist}\r\n                                    onChange={setChecklist}\r\n                                    startDate={startDate}\r\n                                    recalculateSchedule={recalculateSchedule}\r\n                                    setDeadline={setDeadline}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Type Specific Container */}\r\n                    <div className=\"px-6 space-y-4\">\r\n                        {/* Schedule Fields */}\r\n                        <div className=\"relative\">\r\n                            <ScheduleFields\r\n                                type={type}\r\n                                startDate={startDate}\r\n                                deadline={deadline}\r\n                                recurrence={recurrence}\r\n                                onStartDateChange={(date) => {\r\n                                    setStartDate(date);\r\n                                    if (errors.startDate) setErrors(prev => ({ ...prev, startDate: '' }));\r\n                                }}\r\n                                onDeadlineChange={(date) => {\r\n                                    setDeadline(date);\r\n                                    if (errors.deadline) setErrors(prev => ({ ...prev, deadline: '' }));\r\n                                }}\r\n                                onRecurrenceChange={setRecurrence}\r\n                            />\r\n                            {/* Error display for dates could be tricky since they are passed to child component. \r\n                                Ideally ScheduleFields should accept error props. \r\n                                For now, I'll assume global errors or simple alerts, but Zod errors are specific.\r\n                                Let's add simple visual feedback around ScheduleFields or inside it?\r\n                                Since I'm not editing ScheduleFields right now, I'll wrap it or add error text below.\r\n                            */}\r\n                            {(errors.startDate || errors.deadline) && (\r\n                                <div className=\"flex justify-between px-1 mt-1\">\r\n                                    <span className=\"text-red-400 text-[10px] font-bold animate-in slide-in-from-top-1\">{errors.startDate}</span>\r\n                                    <span className=\"text-red-400 text-[10px] font-bold animate-in slide-in-from-top-1 text-right\">{errors.deadline}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"h-px bg-slate-800/50 w-full my-2\" />\r\n\r\n                        {/* Attributes Grid */}\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Dura√ß√£o (Min)</label>\r\n                                <div className=\"bg-slate-950/50 rounded-lg border border-white/5 p-0.5\">\r\n                                    <DurationStepper value={duration} onChange={setDuration} step={1} min={0} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Prioridade</label>\r\n                                <PrioritySelector value={priority} onChange={setPriority} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Vincular a Tema (Opcional)</label>\r\n                            <select\r\n                                value={relatedThemeId}\r\n                                onChange={e => setRelatedThemeId(e.target.value)}\r\n                                disabled={!!defaultThemeId && !goalToEdit}\r\n                                className={`w-full bg-slate-950/50 border border-white/5 h-9 rounded-lg text-xs px-2 outline-none focus:border-blue-500/50 text-slate-300 ${!!defaultThemeId && !goalToEdit ? 'opacity-60 cursor-not-allowed font-bold text-blue-400' : ''}`}\r\n                            >\r\n                                <option value=\"\">Sem v√≠nculo</option>\r\n                                {themes.map(t => (\r\n                                    <option key={t.id} value={t.id}>{t.title}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Categoria</label>\r\n                            <Input\r\n                                value={category}\r\n                                onChange={e => setCategory(e.target.value)}\r\n                                placeholder=\"Ex: Estudos, Sa√∫de, Finan√ßas...\"\r\n                                className=\"bg-slate-950/50 border-white/5 h-9 text-xs\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">√çcone</label>\r\n                                <SymbolPicker\r\n                                    value={icon}\r\n                                    onChange={setIcon}\r\n                                    placeholder=\"üéØ\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-[10px] uppercase font-bold text-slate-500 pl-1\">Cor</label>\r\n                                <ColorPicker\r\n                                    value={color}\r\n                                    onChange={setColor}\r\n                                    disabledColors={goalToEdit ? usedColors.filter(c => c !== goalToEdit.color) : usedColors}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Image */}\r\n                    <div className=\"bg-slate-900/20 rounded-xl mt-5 px-6\">\r\n                        <ImageUpload label=\"Capa do Card (Opcional)\" value={imageUrl} onChange={setImageUrl} />\r\n                    </div>\r\n\r\n                    {/* Footer Actions */}\r\n                    <div className=\"flex items-center justify-between gap-3 pt-4 border-t border-white/5 mt-6 px-6\">\r\n                        {goalToEdit && (\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleDelete}\r\n                                className=\"flex items-center gap-2 px-3 py-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide\"\r\n                            >\r\n                                <Trash2 className=\"w-4 h-4\" />\r\n                                Excluir\r\n                            </button>\r\n                        )}\r\n                        <div className=\"flex items-center gap-3 ml-auto\">\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"ghost\"\r\n                                onClick={onClose}\r\n                                className=\"text-slate-400 hover:text-white text-xs h-9 px-4\"\r\n                            >\r\n                                Cancelar\r\n                            </Button>\r\n                            <Button\r\n                                type=\"submit\"\r\n                                className=\"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/20 text-xs font-bold uppercase tracking-wide h-9 px-6 rounded-lg transition-all active:scale-95\"\r\n                            >\r\n                                {goalToEdit ? \"Salvar\" : \"Criar Meta\"}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </form>\r\n            </div >\r\n        </Modal >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\components\\ChecklistBuilder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\components\\GoalDetailsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoal' is assigned a value but never used.","line":18,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Target, CheckCircle2, Clock, Calendar, Trophy, ArrowRight, Activity } from 'lucide-react';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { format } from 'date-fns';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Goal } from '../../../types';\r\nimport SummaryTimeline from '../../../components/ui/SummaryTimeline';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface GoalDetailsModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    goal: Goal | null;\r\n}\r\n\r\nexport const GoalDetailsModal: React.FC<GoalDetailsModalProps> = ({ isOpen, onClose, goal }) => {\r\n    const { toggleGoal, toggleGoalItem } = useStudy();\r\n\r\n    if (!goal) return null;\r\n\r\n    const isCompleted = goal.progress === 100;\r\n    const isHabit = goal.type === 'habit';\r\n    const isChecklist = goal.type === 'checklist';\r\n\r\n    const colorScheme = isCompleted\r\n        ? {\r\n            text: 'text-emerald-400',\r\n            bg: 'bg-emerald-500/10',\r\n            border: 'border-emerald-500/20',\r\n            gradient: 'from-emerald-600 to-emerald-400'\r\n        }\r\n        : {\r\n            text: 'text-blue-400',\r\n            bg: 'bg-blue-500/10',\r\n            border: 'border-blue-500/20',\r\n            gradient: 'from-blue-600 to-purple-600'\r\n        };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title={null} maxWidth=\"2xl\">\r\n            <div className=\"relative overflow-hidden p-6 sm:p-8\">\r\n\r\n                <div className=\"relative z-10 flex flex-col gap-8\">\r\n                    {/* Header: Icon, Title, Category */}\r\n                    <div className=\"flex items-start gap-6\">\r\n                        <div className={cn(\r\n                            \"w-20 h-20 rounded-3xl flex items-center justify-center shrink-0 shadow-2xl border-2\",\r\n                            \"bg-gradient-to-br\",\r\n                            isCompleted ? \"from-emerald-600 to-emerald-500 border-emerald-400/50\" : \"from-blue-600 to-purple-600 border-blue-400/50\"\r\n                        )}>\r\n                            {/* Gloss removed */}\r\n                            <IconRenderer icon={goal.icon} size={40} className=\"text-white drop-shadow-lg\" fallback={<Target className=\"w-10 h-10\" />} />\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                <span className={cn(\r\n                                    \"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border\",\r\n                                    colorScheme.bg, colorScheme.text, colorScheme.border\r\n                                )}>\r\n                                    {goal.category || (isHabit ? 'H√ÅBITO' : 'META')}\r\n                                </span>\r\n                                <span className=\"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700/50\">\r\n                                    {isHabit ? 'Repetitivo' : isChecklist ? 'Sequencial' : 'Simples'}\r\n                                </span>\r\n                            </div>\r\n                            <h2 className=\"text-3xl font-black text-white leading-tight break-words\">\r\n                                {goal.title}\r\n                            </h2>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Progress Bar Display */}\r\n                    <div className=\"bg-slate-900/20 rounded-3xl p-6 shadow-inner\">\r\n                        <div className=\"flex justify-between items-end mb-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2\">\r\n                                    <Trophy className=\"w-3 h-3\" /> Progresso Geral\r\n                                </span>\r\n                                <div className=\"text-4xl font-black text-white\">\r\n                                    {Math.round(goal.progress)}%\r\n                                </div>\r\n                            </div>\r\n                            {goal.deadline && (\r\n                                <div className=\"text-right space-y-1\">\r\n                                    <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center justify-end gap-2\">\r\n                                        Prazo <Calendar className=\"w-3 h-3\" />\r\n                                    </span>\r\n                                    <div className=\"text-sm font-bold text-slate-300\">\r\n                                        {format(new Date(goal.deadline), 'dd/MM/yyyy')}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"h-4 bg-slate-950/80 rounded-full p-1 border border-slate-800 shadow-inner\">\r\n                            <div\r\n                                className={cn(\r\n                                    \"h-full rounded-full transition-all duration-1000 ease-out shadow-lg\",\r\n                                    \"bg-gradient-to-r\",\r\n                                    colorScheme.gradient\r\n                                )}\r\n                                style={{ width: `${goal.progress}%` }}\r\n                            >\r\n\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Checklist Content */}\r\n                    {isChecklist && goal.checklist && (\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-1\">\r\n                                <Activity className=\"w-4 h-4\" /> Etapas do Projeto\r\n                            </h3>\r\n                            <div className=\"grid gap-3\">\r\n                                {[...(goal.checklist || [])].sort((a, b) => (a.order ?? 0) - (b.order ?? 0)).map((item, idx) => (\r\n                                    <div\r\n                                        key={item.id}\r\n                                        onClick={() => toggleGoalItem(goal.id, item.id)}\r\n                                        className={cn(\r\n                                            \"group flex items-center gap-4 p-4 rounded-2xl border transition-all cursor-pointer\",\r\n                                            item.completed\r\n                                                ? \"bg-emerald-500/5 border-emerald-500/20 opacity-70\"\r\n                                                : \"bg-slate-900/60 hover:bg-slate-800/60 shadow-lg\"\r\n                                        )}\r\n                                    >\r\n                                        <div className={cn(\r\n                                            \"w-10 h-10 rounded-xl flex items-center justify-center transition-all\",\r\n                                            item.completed\r\n                                                ? \"bg-emerald-500 text-white\"\r\n                                                : \"bg-slate-800 text-slate-500 group-hover:bg-blue-500/20 group-hover:text-blue-400\"\r\n                                        )}>\r\n                                            {item.completed ? <CheckCircle2 className=\"w-6 h-6\" /> : <span className=\"font-black text-lg\">{idx + 1}</span>}\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <div className={cn(\r\n                                                \"font-bold text-sm transition-all\",\r\n                                                item.completed ? \"text-slate-400 line-through\" : \"text-white\"\r\n                                            )}>\r\n                                                {item.title}\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-3 mt-1\">\r\n                                                {(item.durationDays ?? 0) > 0 && (\r\n                                                    <span className=\"text-[10px] font-bold text-slate-500 flex items-center gap-1\">\r\n                                                        <Clock className=\"w-2.5 h-2.5\" /> {item.durationDays} dias\r\n                                                    </span>\r\n                                                )}\r\n                                                {item.deadline && (\r\n                                                    <span className=\"text-[10px] font-bold text-blue-400 flex items-center gap-1\">\r\n                                                        <Calendar className=\"w-2.5 h-2.5\" /> {format(new Date(item.deadline), 'dd/MM')}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                        <ArrowRight className={cn(\r\n                                            \"w-4 h-4 transition-all transform group-hover:translate-x-1\",\r\n                                            item.completed ? \"text-emerald-500/40\" : \"text-slate-600 group-hover:text-blue-400\"\r\n                                        )} />\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Habit History Content */}\r\n                    {isHabit && (\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-1\">\r\n                                <Clock className=\"w-4 h-4\" /> Hist√≥rico Recente\r\n                            </h3>\r\n                            <div className=\"bg-slate-900/20 rounded-3xl p-6\">\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {/* Show last 14 days logic */}\r\n                                    {Array.from({ length: 14 }).map((_, i) => {\r\n                                        const d = new Date();\r\n                                        d.setDate(d.getDate() - (13 - i));\r\n                                        const dateStr = format(d, 'yyyy-MM-dd');\r\n                                        const isDone = goal.completionHistory?.some(h => h.startsWith(dateStr));\r\n\r\n                                        return (\r\n                                            <div\r\n                                                key={i}\r\n                                                className={cn(\r\n                                                    \"w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold transition-all\",\r\n                                                    isDone\r\n                                                        ? \"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20\"\r\n                                                        : \"bg-slate-800 text-slate-600 border border-slate-700/50\"\r\n                                                )}\r\n                                                title={format(d, 'dd/MM/yyyy')}\r\n                                            >\r\n                                                {format(d, 'd')}\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                                <p className=\"text-[10px] text-slate-500 mt-4 text-center\">\r\n                                    Visualizando os √∫ltimos 14 dias de consist√™ncia.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Stats or Additional Info */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">In√≠cio</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2\">\r\n                                <Calendar className=\"w-4 h-4 text-blue-400\" />\r\n                                {goal.startDate ? format(new Date(goal.startDate), 'dd/MM/yyyy') : format(new Date(goal.createdAt), 'dd/MM/yyyy')}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Esfor√ßo Total</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2\">\r\n                                <Clock className=\"w-4 h-4 text-purple-400\" />\r\n                                {Math.floor((goal.timeSpent || 0) / 60)}h {(goal.timeSpent || 0) % 60}m\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Summary Timeline - Box de Resumo/Hist√≥rico */}\r\n                    <div className=\"bg-slate-900/40 rounded-[2rem] overflow-hidden\">\r\n                        <div className=\"p-6 sm:p-8 bg-slate-950/40\">\r\n                            <SummaryTimeline\r\n                                summaries={goal.summaries || []}\r\n                                title=\"Hist√≥rico da Meta\"\r\n                                maxItems={5}\r\n                                showEmptyState={true}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bottom Action */}\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"w-full h-14 bg-white/5 hover:bg-white/10 rounded-2xl font-black text-white uppercase tracking-widest transition-all shadow-xl active:scale-[0.98]\"\r\n                    >\r\n                        Fechar Detalhes\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\components\\GoalTypeSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\components\\ScheduleFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\hooks\\useGoalFormLogic.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\hooks\\useGoalFormLogic.ts:50:13\n  48 |     useEffect(() => {\n  49 |         if (isOpen) {\n> 50 |             setErrors({});\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  51 |             setTitle(goalToEdit?.title || '');\n  52 |             setType(goalToEdit?.type || defaultType || 'simple');\n  53 |             setCategory(goalToEdit?.category || '');","line":50,"column":13,"nodeType":null,"endLine":50,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\goals\\hooks\\useGoalFormLogic.ts:120:17\n  118 |\n  119 |             if (currentLastString !== newLastString) {\n> 120 |                 setChecklist(updatedItems);\n      |                 ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  121 |                 if (finalDate) setDeadline(finalDate);\n  122 |             }\n  123 |         }","line":120,"column":17,"nodeType":null,"endLine":120,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checklist', 'recalculateSchedule', and 'type'. Either include them or remove the dependency array.","line":124,"column":8,"nodeType":"ArrayExpression","endLine":124,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [checklist, recalculateSchedule, startDate, type]","fix":{"range":[5283,5294],"text":"[checklist, recalculateSchedule, startDate, type]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { format, addDays } from 'date-fns';\r\nimport type { Goal } from '../../../types';\r\nimport { z } from 'zod';\r\n\r\ninterface UseGoalFormLogicProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    goalToEdit?: Goal;\r\n    defaultThemeId?: string;\r\n    defaultType?: 'simple' | 'checklist' | 'habit';\r\n}\r\n\r\nconst goalSchema = z.object({\r\n    title: z.string().min(3, 'O t√≠tulo da meta deve ter pelo menos 3 caracteres'),\r\n    startDate: z.string().min(1, 'A data de in√≠cio √© obrigat√≥ria'),\r\n    deadline: z.string().min(1, 'O prazo √© obrigat√≥rio'),\r\n    type: z.enum(['simple', 'checklist', 'habit'])\r\n});\r\n\r\nexport const useGoalFormLogic = ({ isOpen, onClose, goalToEdit, defaultThemeId, defaultType }: UseGoalFormLogicProps) => {\r\n    const [title, setTitle] = useState('');\r\n    const [type, setType] = useState<'simple' | 'checklist' | 'habit'>(defaultType || 'simple');\r\n    const [category, setCategory] = useState('');\r\n    const [priority, setPriority] = useState<any>(goalToEdit?.priority || 'medium');\r\n    const [relatedThemeId, setRelatedThemeId] = useState('');\r\n    const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n    const [deadline, setDeadline] = useState('');\r\n    const [recurrence, setRecurrence] = useState<number[]>([]);\r\n    const [icon, setIcon] = useState('');\r\n    const [color, setColor] = useState('');\r\n    const [imageUrl, setImageUrl] = useState('');\r\n    const [duration, setDuration] = useState('');\r\n    const [checklist, setChecklist] = useState<any[]>(goalToEdit?.checklist || []);\r\n\r\n    const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n    const { addGoal, updateGoal, deleteGoal, themes, tasks, goals } = useStudy();\r\n\r\n    const usedColors = [\r\n        ...themes.map(t => t.color),\r\n        ...tasks.map(t => t.color),\r\n        ...goals.map(g => g.color)\r\n    ].filter(Boolean) as string[];\r\n\r\n    // Reset or Set values when goalToEdit changes\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setErrors({});\r\n            setTitle(goalToEdit?.title || '');\r\n            setType(goalToEdit?.type || defaultType || 'simple');\r\n            setCategory(goalToEdit?.category || '');\r\n            setPriority(goalToEdit?.priority || 'medium');\r\n            setRelatedThemeId(goalToEdit?.relatedThemeId || defaultThemeId || '');\r\n            setStartDate(goalToEdit?.startDate || format(new Date(), 'yyyy-MM-dd'));\r\n            setDeadline(goalToEdit?.deadline || '');\r\n            setRecurrence(goalToEdit?.recurrence || []);\r\n            setIcon(goalToEdit?.icon || '');\r\n            setColor(goalToEdit?.color || '');\r\n            setImageUrl(goalToEdit?.imageUrl || '');\r\n            setDuration(goalToEdit?.durationMinutes?.toString() || '');\r\n            setChecklist(goalToEdit?.checklist || []);\r\n\r\n            // If creating a NEW Habit, default recurrence to include Today\r\n            const isNewItem = !goalToEdit;\r\n            const currentType = (goalToEdit?.type || defaultType || 'simple');\r\n\r\n            if (isNewItem && currentType === 'habit') {\r\n                const todayDow = new Date().getDay();\r\n                setRecurrence([todayDow]);\r\n            }\r\n        }\r\n    }, [isOpen, goalToEdit, defaultThemeId, defaultType]);\r\n\r\n    // Helper to parse YYYY-MM-DD as Local Midnight (avoiding UTC timezone issues)\r\n    const parseLocalDate = (dateStr: string): Date => {\r\n        if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\r\n            const [y, m, d] = dateStr.split('-').map(Number);\r\n            return new Date(y, m - 1, d); // Local Midnight\r\n        }\r\n        return new Date(dateStr);\r\n    };\r\n\r\n    // Recalculate dates for all items based on sequence\r\n    const recalculateSchedule = (items: any[], baseStart: string) => {\r\n        let currentDate = parseLocalDate(baseStart);\r\n\r\n        const updatedItems = items.map((item, index) => {\r\n            const durationDays = parseInt(item.estimatedTime || '1') || 1;\r\n            const start = new Date(currentDate);\r\n            const end = addDays(start, durationDays);\r\n\r\n            const itemWithDates = {\r\n                ...item,\r\n                startDate: format(start, 'yyyy-MM-dd'),\r\n                deadline: format(end, 'yyyy-MM-dd'),\r\n                order: index\r\n            };\r\n\r\n            currentDate = end;\r\n            return itemWithDates;\r\n        });\r\n\r\n        const finalDate = updatedItems.length > 0\r\n            ? updatedItems[updatedItems.length - 1].deadline\r\n            : '';\r\n\r\n        return { updatedItems, finalDate };\r\n    };\r\n\r\n    // Update schedule when Start Date changes\r\n    useEffect(() => {\r\n        if (type === 'checklist' && checklist.length > 0 && startDate) {\r\n            const { updatedItems, finalDate } = recalculateSchedule(checklist, startDate);\r\n            const currentLastString = JSON.stringify(checklist.map(i => i.startDate + i.deadline));\r\n            const newLastString = JSON.stringify(updatedItems.map(i => i.startDate + i.deadline));\r\n\r\n            if (currentLastString !== newLastString) {\r\n                setChecklist(updatedItems);\r\n                if (finalDate) setDeadline(finalDate);\r\n            }\r\n        }\r\n    }, [startDate]);\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setErrors({});\r\n\r\n        // Pre-calculation for Checklist type\r\n        let finalChecklist = checklist;\r\n        let finalDeadline = deadline;\r\n\r\n        if (type === 'checklist') {\r\n            const result = recalculateSchedule(checklist, startDate);\r\n            finalChecklist = result.updatedItems;\r\n            finalDeadline = result.finalDate || deadline;\r\n        }\r\n\r\n        // Validate\r\n        const result = goalSchema.safeParse({\r\n            title,\r\n            startDate,\r\n            deadline: finalDeadline,\r\n            type\r\n        });\r\n\r\n        if (!result.success) {\r\n            const newErrors: Record<string, string> = {};\r\n            result.error.issues.forEach(err => {\r\n                if (err.path[0]) newErrors[err.path[0].toString()] = err.message;\r\n            });\r\n            setErrors(newErrors);\r\n            return;\r\n        }\r\n\r\n        const goalData = {\r\n            title,\r\n            type,\r\n            category,\r\n            priority,\r\n            startDate,\r\n            deadline: finalDeadline,\r\n            recurrence: type === 'habit' ? recurrence : undefined,\r\n            relatedThemeId: relatedThemeId || undefined,\r\n            icon: icon || undefined,\r\n            color: color || undefined,\r\n            imageUrl: imageUrl || undefined,\r\n            durationMinutes: duration ? parseInt(duration) : undefined,\r\n            checklist: type === 'checklist' ? finalChecklist : undefined\r\n        };\r\n\r\n        if (goalToEdit) {\r\n            updateGoal(goalToEdit.id, goalData);\r\n        } else {\r\n            addGoal(goalData);\r\n        }\r\n\r\n        onClose();\r\n    };\r\n\r\n    const handleDelete = () => {\r\n        if (goalToEdit && window.confirm('Tem certeza que deseja excluir esta meta?')) {\r\n            deleteGoal(goalToEdit.id);\r\n            onClose();\r\n        }\r\n    };\r\n\r\n    return {\r\n        // State\r\n        title, setTitle,\r\n        type, setType,\r\n        category, setCategory,\r\n        priority, setPriority,\r\n        relatedThemeId, setRelatedThemeId,\r\n        startDate, setStartDate,\r\n        deadline, setDeadline,\r\n        recurrence, setRecurrence,\r\n        icon, setIcon,\r\n        color, setColor,\r\n        imageUrl, setImageUrl,\r\n        duration, setDuration,\r\n        checklist, setChecklist,\r\n        errors, setErrors, // Export errors\r\n\r\n        // Derived\r\n        usedColors,\r\n        themes,\r\n\r\n        // Actions\r\n        handleSubmit,\r\n        handleDelete,\r\n        recalculateSchedule\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\integrations\\IntegrationsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\lists\\GoalList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useRef' is defined but never used.","line":1,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CARD_HEIGHT' is assigned a value but never used.","line":44,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MIN_COL_WIDTH' is assigned a value but never used.","line":45,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GAP' is assigned a value but never used.","line":46,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":14}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useConfirm } from '../../context/ConfirmContext';\r\nimport { Target, Pencil, Trash2, Clock, CheckCircle2, Play, Lock } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { parseLocalDate } from '../../utils/dateHelpers';\r\nimport { AddGoalModal } from '../goals/components/AddGoalModal';\r\nimport { GoalDetailsModal } from '../goals/components/GoalDetailsModal';\r\nimport type { Goal } from '../../types';\r\nimport { cn } from '../../lib/utils';\r\n\r\nexport const GoalList = () => {\r\n    const { goals, toggleGoal, deleteGoal, startFocus } = useStudy();\r\n    const { startFocusSession } = usePomodoroContext();\r\n    const { confirm } = useConfirm();\r\n    const [editingGoal, setEditingGoal] = useState<Goal | undefined>(undefined);\r\n    const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n    const [selectedGoalForDetails, setSelectedGoalForDetails] = useState<Goal | null>(null);\r\n    const [isDetailsModalOpen, setIsDetailsModalOpen] = useState(false);\r\n    const [selectedCategory, setSelectedCategory] = useState<string>('Todos');\r\n\r\n    const handleCloseEditModal = () => {\r\n        setEditingGoal(undefined);\r\n        setIsEditModalOpen(false);\r\n    };\r\n\r\n    const handleEditGoal = (goal: Goal) => {\r\n        setEditingGoal(goal);\r\n        setIsEditModalOpen(true);\r\n    };\r\n\r\n    const handleOpenDetails = (goal: Goal) => {\r\n        setSelectedGoalForDetails(goal);\r\n        setIsDetailsModalOpen(true);\r\n    };\r\n\r\n    const handleCloseDetails = () => {\r\n        setSelectedGoalForDetails(null);\r\n        setIsDetailsModalOpen(false);\r\n    };\r\n\r\n    // Card dimensions - Premium layout\r\n    const CARD_HEIGHT = 340;\r\n    const MIN_COL_WIDTH = 340;\r\n    const GAP = 24;\r\n\r\n    const filteredGoals = goals.filter(g => {\r\n        if (g.relatedThemeId) return false;\r\n        const cat = g.category || (g.type === 'habit' ? 'H√°bitos' : 'Geral');\r\n        return selectedCategory === 'Todos' || cat === selectedCategory;\r\n    });\r\n\r\n    const categories = ['Todos', ...Array.from(new Set(goals.filter(g => !g.relatedThemeId).map(g => g.category || (g.type === 'habit' ? 'H√°bitos' : 'Geral'))))];\r\n\r\n    // Premium Goal Card PRO - Ultra Modern Design\r\n    const GoalCard = ({ goal }: { goal: Goal }) => {\r\n        const isCompleted = goal.progress === 100;\r\n\r\n        // Dynamic Color System - Unique colors per category (no repeats unless same category)\r\n        const getColors = () => {\r\n            if (isCompleted) return {\r\n                bg: 'bg-emerald-950/30',\r\n                border: 'border-emerald-500/30',\r\n                glow: 'shadow-[0_0_50px_-12px_rgba(16,185,129,0.3)]',\r\n                accent: 'text-emerald-400',\r\n                gradient: 'from-emerald-500 to-emerald-700',\r\n                button: 'bg-emerald-500 text-white shadow-emerald-500/40'\r\n            };\r\n\r\n            // Pool of 12 distinct color themes\r\n            const colorPool = [\r\n                { // Blue\r\n                    bg: 'bg-blue-950/30', border: 'border-blue-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(59,130,246,0.3)]', accent: 'text-blue-400',\r\n                    gradient: 'from-blue-500 to-indigo-600', button: 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-blue-500/40'\r\n                },\r\n                { // Rose\r\n                    bg: 'bg-rose-950/30', border: 'border-rose-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(244,63,94,0.3)]', accent: 'text-rose-400',\r\n                    gradient: 'from-rose-500 to-pink-600', button: 'bg-gradient-to-r from-rose-500 to-pink-600 text-white shadow-rose-500/40'\r\n                },\r\n                { // Orange\r\n                    bg: 'bg-orange-950/30', border: 'border-orange-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(249,115,22,0.3)]', accent: 'text-orange-400',\r\n                    gradient: 'from-orange-500 to-amber-600', button: 'bg-gradient-to-r from-orange-500 to-amber-600 text-white shadow-orange-500/40'\r\n                },\r\n                { // Cyan\r\n                    bg: 'bg-cyan-950/30', border: 'border-cyan-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(6,182,212,0.3)]', accent: 'text-cyan-400',\r\n                    gradient: 'from-cyan-500 to-teal-600', button: 'bg-gradient-to-r from-cyan-500 to-teal-600 text-white shadow-cyan-500/40'\r\n                },\r\n                { // Violet\r\n                    bg: 'bg-violet-950/30', border: 'border-violet-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(139,92,246,0.3)]', accent: 'text-violet-400',\r\n                    gradient: 'from-violet-500 to-purple-600', button: 'bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-violet-500/40'\r\n                },\r\n                { // Lime\r\n                    bg: 'bg-lime-950/30', border: 'border-lime-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(132,204,22,0.3)]', accent: 'text-lime-400',\r\n                    gradient: 'from-lime-500 to-green-600', button: 'bg-gradient-to-r from-lime-500 to-green-600 text-white shadow-lime-500/40'\r\n                },\r\n                { // Amber\r\n                    bg: 'bg-amber-950/30', border: 'border-amber-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(245,158,11,0.3)]', accent: 'text-amber-400',\r\n                    gradient: 'from-amber-500 to-yellow-600', button: 'bg-gradient-to-r from-amber-500 to-yellow-600 text-white shadow-amber-500/40'\r\n                },\r\n                { // Pink\r\n                    bg: 'bg-pink-950/30', border: 'border-pink-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(236,72,153,0.3)]', accent: 'text-pink-400',\r\n                    gradient: 'from-pink-500 to-fuchsia-600', button: 'bg-gradient-to-r from-pink-500 to-fuchsia-600 text-white shadow-pink-500/40'\r\n                },\r\n                { // Teal\r\n                    bg: 'bg-teal-950/30', border: 'border-teal-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(20,184,166,0.3)]', accent: 'text-teal-400',\r\n                    gradient: 'from-teal-500 to-emerald-600', button: 'bg-gradient-to-r from-teal-500 to-emerald-600 text-white shadow-teal-500/40'\r\n                },\r\n                { // Indigo\r\n                    bg: 'bg-indigo-950/30', border: 'border-indigo-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(99,102,241,0.3)]', accent: 'text-indigo-400',\r\n                    gradient: 'from-indigo-500 to-blue-600', button: 'bg-gradient-to-r from-indigo-500 to-blue-600 text-white shadow-indigo-500/40'\r\n                },\r\n                { // Red\r\n                    bg: 'bg-red-950/30', border: 'border-red-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(239,68,68,0.3)]', accent: 'text-red-400',\r\n                    gradient: 'from-red-500 to-rose-600', button: 'bg-gradient-to-r from-red-500 to-rose-600 text-white shadow-red-500/40'\r\n                },\r\n                { // Sky\r\n                    bg: 'bg-sky-950/30', border: 'border-sky-500/30',\r\n                    glow: 'shadow-[0_0_40px_-10px_rgba(14,165,233,0.3)]', accent: 'text-sky-400',\r\n                    gradient: 'from-sky-500 to-blue-600', button: 'bg-gradient-to-r from-sky-500 to-blue-600 text-white shadow-sky-500/40'\r\n                }\r\n            ];\r\n\r\n            // Hash function to get consistent index from category name\r\n            const hashCategory = (str: string): number => {\r\n                let hash = 0;\r\n                const s = str.toLowerCase().trim();\r\n                for (let i = 0; i < s.length; i++) {\r\n                    const char = s.charCodeAt(i);\r\n                    hash = ((hash << 5) - hash) + char;\r\n                    hash = hash & hash; // Convert to 32bit integer\r\n                }\r\n                return Math.abs(hash);\r\n            };\r\n\r\n            const category = goal.category || goal.type || 'geral';\r\n            const colorIndex = hashCategory(category) % colorPool.length;\r\n\r\n            return colorPool[colorIndex];\r\n        };\r\n\r\n        const theme = getColors();\r\n\r\n        // Date-based locking logic\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        const isFuture = !!(goal.startDate && goal.startDate > todayStr);\r\n        const lockReason = isFuture ? `Agendado para ${format(new Date(goal.startDate + 'T00:00:00'), 'dd/MM')}` : \"\";\r\n\r\n        return (\r\n            <div className=\"h-full relative\">\r\n                {/* Card Container */}\r\n                <div\r\n                    className={cn(\r\n                        \"relative h-full flex flex-col rounded-[1.5rem] overflow-hidden transition-all duration-500\",\r\n                        \"border backdrop-blur-3xl\",\r\n                        theme.bg, theme.border, theme.glow\r\n                    )}\r\n                >\r\n                    {/* Background Noise/Texture */}\r\n                    <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none mix-blend-overlay\" />\r\n\r\n\r\n\r\n\r\n\r\n                    {/* CONTENT AREA */}\r\n                    <div className=\"flex-1 p-4 flex flex-col relative z-20\">\r\n\r\n                        {/* HEADER: Icon & Title */}\r\n                        <div className=\"flex items-start gap-3 mb-2\">\r\n                            <div className={cn(\r\n                                \"w-10 h-10 rounded-lg flex items-center justify-center shrink-0 shadow-md relative overflow-hidden\",\r\n                                \"bg-gradient-to-br border border-slate-800/50\",\r\n                                theme.gradient\r\n                            )}>\r\n                                {/* Inner Shine */}\r\n                                <div className=\"absolute inset-0 bg-gradient-to-tr from-transparent via-white/20 to-transparent opacity-60\" />\r\n                                <div className=\"relative z-10 text-lg\">\r\n                                    {goal.icon || <Target className=\"w-5 h-5 text-white\" />}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <h3 className=\"text-sm font-bold text-white leading-tight tracking-tight line-clamp-1 mb-1\">\r\n                                    {goal.title}\r\n                                </h3>\r\n                                {/* Meta Tags */}\r\n                                <div className=\"flex flex-wrap items-center gap-1.5\">\r\n                                    <span className={cn(\r\n                                        \"text-[9px] font-bold uppercase tracking-wide px-2 py-0.5 rounded border bg-slate-800/50\",\r\n                                        theme.border, theme.accent\r\n                                    )}>\r\n                                        {goal.category || (goal.type === 'habit' ? 'H√°bito' : 'Meta')}\r\n                                    </span>\r\n                                    {goal.deadline && (\r\n                                        <span className=\"text-[10px] font-medium text-slate-400 flex items-center gap-1\">\r\n                                            <Clock className=\"w-3 h-3\" />\r\n                                            {format(parseLocalDate(goal.deadline), 'dd/MM')}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* ACTIONS - Static & Organized */}\r\n                            <div className=\"flex items-center gap-1.5 ml-auto shrink-0 self-start\">\r\n                                <button\r\n                                    onClick={(e) => { e.stopPropagation(); handleEditGoal(goal); }}\r\n                                    className=\"w-7 h-7 flex items-center justify-center rounded-md bg-slate-800/80 hover:bg-slate-700 text-slate-300 hover:text-white border border-slate-600/50 transition-colors duration-300\"\r\n                                    title=\"Editar\"\r\n                                >\r\n                                    <Pencil className=\"w-3 h-3\" />\r\n                                </button>\r\n                                <button\r\n                                    onClick={async (e) => {\r\n                                        e.stopPropagation();\r\n                                        const confirmed = await confirm({\r\n                                            title: 'Excluir Meta',\r\n                                            message: `Excluir \"${goal.title}\"?`,\r\n                                            confirmText: 'Excluir',\r\n                                            isDangerous: true\r\n                                        });\r\n                                        if (confirmed) deleteGoal(goal.id);\r\n                                    }}\r\n                                    className=\"w-7 h-7 flex items-center justify-center rounded-md bg-slate-800/80 hover:bg-red-900/50 text-slate-300 hover:text-red-400 border border-slate-600/50 transition-colors duration-300\"\r\n                                    title=\"Excluir\"\r\n                                >\r\n                                    <Trash2 className=\"w-3 h-3\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* MIDDLE: Progress */}\r\n                        <div className=\"mt-auto space-y-2\">\r\n                            <div className=\"flex justify-between items-end\">\r\n                                <span className=\"text-[10px] font-semibold text-slate-500 uppercase tracking-wider\">Progresso</span>\r\n                                <div className=\"flex items-baseline gap-0.5\">\r\n                                    <span className={cn(\"text-2xl font-black tracking-tighter\", theme.accent)}>\r\n                                        {goal.progress}\r\n                                    </span>\r\n                                    <span className=\"text-sm font-bold text-slate-600\">%</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Ultra Bar */}\r\n                            <div className=\"h-4 bg-slate-950/50 rounded-full p-1 shadow-inner border border-slate-800/50\">\r\n                                <div\r\n                                    className={cn(\r\n                                        \"h-full rounded-full relative overflow-hidden transition-all duration-1000 ease-out\",\r\n                                        theme.gradient\r\n                                    )}\r\n                                    style={{ width: `${Math.max(goal.progress, 5)}%` }} // Min width for visibility\r\n                                >\r\n                                    <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-[shimmer_8s_infinite]\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* BOTTOM: Actions */}\r\n                        <div className=\"mt-3 flex items-center gap-2\">\r\n                            <button\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    if (goal.type === 'habit') {\r\n                                        const isDone = goal.completionHistory?.some((d: string) => d.startsWith(format(new Date(), 'yyyy-MM-dd')));\r\n                                        if (!isDone) toggleGoal(goal.id);\r\n                                    } else {\r\n                                        handleOpenDetails(goal);\r\n                                    }\r\n                                }}\r\n                                className={cn(\r\n                                    \"flex-1 rounded-lg font-bold text-[10px] uppercase tracking-wide transition-all active:scale-95 border border-slate-800/50 hover:bg-slate-800/50 hover:border-slate-800/50 text-slate-300 flex items-center justify-center gap-1.5 h-10\",\r\n                                    goal.type === 'habit' ? 'bg-slate-800/50' : 'bg-transparent'\r\n                                )}\r\n                            >\r\n                                {goal.type === 'habit' ? (\r\n                                    <>\r\n                                        {isFuture ? <Lock className=\"w-4 h-4\" /> : <CheckCircle2 className=\"w-4 h-4\" />}\r\n                                        <span>{isFuture ? \"Bloqueado\" : \"Concluir\"}</span>\r\n                                    </>\r\n                                ) : 'Detalhes'}\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    if (isFuture) return;\r\n                                    const duration = goal.durationMinutes || 25;\r\n                                    startFocus(goal.id, 'goal', goal.title, duration);\r\n                                    startFocusSession(goal.id, duration);\r\n                                }}\r\n                                disabled={isFuture}\r\n                                className={cn(\r\n                                    \"w-10 h-10 rounded-lg flex items-center justify-center shadow-lg transition-all active:scale-95\",\r\n                                    isFuture\r\n                                        ? \"bg-slate-800 border border-slate-700 text-slate-600 cursor-not-allowed\"\r\n                                        : theme.button\r\n                                )}\r\n                                title={isFuture ? lockReason : \"Iniciar Foco\"}\r\n                            >\r\n                                {isFuture ? <Lock className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4 fill-current ml-0.5\" />}\r\n                            </button>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 w-full pt-8 relative pb-20\">\r\n            {/* Ambient Background Glows */}\r\n            <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-blue-500/10 rounded-full blur-[120px] pointer-events-none\" />\r\n            <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-emerald-500/10 rounded-full blur-[120px] pointer-events-none\" />\r\n\r\n            {/* Header Section */}\r\n            <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 px-6 relative z-10\">\r\n                <div className=\"space-y-2\">\r\n                    <h2 className=\"text-4xl md:text-5xl font-black text-white tracking-tighter text-glow drop-shadow-xl\">Minhas Metas</h2>\r\n                    <p className=\"text-slate-400 text-sm font-medium tracking-wide\">Transforme seus sonhos em realidade.</p>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => setIsEditModalOpen(true)}\r\n                    className=\"px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white rounded-2xl font-bold shadow-xl shadow-blue-900/30 active:scale-95 transition-all flex items-center gap-3 ring-1 ring-white/10 backdrop-blur-md\"\r\n                >\r\n                    <span className=\"text-2xl leading-none font-light pb-0.5\">+</span>\r\n                    Nova Meta\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            {goals.length > 0 && (\r\n                <div className=\"flex items-center gap-3 overflow-x-auto pb-4 scrollbar-hide px-6 relative z-10\">\r\n                    {categories.map(cat => (\r\n                        <button\r\n                            key={cat}\r\n                            onClick={() => setSelectedCategory(cat)}\r\n                            className={cn(\r\n                                \"px-6 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider transition-all border backdrop-blur-md shadow-lg\",\r\n                                selectedCategory === cat\r\n                                    ? \"bg-blue-600/20 border-blue-500/50 text-blue-200 shadow-blue-900/20 active-glow\"\r\n                                    : \"bg-slate-900/40 border-slate-800/50 text-slate-500 hover:bg-slate-800/40 hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            {cat}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"relative px-2 z-10\">\r\n                {filteredGoals.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-[500px] text-center px-4\">\r\n                        <div className=\"w-32 h-32 bg-slate-900/30 backdrop-blur-md rounded-full flex items-center justify-center mb-8 ring-1 ring-white/10 shadow-2xl relative overflow-hidden\">\r\n                            <div className=\"absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent skew-x-12 opacity-50\" />\r\n                            <Target className=\"w-12 h-12 text-slate-600 drop-shadow-lg\" />\r\n                        </div>\r\n                        <h3 className=\"text-3xl font-bold text-white mb-3 text-glow\">Nenhuma meta encontrada</h3>\r\n                        <p className=\"text-slate-400 max-w-sm mb-10 leading-relaxed\">N√£o encontramos metas nesta categoria. Que tal criar algo novo?</p>\r\n                        <button onClick={() => setIsEditModalOpen(true)} className=\"px-10 py-4 bg-slate-800/50 hover:bg-white/10 border border-slate-800/50 text-white rounded-2xl font-bold transition-all shadow-lg backdrop-blur-sm\">\r\n                            Criar Nova Meta\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"p-4\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n                            {filteredGoals.map((goal) => (\r\n                                <div key={goal.id} className=\"h-[200px]\">\r\n                                    <GoalCard goal={goal} />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <AddGoalModal\r\n                isOpen={isEditModalOpen}\r\n                onClose={handleCloseEditModal}\r\n                goalToEdit={editingGoal}\r\n            />\r\n\r\n            <GoalDetailsModal\r\n                isOpen={isDetailsModalOpen}\r\n                onClose={handleCloseDetails}\r\n                goal={selectedGoalForDetails}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\lists\\ProjectList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'LayoutList' is defined but never used.","line":2,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCategoryFilter' is assigned a value but never used.","line":12,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":45}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Plus, Filter, LayoutGrid, LayoutList } from 'lucide-react';\r\nimport { useProjectContext } from '../../context/ProjectProvider';\r\nimport { ProjectCard } from '../projects/components/ProjectCard';\r\nimport { AddProjectModal } from '../projects/components/AddProjectModal';\r\nimport type { Project } from '../../types';\r\n\r\nexport const ProjectList = () => {\r\n    const { projects } = useProjectContext();\r\n    const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n    const [statusFilter, setStatusFilter] = useState<Project['status'] | 'all'>('all');\r\n    const [categoryFilter, setCategoryFilter] = useState<Project['category'] | 'all'>('all');\r\n\r\n    const filteredProjects = projects.filter(project => {\r\n        if (statusFilter !== 'all' && project.status !== statusFilter) return false;\r\n        if (categoryFilter !== 'all' && project.category !== categoryFilter) return false;\r\n        return true;\r\n    });\r\n\r\n    const statusCounts = {\r\n        all: projects.length,\r\n        planning: projects.filter(p => p.status === 'planning').length,\r\n        active: projects.filter(p => p.status === 'active').length,\r\n        paused: projects.filter(p => p.status === 'paused').length,\r\n        completed: projects.filter(p => p.status === 'completed').length,\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 w-full pt-8 relative pb-20 fade-in\">\r\n            {/* Animated Background */}\r\n            <div className=\"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none -z-10\">\r\n                <div className=\"absolute top-20 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-[100px] animate-pulse\" />\r\n                <div className=\"absolute bottom-20 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-[100px] animate-pulse delay-1000\" />\r\n            </div>\r\n\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-white tracking-tight\">\r\n                        Projetos\r\n                    </h1>\r\n                    <p className=\"text-slate-400 mt-1\">\r\n                        Gerencie seus projetos profissionais e pessoais\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setIsAddModalOpen(true)}\r\n                    className=\"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold transition-all flex items-center gap-2 shadow-lg shadow-blue-500/20\"\r\n                >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    Novo Projeto\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-wrap gap-2\">\r\n                {/* Status Filters */}\r\n                {(['all', 'planning', 'active', 'paused', 'completed'] as const).map(status => {\r\n                    const labels = {\r\n                        all: 'Todos',\r\n                        planning: 'Planejando',\r\n                        active: 'Ativos',\r\n                        paused: 'Pausados',\r\n                        completed: 'Conclu√≠dos',\r\n                    };\r\n\r\n                    const colors = {\r\n                        all: 'bg-slate-500/20 text-slate-300 border-slate-500/30',\r\n                        planning: 'bg-slate-500/20 text-slate-300 border-slate-500/30',\r\n                        active: 'bg-blue-500/20 text-blue-300 border-blue-500/30',\r\n                        paused: 'bg-amber-500/20 text-amber-300 border-amber-500/30',\r\n                        completed: 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30',\r\n                    };\r\n\r\n                    return (\r\n                        <button\r\n                            key={status}\r\n                            onClick={() => setStatusFilter(status)}\r\n                            className={`px-4 py-2 rounded-lg font-medium text-sm border transition-all ${statusFilter === status\r\n                                    ? colors[status] + ' ring-2 ring-white/20'\r\n                                    : 'bg-slate-900/50 text-slate-400 border-slate-700 hover:bg-slate-800'\r\n                                }`}\r\n                        >\r\n                            {labels[status]} ({statusCounts[status]})\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Projects Grid */}\r\n            {filteredProjects.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-[400px] text-center\">\r\n                    <div className=\"w-24 h-24 bg-slate-900/30 backdrop-blur-md rounded-full flex items-center justify-center mb-6 ring-1 ring-white/10\">\r\n                        <LayoutGrid className=\"w-10 h-10 text-slate-600\" />\r\n                    </div>\r\n                    <h3 className=\"text-xl font-bold text-white mb-2\">\r\n                        {statusFilter === 'all' ? 'Nenhum projeto ainda' : `Nenhum projeto ${statusFilter === 'planning' ? 'em planejamento' : statusFilter}`}\r\n                    </h3>\r\n                    <p className=\"text-slate-400 max-w-sm mb-6\">\r\n                        {statusFilter === 'all'\r\n                            ? 'Crie seu primeiro projeto para come√ßar a organizar suas entregas'\r\n                            : 'Experimente filtrar por outro status'}\r\n                    </p>\r\n                    {statusFilter === 'all' && (\r\n                        <button\r\n                            onClick={() => setIsAddModalOpen(true)}\r\n                            className=\"bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-bold transition-all flex items-center gap-2\"\r\n                        >\r\n                            <Plus className=\"w-5 h-5\" />\r\n                            Criar Primeiro Projeto\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {filteredProjects.map(project => (\r\n                        <ProjectCard\r\n                            key={project.id}\r\n                            project={project}\r\n                            onClick={() => {\r\n                                // TODO: Open details modal\r\n                                console.log('Open project:', project.id);\r\n                            }}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Add Project Modal */}\r\n            <AddProjectModal\r\n                isOpen={isAddModalOpen}\r\n                onClose={() => setIsAddModalOpen(false)}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\lists\\TaskList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleTask' is assigned a value but never used.","line":14,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleGoalItem' is assigned a value but never used.","line":14,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startAudio' is assigned a value but never used.","line":16,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getItemSize' is assigned a value but never used.","line":67,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":22}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useMemo, useEffect } from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useAudio } from '../../context/AudioContext';\r\nimport { useConfirm } from '../../context/ConfirmContext';\r\nimport { CheckSquare, Pencil, Trash2, Play, Lock, Target, Loader2 } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { parseLocalDate } from '../../utils/dateHelpers';\r\nimport { AddTaskModal } from '../forms/AddTaskModal';\r\nimport { TaskDetailsModal } from '../tasks/components/TaskDetailsModal';\r\nimport type { Task } from '../../types';\r\n\r\nexport const TaskList = () => {\r\n    const { tasks, toggleTask, deleteTask, startFocus, goals, toggleGoalItem } = useStudy();\r\n    const { startFocusSession, linkedItemId, isActive } = usePomodoroContext();\r\n    const { startAudio } = useAudio();\r\n    const { confirm } = useConfirm();\r\n    const [editingTask, setEditingTask] = useState<Task | undefined>(undefined);\r\n    const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n    const [selectedDetailedTask, setSelectedDetailedTask] = useState<Task | null>(null);\r\n\r\n    // We need a ref to the list to reset cache when tasks change (if using VariableSizeList with index-based size)\r\n    const listRef = useRef<any>(null);\r\n\r\n    // Sort tasks: Newest first (by createdAt)\r\n    const sortedItems = useMemo(() => {\r\n        // Flatten Goal Steps\r\n        const steps = goals.flatMap(g =>\r\n            (g.checklist || []).map(item => ({\r\n                id: item.id,\r\n                title: `${item.title} (${g.title})`, // Contextual title\r\n                status: (item.completed ? 'completed' : 'pending') as 'completed' | 'pending',\r\n                createdAt: g.createdAt || 0, // Fallback to goal creation\r\n                type: 'step', // Internal type\r\n                goalId: g.id, // Reference to parent\r\n                priority: g.priority,\r\n                imageUrl: undefined as string | undefined, // Steps don't have images usually\r\n                color: g.color, // Inherit goal color\r\n                date: item.deadline, // Map deadline to date\r\n                startDate: undefined as string | undefined,\r\n                endDate: undefined as string | undefined,\r\n                durationMinutes: 25, // Default duration\r\n                completionHistory: [] as string[]\r\n            }))\r\n        );\r\n\r\n        const all = [...tasks, ...steps];\r\n\r\n        return all.sort((a, b) => {\r\n            // Sort by status (pending first) then by date\r\n            if (a.status === 'pending' && b.status === 'completed') return -1;\r\n            if (a.status === 'completed' && b.status === 'pending') return 1;\r\n\r\n            const timeA = a.createdAt || 0;\r\n            const timeB = b.createdAt || 0;\r\n            return timeB - timeA;\r\n        });\r\n    }, [tasks, goals]);\r\n\r\n    // Reset list cache when tasks change to ensure correct heights map\r\n    useEffect(() => {\r\n        if (listRef.current) {\r\n            listRef.current.resetAfterIndex(0);\r\n        }\r\n    }, [sortedItems]);\r\n\r\n    const getItemSize = (index: number) => {\r\n        const item = sortedItems[index];\r\n        if (!item) return 0;\r\n        // Base height ~110px + Image height ~96px (h-24) + margin\r\n        return item.imageUrl ? 230 : 130;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 h-full flex flex-col pt-6 overflow-hidden\">\r\n            <div className=\"flex items-center justify-between shrink-0 mb-4 px-4\">\r\n                <h2 className=\"text-2xl font-bold text-slate-100\">Minhas Tarefas</h2>\r\n                <button\r\n                    onClick={() => setIsAddModalOpen(true)}\r\n                    className=\"group relative px-4 py-2 bg-slate-900 rounded-lg font-bold text-white shadow-lg hover:scale-[1.02] active:scale-95 transition-all duration-300 overflow-hidden ring-1 ring-white/10\"\r\n                >\r\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 opacity-80 group-hover:opacity-100 transition-opacity\" />\r\n                    <span className=\"relative flex items-center gap-1.5 text-sm\">\r\n                        <span className=\"text-lg leading-none font-light mb-0.5\">+</span>\r\n                        Nova Tarefa\r\n                    </span>\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"flex-1 min-h-0 relative px-4\">\r\n                {sortedItems.length === 0 ? (\r\n                    <div className=\"glass-card text-center py-20 rounded-3xl relative overflow-hidden group border border-slate-800/50 border-dashed bg-slate-900/30\">\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"w-16 h-16 bg-slate-800/50 rounded-full flex items-center justify-center mx-auto mb-4 ring-1 ring-white/10 shadow-xl shadow-black/20 group-hover:scale-110 transition-transform duration-500\">\r\n                                <CheckSquare className=\"w-8 h-8 text-slate-500 group-hover:text-blue-400 transition-colors\" />\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-white mb-2\">Tudo em dia!</h3>\r\n                            <p className=\"text-slate-500 max-w-xs mx-auto mb-6 text-sm\">Nenhuma tarefa pendente. Aproveite para adicionar novos objetivos.</p>\r\n                            <button\r\n                                onClick={() => setIsAddModalOpen(true)}\r\n                                className=\"px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white rounded-lg font-bold transition-all hover:scale-105 shadow-lg shadow-blue-500/25 ring-1 ring-white/20 text-sm\"\r\n                            >\r\n                                Criar Primeira Tarefa\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"h-full overflow-y-auto custom-scrollbar pb-20\">\r\n                        {sortedItems.map((item, index) => {\r\n                            const isLinked = linkedItemId === item.id;\r\n                            const isLocked = isLinked && isActive;\r\n                            const isStep = item.type === 'step';\r\n\r\n                            // Date-based locking\r\n                            const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n                            const itemDate = item.date || (('startDate' in item && item.startDate) ? (item.startDate as string).split('T')[0] : undefined);\r\n                            const isFuture = !!(itemDate && itemDate > todayStr);\r\n\r\n                            // Find first pending task\r\n                            const firstPendingIndex = sortedItems.findIndex(t => t.status === 'pending');\r\n                            const isFirstPending = index === firstPendingIndex && item.status === 'pending';\r\n                            const isBlocked = !!((item.status === 'pending' && !isFirstPending) || isFuture);\r\n                            const lockReason = isFuture ? `Agendado para ${format(parseLocalDate(itemDate || todayStr), 'dd/MM')}` : \"Complete a tarefa anterior primeiro\";\r\n\r\n                            return (\r\n                                <div key={item.id} style={{ height: item.imageUrl ? 230 : 130, marginBottom: 12 }} className=\"px-1 pr-4\">\r\n                                    <div\r\n                                        style={{ '--hover-color': item.color || '#3b82f6' } as React.CSSProperties}\r\n                                        className={`h-full border rounded-xl overflow-hidden transition-colors transition-shadow duration-300 group flex flex-col ${isBlocked\r\n                                            ? 'bg-slate-900/30 border-slate-800/30 opacity-60'\r\n                                            : isLinked\r\n                                                ? 'bg-slate-900 border-rose-500/50 shadow-lg shadow-rose-900/10'\r\n                                                : 'bg-slate-900 border-slate-800 hover:border-[var(--hover-color)]'\r\n                                            }`}\r\n                                    >\r\n                                        {item.imageUrl && (\r\n                                            <div className=\"h-24 w-full relative bg-slate-800 shrink-0\">\r\n                                                <img src={item.imageUrl} alt={item.title} className=\"w-full h-full object-cover\" />\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"flex items-center gap-4 p-4 flex-1\">\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    return;\r\n                                                }}\r\n                                                disabled={true}\r\n                                                className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors shrink-0 ${isBlocked\r\n                                                    ? 'border-slate-600 bg-slate-800/50 cursor-not-allowed'\r\n                                                    : isLocked\r\n                                                        ? 'border-rose-500/50 bg-rose-500/10 cursor-not-allowed'\r\n                                                        : item.status === 'completed'\r\n                                                            ? 'bg-emerald-500 border-emerald-500 cursor-not-allowed'\r\n                                                            : (() => {\r\n                                                                const today = format(new Date(), 'yyyy-MM-dd');\r\n                                                                const isDoneToday = item.completionHistory?.some((d: string) => d.startsWith(today));\r\n                                                                return isDoneToday\r\n                                                                    ? 'bg-emerald-500/20 border-emerald-500/50 cursor-not-allowed'\r\n                                                                    : 'border-slate-500 hover:border-emerald-500 cursor-default';\r\n                                                            })()\r\n                                                    }`}\r\n                                                title={isBlocked ? lockReason : isLocked ? \"Conclua o Pomodoro primeiro!\" : \"Utilize o Pomodoro para concluir\"}\r\n                                            >\r\n                                                {isBlocked ? (\r\n                                                    <Lock className=\"w-3 h-3 text-slate-500\" />\r\n                                                ) : isLocked ? (\r\n                                                    <Lock className=\"w-3 h-3 text-rose-500\" />\r\n                                                ) : (\r\n                                                    (item.status === 'completed' || item.completionHistory?.some((d: string) => d.startsWith(format(new Date(), 'yyyy-MM-dd')))) && <CheckSquare className=\"w-4 h-4 text-white\" />\r\n                                                )}\r\n                                            </button>\r\n\r\n                                            <div className=\"flex-1 min-w-0\" onClick={() => !isStep && setSelectedDetailedTask(item as Task)}>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    {isStep && <Target className=\"w-3 h-3 text-slate-500\" />}\r\n                                                    <p className={`font-medium truncate ${isBlocked\r\n                                                        ? 'text-slate-600'\r\n                                                        : item.status === 'completed'\r\n                                                            ? 'text-slate-500 line-through'\r\n                                                            : (item.date && parseLocalDate(item.date) < new Date(new Date().setHours(0, 0, 0, 0)))\r\n                                                                ? 'text-red-400'\r\n                                                                : 'text-slate-200 cursor-pointer hover:underline'\r\n                                                        }`}>\r\n                                                        {item.title}\r\n                                                    </p>\r\n                                                </div>\r\n\r\n                                                {(item.type === 'period' || item.type === 'recurring') && 'progress' in item && item.progress && (\r\n                                                    <div className=\"mt-2 space-y-1\">\r\n                                                        <div className=\"flex justify-between items-center text-[10px]\">\r\n                                                            <span className=\"text-slate-500 font-bold uppercase tracking-wider\">Progresso</span>\r\n                                                            <span className=\"text-slate-400 font-bold\">\r\n                                                                {item.progress.current}/{item.progress.total}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <div className=\"h-1.5 bg-slate-900 rounded-full overflow-hidden\">\r\n                                                            <div\r\n                                                                className=\"h-full bg-gradient-to-r from-blue-600 to-purple-600 rounded-full transition-all duration-500\"\r\n                                                                style={{ width: `${Math.min(100, (item.progress.current / item.progress.total) * 100)}%` }}\r\n                                                            />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                <div className=\"flex gap-2 text-xs text-slate-500 mt-1 flex-wrap\">\r\n                                                    {isBlocked && (\r\n                                                        <span className=\"flex items-center gap-1 px-2 py-0.5 bg-slate-800/50 text-slate-600 rounded font-medium shrink-0\">\r\n                                                            <Lock className=\"w-3 h-3\" />\r\n                                                            Bloqueada\r\n                                                        </span>\r\n                                                    )}\r\n                                                    <span className={`capitalize px-2 py-0.5 rounded font-medium shrink-0 ${item.priority === 'high' ? 'bg-red-500/20 text-red-400' :\r\n                                                        item.priority === 'medium' ? 'bg-amber-500/20 text-amber-400' :\r\n                                                            'bg-slate-800 text-slate-400'\r\n                                                        }`}>\r\n                                                        {item.priority === 'high' ? 'Alta' : item.priority === 'medium' ? 'M√©dia' : 'Baixa'}\r\n                                                    </span>\r\n                                                    <span className=\"capitalize px-2 py-0.5 bg-slate-800 rounded shrink-0\">\r\n                                                        {item.type === 'day' ? 'Dia' : item.type === 'period' ? 'Per√≠odo' : item.type === 'recurring' ? 'Recorrente' : 'Meta'}\r\n                                                    </span>\r\n                                                    {item.type === 'period' && item.startDate && (\r\n                                                        <span className=\"shrink-0 text-slate-400\">\r\n                                                            In√≠cio: {format(parseLocalDate(item.startDate), 'dd/MM/yyyy')}\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {item.type === 'period' && item.endDate && (\r\n                                                        <span className={`shrink-0 ${parseLocalDate(item.endDate) < new Date(new Date().setHours(0, 0, 0, 0)) ? 'text-red-400 font-bold animate-pulse' : 'text-slate-400'}`}>\r\n                                                            Fim: {format(parseLocalDate(item.endDate), 'dd/MM/yyyy')}\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {item.type === 'day' && item.date && (\r\n                                                        <span className={`shrink-0 ${!item.status && parseLocalDate(item.date) < new Date(new Date().setHours(0, 0, 0, 0)) ? 'text-red-400 font-bold animate-pulse' : ''}`}>\r\n                                                            {isBlocked ? 'In√≠cio: ' : ''}{format(parseLocalDate(item.date), 'dd/MM/yyyy')}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"flex gap-2 items-center shrink-0\">\r\n                                                {item.status !== 'completed' && (\r\n                                                    <button\r\n                                                        onClick={(e) => {\r\n                                                            e.stopPropagation();\r\n                                                            if (isBlocked) {\r\n                                                                alert(lockReason || \"Esta tarefa est√° bloqueada.\");\r\n                                                                return;\r\n                                                            }\r\n\r\n                                                            // PRIORIDADE M√ÅXIMA: Bloqueio de dias futuros\r\n                                                            const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n                                                            const itemDate = item.date || (('startDate' in item && item.startDate) ? (item.startDate as string).split('T')[0] : undefined);\r\n\r\n                                                            if (itemDate && itemDate > todayStr) {\r\n                                                                alert(`Item agendado para o futuro (${format(parseLocalDate(itemDate), 'dd/MM/yyyy')}).`);\r\n                                                                return;\r\n                                                            }\r\n\r\n                                                            const duration = item.durationMinutes || 25;\r\n                                                            if (isStep && item.goalId) {\r\n                                                                startFocus(item.id, 'goal', item.title, duration, undefined, undefined, item.goalId);\r\n                                                            } else {\r\n                                                                startFocus(item.id, 'task', item.title, duration);\r\n                                                            }\r\n                                                            startFocusSession(item.id, duration);\r\n                                                        }}\r\n                                                        disabled={isBlocked}\r\n                                                        className={`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg group/btn hover:scale-105 active:scale-95 ${isBlocked\r\n                                                            ? 'bg-slate-800/30 border-slate-700/30 text-slate-600 cursor-not-allowed'\r\n                                                            : isLinked && isActive\r\n                                                                ? 'bg-rose-500/20 border-rose-500/50 text-rose-400 animate-pulse'\r\n                                                                : 'bg-slate-800 hover:bg-emerald-500 border border-slate-700 hover:border-emerald-500 text-slate-400 hover:text-white'\r\n                                                            }`}\r\n                                                        title={isBlocked ? lockReason : \"Iniciar Foco Imediatamente\"}\r\n                                                    >\r\n                                                        {isLinked && isActive ? (\r\n                                                            <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                                        ) : (\r\n                                                            <Play className={`w-4 h-4 fill-current ml-0.5`} />\r\n                                                        )}\r\n                                                    </button>\r\n                                                )}\r\n\r\n                                                <div className=\"w-px h-4 bg-slate-800 mx-1\" />\r\n\r\n                                                {!isStep && !isBlocked && (\r\n                                                    <>\r\n                                                        <button\r\n                                                            onClick={() => setEditingTask(item as Task)}\r\n                                                            className=\"p-2 text-slate-400 hover:text-blue-400 hover:bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-20\"\r\n                                                        >\r\n                                                            <Pencil className=\"w-4 h-4\" />\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={async () => {\r\n                                                                const confirmed = await confirm({\r\n                                                                    title: 'Excluir Tarefa',\r\n                                                                    message: `Tem certeza que deseja excluir \"${item.title}\"?`,\r\n                                                                    confirmText: 'Excluir',\r\n                                                                    cancelText: 'Cancelar',\r\n                                                                    isDangerous: true\r\n                                                                });\r\n                                                                if (confirmed) deleteTask(item.id);\r\n                                                            }}\r\n                                                            className=\"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-20\"\r\n                                                        >\r\n                                                            <Trash2 className=\"w-4 h-4\" />\r\n                                                        </button>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Modals */}\r\n            <AddTaskModal\r\n                isOpen={!!editingTask || isAddModalOpen}\r\n                onClose={() => {\r\n                    setEditingTask(undefined);\r\n                    setIsAddModalOpen(false);\r\n                }}\r\n                taskToEdit={editingTask}\r\n            />\r\n\r\n            <TaskDetailsModal\r\n                isOpen={!!selectedDetailedTask}\r\n                onClose={() => setSelectedDetailedTask(null)}\r\n                task={selectedDetailedTask}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\lists\\ThemeList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'addDays' is defined but never used.","line":5,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Modal' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Cell' is assigned a value but never used.","line":49,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":15}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { Layers } from 'lucide-react';\r\nimport { format, addDays } from 'date-fns';\r\nimport { AddThemeModal } from '../themes/components/AddThemeModal';\r\nimport { Modal } from '../../components/ui/Modal';\r\n\r\nimport type { Theme } from '../../types';\r\nimport { ThemeCard } from '../themes/components/ThemeCard';\r\nimport { useSRSLogic } from '../../hooks/useSRSLogic';\r\n// Lazy load StudyContentModal\r\n\r\nimport { ThemeDetailsModal } from '../themes/components/ThemeDetailsModal';\r\n\r\ninterface ThemeListProps {\r\n    forceCategory?: 'project' | 'study';\r\n    defaultCategory?: 'project' | 'study';\r\n}\r\n\r\n\r\n// Lazy Definition\r\nconst StudyContentModal = React.lazy(() => import('../themes/components/StudyContentModal').then(m => ({ default: m.StudyContentModal })));\r\n\r\nexport const ThemeList = ({ forceCategory, defaultCategory }: ThemeListProps = {}) => {\r\n    // ...\r\n\r\n    const { themes, deleteTheme, updateSubthemeContent, unlockedSubthemes, completeReview } = useStudy();\r\n    const { calculateQueuedDates, getThemeCompletionDate } = useSRSLogic();\r\n    const [editingTheme, setEditingTheme] = useState<Theme | undefined>(undefined);\r\n    const [selectedSubthemeForNotes, setSelectedSubthemeForNotes] = useState<any>(null);\r\n\r\n    const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n    const [selectedThemeForDetails, setSelectedThemeForDetails] = useState<Theme | null>(null);\r\n\r\n    const [searchParams] = useSearchParams();\r\n    // Use forceCategory prop if provided, otherwise use query param\r\n    const categoryFilter = forceCategory || searchParams.get('category');\r\n\r\n    // Filter themes based on category\r\n    // If category='project', show ONLY projects. Otherwise, show study themes (exclude projects)\r\n    const visibleThemes = categoryFilter === 'project'\r\n        ? themes.filter(t => t.category === 'project')\r\n        : themes.filter(t => t.category !== 'project');\r\n\r\n    // Queue Logic\r\n    const queuedSubthemesMap = calculateQueuedDates(visibleThemes);\r\n\r\n    const Cell = ({ columnIndex, rowIndex, style, data }: any) => {\r\n        const { themes, columnCount, onEdit, onDelete, getCompletion, ...rest } = data;\r\n        const index = rowIndex * columnCount + columnIndex;\r\n\r\n        if (index >= themes.length) {\r\n            return null;\r\n        }\r\n\r\n        const theme = themes[index];\r\n\r\n        return (\r\n            <div style={{ ...style, padding: '12px' }}>\r\n                <ThemeCard\r\n                    theme={theme}\r\n                    completionDate={getCompletion(theme)}\r\n                    onEdit={() => onEdit(theme)}\r\n                    onDelete={() => onDelete(theme.id)}\r\n                    {...rest}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-[calc(100vh-6rem)] flex flex-col gap-6 pb-4\">\r\n            {/* Header with Glow */}\r\n            <div className=\"shrink-0 relative flex flex-col md:flex-row md:items-end justify-between gap-4 px-1\">\r\n                <div className=\"absolute -top-10 -left-10 w-64 h-64 bg-blue-500/20 rounded-full blur-[100px] -z-10 pointer-events-none\" />\r\n                <div>\r\n                    <h2 className=\"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-slate-200 to-slate-500 mb-2\">\r\n                        {categoryFilter === 'project' ? 'Meus Projetos' : 'Meus Mundos de Estudo'}\r\n                    </h2>\r\n                    <p className=\"text-slate-400 max-w-2xl\">\r\n                        {categoryFilter === 'project'\r\n                            ? 'Organize e acompanhe seus projetos e objetivos pr√°ticos.'\r\n                            : 'Gerencie suas trilhas de conhecimento e acompanhe o progresso de cada universo.'}\r\n                    </p>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => setIsAddModalOpen(true)}\r\n                    className=\"group relative px-6 py-3 bg-slate-900 rounded-xl font-bold text-white shadow-xl hover:scale-[1.02] active:scale-95 transition-all duration-300 overflow-hidden ring-1 ring-white/10 shrink-0\"\r\n                >\r\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 opacity-80 group-hover:opacity-100 transition-opacity\" />\r\n                    <span className=\"relative flex items-center gap-2\">\r\n                        <span className=\"text-xl leading-none font-light mb-0.5\">+</span>\r\n                        Novo Tema\r\n                    </span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* List with AutoSizer */}\r\n            <div className=\"flex-1 min-h-0\">\r\n                {visibleThemes.length === 0 ? (\r\n                    <div className=\"glass-card text-center py-20 rounded-3xl relative overflow-hidden group\">\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"w-20 h-20 bg-slate-800/50 rounded-full flex items-center justify-center mx-auto mb-6 ring-1 ring-white/10 shadow-xl shadow-black/20 group-hover:scale-110 transition-transform duration-500\">\r\n                                <Layers className=\"w-10 h-10 text-slate-500 group-hover:text-blue-400 transition-colors\" />\r\n                            </div>\r\n                            <h3 className=\"text-2xl font-bold text-white mb-2\">Seu Universo est√° Vazio</h3>\r\n                            <p className=\"text-slate-400 max-w-md mx-auto mb-8 text-lg\">Crie seu primeiro tema de estudos para come√ßar a organizar seu conhecimento.</p>\r\n                            <button\r\n                                onClick={() => setIsAddModalOpen(true)}\r\n                                className=\"px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white rounded-xl font-bold transition-all hover:scale-105 shadow-lg shadow-blue-500/25 ring-1 ring-white/20\"\r\n                            >\r\n                                Criar Primeiro Tema\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 pb-20\">\r\n                        {visibleThemes.map(theme => (\r\n                            <ThemeCard\r\n                                key={theme.id}\r\n                                theme={theme}\r\n                                completionDate={getThemeCompletionDate(theme, queuedSubthemesMap)}\r\n                                onEdit={() => setEditingTheme(theme)}\r\n                                onDelete={() => deleteTheme(theme.id)}\r\n                                onOpenNotes={setSelectedSubthemeForNotes}\r\n                                onOpenDetails={() => setSelectedThemeForDetails(theme)}\r\n                                queuedSubthemesMap={queuedSubthemesMap}\r\n                                unlockedSubthemes={unlockedSubthemes}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <AddThemeModal\r\n                isOpen={!!editingTheme || isAddModalOpen}\r\n                onClose={() => {\r\n                    setEditingTheme(undefined);\r\n                    setIsAddModalOpen(false);\r\n                }}\r\n                themeToEdit={editingTheme}\r\n                defaultCategory={defaultCategory}\r\n            />\r\n\r\n            <ThemeDetailsModal\r\n                isOpen={!!selectedThemeForDetails}\r\n                onClose={() => setSelectedThemeForDetails(null)}\r\n                theme={selectedThemeForDetails}\r\n            />\r\n\r\n            {/* Study Content Modal (New Comprehensive Version) */}\r\n            <React.Suspense fallback={null}>\r\n                <StudyContentModal\r\n                    isOpen={!!selectedSubthemeForNotes}\r\n                    onClose={() => setSelectedSubthemeForNotes(null)}\r\n                    subtheme={selectedSubthemeForNotes}\r\n                    onSave={(content: string) => {\r\n                        // 1. Save Content\r\n                        updateSubthemeContent(selectedSubthemeForNotes.id, content);\r\n\r\n                        // 2. Check for PENDING reviews due today or earlier\r\n                        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n                        const pendingReview = selectedSubthemeForNotes.reviews.find((r: any) =>\r\n                            r.status === 'pending' && r.date <= todayStr\r\n                        );\r\n\r\n                        if (pendingReview) {\r\n                            completeReview(selectedSubthemeForNotes.id, pendingReview.number);\r\n                        }\r\n\r\n                        setSelectedSubthemeForNotes(null);\r\n                    }}\r\n                />\r\n            </React.Suspense>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\onboarding\\OnboardingModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":3,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BookOpen' is defined but never used.","line":3,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":3,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useStudy' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Sparkles, ArrowRight, User, BookOpen, Check } from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useStudy } from '../../context/StudyContext';\r\n\r\ninterface OnboardingModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const OnboardingModal: React.FC<OnboardingModalProps> = ({ isOpen, onClose }) => {\r\n    const { user, updateProfile } = useAuth();\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    const handleFinalize = async () => {\r\n        setIsSubmitting(true);\r\n        // If name is still generic, set it to something better or just use email part\r\n        if (user?.name === 'User' || !user?.name) {\r\n            const defaultName = user?.email?.split('@')[0] || 'Estudante';\r\n            await updateProfile({ display_name: defaultName });\r\n        }\r\n\r\n        // Mark as dismissed in localStorage to avoid re-triggering just because it's empty\r\n        localStorage.setItem('onboarding_dismissed', 'true');\r\n\r\n        onClose();\r\n        setIsSubmitting(false);\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                <motion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    exit={{ opacity: 0 }}\r\n                    className=\"absolute inset-0 bg-slate-950/90 backdrop-blur-xl\"\r\n                />\r\n\r\n                <motion.div\r\n                    initial={{ scale: 0.9, opacity: 0, y: 20 }}\r\n                    animate={{ scale: 1, opacity: 1, y: 0 }}\r\n                    exit={{ scale: 0.9, opacity: 0, y: 20 }}\r\n                    className=\"relative w-full max-w-md bg-slate-900 border border-white/10 rounded-3xl shadow-2xl overflow-hidden\"\r\n                >\r\n                    {/* Background Effects */}\r\n                    <div className=\"absolute top-0 left-0 w-full h-1/2 bg-blue-600/10 blur-[50px] pointer-events-none\" />\r\n\r\n                    <div className=\"p-8 relative z-10 text-center space-y-6\">\r\n                        <div className=\"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl mx-auto flex items-center justify-center shadow-lg shadow-blue-500/30\">\r\n                            <Sparkles className=\"w-10 h-10 text-white\" />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-black text-white mb-2\">Bem-vindo ao Revis√£o <span className=\"text-blue-400\">PRO</span></h2>\r\n                            <p className=\"text-slate-400\">Sua jornada para a maestria nos estudos come√ßa aqui. Explore sua dashboard e comece a criar suas miss√µes.</p>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleFinalize}\r\n                            disabled={isSubmitting}\r\n                            className=\"w-full py-4 bg-white text-slate-950 font-bold rounded-xl hover:scale-[1.02] transition-transform flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                        >\r\n                            {isSubmitting ? 'Iniciando...' : 'Come√ßar Agora'} <ArrowRight className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </div>\r\n                </motion.div>\r\n            </div>\r\n        </AnimatePresence>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\pomodoro\\FocusSoundsPlayer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Pause' is defined but never used.","line":3,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Howl } from 'howler';\r\nimport { Volume2, VolumeX, CloudRain, Wind, Radio, Play, Pause } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nconst SOUNDS = [\r\n    { id: 'rain', label: 'Chuva', icon: CloudRain, src: 'https://assets.mixkit.co/sfx/preview/mixkit-light-rain-loop-1253.mp3', color: 'text-blue-400' },\r\n    { id: 'white', label: 'Ru√≠do Branco', icon: Radio, src: 'https://assets.mixkit.co/sfx/preview/mixkit-white-noise-1262.mp3', color: 'text-slate-400' },\r\n    { id: 'wind', label: 'Vento', icon: Wind, src: 'https://assets.mixkit.co/sfx/preview/mixkit-wind-through-trees-1224.mp3', color: 'text-emerald-400' },\r\n];\r\n\r\nexport const FocusSoundsPlayer = () => {\r\n    const [currentSound, setCurrentSound] = useState<string | null>(null);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [volume, setVolume] = useState(0.5);\r\n    const [howl, setHowl] = useState<Howl | null>(null);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            if (howl) howl.unload();\r\n        };\r\n    }, [howl]);\r\n\r\n    const toggleSound = (soundId: string) => {\r\n        if (currentSound === soundId && isPlaying) {\r\n            howl?.pause();\r\n            setIsPlaying(false);\r\n            return;\r\n        }\r\n\r\n        if (howl) {\r\n            howl.stop();\r\n        }\r\n\r\n        const sound = SOUNDS.find(s => s.id === soundId);\r\n        if (sound) {\r\n            const newHowl = new Howl({\r\n                src: [sound.src],\r\n                html5: true,\r\n                loop: true,\r\n                volume: volume,\r\n            });\r\n            newHowl.play();\r\n            setHowl(newHowl);\r\n            setCurrentSound(soundId);\r\n            setIsPlaying(true);\r\n        }\r\n    };\r\n\r\n    const handleVolumeChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newVol = parseFloat(e.target.value);\r\n        setVolume(newVol);\r\n        if (howl) howl.volume(newVol);\r\n    };\r\n\r\n    const activeSound = SOUNDS.find(s => s.id === currentSound);\r\n\r\n    return (\r\n        <div className=\"relative\">\r\n            {/* Minimized / Trigger */}\r\n            <button\r\n                onClick={() => setIsExpanded(!isExpanded)}\r\n                className={cn(\r\n                    \"flex items-center gap-2 px-3 py-2 rounded-xl transition-all border\",\r\n                    isPlaying\r\n                        ? \"bg-indigo-500/20 text-indigo-300 border-indigo-500/30 shadow-[0_0_15px_rgba(99,102,241,0.2)]\"\r\n                        : \"bg-slate-800/50 text-slate-400 border-white/5 hover:bg-white/10\"\r\n                )}\r\n            >\r\n                {isPlaying ? <Volume2 className=\"w-4 h-4\" /> : <VolumeX className=\"w-4 h-4\" />}\r\n                <span className=\"text-xs font-bold uppercase tracking-wider hidden md:inline\">\r\n                    {isPlaying ? activeSound?.label : \"Sons\"}\r\n                </span>\r\n            </button>\r\n\r\n            {/* Expanded Menu */}\r\n            <AnimatePresence>\r\n                {isExpanded && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                        exit={{ opacity: 0, y: 10, scale: 0.95 }}\r\n                        className=\"absolute bottom-full right-0 mb-3 w-64 bg-slate-950/90 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl p-4 z-50 ring-1 ring-white/5\"\r\n                    >\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <h4 className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">Ambiente</h4>\r\n                            {isPlaying && (\r\n                                <div className=\"flex items-center gap-1\">\r\n                                    <span className=\"w-0.5 h-2 bg-indigo-500 animate-[bounce_1s_infinite]\" />\r\n                                    <span className=\"w-0.5 h-3 bg-indigo-500 animate-[bounce_1.2s_infinite]\" />\r\n                                    <span className=\"w-0.5 h-2 bg-indigo-500 animate-[bounce_0.8s_infinite]\" />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2 mb-4\">\r\n                            {SOUNDS.map(sound => (\r\n                                <button\r\n                                    key={sound.id}\r\n                                    onClick={() => toggleSound(sound.id)}\r\n                                    className={cn(\r\n                                        \"w-full flex items-center justify-between p-2 rounded-xl transition-all border\",\r\n                                        currentSound === sound.id && isPlaying\r\n                                            ? \"bg-indigo-600/20 border-indigo-500/30 shadow-inner\"\r\n                                            : \"bg-white/5 border-transparent hover:bg-white/10\"\r\n                                    )}\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={cn(\"p-1.5 rounded-lg\", currentSound === sound.id && isPlaying ? \"bg-indigo-500 text-white\" : \"bg-slate-800 text-slate-400\")}>\r\n                                            <sound.icon className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <span className={cn(\"text-xs font-bold\", currentSound === sound.id && isPlaying ? \"text-indigo-200\" : \"text-slate-300\")}>\r\n                                            {sound.label}\r\n                                        </span>\r\n                                    </div>\r\n                                    {currentSound === sound.id && isPlaying && <Play className=\"w-3 h-3 text-indigo-400 fill-current\" />}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Volume Slider */}\r\n                        <div className=\"flex items-center gap-3 px-1\">\r\n                            <Volume2 className=\"w-3 h-3 text-slate-500\" />\r\n                            <input\r\n                                type=\"range\"\r\n                                min=\"0\"\r\n                                max=\"1\"\r\n                                step=\"0.01\"\r\n                                value={volume}\r\n                                onChange={handleVolumeChange}\r\n                                className=\"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-indigo-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:shadow-[0_0_8px_rgba(99,102,241,0.5)]\"\r\n                            />\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\pomodoro\\PomodoroWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useRef' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Square' is defined but never used.","line":7,"column":103,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":109},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleClose' is assigned a value but never used.","line":30,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\pomodoro\\PomodoroWidget.tsx:87:13\n  85 |         // Only show validate if we have an active focus AND timer is finished AND we were in focus mode\n  86 |         if (timeLeft === 0 && mode === 'focus' && activeFocus) {\n> 87 |             setShowValidate(true);\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  88 |             setValidationStep('validate'); // Start at validation step\n  89 |             setIsMinimized(false); // Force open\n  90 |         } else if (timeLeft !== 0) {","line":87,"column":13,"nodeType":null,"endLine":87,"endColumn":28}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useEffect, useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { useAudio } from '../../context/AudioContext'; // Added\r\nimport { useConfirm } from '../../context/ConfirmContext';\r\nimport { Play, Pause, SkipForward, RefreshCw, Timer, X, Volume2, CloudRain, Zap, Waves, CheckCircle2, Square } from 'lucide-react'; // Added icons\r\nimport { cn } from '../../lib/utils';\r\n\r\nexport const PomodoroWidget = () => {\r\n    const {\r\n        mode,\r\n        timeLeft,\r\n        isActive,\r\n        cycles,\r\n        linkedItemId,\r\n        toggleTimer,\r\n        resetTimer,\r\n        skipTimer,\r\n        isWidgetVisible,\r\n        closeWidget,\r\n        openWidget,\r\n        settings\r\n    } = usePomodoroContext();\r\n\r\n    const { endFocus, activeFocus, completeReview, toggleTask, toggleGoal, toggleGoalItem } = useStudy();\r\n    const { isPlaying: isAudioPlaying, togglePlay: toggleAudio, volume, setVolume, currentSound, setSound } = useAudio();\r\n    const { confirm: confirmAction } = useConfirm();\r\n\r\n    const handleClose = async () => {\r\n        if (linkedItemId || activeFocus) {\r\n            const confirmed = await confirmAction({ message: 'Deseja cancelar o foco atual?', isDangerous: true });\r\n            if (!confirmed) {\r\n                return;\r\n            }\r\n            endFocus(false);\r\n            resetTimer();\r\n        }\r\n        closeWidget();\r\n    };\r\n\r\n    const formatTime = (seconds: number) => {\r\n        const m = Math.floor(seconds / 60);\r\n        const s = seconds % 60;\r\n        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    const getModeLabel = () => {\r\n        switch (mode) {\r\n            case 'focus': return 'Foco';\r\n            case 'shortBreak': return 'Pausa Curta';\r\n            case 'longBreak': return 'Pausa Longa';\r\n        }\r\n    };\r\n\r\n    const getModeColor = () => {\r\n        switch (mode) {\r\n            case 'focus': return 'from-rose-500 to-red-600 border-rose-500/20 shadow-rose-900/20';\r\n            case 'shortBreak': return 'from-emerald-500 to-green-600 border-emerald-500/20 shadow-emerald-900/20';\r\n            case 'longBreak': return 'from-blue-500 to-indigo-600 border-blue-500/20 shadow-blue-900/20';\r\n        }\r\n    };\r\n\r\n    // State for minimizing\r\n    const [isMinimized, setIsMinimized] = useState(true);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [position, setPosition] = useState(() => {\r\n        const saved = localStorage.getItem('pomodoro-position');\r\n        return saved ? JSON.parse(saved) : { x: 0, y: 0 };\r\n    });\r\n    const [showValidate, setShowValidate] = useState(false);\r\n    const [validationStep, setValidationStep] = useState<'validate' | 'summary'>('validate'); // New step state\r\n    const [showSoundPanel, setShowSoundPanel] = useState(false);\r\n    const [summaryText, setSummaryText] = useState('');\r\n\r\n    const getModeDuration = () => {\r\n        if (mode === 'focus') return settings.focusDuration * 60;\r\n        if (mode === 'shortBreak') return settings.shortBreakDuration * 60;\r\n        return settings.longBreakDuration * 60;\r\n    };\r\n    const circleProgress = (timeLeft / getModeDuration()) * 100;\r\n\r\n    // Effect: Detect Focus End for Validation\r\n    useEffect(() => {\r\n        // Only show validate if we have an active focus AND timer is finished AND we were in focus mode\r\n        if (timeLeft === 0 && mode === 'focus' && activeFocus) {\r\n            setShowValidate(true);\r\n            setValidationStep('validate'); // Start at validation step\r\n            setIsMinimized(false); // Force open\r\n        } else if (timeLeft !== 0) {\r\n            // Clear validation state if timer is not 0 (e.g. reset)\r\n            setShowValidate(false);\r\n            setSummaryText('');\r\n        }\r\n    }, [timeLeft, mode, activeFocus]);\r\n\r\n    const handleConfirmValidation = () => {\r\n        setValidationStep('summary');\r\n    };\r\n\r\n    const handleFinalizeSession = async () => {\r\n        if (!activeFocus) return;\r\n\r\n        try {\r\n            // Identify if something was written (passed to completion functions)\r\n            if (activeFocus.type === 'subtheme') {\r\n                if (activeFocus.reviewNumber !== undefined) {\r\n                    await completeReview(activeFocus.id, activeFocus.reviewNumber, activeFocus.reviewType || 'review', 'medium', summaryText);\r\n                }\r\n            } else if (activeFocus.type === 'task') {\r\n                toggleTask(activeFocus.id, undefined, summaryText);\r\n            } else if (activeFocus.type === 'goal') {\r\n                if (activeFocus.parentId) {\r\n                    toggleGoalItem(activeFocus.parentId, activeFocus.id, undefined, summaryText);\r\n                } else {\r\n                    toggleGoal(activeFocus.id, undefined, summaryText);\r\n                }\r\n            }\r\n\r\n            // Cleanup: No new pomodoro should appear\r\n            setShowValidate(false);\r\n            endFocus(true, summaryText); // StudyContext cleanup\r\n            resetTimer();   // Reset time to default\r\n            closeWidget();  // Close widget entirely\r\n\r\n            // Reset local states\r\n            setSummaryText('');\r\n            setValidationStep('validate');\r\n        } catch (error) {\r\n            console.error(\"Failed to validate:\", error);\r\n        }\r\n    };\r\n\r\n    // Fail-safe: Ensure widget is visible if timer is active\r\n    // Fail-safe: Ensure widget is visible if timer is active\r\n    useEffect(() => {\r\n        if (isActive && !isWidgetVisible) {\r\n            openWidget();\r\n        }\r\n    }, [isActive, isWidgetVisible, openWidget]);\r\n\r\n    // IF WIDGET IS NOT VISIBLE, RENDER THE FLOATING FAB (LAUNCHER)\r\n    if (!isWidgetVisible) {\r\n        return (\r\n            <motion.div\r\n                drag\r\n                dragMomentum={false}\r\n                dragElastic={0}\r\n                onDragStart={() => setIsDragging(true)}\r\n                onDragEnd={(_, info) => {\r\n                    setTimeout(() => setIsDragging(false), 100);\r\n                    const newPos = { x: position.x + info.offset.x, y: position.y + info.offset.y };\r\n                    setPosition(newPos);\r\n                    localStorage.setItem('pomodoro-position', JSON.stringify(newPos));\r\n                }}\r\n                style={{ x: position.x, y: position.y }}\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n                whileDrag={{ scale: 1.1 }}\r\n                className={cn(\r\n                    \"fixed bottom-24 md:bottom-6 right-4 md:right-6 z-[9999]\",\r\n                    \"w-16 h-16 rounded-full flex items-center justify-center shadow-2xl\",\r\n                    \"bg-slate-900/90 backdrop-blur-xl border border-white/10 text-white group cursor-grab active:cursor-grabbing\",\r\n                    isActive ? \"border-rose-500/50 shadow-rose-500/20\" : \"hover:border-emerald-500/50 shadow-black/50\"\r\n                )}\r\n            >\r\n                <div\r\n                    className=\"absolute inset-0 z-0 rounded-full\"\r\n                    onClick={() => !isDragging && toggleTimer()}\r\n                    onDoubleClick={(e) => {\r\n                        e.stopPropagation();\r\n                        openWidget();\r\n                    }}\r\n                />\r\n\r\n                {/* Progress Ring if Active */}\r\n                {isActive && (\r\n                    <svg className=\"absolute inset-0 w-full h-full -rotate-90 scale-90 pointer-events-none\">\r\n                        <circle cx=\"32\" cy=\"32\" r=\"28\" className=\"fill-none stroke-white/5\" strokeWidth=\"4\" />\r\n                        <motion.circle\r\n                            cx=\"32\" cy=\"32\" r=\"28\"\r\n                            className=\"fill-none stroke-rose-500\"\r\n                            strokeWidth=\"4\"\r\n                            strokeLinecap=\"round\"\r\n                            initial={{ pathLength: 0 }}\r\n                            animate={{ pathLength: circleProgress / 100 }}\r\n                            transition={{ duration: 0.5 }}\r\n                        />\r\n                    </svg>\r\n                )}\r\n\r\n                <div className=\"relative z-10 flex items-center justify-center pointer-events-none\">\r\n                    {isActive ? (\r\n                        <div className=\"flex flex-col items-center\">\r\n                            <span className=\"text-[11px] font-mono font-black text-rose-400 leading-none mb-0.5\">\r\n                                {formatTime(timeLeft)}\r\n                            </span>\r\n                            <Play className=\"w-2.5 h-2.5 fill-rose-500 text-rose-500\" />\r\n                        </div>\r\n                    ) : (\r\n                        <Timer className=\"w-7 h-7 text-slate-400 group-hover:text-emerald-400 transition-colors\" />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Pulsing glow if active */}\r\n                {isActive && (\r\n                    <div className=\"absolute inset-0 rounded-full bg-rose-500/20 animate-pulse -z-10 pointer-events-none\" />\r\n                )}\r\n\r\n                {/* Hint to open */}\r\n                <div className=\"absolute -top-1 -right-1 bg-blue-500 w-4 h-4 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\">\r\n                    <Timer className=\"w-2.5 h-2.5 text-white\" />\r\n                </div>\r\n            </motion.div>\r\n        );\r\n    }\r\n\r\n    // MINIMIZED VIEW (Floating Pill)\r\n    if (isMinimized && !showValidate) {\r\n        return (\r\n            <motion.div\r\n                layoutId=\"pomodoro-widget\"\r\n                drag\r\n                dragMomentum={false}\r\n                dragElastic={0}\r\n                onDragStart={() => setIsDragging(true)}\r\n                onDragEnd={(_, info) => {\r\n                    setTimeout(() => setIsDragging(false), 100);\r\n                    const newPos = { x: position.x + info.offset.x, y: position.y + info.offset.y };\r\n                    setPosition(newPos);\r\n                    localStorage.setItem('pomodoro-position', JSON.stringify(newPos));\r\n                }}\r\n                style={{ x: position.x, y: position.y }}\r\n                whileDrag={{ scale: 1.1 }}\r\n                className={cn(\r\n                    \"fixed bottom-24 md:bottom-6 right-4 md:right-6 z-[9999] p-1 rounded-full shadow-2xl backdrop-blur-xl border cursor-grab active:cursor-grabbing group\",\r\n                    \"bg-slate-900/95 border-slate-700/50 hover:border-slate-500\",\r\n                    mode === 'focus' ? 'shadow-rose-900/30' : mode === 'shortBreak' ? 'shadow-emerald-900/30' : 'shadow-blue-900/30'\r\n                )}\r\n            >\r\n                <div className=\"relative w-16 h-16 flex items-center justify-center\">\r\n                    <div\r\n                        className=\"absolute inset-0 z-20 rounded-full\"\r\n                        onClick={() => !isDragging && toggleTimer()}\r\n                        onDoubleClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setIsMinimized(false);\r\n                        }}\r\n                    />\r\n\r\n                    <svg className=\"absolute inset-0 w-full h-full -rotate-90 scale-90 pointer-events-none\">\r\n                        <circle cx=\"32\" cy=\"32\" r=\"28\" className=\"fill-none stroke-slate-800\" strokeWidth=\"4\" />\r\n                        <circle\r\n                            cx=\"32\" cy=\"32\" r=\"28\"\r\n                            className={cn(\r\n                                \"fill-none transition-all duration-1000\",\r\n                                mode === 'focus' ? \"stroke-rose-500\" : mode === 'shortBreak' ? \"stroke-emerald-500\" : \"stroke-blue-500\"\r\n                            )}\r\n                            strokeWidth=\"4\"\r\n                            strokeDasharray=\"176\" // 2 * PI * 28\r\n                            strokeDashoffset={176 - (176 * (circleProgress / 100))}\r\n                            strokeLinecap=\"round\"\r\n                        />\r\n                    </svg>\r\n\r\n                    <div className=\"flex flex-col items-center justify-center relative z-10 pointer-events-none\">\r\n                        <span className={cn(\r\n                            \"text-[11px] font-mono font-black border-b border-transparent leading-none\",\r\n                            mode === 'focus' ? \"text-rose-400\" : mode === 'shortBreak' ? \"text-emerald-400\" : \"text-blue-400\"\r\n                        )}>\r\n                            {formatTime(timeLeft)}\r\n                        </span>\r\n                        <div className=\"mt-0.5 opacity-60\">\r\n                            {isActive ? (\r\n                                <Pause className={cn(\"w-2 h-2 fill-current\", mode === 'focus' ? \"text-rose-500\" : \"text-emerald-500\")} />\r\n                            ) : (\r\n                                <Play className={cn(\"w-2 h-2 fill-current\", mode === 'focus' ? \"text-rose-500\" : \"text-emerald-500\")} />\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Quick Expand Hint */}\r\n                    <div className=\"absolute bottom-1 right-1 bg-blue-500/20 w-3 h-3 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\">\r\n                        <div className=\"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse\" />\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n        );\r\n    }\r\n\r\n    // MAXIMIZED VIEW (Overlay)\r\n    return (\r\n        <>\r\n            <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n                className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-[9990]\"\r\n                onClick={() => setIsMinimized(true)}\r\n            />\r\n\r\n            <div className=\"fixed inset-0 z-[9999] pointer-events-none flex items-center justify-center\">\r\n                <motion.div\r\n                    layoutId=\"pomodoro-widget\"\r\n                    initial={{ scale: 0.9, opacity: 0 }}\r\n                    animate={{ scale: 1, opacity: 1 }}\r\n                    exit={{ scale: 0.9, opacity: 0 }}\r\n                    className={cn(\r\n                        \"pointer-events-auto relative flex flex-col items-center\",\r\n                        \"w-[90vw] max-w-sm md:w-96 rounded-[2.5rem] p-6 md:p-8 shadow-2xl backdrop-blur-2xl border cursor-default overflow-hidden transition-colors duration-500\",\r\n                        \"bg-slate-900/95 border-slate-800/50\",\r\n                        \"text-white\",\r\n                        getModeColor().replace('from-', 'border-')\r\n                    )}\r\n                    style={{\r\n                        boxShadow: mode === 'focus' ? '0 0 100px -10px rgba(244, 63, 94, 0.4)' :\r\n                            mode === 'shortBreak' ? '0 10px 40px -10px rgba(16, 185, 129, 0.2)' :\r\n                                '0 10px 40px -10px rgba(59, 130, 246, 0.2)'\r\n                    }}\r\n                >\r\n                    {/* Header */}\r\n                    <div className=\"flex items-center justify-between w-full mb-8 mt-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className={cn(\r\n                                \"p-2 rounded-xl bg-slate-800/50\",\r\n                                mode === 'focus' ? 'text-rose-400' :\r\n                                    mode === 'shortBreak' ? 'text-emerald-400' : 'text-blue-400'\r\n                            )}>\r\n                                <Timer className=\"w-4 h-4\" />\r\n                            </div>\r\n                            <span className=\"text-xs font-black uppercase tracking-[0.2em] select-none text-slate-400\">\r\n                                {getModeLabel()}\r\n                            </span>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-2\">\r\n                            <button\r\n                                onClick={() => setShowSoundPanel(!showSoundPanel)}\r\n                                className={cn(\r\n                                    \"p-2 transition-all rounded-xl hover:bg-slate-800/50\",\r\n                                    isAudioPlaying ? \"text-blue-400 bg-blue-500/10\" : \"text-slate-500 hover:text-white\"\r\n                                )}\r\n                                title=\"Sons de Foco\"\r\n                            >\r\n                                <Volume2 className=\"w-5 h-5\" />\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setIsMinimized(true)}\r\n                                className=\"p-2 text-slate-500 hover:text-white transition-all rounded-xl hover:bg-slate-800/50\"\r\n                                title=\"Minimizar\"\r\n                            >\r\n                                <X className=\"w-5 h-5\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Check if Sound Panel is open */}\r\n                    {showSoundPanel ? (\r\n                        <div className=\"w-full h-56 mb-10 overflow-hidden flex flex-col gap-4\">\r\n                            {/* ... Sound Panel Content ... */}\r\n                            <div className=\"flex items-center justify-between px-2\">\r\n                                <span className=\"text-sm font-bold text-slate-400 uppercase tracking-wider\">Ambiente</span>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Volume2 className=\"w-4 h-4 text-slate-500\" />\r\n                                    <input\r\n                                        type=\"range\"\r\n                                        min=\"0\" max=\"1\" step=\"0.05\"\r\n                                        value={volume}\r\n                                        onChange={(e) => setVolume(parseFloat(e.target.value))}\r\n                                        className=\"w-24 accent-blue-500 h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3 mt-2\">\r\n                                {[\r\n                                    { id: 'white', label: 'Ru√≠do Branco', icon: Zap },\r\n                                    { id: 'pink', label: 'Ru√≠do Rosa', icon: Waves },\r\n                                    { id: 'brown', label: 'Ru√≠do Marrom', icon: Volume2 },\r\n                                    { id: 'rain', label: 'Chuva', icon: CloudRain },\r\n                                ].map((sound) => (\r\n                                    <button\r\n                                        key={sound.id}\r\n                                        onClick={() => {\r\n                                            if (currentSound === sound.id && isAudioPlaying) {\r\n                                                toggleAudio();\r\n                                            } else {\r\n                                                setSound(sound.id as any);\r\n                                                if (!isAudioPlaying) toggleAudio();\r\n                                            }\r\n                                        }}\r\n                                        className={cn(\r\n                                            \"flex flex-col items-center justify-center p-4 rounded-2xl border transition-all duration-300\",\r\n                                            currentSound === sound.id && isAudioPlaying\r\n                                                ? \"bg-blue-500/20 border-blue-500/50 text-white\"\r\n                                                : \"bg-slate-800/50 border-slate-800/50 text-slate-400 hover:bg-slate-800/50 hover:text-slate-200\"\r\n                                        )}\r\n                                    >\r\n                                        <sound.icon className={cn(\"w-6 h-6 mb-2\", currentSound === sound.id && isAudioPlaying && \"animate-pulse\")} />\r\n                                        <span className=\"text-xs font-bold\">{sound.label}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : showValidate ? (\r\n                        validationStep === 'validate' ? (\r\n                            /* Step 1: Validation Button Only */\r\n                            <div className=\"w-full h-auto min-h-[14rem] mb-6 flex flex-col items-center justify-center animate-in fade-in zoom-in-95 duration-300\">\r\n                                <div className=\"text-center mb-8\">\r\n                                    <div className=\"w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\r\n                                        <CheckCircle2 className=\"w-10 h-10 text-emerald-500\" />\r\n                                    </div>\r\n                                    <h3 className=\"text-2xl font-bold text-white mb-2\">Foco Finalizado!</h3>\r\n                                    <p className=\"text-slate-400\">Excelente trabalho. Vamos registrar?</p>\r\n                                </div>\r\n\r\n                                <button\r\n                                    onClick={handleConfirmValidation}\r\n                                    className=\"w-full py-4 bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 text-white font-bold rounded-2xl transition-all shadow-lg shadow-emerald-500/20 flex items-center justify-center gap-2 group\"\r\n                                >\r\n                                    <span>Validar Sess√£o</span>\r\n                                    <CheckCircle2 className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            /* Step 2: Summary Input */\r\n                            <div className=\"w-full h-auto min-h-[14rem] mb-6 flex flex-col animate-in fade-in slide-in-from-right-4 duration-300\">\r\n                                <div className=\"text-center mb-4\">\r\n                                    <h3 className=\"text-xl font-bold text-white mb-1\">Resumo da Sess√£o üìù</h3>\r\n                                    <p className=\"text-sm text-slate-400\">O que voc√™ aprendeu ou realizou?</p>\r\n                                </div>\r\n\r\n                                <textarea\r\n                                    value={summaryText}\r\n                                    onChange={(e) => setSummaryText(e.target.value)}\r\n                                    placeholder=\"Escreva aqui seu resumo...\"\r\n                                    className=\"w-full flex-1 bg-slate-800/50 border border-slate-700/50 rounded-xl p-4 text-sm text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none mb-4\"\r\n                                    autoFocus\r\n                                />\r\n\r\n                                <button\r\n                                    onClick={handleFinalizeSession}\r\n                                    className=\"w-full py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold rounded-xl transition-colors shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <CheckCircle2 className=\"w-5 h-5\" />\r\n                                    <span>Salvar & Concluir</span>\r\n                                </button>\r\n                            </div>\r\n                        )\r\n                    ) : (\r\n                        /* Progress Circle Large */\r\n                        <div\r\n                            onClick={toggleTimer}\r\n                            className=\"relative w-56 h-56 mx-auto mb-10 flex items-center justify-center cursor-pointer group hover:scale-105 transition-transform\"\r\n                        >\r\n                            <svg className=\"absolute inset-0 w-full h-full -rotate-90\">\r\n                                <circle\r\n                                    cx=\"112\" cy=\"112\" r=\"100\"\r\n                                    className=\"fill-none stroke-slate-800/50\"\r\n                                    strokeWidth=\"8\"\r\n                                />\r\n                                <motion.circle\r\n                                    cx=\"112\" cy=\"112\" r=\"100\"\r\n                                    className={cn(\r\n                                        \"fill-none stroke-current\",\r\n                                        mode === 'focus' ? \"text-rose-500\" :\r\n                                            mode === 'shortBreak' ? \"text-emerald-500\" : \"text-blue-500\"\r\n                                    )}\r\n                                    strokeWidth=\"8\"\r\n                                    strokeDasharray=\"628\" // 2 * PI * 100\r\n                                    animate={{ strokeDashoffset: 628 - (628 * (1 - circleProgress / 100)) }}\r\n                                    strokeLinecap=\"round\"\r\n                                    transition={{ duration: 1, ease: \"linear\" }}\r\n                                />\r\n                            </svg>\r\n\r\n                            <div className=\"text-center z-10 select-none\">\r\n                                <div className={cn(\r\n                                    \"text-6xl font-mono font-black tracking-tighter tabular-nums\",\r\n                                    mode === 'focus' ? 'text-white' :\r\n                                        mode === 'shortBreak' ? 'text-emerald-500' : 'text-blue-500'\r\n                                )}>\r\n                                    {formatTime(timeLeft)}\r\n                                </div>\r\n                                <div className=\"flex justify-center gap-1.5 mt-6\">\r\n                                    {[...Array(4)].map((_, i) => (\r\n                                        <div\r\n                                            key={i}\r\n                                            className={cn(\r\n                                                \"w-2 h-2 rounded-full transition-colors\",\r\n                                                i < (cycles % 4) ? \"bg-blue-400\" : \"bg-slate-700\"\r\n                                            )}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Controls */}\r\n                    {!showValidate && (\r\n                        <div className=\"flex flex-col gap-4 mb-4\">\r\n                            <div className=\"flex items-center justify-center gap-6\">\r\n                                <button\r\n                                    onClick={resetTimer}\r\n                                    className=\"p-4 rounded-2xl hover:bg-slate-800/50 text-slate-400 hover:text-white transition-all active:scale-90\"\r\n                                >\r\n                                    <RefreshCw className=\"w-6 h-6\" />\r\n                                </button>\r\n\r\n                                <button\r\n                                    onClick={toggleTimer}\r\n                                    className={cn(\r\n                                        \"w-20 h-20 flex items-center justify-center rounded-[2rem] shadow-2xl transition-all active:scale-95 text-white\",\r\n                                        \"bg-gradient-to-br\",\r\n                                        mode === 'focus' ? \"from-rose-500 to-rose-600 shadow-rose-500/30\" :\r\n                                            mode === 'shortBreak' ? \"from-emerald-500 to-emerald-600 shadow-emerald-500/30\" :\r\n                                                \"from-blue-500 to-blue-600 shadow-blue-500/30\"\r\n                                    )}\r\n                                >\r\n                                    {isActive ? <Pause className=\"w-8 h-8 fill-white\" /> : <Play className=\"w-8 h-8 fill-white ml-2\" />}\r\n                                </button>\r\n\r\n                                <button\r\n                                    onClick={skipTimer}\r\n                                    className=\"p-4 rounded-2xl hover:bg-slate-800/50 text-slate-400 hover:text-white transition-all active:scale-90\"\r\n                                >\r\n                                    <SkipForward className=\"w-6 h-6\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </motion.div>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\projects\\components\\AddProjectModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":4,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport type { Project } from '../../../types';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { X, Plus, Calendar } from 'lucide-react';\r\nimport { useProjectContext } from '../../../context/ProjectProvider';\r\nimport { SymbolPicker } from '../../../components/forms/SymbolPicker';\r\n\r\ninterface AddProjectModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const AddProjectModal: React.FC<AddProjectModalProps> = ({ isOpen, onClose }) => {\r\n    const { addProject } = useProjectContext();\r\n\r\n    const [title, setTitle] = useState('');\r\n    const [description, setDescription] = useState('');\r\n    const [category, setCategory] = useState<Project['category']>('personal');\r\n    const [status, setStatus] = useState<Project['status']>('planning');\r\n    const [startDate, setStartDate] = useState('');\r\n    const [deadline, setDeadline] = useState('');\r\n    const [icon, setIcon] = useState('üìÅ');\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!title.trim()) return;\r\n\r\n        addProject({\r\n            title: title.trim(),\r\n            description: description.trim() || undefined,\r\n            category,\r\n            status,\r\n            startDate: startDate || undefined,\r\n            deadline: deadline || undefined,\r\n            icon,\r\n            linkedTaskIds: [],\r\n            linkedGoalIds: [],\r\n        });\r\n\r\n        // Reset form\r\n        setTitle('');\r\n        setDescription('');\r\n        setCategory('personal');\r\n        setStatus('planning');\r\n        setStartDate('');\r\n        setDeadline('');\r\n        setIcon('üìÅ');\r\n\r\n        onClose();\r\n    };\r\n\r\n    const categoryOptions = [\r\n        { value: 'professional', label: 'Profissional', icon: 'üíº' },\r\n        { value: 'personal', label: 'Pessoal', icon: 'üè†' },\r\n        { value: 'academic', label: 'Acad√™mico', icon: 'üéì' },\r\n    ] as const;\r\n\r\n    const statusOptions = [\r\n        { value: 'planning', label: 'Planejando' },\r\n        { value: 'active', label: 'Ativo' },\r\n        { value: 'paused', label: 'Pausado' },\r\n        { value: 'completed', label: 'Conclu√≠do' },\r\n    ] as const;\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} maxWidth=\"lg\">\r\n            <div className=\"p-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <h2 className=\"text-2xl font-bold text-white\">Novo Projeto</h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"text-slate-400 hover:text-white transition-colors\"\r\n                    >\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Form */}\r\n                <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n                    {/* Icon & Title */}\r\n                    <div className=\"flex gap-3\">\r\n                        <div className=\"w-[120px] flex-shrink-0\">\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                √çcone\r\n                            </label>\r\n                            <SymbolPicker\r\n                                value={icon}\r\n                                onChange={setIcon}\r\n                                placeholder=\"üìÅ\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                Nome do Projeto\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={title}\r\n                                onChange={(e) => setTitle(e.target.value)}\r\n                                placeholder=\"Ex: App de Finan√ßas\"\r\n                                className=\"w-full h-[40px] bg-slate-900/50 border border-slate-700 rounded-lg px-4 text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none transition-all\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Description */}\r\n                    <textarea\r\n                        value={description}\r\n                        onChange={(e) => setDescription(e.target.value)}\r\n                        placeholder=\"Descri√ß√£o (opcional)\"\r\n                        className=\"w-full bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none resize-none\"\r\n                        rows={3}\r\n                    />\r\n\r\n                    {/* Category & Status */}\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                Categoria\r\n                            </label>\r\n                            <div className=\"grid grid-cols-3 gap-2\">\r\n                                {categoryOptions.map(opt => (\r\n                                    <button\r\n                                        key={opt.value}\r\n                                        type=\"button\"\r\n                                        onClick={() => setCategory(opt.value)}\r\n                                        className={`p-2 rounded-lg text-xs font-medium transition-all ${category === opt.value\r\n                                            ? 'bg-blue-500 text-white'\r\n                                            : 'bg-slate-800 text-slate-400 hover:bg-slate-700'\r\n                                            }`}\r\n                                    >\r\n                                        <div className=\"text-lg mb-1\">{opt.icon}</div>\r\n                                        {opt.label}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                Status Inicial\r\n                            </label>\r\n                            <select\r\n                                value={status}\r\n                                onChange={(e) => setStatus(e.target.value as Project['status'])}\r\n                                className=\"w-full bg-slate-900/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none\"\r\n                            >\r\n                                {statusOptions.map(opt => (\r\n                                    <option key={opt.value} value={opt.value}>\r\n                                        {opt.label}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Dates */}\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                Data de In√≠cio\r\n                            </label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={startDate}\r\n                                onChange={(e) => setStartDate(e.target.value)}\r\n                                className=\"w-full bg-slate-900/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-2\">\r\n                                Deadline\r\n                            </label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={deadline}\r\n                                onChange={(e) => setDeadline(e.target.value)}\r\n                                className=\"w-full bg-slate-900/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-3 pt-4\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 px-4 py-2 rounded-lg text-slate-400 hover:text-white transition-colors\"\r\n                        >\r\n                            Cancelar\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={!title.trim()}\r\n                            className=\"flex-1 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-bold transition-all flex items-center justify-center gap-2\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            Criar Projeto\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\projects\\components\\ProjectCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport type { Project } from '../../../types';\r\nimport { Calendar, CheckCircle2, Link2, Target } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface ProjectCardProps {\r\n    project: Project;\r\n    onClick: () => void;\r\n}\r\n\r\nexport const ProjectCard: React.FC<ProjectCardProps> = ({ project, onClick }) => {\r\n    const statusConfig = {\r\n        planning: { label: 'Planejando', color: 'bg-slate-500/20 text-slate-300', dot: 'bg-slate-500' },\r\n        active: { label: 'Ativo', color: 'bg-blue-500/20 text-blue-300', dot: 'bg-blue-500' },\r\n        paused: { label: 'Pausado', color: 'bg-amber-500/20 text-amber-300', dot: 'bg-amber-500' },\r\n        completed: { label: 'Conclu√≠do', color: 'bg-emerald-500/20 text-emerald-300', dot: 'bg-emerald-500' },\r\n    };\r\n\r\n    const categoryConfig = {\r\n        professional: { label: 'Profissional', icon: 'üíº' },\r\n        personal: { label: 'Pessoal', icon: 'üè†' },\r\n        academic: { label: 'Acad√™mico', icon: 'üéì' },\r\n    };\r\n\r\n    const status = statusConfig[project.status];\r\n    const category = categoryConfig[project.category];\r\n    const completedMilestones = project.milestones.filter(m => m.completed).length;\r\n\r\n    return (\r\n        <div\r\n            onClick={onClick}\r\n            className=\"bg-slate-900/40 hover:bg-slate-800/50 border border-slate-800/50 rounded-2xl p-6 cursor-pointer transition-all hover:scale-[1.02] hover:shadow-xl group\"\r\n        >\r\n            {/* Header */}\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"text-3xl\">\r\n                        <IconRenderer icon={project.icon || category.icon} size={32} className=\"text-white\" />\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"text-white font-bold text-lg group-hover:text-blue-300 transition-colors\">\r\n                            {project.title}\r\n                        </h3>\r\n                        <p className=\"text-slate-400 text-xs mt-0.5\">{category.label}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={`px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1.5 ${status.color}`}>\r\n                    <div className={`w-2 h-2 rounded-full ${status.dot} animate-pulse`} />\r\n                    {status.label}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Description */}\r\n            {project.description && (\r\n                <p className=\"text-slate-400 text-sm mb-4 line-clamp-2\">\r\n                    {project.description}\r\n                </p>\r\n            )}\r\n\r\n            {/* Progress Bar */}\r\n            <div className=\"mb-4\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                    <span className=\"text-xs text-slate-500\">Progresso</span>\r\n                    <span className=\"text-xs font-bold text-blue-400\">{project.progress}%</span>\r\n                </div>\r\n                <div className=\"h-2 bg-slate-800 rounded-full overflow-hidden\">\r\n                    <div\r\n                        className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500\"\r\n                        style={{ width: `${project.progress}%` }}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Metadata */}\r\n            <div className=\"flex items-center gap-4 text-xs text-slate-500\">\r\n                {project.milestones.length > 0 && (\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <CheckCircle2 className=\"w-4 h-4\" />\r\n                        <span>{completedMilestones}/{project.milestones.length} marcos</span>\r\n                    </div>\r\n                )}\r\n\r\n                {(project.linkedTaskIds.length > 0 || project.linkedGoalIds.length > 0) && (\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <Link2 className=\"w-4 h-4\" />\r\n                        <span>{project.linkedTaskIds.length + project.linkedGoalIds.length} vinculados</span>\r\n                    </div>\r\n                )}\r\n\r\n                {project.deadline && (\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <Calendar className=\"w-4 h-4\" />\r\n                        <span>{format(new Date(project.deadline), \"d 'de' MMM\", { locale: ptBR })}</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\settings\\Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'themes' is assigned a value but never used.","line":14,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'tasks' is assigned a value but never used.","line":14,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'goals' is assigned a value but never used.","line":14,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'studyGamification' is assigned a value but never used.","line":14,"column":82,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":99},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'zenMode' is assigned a value but never used.","line":14,"column":101,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":108},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\settings\\Settings.tsx:29:36\n  27 |\n  28 |     useEffect(() => {\n> 29 |         if (profile?.display_name) setDisplayName((profile.display_name as string) ?? '');\n     |                                    ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |         if (profile?.avatar_url) setAvatarUrl((profile.avatar_url as string) ?? '');\n  31 |         if (settings) {\n  32 |             setFocusDuration(settings.focusDuration);","line":29,"column":36,"nodeType":null,"endLine":29,"endColumn":50}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { usePomodoroContext } from '../../context/PomodoroContext';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { User, Timer, Save, Trash2, ShieldAlert, RefreshCw } from 'lucide-react';\r\nimport { Card } from '../../components/ui/Card';\r\nimport { ConfirmationModal } from '../../components/ui/ConfirmationModal';\r\nimport { ImageUpload } from '../../components/forms/ImageUpload';\r\nimport { BackupSection } from '../../components/settings/BackupSection';\r\n\r\nexport const Settings = () => {\r\n    const { user, profile, updateProfile } = useAuth();\r\n    const { settings, updateSettings } = usePomodoroContext();\r\n    const { resetAccount, resetGamification, themes, tasks, goals, gamification: studyGamification, zenMode } = useStudy();\r\n\r\n    // Local state for form inputs\r\n    const [displayName, setDisplayName] = useState('');\r\n    const [avatarUrl, setAvatarUrl] = useState('');\r\n    const [focusDuration, setFocusDuration] = useState(25);\r\n    const [shortBreak, setShortBreak] = useState(5);\r\n    const [longBreak, setLongBreak] = useState(15);\r\n    const [strictMode, setStrictMode] = useState(false);\r\n    const [isSaved, setIsSaved] = useState(false);\r\n    const [isDangerModalOpen, setIsDangerModalOpen] = useState(false);\r\n    const [isResetGamificationModalOpen, setIsResetGamificationModalOpen] = useState(false);\r\n\r\n\r\n    useEffect(() => {\r\n        if (profile?.display_name) setDisplayName((profile.display_name as string) ?? '');\r\n        if (profile?.avatar_url) setAvatarUrl((profile.avatar_url as string) ?? '');\r\n        if (settings) {\r\n            setFocusDuration(settings.focusDuration);\r\n            setShortBreak(settings.shortBreakDuration);\r\n            setLongBreak(settings.longBreakDuration);\r\n            setStrictMode(settings.strictMode || false);\r\n        }\r\n    }, [profile, settings]);\r\n\r\n    const handleSaveProfile = async () => {\r\n        await updateProfile({\r\n            display_name: displayName,\r\n            avatar_url: avatarUrl\r\n        });\r\n        setIsSaved(true);\r\n        setTimeout(() => setIsSaved(false), 2000);\r\n    };\r\n\r\n    const handleSaveTimer = () => {\r\n        updateSettings({\r\n            focusDuration,\r\n            shortBreakDuration: shortBreak,\r\n            longBreakDuration: longBreak,\r\n            strictMode\r\n        });\r\n        setIsSaved(true);\r\n        setTimeout(() => setIsSaved(false), 2000);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-4xl mx-auto pb-20 fade-in\">\r\n            <header className=\"mb-8\">\r\n                <h1 className=\"text-3xl font-black text-white tracking-tight\">Configura√ß√µes</h1>\r\n                <p className=\"text-slate-400 mt-1\">Personalize sua experi√™ncia de estudos.</p>\r\n            </header>\r\n\r\n            {/* Profile Section */}\r\n            <section className=\"space-y-4\">\r\n                <h2 className=\"text-lg font-bold text-slate-200 flex items-center gap-2\">\r\n                    <User className=\"w-5 h-5 text-blue-400\" />\r\n                    Perfil\r\n                </h2>\r\n                <Card className=\"bg-slate-900/50 border-slate-800\">\r\n                    <div className=\"flex flex-col md:flex-row gap-8 items-start\">\r\n                        {/* 1. Avatar Column */}\r\n                        <div className=\"flex flex-col items-center gap-3 shrink-0 mx-auto md:mx-0\">\r\n                            <div className=\"relative group\">\r\n                                <div className=\"w-24 h-24 rounded-full overflow-hidden border-2 border-slate-700 shadow-xl bg-slate-800\">\r\n                                    {profile?.avatar_url || avatarUrl ? (\r\n                                        <img\r\n                                            src={avatarUrl || (profile?.avatar_url as string) || ''}\r\n                                            alt=\"Profile\"\r\n                                            className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110\"\r\n                                        />\r\n                                    ) : (\r\n                                        <div className=\"w-full h-full flex items-center justify-center text-3xl font-bold text-slate-500\">\r\n                                            {displayName ? displayName[0].toUpperCase() : user?.email?.[0].toUpperCase()}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                {/* Overlay for Upload */}\r\n                                <div className=\"absolute inset-0 rounded-full bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center backdrop-blur-sm cursor-pointer border-2 border-white/20\">\r\n                                    <ImageUpload value={avatarUrl} onChange={setAvatarUrl} />\r\n                                </div>\r\n                            </div>\r\n                            <span className=\"text-[10px] uppercase font-bold text-slate-500 tracking-wider\">Foto de Perfil</span>\r\n                        </div>\r\n\r\n                        {/* 2. Info Column */}\r\n                        <div className=\"flex-1 space-y-5 w-full\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                                <div className=\"space-y-1.5\">\r\n                                    <label className=\"text-xs font-bold text-slate-500 uppercase flex items-center gap-2\">\r\n                                        Nome de Exibi√ß√£o\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={displayName}\r\n                                        onChange={(e) => setDisplayName(e.target.value)}\r\n                                        className=\"bg-slate-950 border border-slate-700 rounded-lg px-4 py-2.5 text-white w-full focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 focus:outline-none transition-all\"\r\n                                        placeholder=\"Como voc√™ quer ser chamado?\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1.5 opacity-60 pointer-events-none select-none\">\r\n                                    <label className=\"text-xs font-bold text-slate-500 uppercase flex items-center gap-2\">\r\n                                        Email (N√£o edit√°vel)\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={user?.email}\r\n                                        readOnly\r\n                                        className=\"bg-slate-900/50 border border-slate-800 rounded-lg px-4 py-2.5 text-slate-400 w-full cursor-not-allowed\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end pt-2\">\r\n                                <button\r\n                                    onClick={handleSaveProfile}\r\n                                    disabled={!displayName.trim()}\r\n                                    className=\"bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2.5 rounded-lg font-bold text-sm transition-all flex items-center gap-2 shadow-lg shadow-blue-500/20 active:translate-y-0.5\"\r\n                                >\r\n                                    <Save className=\"w-4 h-4\" />\r\n                                    Salvar Altera√ß√µes\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n            </section>\r\n\r\n            {/* Timer Section */}\r\n            <section className=\"space-y-4\">\r\n                <h2 className=\"text-lg font-bold text-slate-200 flex items-center gap-2\">\r\n                    <Timer className=\"w-5 h-5 text-amber-400\" />\r\n                    Foco & Pomodoro\r\n                </h2>\r\n                <Card className=\"bg-slate-900/50 border-slate-800\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-slate-500 uppercase block mb-2\">Foco (min)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={focusDuration}\r\n                                onChange={(e) => setFocusDuration(Number(e.target.value))}\r\n                                className=\"bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white w-full font-mono text-lg focus:border-amber-500 focus:outline-none\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-slate-500 uppercase block mb-2\">Pausa Curta (min)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={shortBreak}\r\n                                onChange={(e) => setShortBreak(Number(e.target.value))}\r\n                                className=\"bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white w-full font-mono text-lg focus:border-amber-500 focus:outline-none\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-slate-500 uppercase block mb-2\">Pausa Longa (min)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={longBreak}\r\n                                onChange={(e) => setLongBreak(Number(e.target.value))}\r\n                                className=\"bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white w-full font-mono text-lg focus:border-amber-500 focus:outline-none\"\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-slate-500 uppercase block mb-2\">Modo Strict</label>\r\n                            <div className=\"flex items-center gap-3 mt-2\">\r\n                                <button\r\n                                    onClick={() => setStrictMode(!strictMode)}\r\n                                    className={`w-12 h-6 rounded-full p-1 transition-colors ${strictMode ? 'bg-amber-600' : 'bg-slate-700'}`}\r\n                                >\r\n                                    <div className={`w-4 h-4 bg-white rounded-full transition-transform ${strictMode ? 'translate-x-6' : 'translate-x-0'}`} />\r\n                                </button>\r\n                                <span className=\"text-xs text-slate-400\">\r\n                                    {strictMode ? 'Ativado (Esconde Menu)' : 'Desativado'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end\">\r\n                        <button\r\n                            onClick={handleSaveTimer}\r\n                            className=\"bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg font-bold transition-all flex items-center gap-2\"\r\n                        >\r\n                            <Save className=\"w-4 h-4\" />\r\n                            Atualizar Timer\r\n                        </button>\r\n                    </div>\r\n                </Card>\r\n            </section>\r\n\r\n            {/* Data Management Section */}\r\n            <section className=\"space-y-4\">\r\n                <h2 className=\"text-lg font-bold text-slate-200 flex items-center gap-2\">\r\n                    <Timer className=\"w-5 h-5 text-emerald-400\" />\r\n                    Dados e Backup\r\n                </h2>\r\n                <BackupSection />\r\n            </section>\r\n\r\n            {/* Danger Zone */}\r\n            <section className=\"space-y-4 opacity-80 hover:opacity-100 transition-opacity\">\r\n                <h2 className=\"text-lg font-bold text-red-400 flex items-center gap-2\">\r\n                    <ShieldAlert className=\"w-5 h-5\" />\r\n                    Zona de Perigo\r\n                </h2>\r\n                <Card className=\"bg-red-950/10 border-red-900/30 border-dashed\">\r\n                    <div className=\"flex flex-col gap-6\">\r\n                        {/* Reset Gamification */}\r\n                        <div className=\"flex items-center justify-between pb-6 border-b border-red-900/30\">\r\n                            <div>\r\n                                <h3 className=\"font-bold text-red-200\">Resetar Gamifica√ß√£o</h3>\r\n                                <p className=\"text-xs text-red-300/60 mt-1\">\r\n                                    Zera seu N√≠vel, XP e Conquistas, mas <span className=\"text-red-300 font-bold\">MANT√âM</span> seus temas e tarefas.\r\n                                </p>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setIsResetGamificationModalOpen(true)}\r\n                                className=\"bg-red-950 hover:bg-red-900 text-red-400 border border-red-800 px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2\"\r\n                            >\r\n                                <RefreshCw className=\"w-4 h-4\" />\r\n                                Resetar XP\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Reset All */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <h3 className=\"font-bold text-red-200\">Zerar Tudo (Come√ßar do Zero)</h3>\r\n                                <p className=\"text-xs text-red-300/60 mt-1\">\r\n                                    Apaga permanentemente: <span className=\"font-bold text-red-400\">Metas, Calend√°rio e Tarefas</span>.\r\n                                </p>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setIsDangerModalOpen(true)}\r\n                                className=\"bg-red-950 hover:bg-red-900 text-red-400 border border-red-800 px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2\"\r\n                            >\r\n                                <Trash2 className=\"w-4 h-4\" />\r\n                                Zerar Tudo\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n            </section>\r\n\r\n            {isSaved && (\r\n                <div className=\"fixed bottom-8 right-8 bg-emerald-500 text-white px-6 py-3 rounded-xl shadow-lg shadow-emerald-500/20 font-bold animate-in slide-in-from-bottom-5 fade-in\">\r\n                    Altera√ß√µes salvas!\r\n                </div>\r\n            )}\r\n\r\n            <ConfirmationModal\r\n                isOpen={isDangerModalOpen}\r\n                onClose={() => setIsDangerModalOpen(false)}\r\n                onConfirm={() => {\r\n                    resetAccount();\r\n                    setIsDangerModalOpen(false);\r\n                }}\r\n                title=\"Zerar Tudo?\"\r\n                description=\"Voc√™ est√° prestes a apagar TODAS as suas Metas, Itens do Calend√°rio e Tarefas. Esta a√ß√£o √© irrevers√≠vel. Tem certeza que deseja recome√ßar do zero?\"\r\n                confirmText=\"Sim, Zerar Tudo\"\r\n                type=\"danger\"\r\n            />\r\n\r\n            <ConfirmationModal\r\n                isOpen={isResetGamificationModalOpen}\r\n                onClose={() => setIsResetGamificationModalOpen(false)}\r\n                onConfirm={async () => {\r\n                    await resetGamification();\r\n                    setIsResetGamificationModalOpen(false);\r\n                }}\r\n                title=\"Resetar Apenas Gamifica√ß√£o?\"\r\n                description=\"Voc√™ voltar√° para o N√≠vel 1 com 0 XP. Suas conquistas ser√£o bloqueadas novamente. Seus temas e tarefas N√ÉO ser√£o apagados.\"\r\n                confirmText=\"Sim, Zerar meu XP\"\r\n                type=\"danger\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\study\\StudySession.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\study\\StudySession.tsx:39:13\n  37 |\n  38 |         if (found) {\n> 39 |             setSubtheme(found);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  40 |             setThemeColor(color);\n  41 |         }\n  42 |     }, [subthemeId, themes]);","line":39,"column":13,"nodeType":null,"endLine":39,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'grade' is defined but never used.","line":48,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":37}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { Flashcard } from './components/Flashcard';\r\nimport { StudyControls } from './components/StudyControls';\r\nimport { ArrowLeft, Loader2, Award } from 'lucide-react';\r\n\r\ninterface StudySessionProps {\r\n    subthemeId: string;\r\n    onExit: () => void;\r\n}\r\n\r\nexport const StudySession: React.FC<StudySessionProps> = ({ subthemeId, onExit }) => {\r\n    const { themes, completeReview } = useStudy();\r\n\r\n    // State\r\n    const [isFlipped, setIsFlipped] = useState(false);\r\n    const [subtheme, setSubtheme] = useState<any>(null);\r\n    const [themeColor, setThemeColor] = useState('#3b82f6');\r\n    const [isCompleted, setIsCompleted] = useState(false);\r\n\r\n    // Load Subtheme\r\n    useEffect(() => {\r\n        if (!subthemeId || themes.length === 0) return;\r\n\r\n        // Find subs in themes\r\n        let found = null;\r\n        let color = '#3b82f6';\r\n\r\n        for (const t of themes) {\r\n            const s = t.subthemes.find(sub => sub.id === subthemeId);\r\n            if (s) {\r\n                found = s;\r\n                color = t.color || '#3b82f6';\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (found) {\r\n            setSubtheme(found);\r\n            setThemeColor(color);\r\n        }\r\n    }, [subthemeId, themes]);\r\n\r\n    const handleFlip = () => {\r\n        setIsFlipped(!isFlipped);\r\n    };\r\n\r\n    const handleGrade = async (grade: 'bad' | 'hard' | 'good' | 'easy') => {\r\n        if (!subtheme) return;\r\n\r\n        // In future: pass grade to algorithm\r\n        await completeReview(subtheme.id, subtheme.reviews, 'review');\r\n\r\n        setIsCompleted(true);\r\n        // Delay to exit\r\n        setTimeout(() => {\r\n            onExit();\r\n        }, 1500);\r\n    };\r\n\r\n    if (!subtheme) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-screen bg-slate-950\">\r\n                <Loader2 className=\"w-8 h-8 text-blue-500 animate-spin\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (isCompleted) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center h-screen bg-slate-950 animate-in fade-in duration-500 relative z-50\">\r\n                <div className=\"w-24 h-24 bg-emerald-500/20 rounded-full flex items-center justify-center mb-6 ring-4 ring-emerald-500/10 animate-bounce\">\r\n                    <Award className=\"w-12 h-12 text-emerald-400\" />\r\n                </div>\r\n                <h2 className=\"text-3xl font-bold text-white mb-2\">Excelente!</h2>\r\n                <p className=\"text-slate-400\">Revis√£o conclu√≠da com sucesso.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex flex-col h-screen bg-slate-950 relative overflow-hidden animate-in zoom-in-95 duration-300\">\r\n            {/* Zen Background */}\r\n            <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5 mix-blend-overlay pointer-events-none\" />\r\n            <div\r\n                className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] blur-[120px] opacity-20 pointer-events-none transition-colors duration-1000\"\r\n                style={{ backgroundColor: themeColor }}\r\n            />\r\n\r\n            {/* Header */}\r\n            <header className=\"flex items-center justify-between p-6 relative z-10\">\r\n                <button\r\n                    onClick={onExit}\r\n                    className=\"p-2 text-slate-400 hover:text-white hover:bg-slate-800/50 rounded-xl transition-all\"\r\n                >\r\n                    <ArrowLeft className=\"w-6 h-6\" />\r\n                </button>\r\n                <div className=\"flex flex-col items-center\">\r\n                    <span className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Revis√£o</span>\r\n                </div>\r\n                <div className=\"w-10\" />\r\n            </header>\r\n\r\n            {/* Main Stage */}\r\n            <main className=\"flex-1 flex flex-col items-center justify-center p-6 relative z-10 pb-20\">\r\n                <Flashcard\r\n                    frontContent={subtheme.title}\r\n                    backContent={subtheme.text_content || \"Sem descri√ß√£o dispon√≠vel para estudo.\"}\r\n                    isFlipped={isFlipped}\r\n                    onFlip={handleFlip}\r\n                />\r\n            </main>\r\n\r\n            {/* Controls */}\r\n            <footer className=\"fixed bottom-0 w-full p-8 pb-12 flex justify-center bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent pointer-events-none\">\r\n                <div className=\"pointer-events-auto\">\r\n                    <StudyControls\r\n                        isVisible={isFlipped}\r\n                        onGrade={handleGrade}\r\n                    />\r\n                </div>\r\n            </footer>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\study\\components\\Flashcard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { cn } from '../../../lib/utils'; // Assuming global utils path\r\nimport DOMPurify from 'dompurify';\r\n\r\ninterface FlashcardProps {\r\n    frontContent: string;\r\n    backContent: string;\r\n    isFlipped: boolean;\r\n    onFlip: () => void;\r\n}\r\n\r\nexport const Flashcard: React.FC<FlashcardProps> = ({ frontContent, backContent, isFlipped, onFlip }) => {\r\n    return (\r\n        <div\r\n            className=\"perspective-1000 w-full max-w-2xl h-96 cursor-pointer group\"\r\n            onClick={onFlip}\r\n        >\r\n            <div className={cn(\r\n                \"relative w-full h-full transition-all duration-500 transform-style-3d\",\r\n                isFlipped ? \"rotate-y-180\" : \"\"\r\n            )}>\r\n                {/* Front */}\r\n                <div className=\"absolute w-full h-full backface-hidden\">\r\n                    <div className=\"w-full h-full bg-slate-900 border-2 border-slate-700/50 rounded-3xl flex flex-col items-center justify-center p-8 shadow-2xl hover:border-slate-600 transition-colors\">\r\n                        <span className=\"text-sm font-bold text-slate-500 uppercase tracking-[0.2em] mb-4\">Pergunta</span>\r\n                        <h2 className=\"text-3xl md:text-4xl font-bold text-center text-slate-100 leading-tight\">\r\n                            {frontContent}\r\n                        </h2>\r\n                        <span className=\"absolute bottom-8 text-xs text-slate-600 animate-pulse\">Toque para virar</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Back */}\r\n                <div className=\"absolute w-full h-full backface-hidden rotate-y-180\">\r\n                    <div className=\"w-full h-full bg-gradient-to-br from-blue-900/40 to-slate-900 border-2 border-blue-500/30 rounded-3xl flex flex-col items-center justify-center p-8 shadow-[0_0_30px_rgba(59,130,246,0.1)]\">\r\n                        <span className=\"text-sm font-bold text-blue-400 uppercase tracking-[0.2em] mb-4\">Resposta</span>\r\n                        <div\r\n                            className=\"text-xl md:text-2xl text-center text-slate-200 leading-relaxed overflow-y-auto max-h-full custom-scrollbar prose prose-invert\"\r\n                            dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(backContent) }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\study\\components\\StudyControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\summaries\\SummariesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Sparkles' is defined but never used.","line":2,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { FileText, Sparkles, Calendar as CalendarIcon, Filter } from 'lucide-react';\r\nimport { useStudy } from '../../context/StudyContext';\r\nimport { Timeline } from '../../components/timeline';\r\nimport type { SummaryEntry } from '../../types';\r\n\r\nexport const SummariesPage: React.FC = () => {\r\n    const { goals, themes, tasks } = useStudy();\r\n    const [filterType, setFilterType] = React.useState<SummaryEntry['type'] | 'all'>('all');\r\n    const [searchTerm, setSearchTerm] = React.useState('');\r\n\r\n    // Collect all summaries from all sources\r\n    const allSummaries = useMemo(() => {\r\n        const summaries: SummaryEntry[] = [];\r\n\r\n        // Track source type for each entry if not already in metadata\r\n        tasks.forEach(task => {\r\n            if (task.summaries) {\r\n                task.summaries.forEach(s => {\r\n                    summaries.push({\r\n                        ...s,\r\n                        metadata: {\r\n                            ...s.metadata,\r\n                            entityId: s.metadata?.entityId || task.id,\r\n                            entityType: s.metadata?.entityType || 'task',\r\n                            entityTitle: s.metadata?.entityTitle || task.title,\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        goals.forEach(goal => {\r\n            if (goal.summaries) {\r\n                goal.summaries.forEach(s => {\r\n                    summaries.push({\r\n                        ...s,\r\n                        metadata: {\r\n                            ...s.metadata,\r\n                            entityId: s.metadata?.entityId || goal.id,\r\n                            entityType: s.metadata?.entityType || 'goal',\r\n                            entityTitle: s.metadata?.entityTitle || goal.title,\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        themes.forEach(theme => {\r\n            const themeType = theme.category === 'project' ? 'project' : 'theme';\r\n            if (theme.summaries) {\r\n                theme.summaries.forEach(s => {\r\n                    summaries.push({\r\n                        ...s,\r\n                        metadata: {\r\n                            ...s.metadata,\r\n                            entityId: s.metadata?.entityId || theme.id,\r\n                            entityType: s.metadata?.entityType || themeType,\r\n                            entityTitle: s.metadata?.entityTitle || theme.title,\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            theme.subthemes.forEach(subtheme => {\r\n                if (subtheme.summaries) {\r\n                    subtheme.summaries.forEach(s => {\r\n                        summaries.push({\r\n                            ...s,\r\n                            metadata: {\r\n                                ...s.metadata,\r\n                                entityId: s.metadata?.entityId || subtheme.id,\r\n                                entityType: s.metadata?.entityType || themeType,\r\n                                entityTitle: s.metadata?.entityTitle || subtheme.title,\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        return summaries.sort((a, b) =>\r\n            new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\r\n        );\r\n    }, [tasks, goals, themes]);\r\n\r\n    // Update filter logic to use entityType\r\n    const [entityFilter, setEntityFilter] = React.useState<NonNullable<SummaryEntry['metadata']>['entityType'] | 'all'>('all');\r\n\r\n    const filteredSummaries = useMemo(() => {\r\n        let filtered = allSummaries;\r\n\r\n        if (entityFilter !== 'all') {\r\n            filtered = filtered.filter(s => s.metadata?.entityType === entityFilter);\r\n        }\r\n\r\n        if (filterType !== 'all') {\r\n            filtered = filtered.filter(s => s.type === filterType);\r\n        }\r\n\r\n        if (searchTerm.trim()) {\r\n            const term = searchTerm.toLowerCase();\r\n            filtered = filtered.filter(s =>\r\n                s.title?.toLowerCase().includes(term) ||\r\n                s.description?.toLowerCase().includes(term) ||\r\n                s.metadata?.entityTitle?.toLowerCase().includes(term)\r\n            );\r\n        }\r\n\r\n        return filtered;\r\n    }, [allSummaries, entityFilter, filterType, searchTerm]);\r\n\r\n    const counts = useMemo(() => {\r\n        return {\r\n            all: allSummaries.length,\r\n            task: allSummaries.filter(s => s.metadata?.entityType === 'task').length,\r\n            goal: allSummaries.filter(s => s.metadata?.entityType === 'goal').length,\r\n            theme: allSummaries.filter(s => s.metadata?.entityType === 'theme').length,\r\n            project: allSummaries.filter(s => s.metadata?.entityType === 'project').length,\r\n        };\r\n    }, [allSummaries]);\r\n\r\n    const entityButtons = [\r\n        { type: 'all' as const, label: 'Todos', color: 'from-slate-500 to-slate-600', bgColor: 'bg-slate-500/10', borderColor: 'border-slate-500/30' },\r\n        { type: 'goal' as const, label: 'Metas', color: 'from-blue-500 to-blue-600', bgColor: 'bg-blue-500/10', borderColor: 'border-blue-500/30' },\r\n        { type: 'task' as const, label: 'Tarefas', color: 'from-purple-500 to-purple-600', bgColor: 'bg-purple-500/10', borderColor: 'border-purple-500/30' },\r\n        { type: 'theme' as const, label: 'Temas', color: 'from-orange-500 to-orange-600', bgColor: 'bg-orange-500/10', borderColor: 'border-orange-500/30' },\r\n        { type: 'project' as const, label: 'Projetos', color: 'from-green-500 to-green-600', bgColor: 'bg-green-500/10', borderColor: 'border-green-500/30' },\r\n    ];\r\n\r\n    const filterButtons: { type: SummaryEntry['type'] | 'all', label: string }[] = [\r\n        { type: 'all', label: 'Todos os tipos' },\r\n        { type: 'review', label: 'Revis√µes' },\r\n        { type: 'session', label: 'Sess√µes de Foco' },\r\n        { type: 'goal', label: 'Progresso' },\r\n        { type: 'completion', label: 'Conclus√µes' },\r\n        { type: 'note', label: 'Notas' }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-full min-h-screen relative pb-32\">\r\n            {/* Animated Background */}\r\n            <div className=\"absolute inset-0 opacity-30 pointer-events-none overflow-hidden\">\r\n                <div className=\"absolute top-0 -left-4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob\" />\r\n                <div className=\"absolute top-0 -right-4 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000\" />\r\n                <div className=\"absolute -bottom-8 left-20 w-96 h-96 bg-orange-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000\" />\r\n            </div>\r\n\r\n            <div className=\"relative z-10 max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <div className=\"flex items-center gap-3 mb-6\">\r\n                        <div className=\"w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500/20 to-blue-500/20 border border-purple-500/30 flex items-center justify-center backdrop-blur-xl shadow-lg shadow-purple-900/20\">\r\n                            <FileText className=\"w-6 h-6 text-purple-400\" />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-3xl md:text-4xl font-bold bg-gradient-to-r from-white via-purple-200 to-blue-200 bg-clip-text text-transparent\">\r\n                                Resumos & Hist√≥rico\r\n                            </h1>\r\n                            <p className=\"text-slate-400 text-sm md:text-base\">\r\n                                Acompanhe todas as suas atividades e conquistas\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Entity Boxes - Main Categories */}\r\n                    <div className=\"bg-slate-800/40 backdrop-blur-xl border border-slate-700/50 rounded-[2.5rem] p-8 mb-8 shadow-2xl\">\r\n                        <h3 className=\"text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 px-2\">Categorias de Hist√≥rico</h3>\r\n                        <div className=\"grid grid-cols-2 lg:grid-cols-5 gap-6\">\r\n                            {entityButtons.map((btn) => {\r\n                                const count = counts[btn.type as keyof typeof counts] || (btn.type === 'all' ? counts.all : 0);\r\n                                const isActive = entityFilter === btn.type;\r\n\r\n                                return (\r\n                                    <button\r\n                                        key={btn.type}\r\n                                        onClick={() => setEntityFilter(btn.type)}\r\n                                        className={`\r\n                                            relative p-6 rounded-[2rem] border transition-all duration-300 group\r\n                                            ${isActive\r\n                                                ? `${btn.bgColor} ${btn.borderColor} scale-105 shadow-xl`\r\n                                                : 'bg-slate-900/40 border-white/5 hover:bg-slate-800/60'\r\n                                            }\r\n                                        `}\r\n                                    >\r\n                                        <div className=\"relative flex flex-col items-center\">\r\n                                            <div className={`\r\n                                                text-3xl font-black mb-2 transition-transform duration-300 group-hover:scale-110\r\n                                                ${isActive ? 'bg-gradient-to-r ' + btn.color + ' bg-clip-text text-transparent' : 'text-slate-300'}\r\n                                            `}>\r\n                                                {count}\r\n                                            </div>\r\n                                            <div className={`text-sm font-bold tracking-wide uppercase ${isActive ? 'text-white' : 'text-slate-500'}`}>\r\n                                                {btn.label}\r\n                                            </div>\r\n                                        </div>\r\n                                    </button>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Filter Bar & Search */}\r\n                    <div className=\"flex flex-col md:flex-row gap-4 items-center\">\r\n                        <div className=\"flex flex-wrap gap-2 flex-1\">\r\n                            {filterButtons.map(btn => (\r\n                                <button\r\n                                    key={btn.type}\r\n                                    onClick={() => setFilterType(filterType === btn.type ? 'all' : btn.type)}\r\n                                    className={`\r\n                                        px-4 py-2 rounded-full text-xs font-bold transition-all\r\n                                        ${filterType === btn.type\r\n                                            ? 'bg-white text-slate-900 shadow-lg'\r\n                                            : 'bg-slate-800/50 text-slate-400 border border-white/5 hover:bg-slate-700/50'}\r\n                                    `}\r\n                                >\r\n                                    {btn.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"relative w-full md:w-96\">\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Buscar em resumos...\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                className=\"w-full bg-slate-800/40 backdrop-blur-xl border border-white/5 rounded-2xl py-3 px-4 pl-12 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all shadow-lg\"\r\n                            />\r\n                            <Filter className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Timeline Box */}\r\n                <div className=\"bg-slate-800/40 backdrop-blur-xl border border-slate-700/50 rounded-[2.5rem] p-10 shadow-2xl\">\r\n                    <div className=\"flex items-center gap-4 mb-10 pb-6 border-b border-white/5\">\r\n                        <div className=\"w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center shadow-lg\">\r\n                            <CalendarIcon className=\"w-7 h-7 text-purple-400\" />\r\n                        </div>\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-black text-white tracking-tight\">Timeline de Atividades</h2>\r\n                            <p className=\"text-slate-400 font-medium\">\r\n                                {filteredSummaries.length > 0\r\n                                    ? `${filteredSummaries.length} ${filteredSummaries.length === 1 ? 'evento encontrado' : 'eventos encontrados'}`\r\n                                    : 'Nenhum evento encontrado'\r\n                                }\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Timeline\r\n                        items={filteredSummaries}\r\n                        emptyMessage={searchTerm ? 'Nenhum resultado encontrado' : 'Suas atividades aparecer√£o aqui automaticamente'}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Custom Styles */}\r\n            <style>{`\r\n                @keyframes blob {\r\n                    0%, 100% { transform: translate(0, 0) scale(1); }\r\n                    25% { transform: translate(20px, -50px) scale(1.1); }\r\n                    50% { transform: translate(-20px, 20px) scale(0.9); }\r\n                    75% { transform: translate(50px, 50px) scale(1.05); }\r\n                }\r\n                .animate-blob {\r\n                    animation: blob 7s infinite;\r\n                }\r\n                .animation-delay-2000 {\r\n                    animation-delay: 2s;\r\n                }\r\n                .animation-delay-4000 {\r\n                    animation-delay: 4s;\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\tasks\\components\\TaskDetailsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { CheckSquare, Clock, Calendar, Trophy, PlayCircle, Activity, FileText } from 'lucide-react';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Task } from '../../../types';\r\nimport SummaryTimeline from '../../../components/ui/SummaryTimeline';\r\nimport { usePomodoroContext } from '../../../context/PomodoroContext';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface TaskDetailsModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    task: Task | null;\r\n}\r\n\r\nexport const TaskDetailsModal: React.FC<TaskDetailsModalProps> = ({ isOpen, onClose, task }) => {\r\n    const { startFocus } = useStudy();\r\n    const { startFocusSession } = usePomodoroContext();\r\n\r\n    if (!task) return null;\r\n\r\n    const isCompleted = task.status === 'completed';\r\n    const isPeriod = task.type === 'period';\r\n    const isRecurring = task.type === 'recurring';\r\n\r\n    const colorScheme = isCompleted\r\n        ? {\r\n            text: 'text-emerald-400',\r\n            bg: 'bg-emerald-500/10',\r\n            border: 'border-emerald-500/20',\r\n            gradient: 'from-emerald-600 to-emerald-400'\r\n        }\r\n        : {\r\n            text: 'text-blue-400',\r\n            bg: 'bg-blue-500/10',\r\n            border: 'border-blue-500/20',\r\n            gradient: 'from-blue-600 to-indigo-600'\r\n        };\r\n\r\n    const handleStartFocus = () => {\r\n        const duration = task.durationMinutes || 25;\r\n        startFocus(task.id, 'task', task.title, duration);\r\n        startFocusSession(task.id, duration);\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title=\"\" maxWidth=\"2xl\">\r\n            <div className=\"relative overflow-hidden p-6 sm:p-8\">\r\n                {/* Background Decoration */}\r\n                <div className=\"absolute top-[-10%] right-[-10%] w-[300px] h-[300px] bg-blue-600/5 rounded-full blur-[100px] pointer-events-none\" />\r\n                <div className=\"absolute bottom-[-10%] left-[-10%] w-[250px] h-[250px] bg-indigo-600/5 rounded-full blur-[80px] pointer-events-none\" />\r\n\r\n                <div className=\"relative z-10 flex flex-col gap-8\">\r\n                    {/* Header: Icon, Title, Category */}\r\n                    <div className=\"flex items-start gap-6\">\r\n                        <div className={cn(\r\n                            \"w-20 h-20 rounded-3xl flex items-center justify-center shrink-0 shadow-2xl border-2 relative overflow-hidden\",\r\n                            \"bg-gradient-to-br\",\r\n                            isCompleted ? \"from-emerald-600 to-emerald-500 border-emerald-400/50\" : \"from-blue-600 to-indigo-600 border-blue-400/50\"\r\n                        )}>\r\n\r\n                            <IconRenderer icon={task.icon} size={40} className=\"text-white drop-shadow-lg relative z-10\" fallback={<CheckSquare className=\"w-10 h-10\" />} />\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                <span className={cn(\r\n                                    \"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border\",\r\n                                    colorScheme.bg, colorScheme.text, colorScheme.border\r\n                                )}>\r\n                                    TAREFA\r\n                                </span>\r\n                                <span className=\"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-800/50\">\r\n                                    {task.type === 'day' ? '√öNICA' : isPeriod ? 'PER√çODO' : 'RECORRENTE'}\r\n                                </span>\r\n                                <span className={cn(\r\n                                    \"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border\",\r\n                                    task.priority === 'high' ? 'bg-red-500/10 text-red-400 border-red-500/20' :\r\n                                        task.priority === 'medium' ? 'bg-amber-500/10 text-amber-400 border-amber-500/20' :\r\n                                            'bg-emerald-500/10 text-emerald-400 border-emerald-500/20'\r\n                                )}>\r\n                                    {task.priority === 'high' ? 'ALTA' : task.priority === 'medium' ? 'M√âDIA' : 'BAIXA'}\r\n                                </span>\r\n                            </div>\r\n                            <h2 className=\"text-3xl font-black text-white leading-tight break-words\">\r\n                                {task.title}\r\n                            </h2>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Progress Bar Display (for Period/Recurring) */}\r\n                    {(isPeriod || isRecurring) && task.progress && (\r\n                        <div className=\"bg-slate-900/20 rounded-3xl p-6 shadow-inner\">\r\n                            <div className=\"flex justify-between items-end mb-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2\">\r\n                                        <Trophy className=\"w-3 h-3\" /> Progresso da Miss√£o\r\n                                    </span>\r\n                                    <div className=\"text-4xl font-black text-white\">\r\n                                        {task.progress.current}/{task.progress.total}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"text-right space-y-1\">\r\n                                    <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center justify-end gap-2\">\r\n                                        Status Atual\r\n                                    </span>\r\n                                    <div className={cn(\r\n                                        \"text-sm font-bold\",\r\n                                        isCompleted ? \"text-emerald-400\" : \"text-blue-400\"\r\n                                    )}>\r\n                                        {isCompleted ? 'Finalizado' : 'Em Andamento'}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"h-4 bg-slate-950/80 rounded-full p-1 border border-slate-800/50 shadow-inner relative overflow-hidden\">\r\n                                <div\r\n                                    className={cn(\r\n                                        \"h-full rounded-full transition-all duration-1000 ease-out shadow-lg\",\r\n                                        \"bg-gradient-to-r\",\r\n                                        colorScheme.gradient\r\n                                    )}\r\n                                    style={{ width: `${Math.min(100, (task.progress.current / task.progress.total) * 100)}%` }}\r\n                                >\r\n\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Main Stats */}\r\n                    <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">In√≠cio</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Calendar className=\"w-4 h-4 text-blue-400\" />\r\n                                {task.startDate || task.date ? format(new Date((task.startDate || task.date) + 'T00:00:00'), 'dd/MM/yy') : '--/--/--'}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Prazo</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Calendar className=\"w-4 h-4 text-rose-400\" />\r\n                                {task.endDate || task.date ? format(new Date((task.endDate || task.date) + 'T00:00:00'), 'dd/MM/yy') : '--/--/--'}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Dura√ß√£o</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Clock className=\"w-4 h-4 text-amber-400\" />\r\n                                {task.durationMinutes || 25} min\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Total Gasto</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Activity className=\"w-4 h-4 text-emerald-400\" />\r\n                                {Math.floor((task.timeSpent || 0) / 60)}h {(task.timeSpent || 0) % 60}m\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Description or Current Summary Note */}\r\n                    <div className=\"bg-slate-900/20 rounded-3xl p-6 space-y-4\">\r\n                        <h3 className=\"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-1\">\r\n                            <FileText className=\"w-4 h-4\" /> Notas da Tarefa\r\n                        </h3>\r\n                        <div className=\"text-slate-300 text-sm leading-relaxed italic bg-slate-950/50 p-4 rounded-xl border border-slate-800/50\">\r\n                            {task.summary || \"Nenhuma nota espec√≠fica para esta tarefa ainda.\"}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Summary Timeline - Box de Resumo/Hist√≥rico */}\r\n                    <div className=\"bg-slate-900/40 rounded-[2rem] overflow-hidden\">\r\n                        <div className=\"p-6 sm:p-8 bg-slate-950/40\">\r\n                            <SummaryTimeline\r\n                                summaries={task.summaries || []}\r\n                                title=\"Hist√≥rico da Tarefa\"\r\n                                maxItems={5}\r\n                                showEmptyState={true}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bottom Action */}\r\n                    <div className=\"flex gap-4\">\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"flex-1 h-14 bg-white/5 hover:bg-white/10 rounded-2xl font-black text-white uppercase tracking-widest transition-all shadow-xl active:scale-[0.98]\"\r\n                        >\r\n                            Fechar\r\n                        </button>\r\n                        {!isCompleted && (\r\n                            <button\r\n                                onClick={handleStartFocus}\r\n                                className=\"flex-[2] h-14 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 border border-blue-400/20 rounded-2xl font-black text-white uppercase tracking-widest transition-all shadow-xl shadow-blue-500/20 flex items-center justify-center gap-3 active:scale-[0.98]\"\r\n                            >\r\n                                <PlayCircle className=\"w-6 h-6\" />\r\n                                Iniciar Foco\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\AddThemeModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\StudyContentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":14}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, BookOpen, Save, Clock, Brain, History, Sparkles, Maximize2 } from 'lucide-react';\r\nimport { RichTextEditor } from '../../../components/ui/RichTextEditor';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Subtheme } from '../../../types';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport SummaryTimeline from '../../../components/ui/SummaryTimeline';\r\n\r\ninterface StudyContentModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    subtheme: Subtheme | null;\r\n    onSave: (content: string) => void;\r\n}\r\n\r\nexport const StudyContentModal: React.FC<StudyContentModalProps> = ({ isOpen, onClose, subtheme, onSave }) => {\r\n    const [content, setContent] = useState(subtheme?.text_content || '');\r\n    const [activeTab, setActiveTab] = useState<'content' | 'history'>('content');\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n    // Update internal content when subtheme changes\r\n    React.useEffect(() => {\r\n        if (subtheme) {\r\n            setContent(subtheme.text_content || '');\r\n        }\r\n    }, [subtheme]);\r\n\r\n    if (!subtheme) return null;\r\n\r\n    const timeSpentH = Math.floor((subtheme.timeSpent || 0) / 60);\r\n    const timeSpentM = (subtheme.timeSpent || 0) % 60;\r\n\r\n    return (\r\n        <Modal\r\n            isOpen={isOpen}\r\n            onClose={onClose}\r\n            title={null} // Custom Header\r\n            maxWidth={isFullscreen ? 'full' : '3xl'}\r\n            padding={false}\r\n            className={cn(\"transition-all duration-500\", isFullscreen ? \"h-[95vh]\" : \"h-[85vh]\")}\r\n        >\r\n            <div className=\"flex flex-col h-full bg-slate-950 overflow-hidden rounded-2xl border border-slate-800/50 shadow-2xl\">\r\n                {/* Custom Header */}\r\n                <div className=\"p-6 border-b border-slate-800/50 bg-slate-900/40 relative overflow-hidden shrink-0\">\r\n                    <div className=\"absolute top-0 right-0 w-64 h-full bg-blue-500/5 blur-3xl rounded-full pointer-events-none\" />\r\n\r\n                    <div className=\"flex items-start justify-between relative z-10\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20\">\r\n                                <BookOpen className=\"w-6 h-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-xl font-bold text-white tracking-tight\">{subtheme.title}</h2>\r\n                                <div className=\"flex items-center gap-3 mt-1\">\r\n                                    <span className=\"flex items-center gap-1 text-[10px] font-bold text-slate-500 uppercase tracking-widest\">\r\n                                        <Clock className=\"w-3 h-3\" />\r\n                                        {timeSpentH}h {timeSpentM}m de Estudo\r\n                                    </span>\r\n                                    <span className=\"w-1 h-1 bg-slate-800 rounded-full\" />\r\n                                    <span className=\"flex items-center gap-1 text-[10px] font-bold text-blue-400 uppercase tracking-widest\">\r\n                                        <Brain className=\"w-3 h-3\" />\r\n                                        SRS N√≠vel {subtheme.reviews.filter(r => r.status === 'completed').length}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2 hover:bg-slate-800/50 rounded-xl text-slate-500 hover:text-white transition-all\"\r\n                        >\r\n                            <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Tabs */}\r\n                    <div className=\"flex gap-1 mt-6 p-1 bg-black/40 rounded-xl w-fit border border-slate-800/50\">\r\n                        <button\r\n                            onClick={() => setActiveTab('content')}\r\n                            className={cn(\r\n                                \"flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold transition-all\",\r\n                                activeTab === 'content' ? \"bg-slate-800 text-white shadow-lg\" : \"text-slate-500 hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            <FileTextIcon className=\"w-3.5 h-3.5\" />\r\n                            Conte√∫do Principal\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('history')}\r\n                            className={cn(\r\n                                \"flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold transition-all\",\r\n                                activeTab === 'history' ? \"bg-slate-800 text-white shadow-lg\" : \"text-slate-500 hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            <History className=\"w-3.5 h-3.5\" />\r\n                            Di√°rio & Resumos\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content Area */}\r\n                <div className=\"flex-1 overflow-y-auto p-6 custom-scrollbar\">\r\n                    <AnimatePresence mode=\"wait\">\r\n                        {activeTab === 'content' ? (\r\n                            <motion.div\r\n                                key=\"content\"\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, y: -10 }}\r\n                                className=\"space-y-6\"\r\n                            >\r\n                                <div className=\"flex items-center justify-between mb-2\">\r\n                                    <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-widest\">Anota√ß√µes do M√≥dulo</h3>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <button className=\"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-400 rounded-lg text-[10px] font-bold uppercase transition-all border border-indigo-500/20\">\r\n                                            <Sparkles className=\"w-3 h-3\" />\r\n                                            Gerar com IA\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <RichTextEditor\r\n                                    content={content}\r\n                                    onChange={setContent}\r\n                                />\r\n\r\n                                <div className=\"bg-slate-900/30 border border-slate-800/50 rounded-2xl p-4 flex items-center gap-4\">\r\n                                    <div className=\"p-2 rounded-lg bg-emerald-500/10 text-emerald-500\">\r\n                                        <Maximize2 className=\"w-4 h-4\" />\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <p className=\"text-xs font-bold text-white\">Modo de Leitura Focado</p>\r\n                                        <p className=\"text-[10px] text-slate-500\">Expanda para estudar sem distra√ß√µes.</p>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => setIsFullscreen(!isFullscreen)}\r\n                                        className=\"px-3 py-1 bg-slate-800 hover:bg-slate-700 text-white rounded-lg text-[10px] font-bold\"\r\n                                    >\r\n                                        {isFullscreen ? 'REDUZIR' : 'ABRIR'}\r\n                                    </button>\r\n                                </div>\r\n                            </motion.div>\r\n                        ) : (\r\n                            <motion.div\r\n                                key=\"history\"\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, y: -10 }}\r\n                                className=\"space-y-4\"\r\n                            >\r\n                                {(!subtheme.summaries || subtheme.summaries.length === 0) && (!subtheme.reviews || subtheme.reviews.filter(r => r.status === 'completed').length === 0) ? (\r\n                                    <div className=\"text-center py-20 bg-slate-900/20 rounded-[2rem] border border-dashed border-slate-800\">\r\n                                        <History className=\"w-12 h-12 text-slate-700 mx-auto mb-4\" />\r\n                                        <p className=\"text-slate-500 font-medium\">Nenhum resumo dispon√≠vel ainda.</p>\r\n                                        <p className=\"text-xs text-slate-600 mt-1\">Conclua uma revis√£o para registrar seus aprendizados.</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <SummaryTimeline summaries={subtheme.summaries || []} title=\"Hist√≥rico de Estudos\" />\r\n                                )}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                {activeTab === 'content' && (\r\n                    <div className=\"p-4 border-t border-slate-800/50 bg-slate-900/40 shrink-0 flex items-center justify-between\">\r\n                        <p className=\"text-[10px] text-slate-500 font-medium italic\">\r\n                            Alt + S para salvar rapidamente\r\n                        </p>\r\n                        <button\r\n                            onClick={() => onSave(content)}\r\n                            className=\"group relative flex items-center gap-2 px-6 py-2.5 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-emerald-500/20 transition-all hover:scale-[1.02] active:scale-95\"\r\n                        >\r\n                            <Save className=\"w-4 h-4\" />\r\n                            Salvar Altera√ß√µes\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nconst FileTextIcon = (props: any) => (\r\n    <svg\r\n        {...props}\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        strokeWidth=\"2\"\r\n        strokeLinecap=\"round\"\r\n        strokeLinejoin=\"round\"\r\n    >\r\n        <path d=\"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\" /><path d=\"M14 2v4a2 2 0 0 0 2 2h4\" /><path d=\"M10 9H8\" /><path d=\"M16 13H8\" /><path d=\"M16 17H8\" />\r\n    </svg>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\SubthemeItem.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useRef' is defined but never used.","line":1,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'themeColor' is defined but never used.","line":20,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startAudio' is assigned a value but never used.","line":25,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from 'react';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { usePomodoroContext } from '../../../context/PomodoroContext';\r\nimport { useAudio } from '../../../context/AudioContext';\r\nimport { Play, FileText, ChevronDown, BookOpen, Lock } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Subtheme, Review } from '../../../types';\r\nimport { useSRSLogic } from '../../../hooks/useSRSLogic';\r\nimport { SummaryHistoryModal } from './SummaryHistoryModal';\r\n\r\ninterface SubthemeItemProps {\r\n    sub: Subtheme;\r\n    themeColor: string;\r\n    projectedStart?: string;\r\n    onOpenNotes: (sub: Subtheme) => void;\r\n    unlockedSubthemes: string[];\r\n}\r\n\r\nexport const SubthemeItem = ({ sub, themeColor, projectedStart, onOpenNotes, unlockedSubthemes }: SubthemeItemProps) => {\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n    const { startFocus } = useStudy();\r\n    const { startFocusSession, isActive } = usePomodoroContext();\r\n    const { startAudio } = useAudio();\r\n    const { generateProjectedReviews } = useSRSLogic();\r\n\r\n    // Strict Summary Unlock Logic\r\n    const isUnlocked = unlockedSubthemes && unlockedSubthemes.includes(sub.id);\r\n\r\n    // Determines items to show\r\n    let displayReviews = [...sub.reviews];\r\n    const isProjectedView = sub.status === 'queue' && projectedStart && displayReviews.length === 0;\r\n\r\n    if (isProjectedView && projectedStart) {\r\n        displayReviews = generateProjectedReviews(projectedStart);\r\n    }\r\n    const sortedReviews = displayReviews.sort((a: Review, b: Review) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n\r\n    // Status Config\r\n    const statusConfig: Record<string, { color: string; bg: string; border: string; icon: string; label: string }> = {\r\n        active: { color: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20', icon: '‚ö°', label: 'Ativo' },\r\n        completed: { color: 'text-blue-400', bg: 'bg-blue-500/10', border: 'border-blue-500/20', icon: '‚úì', label: 'Conclu√≠do' },\r\n        queue: { color: 'text-slate-400', bg: 'bg-slate-800/50', border: 'border-slate-700/50', icon: '‚è≥', label: 'Fila' },\r\n    };\r\n    const status = statusConfig[sub.status as string] || statusConfig.queue;\r\n\r\n    const [isSummaryOpen, setIsSummaryOpen] = useState(false);\r\n\r\n    // ... existing statusConfig ...\r\n\r\n    const isModule = sub.difficulty === 'module';\r\n\r\n    if (isModule) {\r\n        // ... module render ...\r\n        return (\r\n            <div className=\"relative py-2 flex items-center justify-center overflow-hidden\">\r\n                <div className=\"absolute inset-0 flex items-center\">\r\n                    <div className=\"w-full border-t border-slate-800/50\"></div>\r\n                </div>\r\n                <span className=\"relative bg-slate-950 px-3 text-[10px] font-black uppercase tracking-[0.2em] text-slate-600\">\r\n                    {sub.title}\r\n                </span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div className={cn(\r\n                \"rounded-xl transition-all duration-300 border group/item overflow-hidden\",\r\n                isExpanded ? \"bg-slate-900 border-slate-700 shadow-xl\" : \"bg-slate-900/40 border-slate-800/50 hover:bg-slate-900/60 hover:border-slate-700/50\"\r\n            )}>\r\n                <div\r\n                    onClick={() => setIsExpanded(!isExpanded)}\r\n                    className=\"p-3 flex items-center gap-3 cursor-pointer select-none\"\r\n                >\r\n                    {/* Status Dot */}\r\n                    <div className={cn(\"w-2 h-2 rounded-full shadow-[0_0_8px]\", status.bg.replace('bg-', 'bg-').replace('/10', ''))}\r\n                        style={{ backgroundColor: status.color.replace('text-', ''), boxShadow: `0 0 8px currentColor` }}\r\n                    />\r\n\r\n                    <span className={cn(\r\n                        \"flex-1 text-sm font-medium transition-colors truncate\",\r\n                        isExpanded ? \"text-white\" : \"text-slate-400 group-hover:item:text-slate-200\",\r\n                        sub.status === 'completed' && \"line-through opacity-50 text-slate-600\"\r\n                    )}>\r\n                        {sub.title}\r\n                    </span>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {/* Summary History Button (New) */}\r\n                        <button\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                setIsSummaryOpen(true);\r\n                            }}\r\n                            className={cn(\r\n                                \"w-7 h-7 flex items-center justify-center rounded-lg border transition-all\",\r\n                                \"bg-slate-800 border-slate-700 text-slate-500 hover:bg-indigo-500/20 hover:text-indigo-300 hover:border-indigo-500/30\"\r\n                            )}\r\n                            title=\"Di√°rio de Aprendizado / Resumos\"\r\n                        >\r\n                            <BookOpen className=\"w-3.5 h-3.5 fill-current\" />\r\n                        </button>\r\n\r\n                        {/* Edit Content / Notes Button */}\r\n                        <button\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                if (isUnlocked) onOpenNotes(sub);\r\n                            }}\r\n                            disabled={!isUnlocked}\r\n                            className={cn(\r\n                                \"w-7 h-7 flex items-center justify-center rounded-lg border transition-all\",\r\n                                !isUnlocked\r\n                                    ? \"bg-slate-800/50 border-slate-700/50 text-slate-600 cursor-not-allowed opacity-50\"\r\n                                    : sub.text_content\r\n                                        ? \"bg-indigo-500/10 border-indigo-500/30 text-indigo-400 hover:bg-indigo-500 hover:text-white\"\r\n                                        : \"bg-slate-800 border-slate-700 text-slate-500 hover:bg-indigo-500/20 hover:text-indigo-300 hover:border-indigo-500/30\"\r\n                            )}\r\n                            title={isUnlocked ? \"Anota√ß√µes do Conte√∫do\" : \"Complete um Pomodoro hoje para liberar o conte√∫do\"}\r\n                        >\r\n                            <FileText className=\"w-3.5 h-3.5 fill-current\" />\r\n                        </button>\r\n\r\n                        {/* Play Button for Subtheme */}\r\n                        {(() => {\r\n                            // Determine availability\r\n                            let isLocked = false;\r\n                            let lockReason = \"\";\r\n                            const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n\r\n                            if (sub.status === 'completed') {\r\n                                isLocked = true;\r\n                                lockReason = \"Tema conclu√≠do! Parab√©ns!\";\r\n                            } else if (sub.status === 'queue') {\r\n                                isLocked = true;\r\n                                lockReason = \"Este m√≥dulo ainda n√£o foi iniciado.\";\r\n                                if (projectedStart) lockReason += ` Previs√£o: ${format(new Date(projectedStart), 'dd/MM')}`;\r\n                            } else if (sub.status === 'active') {\r\n                                const nextReview = sub.reviews.find((r: any) => r.status === 'pending');\r\n                                if (!nextReview) {\r\n                                    isLocked = true;\r\n                                    lockReason = \"Sem revis√µes pendentes.\";\r\n                                } else if (nextReview.date > todayStr) {\r\n                                    isLocked = true;\r\n                                    lockReason = `Pr√≥xima revis√£o agendada para ${format(new Date(nextReview.date), 'dd/MM')}`;\r\n                                }\r\n                            }\r\n\r\n                            return (\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        // Critical: Check Ref (sync) AND State (async) AND Context (global)\r\n                                        if (isLocked || isActive) return;\r\n\r\n                                        startFocus(sub.id, 'subtheme', sub.title, 25);\r\n                                        startFocusSession(sub.id, 25);\r\n                                    }}\r\n                                    disabled={isLocked || isActive}\r\n                                    className={cn(\r\n                                        \"w-7 h-7 flex items-center justify-center rounded-lg border transition-all relative group/playbtn\",\r\n                                        isLocked || isActive\r\n                                            ? \"bg-slate-800/50 border-slate-700/50 text-slate-600 cursor-not-allowed\"\r\n                                            : \"bg-slate-800 hover:bg-emerald-600 border-slate-700 hover:border-emerald-500 text-slate-400 hover:text-white\"\r\n                                    )}\r\n                                    title={isActive ? \"Foco em andamento\" : (isLocked ? lockReason : \"Focar neste Tema\")}\r\n                                >\r\n                                    {isLocked ? (\r\n                                        <Lock className=\"w-3 h-3 text-slate-600\" />\r\n                                    ) : (\r\n                                        <Play className=\"w-3 h-3 fill-current\" />\r\n                                    )}\r\n                                </button>\r\n                            );\r\n                        })()}\r\n\r\n                        <ChevronDown className={cn(\"w-4 h-4 text-slate-600 transition-transform duration-300\", isExpanded && \"rotate-180 text-white\")} />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Expanded Content */}\r\n                {isExpanded && (\r\n                    <div className=\"px-3 pb-3 border-t border-slate-800/50 animate-in slide-in-from-top-2 duration-200\">\r\n                        <div className=\"mt-2 grid gap-1\">\r\n                            {sortedReviews.length === 0 ? (\r\n                                <p className=\"text-[10px] text-slate-600 italic text-center py-2\">Sem revis√µes agendadas.</p>\r\n                            ) : (\r\n                                <div className=\"relative\">\r\n                                    {/* Timeline Line (Visual Only) */}\r\n                                    <div className=\"absolute left-3 top-2 bottom-2 w-px bg-slate-800/50\" />\r\n\r\n                                    {sortedReviews.map((rev: any, idx: number) => {\r\n                                        const isDone = rev.status === 'completed';\r\n                                        const isNext = !isDone && !rev.isProjected && rev.number === (sortedReviews.find((r: any) => r.status === 'pending')?.number || 0);\r\n\r\n                                        return (\r\n                                            <div key={idx} className=\"relative flex items-center gap-3 py-1.5 pl-1 group/rev\">\r\n                                                {/* Dot on Timeline */}\r\n                                                <div className={cn(\r\n                                                    \"relative z-10 w-4 h-4 rounded-full border-2 flex items-center justify-center text-[8px] font-bold transition-all\",\r\n                                                    isDone\r\n                                                        ? \"bg-slate-900 border-emerald-500 text-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.2)]\"\r\n                                                        : isNext\r\n                                                            ? \"bg-blue-500 border-blue-400 text-white animate-pulse shadow-[0_0_10px_rgba(59,130,246,0.5)]\"\r\n                                                            : \"bg-slate-900 border-slate-700 text-slate-600\"\r\n                                                )}>\r\n                                                    {isDone ? '‚úì' : rev.number}\r\n                                                </div>\r\n\r\n                                                <div className=\"flex-1 flex items-center justify-between text-xs p-1.5 rounded-lg hover:bg-slate-800/50 transition-colors\">\r\n                                                    <span className={cn(\"font-mono\", isDone ? \"text-emerald-400\" : isNext ? \"text-blue-300\" : \"text-slate-500\")}>\r\n                                                        {format(new Date(rev.date), 'dd/MM/yyyy')}\r\n                                                    </span>\r\n                                                    <span className={cn(\"text-[10px] font-bold uppercase\",\r\n                                                        isDone ? \"text-emerald-500\" :\r\n                                                            rev.isProjected ? \"text-slate-700 italic\" :\r\n                                                                isNext ? \"text-blue-400\" : \"text-amber-500/50\"\r\n                                                    )}>\r\n                                                        {rev.isProjected ? 'Estimado' : isDone ? 'Feito' : isNext ? 'Pr√≥ximo' : 'Pendente'}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <SummaryHistoryModal\r\n                isOpen={isSummaryOpen}\r\n                onClose={() => setIsSummaryOpen(false)}\r\n                subtheme={sub}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\SummaryHistoryModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Quote' is defined but never used.","line":3,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":3,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, BookOpen, Quote, Calendar } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Subtheme } from '../../../types';\r\nimport SummaryTimeline from '../../../components/ui/SummaryTimeline';\r\n\r\ninterface SummaryHistoryModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    subtheme: Subtheme;\r\n}\r\n\r\nexport const SummaryHistoryModal: React.FC<SummaryHistoryModalProps> = ({ isOpen, onClose, subtheme }) => {\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <>\r\n                    {/* Backdrop */}\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9998]\"\r\n                        onClick={onClose}\r\n                    />\r\n\r\n                    {/* Modal Content */}\r\n                    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4 pointer-events-none\">\r\n                        <motion.div\r\n                            initial={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                            animate={{ scale: 1, opacity: 1, y: 0 }}\r\n                            exit={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                            className=\"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-lg shadow-2xl pointer-events-auto flex flex-col max-h-[85vh]\"\r\n                        >\r\n                            {/* Header */}\r\n                            <div className=\"p-6 border-b border-slate-800 flex items-start justify-between bg-slate-900/50 rounded-t-2xl\">\r\n                                <div>\r\n                                    <div className=\"flex items-center gap-2 text-indigo-400 mb-1\">\r\n                                        <BookOpen className=\"w-5 h-5\" />\r\n                                        <span className=\"text-xs font-bold uppercase tracking-widest\">Di√°rio de Aprendizado</span>\r\n                                    </div>\r\n                                    <h2 className=\"text-xl font-bold text-white\">{subtheme.title}</h2>\r\n                                </div>\r\n                                <button\r\n                                    onClick={onClose}\r\n                                    className=\"p-2 hover:bg-slate-800 rounded-lg text-slate-500 hover:text-white transition-colors\"\r\n                                >\r\n                                    <X className=\"w-5 h-5\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Scrollable Content */}\r\n                            <div className=\"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent\">\r\n                                <SummaryTimeline\r\n                                    summaries={subtheme.summaries || []}\r\n                                    title=\"Hist√≥rico de Revis√£o\"\r\n                                    showEmptyState={true}\r\n                                />\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                </>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\ThemeCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'completionDate' is defined but never used.","line":18,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":50}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BrainCircuit, Pencil, Trash2 } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Theme, Subtheme } from '../../../types';\r\nimport { SubthemeItem } from './SubthemeItem';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface ThemeCardProps {\r\n    theme: Theme;\r\n    completionDate: string | null;\r\n    queuedSubthemesMap: Map<string, string>;\r\n    onEdit: () => void;\r\n    onDelete: () => void;\r\n    onOpenNotes: (sub: Subtheme) => void;\r\n    onOpenDetails: () => void;\r\n    unlockedSubthemes: string[];\r\n}\r\n\r\nexport const ThemeCard = ({ theme, completionDate, queuedSubthemesMap, onEdit, onDelete, onOpenNotes, onOpenDetails, unlockedSubthemes }: ThemeCardProps) => {\r\n    const themeColor = theme.color || '#3b82f6';\r\n\r\n    // Calculate Progress\r\n    const totalSubs = theme.subthemes.length;\r\n    const completedSubs = theme.subthemes.filter((s: Subtheme) => s.status === 'completed').length;\r\n    const progress = totalSubs === 0 ? 0 : (completedSubs / totalSubs) * 100;\r\n\r\n    return (\r\n        <div className=\"group relative w-full h-full flex flex-col\">\r\n            {/* Main Card Structure */}\r\n            <div\r\n                onClick={onOpenDetails}\r\n                className=\"relative flex-1 bg-[#0f111a] rounded-[2rem] border border-slate-800/50 overflow-hidden transition-all duration-300 hover:border-slate-700 hover:shadow-2xl hover:shadow-black/50 hover:translate-y-[-2px] cursor-pointer\"\r\n            >\r\n\r\n                {/* Ambient Background Gradient (restored \"Design de Antes\" feel) */}\r\n                <div\r\n                    className=\"absolute inset-0 opacity-20 pointer-events-none\"\r\n                    style={{\r\n                        background: `radial-gradient(circle at top left, ${themeColor}, transparent 70%)`\r\n                    }}\r\n                />\r\n\r\n                {/* Header Content (The screenshot part) */}\r\n                <div className=\"relative p-6 z-10\">\r\n                    <div className=\"flex items-start gap-4\">\r\n                        <div className=\"flex items-center gap-5 flex-1 min-w-0\">\r\n                            {/* Icon Box */}\r\n                            <div\r\n                                className=\"w-16 h-16 rounded-2xl border border-white/10 flex items-center justify-center shrink-0 bg-gradient-to-br from-white/5 to-white/0 shadow-lg\"\r\n                                style={{ boxShadow: `0 8px 32px -8px ${themeColor}40` }}\r\n                            >\r\n                                {theme.imageUrl ? (\r\n                                    <img\r\n                                        src={theme.imageUrl}\r\n                                        alt={theme.title}\r\n                                        className=\"w-full h-full object-cover rounded-2xl opacity-90\"\r\n                                    />\r\n                                ) : (\r\n                                    <div className=\"text-white/90 transform group-hover:scale-110 transition-transform duration-500\">\r\n                                        <IconRenderer icon={theme.icon} size={32} fallback={<BrainCircuit className=\"w-8 h-8\" />} />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Title & Badge */}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <h3 className=\"text-2xl font-bold text-white tracking-tight leading-tight mb-2 drop-shadow-sm truncate\">\r\n                                    {theme.title}\r\n                                </h3>\r\n                                <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                    <span className=\"inline-flex items-center px-3 py-1 rounded-full bg-black/40 border border-white/5 text-[10px] font-bold text-slate-400 uppercase tracking-widest backdrop-blur-sm\">\r\n                                        {totalSubs} {totalSubs === 1 ? 'M√≥dulo' : 'M√≥dulos'}\r\n                                    </span>\r\n                                    {/* Category Badge */}\r\n                                    <span className={`inline-flex items-center px-2 py-0.5 rounded-md text-[9px] font-bold uppercase tracking-wider border ${theme.category === 'project'\r\n                                        ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20'\r\n                                        : 'bg-blue-500/10 text-blue-400 border-blue-500/20'\r\n                                        }`}>\r\n                                        {theme.category === 'project' ? 'Projeto' : 'Tema'}\r\n                                    </span>\r\n                                    {/* Start Date */}\r\n                                    {theme.startDate && (\r\n                                        <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[9px] font-bold bg-slate-800/60 text-slate-300 border border-slate-600/40\">\r\n                                            In√≠cio: {new Date(theme.startDate).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}\r\n                                        </span>\r\n                                    )}\r\n                                    {/* Deadline */}\r\n                                    {theme.deadline && (\r\n                                        <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[9px] font-bold bg-slate-800/60 text-slate-300 border border-slate-600/40\">\r\n                                            Fim: {new Date(theme.deadline).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Actions - Positioned on the right */}\r\n                        {/* Actions - Positioned on the right */}\r\n                        <div className=\"flex gap-1.5 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none group-hover:pointer-events-auto\">\r\n                            <button\r\n                                onClick={(e) => { e.stopPropagation(); onEdit(); }}\r\n                                className=\"w-8 h-8 flex items-center justify-center bg-slate-950/40 hover:bg-blue-600/80 backdrop-blur-md rounded-full text-slate-400 hover:text-white transition-all duration-200 border border-white/5 hover:border-blue-400/50 shadow-sm\"\r\n                                title=\"Editar tema\"\r\n                            >\r\n                                <Pencil className=\"w-3.5 h-3.5\" />\r\n                            </button>\r\n                            <button\r\n                                onClick={(e) => { e.stopPropagation(); onDelete(); }}\r\n                                className=\"w-8 h-8 flex items-center justify-center bg-slate-950/40 hover:bg-red-600/80 backdrop-blur-md rounded-full text-slate-400 hover:text-white transition-all duration-200 border border-white/5 hover:border-red-400/50 shadow-sm\"\r\n                                title=\"Excluir tema\"\r\n                            >\r\n                                <Trash2 className=\"w-3.5 h-3.5\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Body Content (Progress + Subthemes) - Kept but styled comfortably below header */}\r\n                <div className=\"relative px-6 pb-6 space-y-6\">\r\n\r\n                    {/* Progress Bar */}\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"flex justify-between items-center text-xs px-1\">\r\n                            <span className=\"text-slate-500 font-bold uppercase tracking-wider\">Progresso</span>\r\n                            <span className=\"text-slate-300 font-bold\">{Math.round(progress)}%</span>\r\n                        </div>\r\n                        <div className=\"h-1.5 bg-slate-900 rounded-full overflow-hidden\">\r\n                            <div\r\n                                className=\"h-full rounded-full transition-all duration-1000 ease-out relative group-hover:shadow-[0_0_12px_rgba(255,255,255,0.3)]\"\r\n                                style={{ width: `${progress}%`, background: themeColor }}\r\n                            >\r\n                                <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full -translate-x-full animate-[shimmer_2s_infinite]\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Subthemes List (Grouped by Modules) */}\r\n                    <div className=\"space-y-3 max-h-[260px] overflow-y-auto custom-scrollbar pr-1\">\r\n                        {(() => {\r\n                            const groups: { module: Subtheme | null, items: Subtheme[] }[] = [];\r\n                            let currentGroup: { module: Subtheme | null, items: Subtheme[] } | null = null;\r\n\r\n                            theme.subthemes.forEach(sub => {\r\n                                if (sub.difficulty === 'module') {\r\n                                    currentGroup = { module: sub, items: [] };\r\n                                    groups.push(currentGroup);\r\n                                } else {\r\n                                    if (!currentGroup) {\r\n                                        currentGroup = { module: null, items: [] };\r\n                                        groups.push(currentGroup);\r\n                                    }\r\n                                    currentGroup.items.push(sub);\r\n                                }\r\n                            });\r\n\r\n                            return groups.map((group, gIdx) => (\r\n                                <div key={gIdx} className=\"space-y-1.5\">\r\n                                    {group.module && (\r\n                                        <SubthemeItem\r\n                                            sub={group.module}\r\n                                            themeColor={themeColor}\r\n                                            onOpenNotes={onOpenNotes}\r\n                                            unlockedSubthemes={unlockedSubthemes}\r\n                                        />\r\n                                    )}\r\n                                    <div className={cn(\"space-y-1.5\", group.module && \"pl-2 border-l border-slate-800/50 ml-1\")}>\r\n                                        {group.items.map(sub => (\r\n                                            <SubthemeItem\r\n                                                key={sub.id}\r\n                                                sub={sub}\r\n                                                themeColor={themeColor}\r\n                                                projectedStart={queuedSubthemesMap.get(sub.id)}\r\n                                                onOpenNotes={onOpenNotes}\r\n                                                unlockedSubthemes={unlockedSubthemes}\r\n                                            />\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ));\r\n                        })()}\r\n                        {theme.subthemes.length === 0 && (\r\n                            <div className=\"py-6 text-center border border-dashed border-slate-800 rounded-xl bg-slate-900/30\">\r\n                                <p className=\"text-slate-500 text-xs\">Sem m√≥dulos ainda</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\features\\themes\\components\\ThemeDetailsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":2,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Activity' is defined but never used.","line":2,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'themes' is assigned a value but never used.","line":18,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'colorScheme' is assigned a value but never used.","line":45,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'nextDate' is assigned a value but never used.","line":186,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":47}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { BrainCircuit, Clock, Calendar, Trophy, ArrowRight, Activity, BookOpen, Layers, CheckCircle2 } from 'lucide-react';\r\nimport { Modal } from '../../../components/ui/Modal';\r\nimport { useStudy } from '../../../context/StudyContext';\r\nimport { format, isValid } from 'date-fns';\r\nimport { cn } from '../../../lib/utils';\r\nimport type { Theme, Subtheme } from '../../../types';\r\nimport SummaryTimeline from '../../../components/ui/SummaryTimeline';\r\nimport { IconRenderer } from '../../../components/ui/IconRenderer';\r\n\r\ninterface ThemeDetailsModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    theme: Theme | null;\r\n}\r\n\r\nexport const ThemeDetailsModal: React.FC<ThemeDetailsModalProps> = ({ isOpen, onClose, theme }) => {\r\n    const { themes } = useStudy();\r\n    const [expandedSubthemeId, setExpandedSubthemeId] = useState<string | null>(null);\r\n\r\n    if (!theme) return null;\r\n\r\n    // Helper function to format minutes to hours and minutes\r\n    const formatMinutesToHours = (totalMinutes: number): string => {\r\n        const hours = Math.floor(totalMinutes / 60);\r\n        const minutes = totalMinutes % 60;\r\n\r\n        if (hours === 0) {\r\n            return `${minutes}m`;\r\n        } else if (minutes === 0) {\r\n            return `${hours}h`;\r\n        } else {\r\n            return `${hours}h ${minutes}m`;\r\n        }\r\n    };\r\n\r\n    // Recalculate progress based on subthemes\r\n    const totalSubs = theme.subthemes.length;\r\n    const completedSubs = theme.subthemes.filter((s: Subtheme) => s.status === 'completed').length;\r\n    const progress = totalSubs === 0 ? 0 : (completedSubs / totalSubs) * 100;\r\n    const isCompleted = progress === 100;\r\n\r\n    const themeColor = theme.color || '#3b82f6';\r\n\r\n    const colorScheme = isCompleted\r\n        ? {\r\n            text: 'text-emerald-400',\r\n            bg: 'bg-emerald-500/10',\r\n            border: 'border-emerald-500/20',\r\n            gradient: 'from-emerald-600 to-emerald-400'\r\n        }\r\n        : {\r\n            text: 'text-blue-400',\r\n            bg: 'bg-blue-500/10',\r\n            border: 'border-blue-500/20',\r\n            gradient: `from-[${themeColor}] to-purple-600`\r\n        };\r\n\r\n    const getNextReviewDate = (sub: Subtheme) => {\r\n        const pending = sub.reviews.find(r => r.status === 'pending');\r\n        return pending?.date;\r\n    };\r\n\r\n    const totalMinutes = theme.subthemes.reduce((acc, s) => acc + (s.durationMinutes || 0), 0);\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title=\"\" maxWidth=\"3xl\">\r\n            <div className=\"relative overflow-hidden p-6 sm:p-8\">\r\n                {/* Background Decoration */}\r\n                <div\r\n                    className=\"absolute top-[-10%] right-[-10%] w-[300px] h-[300px] rounded-full blur-[100px] pointer-events-none opacity-10\"\r\n                    style={{ backgroundColor: themeColor }}\r\n                />\r\n                <div className=\"absolute bottom-[-10%] left-[-10%] w-[250px] h-[250px] bg-purple-600/5 rounded-full blur-[80px] pointer-events-none\" />\r\n\r\n                <div className=\"relative z-10 flex flex-col gap-8\">\r\n                    {/* Header: Icon, Title, Category */}\r\n                    <div className=\"flex items-start gap-6\">\r\n                        <div\r\n                            className={cn(\r\n                                \"w-20 h-20 rounded-3xl flex items-center justify-center shrink-0 shadow-2xl border-2 relative overflow-hidden\",\r\n                                \"bg-gradient-to-br\"\r\n                            )}\r\n                            style={{\r\n                                background: isCompleted ? undefined : `linear-gradient(to bottom right, ${themeColor}, #6366f1)`,\r\n                                borderColor: `${themeColor}50`\r\n                            }}\r\n                        >\r\n\r\n                            {theme.imageUrl ? (\r\n                                <img src={theme.imageUrl} alt={theme.title} className=\"w-full h-full object-cover relative z-10\" />\r\n                            ) : (\r\n                                <IconRenderer icon={theme.icon} size={40} className=\"text-white drop-shadow-lg relative z-10\" fallback={<BrainCircuit className=\"w-10 h-10\" />} />\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                <span className={cn(\r\n                                    \"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border\",\r\n                                    theme.category === 'project' ? \"bg-emerald-500/10 text-emerald-400 border-emerald-500/20\" : \"bg-blue-500/10 text-blue-400 border-blue-500/20\"\r\n                                )}>\r\n                                    {theme.category === 'project' ? 'PROJETO' : 'TEMA DE ESTUDO'}\r\n                                </span>\r\n                                <span className=\"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-800/50\">\r\n                                    {totalSubs} {totalSubs === 1 ? 'M√ìDULO' : 'M√ìDULOS'}\r\n                                </span>\r\n                            </div>\r\n                            <h2 className=\"text-3xl font-black text-white leading-tight break-words\">\r\n                                {theme.title}\r\n                            </h2>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Progress Bar Display */}\r\n                    <div className=\"bg-slate-900/20 rounded-3xl p-6 shadow-inner\">\r\n                        <div className=\"flex justify-between items-end mb-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2\">\r\n                                    <Trophy className=\"w-3 h-3\" /> Conclus√£o dos M√≥dulos\r\n                                </span>\r\n                                <div className=\"text-4xl font-black text-white\">\r\n                                    {Math.round(progress)}%\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-right space-y-1\">\r\n                                <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center justify-end gap-2\">\r\n                                    Estado Geral\r\n                                </span>\r\n                                <div className={cn(\r\n                                    \"text-sm font-bold\",\r\n                                    isCompleted ? \"text-emerald-400\" : \"text-blue-400\"\r\n                                )}>\r\n                                    {isCompleted ? 'Especialista' : 'Em Aprendizado'}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-4 bg-slate-950/80 rounded-full p-1 border border-slate-800/50 shadow-inner\">\r\n                            <div\r\n                                className={cn(\r\n                                    \"h-full rounded-full transition-all duration-1000 ease-out shadow-lg\"\r\n                                )}\r\n                                style={{\r\n                                    width: `${progress}%`,\r\n                                    background: isCompleted ? undefined : `linear-gradient(to right, ${themeColor}, #a855f7)`,\r\n                                    backgroundColor: isCompleted ? '#10b981' : undefined\r\n                                }}\r\n                            >\r\n\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Stats Grid */}\r\n                    <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4\">\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Criado em</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Calendar className=\"w-4 h-4 text-blue-400\" />\r\n                                {format(new Date(theme.createdAt), 'dd/MM/yy')}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-1\">M√≥dulos Conclu√≠dos</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-xl\">\r\n                                <BookOpen className=\"w-5 h-5 text-emerald-400\" />\r\n                                {completedSubs}<span className=\"text-slate-500 text-sm\">/{totalSubs}</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-slate-900/20 rounded-2xl p-4 block sm:hidden md:block\">\r\n                            <span className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2\">Esfor√ßo Estimado</span>\r\n                            <div className=\"text-white font-bold flex items-center gap-2 text-sm\">\r\n                                <Clock className=\"w-4 h-4 text-amber-400\" />\r\n                                {totalMinutes} min <span className=\"text-slate-400 font-normal\">({formatMinutesToHours(totalMinutes)})</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* List of Modules Summary */}\r\n                    <div className=\"space-y-4\">\r\n                        <h3 className=\"text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-1\">\r\n                            <Layers className=\"w-4 h-4\" /> Resumo dos M√≥dulos\r\n                        </h3>\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                            {theme.subthemes.map((sub, idx) => {\r\n                                const nextDate = getNextReviewDate(sub);\r\n                                const isExpanded = expandedSubthemeId === sub.id;\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={sub.id}\r\n                                        onClick={() => setExpandedSubthemeId(isExpanded ? null : sub.id)}\r\n                                        className={cn(\r\n                                            \"rounded-xl border transition-all duration-300 cursor-pointer overflow-hidden\",\r\n                                            sub.status === 'completed'\r\n                                                ? \"bg-emerald-500/5 border-emerald-500/20\"\r\n                                                : isExpanded\r\n                                                    ? \"bg-slate-800/40 border-slate-700 ring-1 ring-slate-600\"\r\n                                                    : \"bg-slate-900/20 border-transparent hover:border-slate-800\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"p-3 flex items-center justify-between gap-3\">\r\n                                            <div className=\"flex items-center gap-3 min-w-0\">\r\n                                                <div className={cn(\r\n                                                    \"w-6 h-6 rounded-md flex items-center justify-center text-[10px] font-bold shrink-0 transition-colors\",\r\n                                                    sub.status === 'completed' ? \"bg-emerald-500 text-white\" : \"bg-slate-800 text-slate-500\"\r\n                                                )}>\r\n                                                    {idx + 1}\r\n                                                </div>\r\n                                                <span className={cn(\r\n                                                    \"text-xs font-bold truncate transition-colors\",\r\n                                                    sub.status === 'completed' ? \"text-slate-400 line-through\" : isExpanded ? \"text-white\" : \"text-slate-200\"\r\n                                                )}>\r\n                                                    {sub.title}\r\n                                                </span>\r\n                                            </div>\r\n                                            {sub.status === 'completed' && <CheckCircle2 className=\"w-3.5 h-3.5 text-emerald-500\" />}\r\n                                        </div>\r\n\r\n                                        {/* Expanded Details */}\r\n                                        <div className={cn(\r\n                                            \"grid transition-[grid-template-rows] duration-300 ease-out\",\r\n                                            isExpanded ? \"grid-rows-[1fr] border-t border-slate-800/50\" : \"grid-rows-[0fr]\"\r\n                                        )}>\r\n                                            <div className=\"overflow-hidden\">\r\n                                                <div className=\"p-3 pt-0 mt-3 space-y-3\">\r\n                                                    {/* Dates Info */}\r\n                                                    <div className=\"flex flex-wrap gap-4 text-[10px] text-slate-400\">\r\n                                                        {sub.introductionDate && (\r\n                                                            <div className=\"flex items-center gap-1.5\">\r\n                                                                <Calendar className=\"w-3 h-3 text-slate-500\" />\r\n                                                                <span>In√≠cio: <span className=\"text-slate-200 font-medium\">{format(new Date(sub.introductionDate), 'dd/MM/yy')}</span></span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        {sub.status === 'queue' && (\r\n                                                            <div className=\"flex items-center gap-1.5 text-amber-500\">\r\n                                                                <Clock className=\"w-3 h-3\" />\r\n                                                                <span>Aguardando na Fila</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n\r\n                                                    {/* All Reviews List */}\r\n                                                    {sub.reviews && sub.reviews.length > 0 && (\r\n                                                        <div className=\"bg-slate-950/30 rounded-lg p-2\">\r\n                                                            <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2 block pl-1\">Cronograma de Revis√µes</span>\r\n                                                            <div className=\"grid grid-cols-3 sm:grid-cols-6 gap-2\">\r\n                                                                {sub.reviews.map((review, rIdx) => {\r\n                                                                    const isDone = review.status === 'completed';\r\n                                                                    const date = new Date(review.date);\r\n                                                                    const isPast = date < new Date() && !isDone;\r\n\r\n                                                                    return (\r\n                                                                        <div key={rIdx} className={cn(\r\n                                                                            \"flex flex-col items-center justify-center p-1.5 rounded-lg border text-center transition-colors\",\r\n                                                                            isDone\r\n                                                                                ? \"bg-emerald-500/10 border-emerald-500/20 text-emerald-400\"\r\n                                                                                : isPast\r\n                                                                                    ? \"bg-red-500/10 border-red-500/20 text-red-400\"\r\n                                                                                    : \"bg-slate-800/40 border-slate-800 text-slate-400\"\r\n                                                                        )}>\r\n                                                                            <span className=\"text-[9px] font-black opacity-60\">R{review.number}</span>\r\n                                                                            <span className=\"text-[10px] font-bold leading-tight\">\r\n                                                                                {isValid(date) ? format(date, 'dd/MM') : '--'}\r\n                                                                            </span>\r\n                                                                            {isDone && <CheckCircle2 className=\"w-2.5 h-2.5 mt-0.5\" />}\r\n                                                                        </div>\r\n                                                                    );\r\n                                                                })}\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Summary Timeline - Box de Resumo/Hist√≥rico */}\r\n                    <div className=\"bg-slate-900/40 rounded-[2rem] overflow-hidden\">\r\n                        <div className=\"p-6 sm:p-8 bg-slate-950/40\">\r\n                            <SummaryTimeline\r\n                                summaries={theme.summaries || []}\r\n                                title=\"Hist√≥rico do Tema\"\r\n                                maxItems={5}\r\n                                showEmptyState={true}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bottom Action */}\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"w-full h-14 bg-white/5 hover:bg-white/10 rounded-2xl font-black text-white uppercase tracking-widest transition-all shadow-xl active:scale-[0.98]\"\r\n                    >\r\n                        Fechar Detalhes\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\__tests__\\useLocalStorage.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'vi' is defined but never used.","line":1,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { renderHook, act } from '@testing-library/react';\r\nimport { useLocalStorage } from '../useLocalStorage';\r\n\r\ndescribe('useLocalStorage', () => {\r\n    beforeEach(() => {\r\n        localStorage.clear();\r\n    });\r\n\r\n    it('returns initial value when no stored value exists', () => {\r\n        const { result } = renderHook(() =>\r\n            useLocalStorage('test-key', 'default-value')\r\n        );\r\n\r\n        expect(result.current[0]).toBe('default-value');\r\n    });\r\n\r\n    it('saves value to localStorage', () => {\r\n        const { result } = renderHook(() =>\r\n            useLocalStorage('test-key', 'initial')\r\n        );\r\n\r\n        act(() => {\r\n            result.current[1]('new-value');\r\n        });\r\n\r\n        expect(localStorage.getItem('test-key')).toBe(JSON.stringify('new-value'));\r\n        expect(result.current[0]).toBe('new-value');\r\n    });\r\n\r\n    it('loads existing value from localStorage', () => {\r\n        localStorage.setItem('test-key', JSON.stringify('stored-value'));\r\n\r\n        const { result } = renderHook(() =>\r\n            useLocalStorage('test-key', 'default')\r\n        );\r\n\r\n        expect(result.current[0]).toBe('stored-value');\r\n    });\r\n\r\n    it('handles objects', () => {\r\n        const { result } = renderHook(() =>\r\n            useLocalStorage('test-obj', { foo: 'bar' })\r\n        );\r\n\r\n        act(() => {\r\n            result.current[1]({ foo: 'baz' });\r\n        });\r\n\r\n        expect(result.current[0]).toEqual({ foo: 'baz' });\r\n    });\r\n\r\n    it('handles invalid JSON in localStorage', () => {\r\n        localStorage.setItem('test-key', 'invalid-json{');\r\n\r\n        const { result } = renderHook(() =>\r\n            useLocalStorage('test-key', 'default')\r\n        );\r\n\r\n        // Should fallback to default on parse error\r\n        expect(result.current[0]).toBe('default');\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useDashboardData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useDevice.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useDevice.ts:13:9\n  11 |         // Detect iOS\n  12 |         const ios = /iphone|ipad|ipod/.test(userAgent);\n> 13 |         setIsIOS(ios);\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  14 |\n  15 |         // Detect Android\n  16 |         const android = /android/.test(userAgent);","line":13,"column":9,"nodeType":null,"endLine":13,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\n\r\nexport const useDevice = () => {\r\n    const [isIOS, setIsIOS] = useState(false);\r\n    const [isAndroid, setIsAndroid] = useState(false);\r\n    const [isPWA, setIsPWA] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const userAgent = window.navigator.userAgent.toLowerCase();\r\n\r\n        // Detect iOS\r\n        const ios = /iphone|ipad|ipod/.test(userAgent);\r\n        setIsIOS(ios);\r\n\r\n        // Detect Android\r\n        const android = /android/.test(userAgent);\r\n        setIsAndroid(android);\r\n\r\n        // Detect PWA Mode\r\n        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || (window.navigator as any).standalone === true;\r\n        setIsPWA(isStandalone);\r\n\r\n    }, []);\r\n\r\n    return {\r\n        isIOS,\r\n        isAndroid,\r\n        isPWA,\r\n        isMobile: isIOS || isAndroid,\r\n        // Helper classes for Safe Area\r\n        safeAreaTopClass: isIOS && isPWA ? 'pt-[env(safe-area-inset-top)]' : '',\r\n        safeAreaBottomClass: isIOS && isPWA ? 'pb-[env(safe-area-inset-bottom)]' : '',\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useGlobalSearch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useGoals.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useToast' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from '@testing-library/react';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { useGoals } from './useGoals';\r\nimport { SyncQueueService } from '../services/SyncQueueService';\r\nimport { useToast } from '../context/ToastContext';\r\nimport { XP_VALUES } from '../config/gamification';\r\n\r\n// Mock dependencies\r\nvi.mock('../services/SyncQueueService', () => ({\r\n    SyncQueueService: {\r\n        enqueue: vi.fn(),\r\n    },\r\n}));\r\n\r\nvi.mock('../context/ToastContext', () => ({\r\n    useToast: vi.fn(() => ({\r\n        showToast: vi.fn(),\r\n    })),\r\n}));\r\n\r\nvi.mock('../utils/celebration', () => ({\r\n    celebrate: vi.fn(),\r\n}));\r\n\r\nvi.mock('../utils/summaries', () => ({\r\n    addGoalProgressSummary: vi.fn(),\r\n    addCompletionSummary: vi.fn(),\r\n}));\r\n\r\nvi.mock('../utils/deletedItemsBlacklist', () => ({\r\n    addToBlacklist: vi.fn(),\r\n    removeFromBlacklist: vi.fn(),\r\n}));\r\n\r\n// Mock crypto.randomUUID\r\nvi.stubGlobal('crypto', {\r\n    randomUUID: () => 'test-uuid-' + Math.random().toString(36).substring(2)\r\n});\r\n\r\ndescribe('useGoals hook', () => {\r\n    const mockUser = { id: 'user-123', email: 'test@example.com' };\r\n    const mockGamification = { level: 1, xp: 0, nextLevelXp: 100 };\r\n    const awardXP = vi.fn();\r\n    const updateStats = vi.fn();\r\n\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        localStorage.clear();\r\n    });\r\n\r\n    it('should initialize with goals from localStorage', () => {\r\n        const initialGoals = [{ id: '1', title: 'Test Goal', category: 'Study', progress: 0 }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        expect(result.current.goals).toEqual(initialGoals);\r\n    });\r\n\r\n    it('should add a new goal and trigger sync', async () => {\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const newGoalData = {\r\n            title: 'New Goal',\r\n            type: 'simple',\r\n            category: 'Study',\r\n            deadline: '2026-12-31',\r\n            description: 'Description',\r\n            icon: 'üéØ'\r\n        };\r\n\r\n        await act(async () => {\r\n            await result.current.addGoal(newGoalData as any);\r\n        });\r\n\r\n        expect(result.current.goals).toHaveLength(1);\r\n        expect(result.current.goals[0].title).toBe('New Goal');\r\n        expect(awardXP).toHaveBeenCalledWith(XP_VALUES.GOAL * 0.1);\r\n        expect(SyncQueueService.enqueue).toHaveBeenCalledWith(expect.objectContaining({\r\n            type: 'ADD',\r\n            table: 'goals'\r\n        }));\r\n    });\r\n\r\n    it('should fail to add a goal if validation fails', async () => {\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const invalidGoal = { title: '' }; // Title is required and must be min 1\r\n\r\n        await act(async () => {\r\n            await result.current.addGoal(invalidGoal as any);\r\n        });\r\n\r\n        expect(result.current.goals).toHaveLength(0);\r\n    });\r\n\r\n    it('should delete a goal and add to blacklist', async () => {\r\n        const initialGoals = [{ id: 'goal-to-delete', title: 'Delete Me', category: 'Study' }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.deleteGoal('goal-to-delete');\r\n        });\r\n\r\n        expect(result.current.goals).toHaveLength(0);\r\n        expect(SyncQueueService.enqueue).toHaveBeenCalledWith(expect.objectContaining({\r\n            type: 'DELETE',\r\n            table: 'goals'\r\n        }));\r\n    });\r\n\r\n    it('should update a goal', async () => {\r\n        const initialGoals = [{ id: '1', title: 'Old Title', category: 'Study' }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.updateGoal('1', { title: 'New Title' });\r\n        });\r\n\r\n        expect(result.current.goals[0].title).toBe('New Title');\r\n    });\r\n\r\n    it('should toggle goal status and award XP', async () => {\r\n        const initialGoals = [{\r\n            id: '1',\r\n            title: 'Test Goal',\r\n            category: 'Study',\r\n            progress: 0,\r\n            completionHistory: []\r\n        }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoal('1');\r\n        });\r\n\r\n        expect(result.current.goals[0].progress).toBe(100);\r\n        expect(awardXP).toHaveBeenCalledWith(XP_VALUES.GOAL);\r\n    });\r\n\r\n    it('should calculate progress correctly when toggling checklist items', async () => {\r\n        const initialGoals = [{\r\n            id: 'checklist-goal',\r\n            title: 'Checklist',\r\n            type: 'checklist',\r\n            category: 'Study',\r\n            progress: 0,\r\n            checklist: [\r\n                { id: 'item-1', title: 'Item 1', completed: false, order: 0 },\r\n                { id: 'item-2', title: 'Item 2', completed: false, order: 1 }\r\n            ]\r\n        }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoalItem('checklist-goal', 'item-1');\r\n        });\r\n\r\n        expect(result.current.goals[0].progress).toBe(50);\r\n        expect(result.current.goals[0].checklist![0].completed).toBe(true);\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoalItem('checklist-goal', 'item-2');\r\n        });\r\n\r\n        expect(result.current.goals[0].progress).toBe(100);\r\n    });\r\n\r\n    it('should handle habit toggling and history', async () => {\r\n        const initialGoals = [{\r\n            id: 'habit-goal',\r\n            title: 'Habit',\r\n            type: 'habit',\r\n            category: 'Study',\r\n            completionHistory: []\r\n        }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoal('habit-goal');\r\n        });\r\n\r\n        // Habit should add to history\r\n        expect(result.current.goals[0].completionHistory).toHaveLength(1);\r\n        expect(awardXP).toHaveBeenCalledWith(XP_VALUES.GOAL / 5);\r\n    });\r\n\r\n    it('should fail to update a goal if validation fails', async () => {\r\n        const initialGoals = [{ id: '1', title: 'Goal', category: 'Study', type: 'simple' }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.updateGoal('1', { title: '' }); // Invalid title\r\n        });\r\n\r\n        expect(result.current.goals[0].title).toBe('Goal'); // Title should not change\r\n    });\r\n\r\n    it('should add progress summary when updating goal progress', async () => {\r\n        const initialGoals = [{ id: '1', title: 'Goal', category: 'Study', type: 'simple', progress: 0 }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.updateGoal('1', { progress: 50 });\r\n        });\r\n\r\n        const { addGoalProgressSummary } = await import('../utils/summaries');\r\n        expect(addGoalProgressSummary).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should block future dates in toggleGoalItem', async () => {\r\n        const initialGoals = [{\r\n            id: '1',\r\n            type: 'checklist',\r\n            category: 'Study',\r\n            checklist: [{ id: 'i1', title: 'Item', completed: false, order: 0 }]\r\n        }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const futureDate = '2099-12-31';\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoalItem('1', 'i1', futureDate);\r\n        });\r\n\r\n        expect(result.current.goals[0].checklist![0].completed).toBe(false);\r\n    });\r\n\r\n    it('should generate summary when completing a checklist item', async () => {\r\n        const initialGoals = [{\r\n            id: '1',\r\n            type: 'checklist',\r\n            category: 'Study',\r\n            checklist: [{ id: 'i1', title: 'Item', completed: false, order: 0 }]\r\n        }];\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(initialGoals));\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleGoalItem('1', 'i1');\r\n        });\r\n\r\n        const { addGoalProgressSummary } = await import('../utils/summaries');\r\n        expect(addGoalProgressSummary).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should return empty goals if localStorage contains invalid JSON', () => {\r\n        localStorage.setItem('study_goals_backup', 'invalid-json{');\r\n\r\n        // Suppress console.error for this test\r\n        const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => { });\r\n\r\n        const { result } = renderHook(() => useGoals({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        expect(result.current.goals).toEqual([]);\r\n        expect(consoleSpy).toHaveBeenCalled();\r\n        consoleSpy.mockRestore();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useGoals.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_gamification' is defined but never used.","line":22,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_updateStats' is defined but never used.","line":22,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":97},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_error' is defined but never used.","line":113,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":24}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { logger } from '../utils/logger';\r\nimport type { Goal } from '../types';\r\nimport type { User } from '../types/sync';\r\nimport type { GamificationState, GameStats } from '../types/gamification';\r\nimport { GoalSchema } from '../lib/validation';\r\nimport { SyncQueueService } from '../services/SyncQueueService';\r\nimport { XP_VALUES } from '../config/gamification';\r\nimport { celebrate } from '../utils/celebration';\r\nimport { format } from 'date-fns';\r\nimport { useToast } from '../context/ToastContext';\r\nimport { addGoalProgressSummary, addCompletionSummary } from '../utils/summaries';\r\nimport { addToBlacklist, removeFromBlacklist } from '../utils/deletedItemsBlacklist';\r\n\r\ninterface UseGoalsProps {\r\n    user: User | null;\r\n    gamification: GamificationState;\r\n    awardXP: (amount: number) => void;\r\n    updateStats: (updates: Partial<GameStats>) => void;\r\n}\r\n\r\nexport const useGoals = ({ user, gamification: _gamification, awardXP, updateStats: _updateStats }: UseGoalsProps) => {\r\n    const { showToast } = useToast();\r\n    const [goals, setGoals] = useState<Goal[]>(() => {\r\n        try {\r\n            const saved = localStorage.getItem('study_goals_backup');\r\n            return saved ? JSON.parse(saved) : [];\r\n        } catch (e) {\r\n            logger.error(\"Failed to parse study_goals_backup\", e);\r\n            return [];\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(goals));\r\n\r\n        // üõ°Ô∏è CLEANUP: Remove orphaned keys\r\n        const orphanedKeys = ['study_goals', 'study-panel-goals', 'goals_backup'];\r\n        orphanedKeys.forEach(key => {\r\n            if (localStorage.getItem(key)) {\r\n                logger.info(`üßπ Cleaning orphaned localStorage key: ${key}`);\r\n                localStorage.removeItem(key);\r\n            }\r\n        });\r\n    }, [goals]);\r\n\r\n    const addGoal = async (goal: Omit<Goal, 'id' | 'progress' | 'createdAt'>) => {\r\n        if (!user) {\r\n            showToast(\"Erro: Usu√°rio n√£o identificado.\", \"error\");\r\n            return;\r\n        }\r\n        // Validation\r\n        const val = GoalSchema.omit({ id: true, progress: true }).safeParse(goal);\r\n        if (!val.success) {\r\n            showToast(\"Erro: \" + val.error.issues[0].message, \"error\");\r\n            return;\r\n        }\r\n\r\n        const newGoal: Goal = {\r\n            ...goal,\r\n            id: crypto.randomUUID(),\r\n            createdAt: Date.now(),\r\n            progress: 0,\r\n            completionHistory: [],\r\n            sessions: [],\r\n            timeSpent: 0\r\n        };\r\n\r\n        // 1. Optimistic Update\r\n        const updatedGoals = [...goals, newGoal];\r\n        setGoals(updatedGoals);\r\n\r\n        awardXP(XP_VALUES.GOAL * 0.1);\r\n\r\n        // 2. Queue Sync\r\n        SyncQueueService.enqueue({\r\n            type: 'ADD',\r\n            table: 'goals',\r\n            data: { ...newGoal, user_id: user.id }\r\n        });\r\n\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        if (newGoal.startDate && newGoal.startDate > todayStr) {\r\n            showToast(`Meta agendada para iniciar em ${format(new Date(newGoal.startDate + 'T00:00:00'), 'dd/MM')}!`, \"success\");\r\n        } else {\r\n            showToast(\"Meta criada com sucesso!\", \"success\");\r\n        }\r\n    };\r\n\r\n    const deleteGoal = async (goalId: string) => {\r\n        logger.info(`üóëÔ∏è deleteGoal called for ID: ${goalId}`);\r\n        // Optimistic Update\r\n        const previousGoals = [...goals];\r\n        const updatedGoals = goals.filter(g => g.id !== goalId);\r\n        setGoals(updatedGoals);\r\n\r\n        // üî• CRITICAL: Force IMMEDIATE localStorage update\r\n        localStorage.setItem('study_goals_backup', JSON.stringify(updatedGoals));\r\n        logger.info(`üíæ Forced localStorage update: ${updatedGoals.length} goals remaining`);\r\n\r\n        // üö´ NUCLEAR OPTION: Add to permanent blacklist\r\n        addToBlacklist(goalId, 'goal');\r\n\r\n        showToast(\"Meta exclu√≠da com sucesso!\", \"success\");\r\n\r\n        try {\r\n            // Queue Sync\r\n            SyncQueueService.enqueue({\r\n                type: 'DELETE',\r\n                table: 'goals',\r\n                data: { id: goalId }\r\n            });\r\n        } catch (_error) {\r\n            setGoals(previousGoals);\r\n            localStorage.setItem('study_goals_backup', JSON.stringify(previousGoals));\r\n            removeFromBlacklist(goalId, 'goal');\r\n            showToast(\"Erro ao excluir meta.\", \"error\");\r\n        }\r\n    };\r\n\r\n    const updateGoal = async (id: string, updates: Partial<Goal>) => {\r\n        // Validation\r\n        const val = GoalSchema.partial().safeParse(updates);\r\n        if (!val.success) {\r\n            showToast(\"Erro: Dados inv√°lidos.\", \"error\");\r\n            return;\r\n        }\r\n\r\n        // Se o progresso foi atualizado, adicionar resumo\r\n        if (updates.progress !== undefined) {\r\n            const currentGoal = goals.find(g => g.id === id);\r\n            if (currentGoal && currentGoal.progress !== updates.progress) {\r\n                const currentSummaries = currentGoal.summaries || [];\r\n                updates.summaries = addGoalProgressSummary(\r\n                    currentSummaries,\r\n                    updates.progress,\r\n                    `Progresso atualizado de ${Math.round(currentGoal.progress)}% para ${Math.round(updates.progress)}%`,\r\n                    currentGoal.category,\r\n                    { id: currentGoal.id, type: 'goal', title: currentGoal.title }\r\n                );\r\n            }\r\n        }\r\n\r\n        setGoals(prev => prev.map(g => g.id === id ? { ...g, ...updates } : g));\r\n\r\n        if (user) {\r\n            SyncQueueService.enqueue({\r\n                type: 'UPDATE',\r\n                table: 'goals',\r\n                data: { id, ...updates, user_id: user.id }\r\n            });\r\n        }\r\n    };\r\n\r\n    const toggleGoal = async (goalId: string, dateStr?: string, summaryText?: string) => {\r\n        const goal = goals.find(g => g.id === goalId);\r\n        if (!goal) return;\r\n\r\n        const now = new Date();\r\n        const todayStr = format(now, 'yyyy-MM-dd');\r\n        const date = dateStr || todayStr;\r\n\r\n        // PRIORIDADE M√ÅXIMA: Bloquear dias futuros\r\n        if (date > todayStr) {\r\n            showToast(\"Voc√™ n√£o pode concluir atividades de dias futuros!\", \"error\");\r\n            return;\r\n        }\r\n        let updates: Partial<Goal> = {};\r\n        let xpAwarded = 0;\r\n        let isCompletedAction = false;\r\n\r\n        // Check history for ALL goal types to prevent XP farming\r\n        const history = goal.completionHistory || [];\r\n        const hasCompletedTargetDate = history.some(d => d.startsWith(date));\r\n\r\n        if (goal.type === 'habit') {\r\n            let newHistory;\r\n            if (hasCompletedTargetDate) {\r\n                // Uncheck: Deduct XP\r\n                newHistory = history.filter(d => !d.startsWith(date));\r\n                xpAwarded = -(XP_VALUES.GOAL / 5);\r\n            } else {\r\n                // Check\r\n                const completionIso = new Date().toISOString();\r\n                newHistory = [...history, completionIso];\r\n                xpAwarded = XP_VALUES.GOAL / 5;\r\n                isCompletedAction = true;\r\n            }\r\n            updates = { completionHistory: newHistory };\r\n\r\n            // Update progress for UI\r\n            const isCompletedToday = !hasCompletedTargetDate;\r\n            updates.progress = isCompletedToday ? 100 : 0;\r\n\r\n            // Adicionar resumo para h√°bitos\r\n            if (isCompletedAction) {\r\n                const currentSummaries = goal.summaries || [];\r\n                updates.summaries = addCompletionSummary(\r\n                    currentSummaries,\r\n                    summaryText || `H√°bito \"${goal.title}\" conclu√≠do em ${format(now, 'dd/MM/yyyy \\'√†s\\' HH:mm')}`,\r\n                    'habit',\r\n                    { id: goal.id, type: 'goal', title: goal.title }\r\n                );\r\n            }\r\n\r\n        } else {\r\n            // Standard Goal\r\n            const isComplete = goal.progress >= 100;\r\n\r\n            if (isComplete) {\r\n                updates = { progress: 0 };\r\n                xpAwarded = -XP_VALUES.GOAL;\r\n            } else {\r\n                updates = { progress: 100 };\r\n\r\n                if (!hasCompletedTargetDate) {\r\n                    const completionIso = new Date().toISOString();\r\n                    updates.completionHistory = [...history, completionIso];\r\n                    xpAwarded = XP_VALUES.GOAL;\r\n                    isCompletedAction = true;\r\n\r\n                    // Adicionar resumo para metas padr√£o\r\n                    const currentSummaries = goal.summaries || [];\r\n                    updates.summaries = addCompletionSummary(\r\n                        currentSummaries,\r\n                        summaryText || `Meta \"${goal.title}\" conclu√≠da com sucesso! üéØ`,\r\n                        'goal',\r\n                        { id: goal.id, type: 'goal', title: goal.title }\r\n                    );\r\n                }\r\n            }\r\n        }\r\n\r\n        // 1. Optimistic Update\r\n        setGoals(prev => prev.map(g => g.id === goalId ? { ...g, ...updates } : g));\r\n\r\n        // 2. Side Effects\r\n        if (xpAwarded !== 0) {\r\n            awardXP(xpAwarded);\r\n        }\r\n        if (isCompletedAction) {\r\n            celebrate();\r\n        }\r\n\r\n        // 3. Queue Sync\r\n        if (user) {\r\n            SyncQueueService.enqueue({\r\n                type: 'UPDATE',\r\n                table: 'goals',\r\n                data: { id: goalId, ...updates, user_id: user.id }\r\n            });\r\n        }\r\n    };\r\n\r\n    const toggleGoalItem = async (goalId: string, itemId: string, dateStr?: string, summaryText?: string) => {\r\n        const goal = goals.find(g => g.id === goalId);\r\n        if (!goal || !goal.checklist) return;\r\n\r\n        const now = new Date();\r\n        const todayStr = format(now, 'yyyy-MM-dd');\r\n        const date = dateStr || todayStr;\r\n\r\n        // PRIORIDADE M√ÅXIMA: Bloquear dias futuros\r\n        if (date > todayStr) {\r\n            showToast(\"Voc√™ n√£o pode concluir atividades de dias futuros!\", \"error\");\r\n            return;\r\n        }\r\n\r\n        const updatedChecklist = goal.checklist.map(item => {\r\n            if (item.id === itemId) {\r\n                const isNowCompleted = !item.completed;\r\n                return {\r\n                    ...item,\r\n                    completed: isNowCompleted,\r\n                    completedAt: isNowCompleted ? new Date().toISOString() : undefined\r\n                };\r\n            }\r\n            return item;\r\n        });\r\n\r\n        const totalItems = updatedChecklist.length;\r\n        const completedItems = updatedChecklist.filter(i => i.completed).length;\r\n        const newProgress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;\r\n\r\n        const updates: Partial<Goal> = {\r\n            checklist: updatedChecklist,\r\n            progress: newProgress\r\n        };\r\n\r\n        // Add summary if item completed\r\n        const completedItem = updatedChecklist.find(i => i.id === itemId);\r\n        if (completedItem?.completed) {\r\n            const currentSummaries = goal.summaries || [];\r\n            updates.summaries = addGoalProgressSummary(\r\n                currentSummaries,\r\n                newProgress,\r\n                summaryText || `Item \"${completedItem.title}\" conclu√≠do! (${newProgress}%)`,\r\n                goal.category,\r\n                { id: goal.id, type: 'goal', title: goal.title }\r\n            );\r\n        }\r\n\r\n        // 1. Optimistic Update\r\n        setGoals(prev => prev.map(g => g.id === goalId ? { ...g, ...updates } : g));\r\n\r\n        // 2. Award XP if completing an item\r\n        const item = updatedChecklist.find(i => i.id === itemId);\r\n        if (item?.completed) {\r\n            awardXP(XP_VALUES.GOAL / 10);\r\n        }\r\n\r\n        if (user) {\r\n            SyncQueueService.enqueue({\r\n                type: 'UPDATE',\r\n                table: 'goals',\r\n                data: { id: goalId, ...updates, user_id: user.id }\r\n            });\r\n        }\r\n    };\r\n\r\n    return {\r\n        goals,\r\n        setGoals,\r\n        addGoal,\r\n        updateGoal,\r\n        deleteGoal,\r\n        toggleGoal,\r\n        toggleGoalItem\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useLayoutModals.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useLayoutModals.ts:68:13\n  66 |             setIsSummaryModalOpen(false);\n  67 |             setIsMissionModalOpen(false);\n> 68 |             setIsTaskModalOpen(false);\n     |             ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  69 |             setIsGoalModalOpen(false);\n  70 |             setIsThemeModalOpen(false);\n  71 |             setIsSidebarOpen(false);","line":68,"column":13,"nodeType":null,"endLine":68,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setIsMissionModalOpen'. Either include it or remove the dependency array. If 'setIsMissionModalOpen' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":76,"column":8,"nodeType":"ArrayExpression","endLine":76,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [activeFocus, setIsMissionModalOpen, setIsSummaryModalOpen]","fix":{"range":[3297,3333],"text":"[activeFocus, setIsMissionModalOpen, setIsSummaryModalOpen]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useStudy } from '../context/StudyContext';\r\nimport type { Goal, Theme } from '../types';\r\n\r\nexport const useLayoutModals = (\r\n    activeFocus: boolean,\r\n    setIsSummaryModalOpen: (isOpen: boolean) => void,\r\n    isMissionModalOpen: boolean,\r\n    setIsMissionModalOpen: (isOpen: boolean) => void\r\n) => {\r\n    const { user } = useAuth();\r\n    const { themes, goals, tasks } = useStudy();\r\n\r\n    // Modals\r\n    const [isTaskModalOpen, setIsTaskModalOpen] = useState(false);\r\n    const [isGoalModalOpen, setIsGoalModalOpen] = useState(false);\r\n    const [isThemeModalOpen, setIsThemeModalOpen] = useState(false);\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(false);\r\n    const [isOnboardingOpen, setIsOnboardingOpen] = useState(false);\r\n\r\n    // Edit states\r\n    const [goalToEdit, setGoalToEdit] = useState<undefined | Goal>(undefined);\r\n    const [themeToEdit, setThemeToEdit] = useState<undefined | Theme>(undefined);\r\n    const [preselectedThemeId, setPreselectedThemeId] = useState<undefined | string>(undefined);\r\n    const [themeCategory, setThemeCategory] = useState<'study' | 'project'>('study');\r\n    const [defaultGoalType, setDefaultGoalType] = useState<'simple' | 'checklist' | 'habit'>('simple');\r\n\r\n    const handleEditGoal = (goal: Goal) => {\r\n        setGoalToEdit(goal);\r\n        setIsGoalModalOpen(true);\r\n        setIsSummaryModalOpen(false);\r\n    };\r\n\r\n    const handleEditTheme = (theme: Theme) => {\r\n        setThemeToEdit(theme);\r\n        // Determine category from theme\r\n        setThemeCategory((theme as any).category || 'study');\r\n        setIsThemeModalOpen(true);\r\n        setIsSummaryModalOpen(false);\r\n    };\r\n\r\n    const handleOpenGoalModalWithTheme = (themeId: string) => {\r\n        setPreselectedThemeId(themeId);\r\n        setGoalToEdit(undefined); // Ensure we are not editing\r\n        setIsGoalModalOpen(true);\r\n        setIsSummaryModalOpen(false); // Close summary to focus on creation\r\n    };\r\n\r\n    // Onboarding Trigger\r\n    useEffect(() => {\r\n        const isCompletelyEmpty = themes.length === 0 && goals.length === 0 && tasks.length === 0;\r\n        const isDismissed = localStorage.getItem('onboarding_dismissed') === 'true';\r\n\r\n        const timer = setTimeout(() => {\r\n            if (user && !isDismissed && (user.name === 'User' || user.name === undefined || isCompletelyEmpty)) {\r\n                setIsOnboardingOpen(true);\r\n            }\r\n        }, 1000);\r\n        return () => clearTimeout(timer);\r\n    }, [user, themes.length, goals.length, tasks.length]);\r\n\r\n    // Auto-close overlaying UI when Focus Mode starts\r\n    useEffect(() => {\r\n        if (activeFocus) {\r\n            setIsSummaryModalOpen(false);\r\n            setIsMissionModalOpen(false);\r\n            setIsTaskModalOpen(false);\r\n            setIsGoalModalOpen(false);\r\n            setIsThemeModalOpen(false);\r\n            setIsSidebarOpen(false);\r\n            // Note: isMobileMenuOpen logic remains in component or needs to be passed here if managed here\r\n            // But MobileMenu logic was in MainLayout state: [isMobileMenuOpen, setIsMobileMenuOpen] \r\n            // We should probably include it here to centralize ALL overlay UI state.\r\n        }\r\n    }, [activeFocus, setIsSummaryModalOpen]);\r\n\r\n\r\n    return {\r\n        state: {\r\n            isTaskModalOpen,\r\n            isGoalModalOpen,\r\n            isThemeModalOpen,\r\n            isMissionModalOpen,\r\n            isSidebarOpen,\r\n            isOnboardingOpen,\r\n            goalToEdit,\r\n            themeToEdit,\r\n            preselectedThemeId,\r\n            themeCategory,\r\n            defaultGoalType\r\n        },\r\n        actions: {\r\n            setIsTaskModalOpen,\r\n            setIsGoalModalOpen,\r\n            setIsThemeModalOpen,\r\n            setIsMissionModalOpen,\r\n            setIsSidebarOpen,\r\n            setIsOnboardingOpen,\r\n            setGoalToEdit,\r\n            setThemeToEdit,\r\n            setPreselectedThemeId,\r\n            setThemeCategory,\r\n            setDefaultGoalType,\r\n            handleEditGoal,\r\n            handleEditTheme,\r\n            handleOpenGoalModalWithTheme\r\n        }\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useLocalStorage.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useLocalStorage.ts:42:9\n  40 |\n  41 |     useEffect(() => {\n> 42 |         setStoredValue(readValue());\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |     }, [key]);\n  44 |\n  45 |     return [storedValue, setValue] as const;","line":42,"column":9,"nodeType":null,"endLine":42,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'readValue'. Either include it or remove the dependency array.","line":43,"column":8,"nodeType":"ArrayExpression","endLine":43,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [key, readValue]","fix":{"range":[1530,1535],"text":"[key, readValue]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\n\r\nexport function useLocalStorage<T>(key: string, initialValue: T) {\r\n    // Get from local storage then\r\n    // parse stored json or return initialValue\r\n    const readValue = () => {\r\n        if (typeof window === 'undefined') {\r\n            return initialValue;\r\n        }\r\n\r\n        try {\r\n            const item = window.localStorage.getItem(key);\r\n            if (!item) return initialValue;\r\n            const parsed = JSON.parse(item);\r\n            return parsed !== null ? parsed : initialValue;\r\n        } catch (error) {\r\n            console.warn(`Error reading localStorage key ‚Äú${key}‚Äù:`, error);\r\n            return initialValue;\r\n        }\r\n    };\r\n\r\n    const [storedValue, setStoredValue] = useState<T>(readValue);\r\n\r\n    // Return a wrapped version of useState's setter function that ...\r\n    // ... persists the new value to localStorage.\r\n    const setValue = (value: T | ((val: T) => T)) => {\r\n        try {\r\n            // Allow value to be a function so we have same API as useState\r\n            const valueToStore = value instanceof Function ? value(storedValue) : value;\r\n\r\n            setStoredValue(valueToStore);\r\n\r\n            if (typeof window !== 'undefined') {\r\n                window.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n            }\r\n        } catch (error) {\r\n            console.warn(`Error setting localStorage key ‚Äú${key}‚Äù:`, error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setStoredValue(readValue());\r\n    }, [key]);\r\n\r\n    return [storedValue, setValue] as const;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useNotifications.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useNotifications.ts:9:9\n   7 |\n   8 |     useEffect(() => {\n>  9 |         setIsSupported('Notification' in window);\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  10 |         setHasPermission(Notification.permission === 'granted');\n  11 |     }, []);\n  12 |","line":9,"column":9,"nodeType":null,"endLine":9,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { NotificationService } from '../services/NotificationService';\r\n\r\nexport const useNotifications = () => {\r\n    const [hasPermission, setHasPermission] = useState(false);\r\n    const [isSupported, setIsSupported] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setIsSupported('Notification' in window);\r\n        setHasPermission(Notification.permission === 'granted');\r\n    }, []);\r\n\r\n    const requestPermission = useCallback(async () => {\r\n        const granted = await NotificationService.requestPermission();\r\n        setHasPermission(granted);\r\n        return granted;\r\n    }, []);\r\n\r\n    const sendNotification = useCallback((title: string, body: string, icon?: string) => {\r\n        NotificationService.showNotification(title, body, icon);\r\n    }, []);\r\n\r\n    const sendReviewReminder = useCallback((themeTitle: string, reviewNumber: number) => {\r\n        NotificationService.showNotification(\r\n            'üìö Hora de Revisar!',\r\n            `${themeTitle} - Revis√£o ${reviewNumber} est√° pronta`,\r\n            'üìö'\r\n        );\r\n    }, []);\r\n\r\n    const sendTaskReminder = useCallback((taskTitle: string, isOverdue: boolean = false) => {\r\n        NotificationService.showNotification(\r\n            isOverdue ? '‚ö†Ô∏è Tarefa Atrasada!' : 'üìã Lembrete de Tarefa',\r\n            taskTitle,\r\n            isOverdue ? '‚ö†Ô∏è' : 'üìã'\r\n        );\r\n    }, []);\r\n\r\n    const sendPomodoroComplete = useCallback((mode: 'focus' | 'break') => {\r\n        const isFocus = mode === 'focus';\r\n        NotificationService.showNotification(\r\n            isFocus ? 'üéâ Foco Completo!' : '‚è∞ Pausa Terminada!',\r\n            isFocus\r\n                ? '√ìtimo trabalho! Hora de fazer uma pausa.'\r\n                : 'Pausa terminada! Pronto para focar?',\r\n            isFocus ? 'üéâ' : '‚è∞'\r\n        );\r\n    }, []);\r\n\r\n    const sendDailySummary = useCallback((tasksToday: number, reviewsToday: number) => {\r\n        if (tasksToday === 0 && reviewsToday === 0) return;\r\n\r\n        const parts: string[] = [];\r\n        if (tasksToday > 0) parts.push(`${tasksToday} tarefa${tasksToday !== 1 ? 's' : ''}`);\r\n        if (reviewsToday > 0) parts.push(`${reviewsToday} revis√£o${reviewsToday !== 1 ? '√µes' : ''}`);\r\n\r\n        NotificationService.showNotification(\r\n            '‚òÄÔ∏è Bom dia!',\r\n            `Voc√™ tem ${parts.join(' e ')} para hoje`,\r\n            '‚òÄÔ∏è'\r\n        );\r\n    }, []);\r\n\r\n    return {\r\n        isSupported,\r\n        hasPermission,\r\n        requestPermission,\r\n        sendNotification,\r\n        sendReviewReminder,\r\n        sendTaskReminder,\r\n        sendPomodoroComplete,\r\n        sendDailySummary,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOnboarding.ts","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`completeOnboarding` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOnboarding.ts:95:13\n  93 |             setCurrentStep(prev => prev + 1);\n  94 |         } else {\n> 95 |             completeOnboarding();\n     |             ^^^^^^^^^^^^^^^^^^ `completeOnboarding` accessed before it is declared\n  96 |         }\n  97 |     }, [currentStep]);\n  98 |\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOnboarding.ts:111:5\n  109 |     }, []);\n  110 |\n> 111 |     const completeOnboarding = useCallback(() => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 112 |         setIsActive(false);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 113 |         localStorage.setItem('onboarding_completed', 'true');\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 114 |         setIsCompleted(true);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 115 |     }, []);\n      | ^^^^^^^^^^^^ `completeOnboarding` is declared here\n  116 |\n  117 |     const resetOnboarding = useCallback(() => {\n  118 |         localStorage.removeItem('onboarding_completed');","line":95,"column":13,"nodeType":null,"endLine":95,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'completeOnboarding'. Either include it or remove the dependency array.","line":97,"column":8,"nodeType":"ArrayExpression","endLine":97,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [completeOnboarding, currentStep]","fix":{"range":[3288,3301],"text":"[completeOnboarding, currentStep]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\n\r\nexport interface TourStep {\r\n    id: string;\r\n    title: string;\r\n    description: string;\r\n    target?: string; // CSS selector or element ID\r\n    placement?: 'top' | 'bottom' | 'left' | 'right' | 'center';\r\n    action?: {\r\n        label: string;\r\n        onClick: () => void;\r\n    };\r\n}\r\n\r\nconst TOUR_STEPS: TourStep[] = [\r\n    {\r\n        id: 'welcome',\r\n        title: 'Bem-vindo ao Study Panel! üéì',\r\n        description: 'Vamos fazer um tour r√°pido pelas principais funcionalidades para voc√™ come√ßar a estudar de forma mais eficiente.',\r\n        placement: 'center',\r\n    },\r\n    {\r\n        id: 'dashboard',\r\n        title: 'Este √© seu painel central',\r\n        description: 'Aqui voc√™ v√™ suas miss√µes do dia, progresso e estat√≠sticas em tempo real.',\r\n        target: '#dashboard-main',\r\n        placement: 'bottom',\r\n    },\r\n    {\r\n        id: 'srs',\r\n        title: 'Sistema de Revis√£o Espa√ßada (SRS) üìö',\r\n        description: 'Revis√µes otimizadas cientificamente para m√°xima reten√ß√£o de conhecimento a longo prazo.',\r\n        target: '#srs-widget',\r\n        placement: 'left',\r\n    },\r\n    {\r\n        id: 'pomodoro',\r\n        title: 'Foque com a t√©cnica Pomodoro üçÖ',\r\n        description: '25 minutos de foco intenso seguidos de 5 minutos de pausa. A ci√™ncia comprova!',\r\n        target: '#pomodoro-widget',\r\n        placement: 'left',\r\n    },\r\n    {\r\n        id: 'gamification',\r\n        title: 'Ganhe XP e suba de n√≠vel! üèÜ',\r\n        description: 'Cada minuto focado rende 10 XP. Desbloqueie conquistas e acompanhe seu progresso.',\r\n        target: '#gamification-widget',\r\n        placement: 'left',\r\n    },\r\n    {\r\n        id: 'themes',\r\n        title: 'Organize seus estudos em Temas',\r\n        description: 'Crie temas para suas mat√©rias e subtemas para organizar o conte√∫do.',\r\n        target: '[href=\"/themes\"]',\r\n        placement: 'right',\r\n    },\r\n    {\r\n        id: 'projects',\r\n        title: 'Gerencie projetos profissionais üíº',\r\n        description: 'Separe projetos de trabalho dos seus estudos acad√™micos.',\r\n        target: '[href=\"/projects\"]',\r\n        placement: 'right',\r\n    },\r\n    {\r\n        id: 'complete',\r\n        title: 'Voc√™ est√° pronto! üéâ',\r\n        description: 'Explore livremente e aproveite todas as funcionalidades. Bons estudos!',\r\n        placement: 'center',\r\n    },\r\n];\r\n\r\nexport const useOnboarding = () => {\r\n    const [isActive, setIsActive] = useState(false);\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [isCompleted, setIsCompleted] = useState(false);\r\n\r\n    // Check if onboarding was completed\r\n    useEffect(() => {\r\n        const completed = localStorage.getItem('onboarding_completed');\r\n        if (completed === 'true') {\r\n            setIsCompleted(true);\r\n        } else {\r\n            // Auto-start onboarding for new users after a short delay\r\n            const timer = setTimeout(() => {\r\n                setIsActive(true);\r\n            }, 1500);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, []);\r\n\r\n    const nextStep = useCallback(() => {\r\n        if (currentStep < TOUR_STEPS.length - 1) {\r\n            setCurrentStep(prev => prev + 1);\r\n        } else {\r\n            completeOnboarding();\r\n        }\r\n    }, [currentStep]);\r\n\r\n    const prevStep = useCallback(() => {\r\n        if (currentStep > 0) {\r\n            setCurrentStep(prev => prev - 1);\r\n        }\r\n    }, [currentStep]);\r\n\r\n    const skipOnboarding = useCallback(() => {\r\n        setIsActive(false);\r\n        localStorage.setItem('onboarding_completed', 'true');\r\n        setIsCompleted(true);\r\n    }, []);\r\n\r\n    const completeOnboarding = useCallback(() => {\r\n        setIsActive(false);\r\n        localStorage.setItem('onboarding_completed', 'true');\r\n        setIsCompleted(true);\r\n    }, []);\r\n\r\n    const resetOnboarding = useCallback(() => {\r\n        localStorage.removeItem('onboarding_completed');\r\n        setCurrentStep(0);\r\n        setIsActive(true);\r\n        setIsCompleted(false);\r\n    }, []);\r\n\r\n    return {\r\n        isActive,\r\n        currentStep,\r\n        totalSteps: TOUR_STEPS.length,\r\n        currentStepData: TOUR_STEPS[currentStep],\r\n        nextStep,\r\n        prevStep,\r\n        skipOnboarding,\r\n        completeOnboarding,\r\n        resetOnboarding,\r\n        isCompleted,\r\n        progress: ((currentStep + 1) / TOUR_STEPS.length) * 100,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOptimization.ts","messages":[{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the first argument to be an inline function expression\n\nExpected the first argument to be an inline function expression.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOptimization.ts:36:9\n  34 |\n  35 |     return useCallback(\n> 36 |         ((...args) => {\n     |         ^^^^^^^^^^^^^^^\n> 37 |             if (Date.now() - lastRan.current >= delay) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 38 |                 callback(...args);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 39 |                 lastRan.current = Date.now();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 40 |             }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 41 |         }) as T,\n     | ^^^^^^^^^^^^^^^^ Expected the first argument to be an inline function expression\n  42 |         [callback, delay]\n  43 |     );\n  44 | }","line":36,"column":9,"nodeType":null,"endLine":41,"endColumn":16},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOptimization.ts:82:9\n  80 |\n  81 |         // Set initial value\n> 82 |         setMatches(mediaQuery.matches);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  83 |\n  84 |         // Listen for changes\n  85 |         if (mediaQuery.addEventListener) {","line":82,"column":9,"nodeType":null,"endLine":82,"endColumn":19},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOptimization.ts:132:12\n  130 |     }, [value]);\n  131 |\n> 132 |     return ref.current;\n      |            ^^^^^^^^^^^ Cannot access ref value during render\n  133 | }\n  134 |\n  135 | /**","line":132,"column":12,"nodeType":null,"endLine":132,"endColumn":23},{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the first argument to be an inline function expression\n\nExpected the first argument to be an inline function expression.\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useOptimization.ts:148:24\n  146 |     }, [fn]);\n  147 |\n> 148 |     return useCallback(((...args) => ref.current(...args)) as T, []);\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Expected the first argument to be an inline function expression\n  149 | }\n  150 |\n  151 | /**","line":148,"column":24,"nodeType":null,"endLine":148,"endColumn":64}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef, useCallback } from 'react';\r\n\r\n/**\r\n * Hook for debouncing values to reduce unnecessary re-renders and API calls\r\n * @param value - The value to debounce\r\n * @param delay - Delay in milliseconds (default: 500ms)\r\n */\r\nexport function useDebounce<T>(value: T, delay: number = 500): T {\r\n    const [debouncedValue, setDebouncedValue] = useState<T>(value);\r\n\r\n    useEffect(() => {\r\n        const handler = setTimeout(() => {\r\n            setDebouncedValue(value);\r\n        }, delay);\r\n\r\n        return () => {\r\n            clearTimeout(handler);\r\n        };\r\n    }, [value, delay]);\r\n\r\n    return debouncedValue;\r\n}\r\n\r\n/**\r\n * Hook for throttling function calls\r\n * @param callback - Function to throttle\r\n * @param delay - Delay in milliseconds (default: 500ms)\r\n */\r\nexport function useThrottle<T extends (...args: unknown[]) => unknown>(\r\n    callback: T,\r\n    delay: number = 500\r\n): T {\r\n    const lastRan = useRef(Date.now());\r\n\r\n    return useCallback(\r\n        ((...args) => {\r\n            if (Date.now() - lastRan.current >= delay) {\r\n                callback(...args);\r\n                lastRan.current = Date.now();\r\n            }\r\n        }) as T,\r\n        [callback, delay]\r\n    );\r\n}\r\n\r\n/**\r\n * Hook to track if component is mounted\r\n * Useful for preventing state updates on unmounted components\r\n */\r\nexport function useIsMounted(): () => boolean {\r\n    const isMounted = useRef(false);\r\n\r\n    useEffect(() => {\r\n        isMounted.current = true;\r\n        return () => {\r\n            isMounted.current = false;\r\n        };\r\n    }, []);\r\n\r\n    return useCallback(() => isMounted.current, []);\r\n}\r\n\r\n/**\r\n * Hook for media queries\r\n * @param query - Media query string\r\n */\r\nexport function useMediaQuery(query: string): boolean {\r\n    const [matches, setMatches] = useState(() => {\r\n        if (typeof window !== 'undefined') {\r\n            return window.matchMedia(query).matches;\r\n        }\r\n        return false;\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (typeof window === 'undefined') return;\r\n\r\n        const mediaQuery = window.matchMedia(query);\r\n        const handler = (event: MediaQueryListEvent) => setMatches(event.matches);\r\n\r\n        // Set initial value\r\n        setMatches(mediaQuery.matches);\r\n\r\n        // Listen for changes\r\n        if (mediaQuery.addEventListener) {\r\n            mediaQuery.addEventListener('change', handler);\r\n            return () => mediaQuery.removeEventListener('change', handler);\r\n        } else {\r\n            // Fallback for older browsers\r\n            mediaQuery.addListener(handler);\r\n            return () => mediaQuery.removeListener(handler);\r\n        }\r\n    }, [query]);\r\n\r\n    return matches;\r\n}\r\n\r\n/**\r\n * Hook for detecting clicks outside an element\r\n * @param callback - Function to call when clicking outside\r\n */\r\nexport function useClickOutside<T extends HTMLElement = HTMLElement>(\r\n    callback: () => void\r\n): React.RefObject<T | null> {\r\n    const ref = useRef<T | null>(null);\r\n\r\n    useEffect(() => {\r\n        const handleClick = (event: MouseEvent) => {\r\n            if (ref.current && !ref.current.contains(event.target as Node)) {\r\n                callback();\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousedown', handleClick);\r\n        return () => document.removeEventListener('mousedown', handleClick);\r\n    }, [callback]);\r\n\r\n    return ref;\r\n}\r\n\r\n/**\r\n * Hook for managing previous value\r\n * @param value - Current value\r\n */\r\nexport function usePrevious<T>(value: T): T | undefined {\r\n    const ref = useRef<T | undefined>(undefined);\r\n\r\n    useEffect(() => {\r\n        ref.current = value;\r\n    }, [value]);\r\n\r\n    return ref.current;\r\n}\r\n\r\n/**\r\n * Hook for creating a stable callback that doesn't change between renders\r\n * Similar to useCallback but doesn't require dependencies\r\n */\r\nexport function useEventCallback<T extends (...args: unknown[]) => unknown>(\r\n    fn: T\r\n): T {\r\n    const ref = useRef(fn);\r\n\r\n    useEffect(() => {\r\n        ref.current = fn;\r\n    }, [fn]);\r\n\r\n    return useCallback(((...args) => ref.current(...args)) as T, []);\r\n}\r\n\r\n/**\r\n * Hook for local storage with state synchronization\r\n * @param key - Storage key\r\n * @param initialValue - Initial value if key doesn't exist\r\n */\r\nexport function useLocalStorage<T>(\r\n    key: string,\r\n    initialValue: T\r\n): [T, (value: T | ((val: T) => T)) => void] {\r\n    // State to store our value\r\n    const [storedValue, setStoredValue] = useState<T>(() => {\r\n        if (typeof window === 'undefined') {\r\n            return initialValue;\r\n        }\r\n        try {\r\n            const item = window.localStorage.getItem(key);\r\n            return item ? JSON.parse(item) : initialValue;\r\n        } catch (error) {\r\n            console.error(`Error reading localStorage key \"${key}\":`, error);\r\n            return initialValue;\r\n        }\r\n    });\r\n\r\n    // Return a wrapped version of useState's setter function that persists to localStorage\r\n    const setValue = useCallback(\r\n        (value: T | ((val: T) => T)) => {\r\n            try {\r\n                // Allow value to be a function so we have same API as useState\r\n                const valueToStore = value instanceof Function ? value(storedValue) : value;\r\n                setStoredValue(valueToStore);\r\n                if (typeof window !== 'undefined') {\r\n                    window.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n                }\r\n            } catch (error) {\r\n                console.error(`Error setting localStorage key \"${key}\":`, error);\r\n            }\r\n        },\r\n        [key, storedValue]\r\n    );\r\n\r\n    return [storedValue, setValue];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\usePomodoro.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\usePomodoro.ts:64:13\n  62 |             }, 1000);\n  63 |         } else if (timeLeft === 0) {\n> 64 |             handleTimerComplete();\n     |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  65 |         }\n  66 |\n  67 |         return () => clearInterval(interval);","line":64,"column":13,"nodeType":null,"endLine":64,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\r\n\r\ntype Mode = 'focus' | 'shortBreak' | 'longBreak';\r\n\r\nconst SETTINGS = {\r\n    focus: 25 * 60,\r\n    shortBreak: 5 * 60,\r\n    longBreak: 15 * 60,\r\n    cyclesForLongBreak: 4,\r\n};\r\n\r\nexport const usePomodoro = () => {\r\n    const [mode, setMode] = useState<Mode>('focus');\r\n    const [timeLeft, setTimeLeft] = useState(SETTINGS.focus);\r\n    const [isActive, setIsActive] = useState(false);\r\n    const [cycles, setCycles] = useState(0);\r\n\r\n    // Audio ref (we'll create an Audio object)\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    useEffect(() => {\r\n        audioRef.current = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3'); // Simple clear bell\r\n    }, []);\r\n\r\n    const playSound = useCallback(() => {\r\n        if (audioRef.current) {\r\n            audioRef.current.currentTime = 0;\r\n            audioRef.current.play().catch(() => { });\r\n        }\r\n    }, []);\r\n\r\n    const switchMode = useCallback((nextMode: Mode) => {\r\n        setMode(nextMode);\r\n        setTimeLeft(SETTINGS[nextMode]);\r\n        setIsActive(false);\r\n    }, []);\r\n\r\n    const handleTimerComplete = useCallback(() => {\r\n        playSound();\r\n\r\n        if (mode === 'focus') {\r\n            const newCycles = cycles + 1;\r\n            setCycles(newCycles);\r\n\r\n            if (newCycles % SETTINGS.cyclesForLongBreak === 0) {\r\n                switchMode('longBreak');\r\n            } else {\r\n                switchMode('shortBreak');\r\n            }\r\n        } else {\r\n            // Break is over, back to work!\r\n            switchMode('focus');\r\n        }\r\n    }, [mode, cycles, playSound, switchMode]);\r\n\r\n    useEffect(() => {\r\n        let interval: ReturnType<typeof setInterval>;\r\n\r\n        if (isActive && timeLeft > 0) {\r\n            interval = setInterval(() => {\r\n                setTimeLeft((time) => time - 1);\r\n            }, 1000);\r\n        } else if (timeLeft === 0) {\r\n            handleTimerComplete();\r\n        }\r\n\r\n        return () => clearInterval(interval);\r\n    }, [isActive, timeLeft, handleTimerComplete]);\r\n\r\n    const toggleTimer = () => setIsActive(!isActive);\r\n\r\n    const resetTimer = () => {\r\n        setIsActive(false);\r\n        setTimeLeft(SETTINGS[mode]);\r\n    };\r\n\r\n    const skipTimer = () => {\r\n        handleTimerComplete();\r\n    };\r\n\r\n    return {\r\n        mode,\r\n        timeLeft,\r\n        isActive,\r\n        cycles,\r\n        toggleTimer,\r\n        resetTimer,\r\n        skipTimer,\r\n        settings: SETTINGS\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useSRSLogic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useTasks.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useToast' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":94,"column":61,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":94,"endColumn":62,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2966,2967],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2966,2966],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":94,"column":66,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":94,"endColumn":67,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2971,2972],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2971,2971],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from '@testing-library/react';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { useTasks } from './useTasks';\r\nimport { SyncQueueService } from '../services/SyncQueueService';\r\nimport { useToast } from '../context/ToastContext';\r\nimport { XP_VALUES } from '../config/gamification';\r\nimport { format } from 'date-fns';\r\n\r\n// Mock dependencies\r\nvi.mock('../services/SyncQueueService', () => ({\r\n    SyncQueueService: {\r\n        enqueue: vi.fn(),\r\n    },\r\n}));\r\n\r\nvi.mock('../context/ToastContext', () => ({\r\n    useToast: vi.fn(() => ({\r\n        showToast: vi.fn(),\r\n    })),\r\n}));\r\n\r\nvi.mock('../utils/celebration', () => ({\r\n    celebrate: vi.fn(),\r\n}));\r\n\r\nvi.mock('../utils/summaries', () => ({\r\n    addCompletionSummary: vi.fn(),\r\n    addSessionSummary: vi.fn(),\r\n}));\r\n\r\nvi.mock('../utils/deletedItemsBlacklist', () => ({\r\n    addToBlacklist: vi.fn(),\r\n    removeFromBlacklist: vi.fn(),\r\n}));\r\n\r\n// Mock crypto.randomUUID\r\nvi.stubGlobal('crypto', {\r\n    randomUUID: () => 'task-uuid-' + Math.random().toString(36).substring(2)\r\n});\r\n\r\ndescribe('useTasks hook', () => {\r\n    const mockUser = { id: 'user-123', email: 'test@example.com' };\r\n    const mockGamification = { level: 1, xp: 0, nextLevelXp: 100 };\r\n    const awardXP = vi.fn();\r\n    const updateStats = vi.fn();\r\n\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        localStorage.clear();\r\n    });\r\n\r\n    it('should initialize with tasks from localStorage', () => {\r\n        const initialTasks = [{ id: '1', title: 'Test Task', status: 'pending', priority: 'medium', type: 'day' }];\r\n        localStorage.setItem('study_tasks_backup', JSON.stringify(initialTasks));\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        expect(result.current.tasks).toEqual(initialTasks);\r\n    });\r\n\r\n    it('should add a new task and trigger sync', async () => {\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const newTaskData = {\r\n            title: 'New Task',\r\n            type: 'day',\r\n            priority: 'high' as const,\r\n            date: format(new Date(), 'yyyy-MM-dd')\r\n        };\r\n\r\n        await act(async () => {\r\n            await result.current.addTask(newTaskData as any);\r\n        });\r\n\r\n        expect(result.current.tasks).toHaveLength(1);\r\n        expect(result.current.tasks[0].title).toBe('New Task');\r\n        expect(awardXP).toHaveBeenCalledWith(XP_VALUES.TASK * 0.1);\r\n        expect(SyncQueueService.enqueue).toHaveBeenCalledWith(expect.objectContaining({\r\n            type: 'ADD',\r\n            table: 'tasks'\r\n        }));\r\n    });\r\n\r\n    it('should fail to add a task with future date for type \\\"day\\\"', async () => {\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const futureTask = {\r\n            title: 'Future Task',\r\n            type: 'day',\r\n            priority: 'low' as const,\r\n            date: '2099-12-31'\r\n        };\r\n\r\n        await act(async () => {\r\n            await result.current.addTask(futureTask as any);\r\n        });\r\n\r\n        expect(result.current.tasks).toHaveLength(0);\r\n    });\r\n\r\n    it('should delete a task and trigger sync', async () => {\r\n        const initialTasks = [{ id: 'task-1', title: 'Delete Me', type: 'day', priority: 'medium' }];\r\n        localStorage.setItem('study_tasks_backup', JSON.stringify(initialTasks));\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.deleteTask('task-1');\r\n        });\r\n\r\n        expect(result.current.tasks).toHaveLength(0);\r\n        expect(SyncQueueService.enqueue).toHaveBeenCalledWith(expect.objectContaining({\r\n            type: 'DELETE',\r\n            table: 'tasks'\r\n        }));\r\n    });\r\n\r\n    it('should update a task', async () => {\r\n        const initialTasks = [{ id: '1', title: 'Old', type: 'day', priority: 'low' }];\r\n        localStorage.setItem('study_tasks_backup', JSON.stringify(initialTasks));\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.updateTask('1', { title: 'New' });\r\n        });\r\n\r\n        expect(result.current.tasks[0].title).toBe('New');\r\n    });\r\n\r\n    it('should toggle task status and award XP', async () => {\r\n        const initialTasks = [{\r\n            id: '1',\r\n            title: 'Task',\r\n            status: 'pending',\r\n            type: 'day',\r\n            priority: 'medium',\r\n            completionHistory: []\r\n        }];\r\n        localStorage.setItem('study_tasks_backup', JSON.stringify(initialTasks));\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleTask('1');\r\n        });\r\n\r\n        expect(result.current.tasks[0].status).toBe('completed');\r\n        expect(awardXP).toHaveBeenCalledWith(XP_VALUES.TASK);\r\n    });\r\n\r\n    it('should fail to add a task if validation fails', async () => {\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        const invalidTask = { title: '' }; // Title required\r\n\r\n        await act(async () => {\r\n            await result.current.addTask(invalidTask as any);\r\n        });\r\n\r\n        expect(result.current.tasks).toHaveLength(0);\r\n    });\r\n\r\n    it('should add completion summary when toggling task to complete', async () => {\r\n        const initialTasks = [{\r\n            id: '1',\r\n            title: 'Task',\r\n            status: 'pending',\r\n            type: 'day',\r\n            priority: 'medium',\r\n            completionHistory: []\r\n        }];\r\n        localStorage.setItem('study_tasks_backup', JSON.stringify(initialTasks));\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        await act(async () => {\r\n            await result.current.toggleTask('1');\r\n        });\r\n\r\n        const { addCompletionSummary } = await import('../utils/summaries');\r\n        expect(addCompletionSummary).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle JSON parse error during initialization', () => {\r\n        localStorage.setItem('study_tasks_backup', 'invalid[');\r\n        const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => { });\r\n\r\n        const { result } = renderHook(() => useTasks({\r\n            user: mockUser as any,\r\n            gamification: mockGamification as any,\r\n            awardXP,\r\n            updateStats\r\n        }));\r\n\r\n        expect(result.current.tasks).toEqual([]);\r\n        consoleSpy.mockRestore();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useTasks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useTemplates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useThemes.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\hooks\\useThemes.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_subthemes' is assigned a value but never used.","line":155,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_durationMinutes' is assigned a value but never used.","line":214,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":50}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { logger } from '../utils/logger';\r\nimport type { Theme, Subtheme, Review } from '../types';\r\nimport type { User } from '../types/sync';\r\nimport type { GamificationState, GameStats } from '../types/gamification';\r\nimport { SyncQueueService } from '../services/SyncQueueService';\r\nimport { SRSService } from '../services/SRSService';\r\nimport { XP_VALUES } from '../config/gamification';\r\nimport { celebrate } from '../utils/celebration';\r\nimport { format } from 'date-fns';\r\nimport { parseLocalDate } from '../utils/dateHelpers';\r\nimport { useToast } from '../context/ToastContext';\r\nimport { addReviewSummary, addCompletionSummary } from '../utils/summaries';\r\n\r\nconst calculateInitialSubthemeState = (\r\n    startDate: string | undefined,\r\n    idx: number,\r\n    difficulty: string | undefined\r\n) => {\r\n    let introDate: string | undefined = undefined;\r\n    let status: 'queue' | 'active' = 'queue';\r\n    let reviews: Review[] = [];\r\n\r\n    if (startDate && difficulty !== 'module') {\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        const introObj = parseLocalDate(startDate);\r\n        introObj.setDate(introObj.getDate() + idx);\r\n        introDate = format(introObj, 'yyyy-MM-dd');\r\n\r\n        if (idx === 0 && introDate <= todayStr) {\r\n            status = 'active';\r\n        }\r\n\r\n        const offsets = [1, 3, 7, 15, 30];\r\n        reviews = offsets.map((offset, reviewIdx) => {\r\n            const reviewDateObj = new Date(introObj);\r\n            reviewDateObj.setDate(reviewDateObj.getDate() + offset);\r\n            return {\r\n                number: reviewIdx + 1,\r\n                date: format(reviewDateObj, 'yyyy-MM-dd'),\r\n                status: 'pending' as const\r\n            };\r\n        });\r\n    }\r\n\r\n    return { introDate, status, reviews };\r\n};\r\n\r\ninterface UseThemesProps {\r\n    user: User | null;\r\n    gamification: GamificationState;\r\n    awardXP: (amount: number) => void;\r\n    updateStats: (updates: Partial<GameStats>) => void;\r\n    playSFX: (type: 'success' | 'xp' | 'achievement' | 'levelUp') => void;\r\n}\r\n\r\nexport const useThemes = ({ user, gamification, awardXP, updateStats, playSFX }: UseThemesProps) => {\r\n    const { showToast } = useToast();\r\n    // Local-First State Initialization (Load backup immediately)\r\n    const [themes, setThemes] = useState<Theme[]>(() => {\r\n        try {\r\n            const saved = localStorage.getItem('study_themes_backup');\r\n            if (!saved) return [];\r\n\r\n            const parsedThemes = JSON.parse(saved);\r\n            return parsedThemes;\r\n        } catch (e) {\r\n            logger.error(\"Failed to parse study_themes_backup\", e);\r\n            return [];\r\n        }\r\n    });\r\n\r\n    // Persist backups whenever state changes\r\n    useEffect(() => {\r\n        localStorage.setItem('study_themes_backup', JSON.stringify(themes));\r\n    }, [themes]);\r\n\r\n    // Data fetching logic moved to StudyContext\r\n\r\n    const addTheme = async (title: string, subthemesInit: { title: string; duration?: number; difficulty?: 'beginner' | 'intermediate' | 'advanced' | 'module' }[], options: { icon?: string, imageUrl?: string, color?: string, priority?: 'low' | 'medium' | 'high', startDate?: string, subtitle?: string, deadline?: string, category?: 'study' | 'project' } = {}) => {\r\n        const { icon: _icon, imageUrl: _imageUrl, color, priority: _priority, startDate, deadline, category } = options;\r\n\r\n        if (!user) {\r\n            logger.error(\"Add Theme failed: No user logged in\");\r\n            showToast(\"Erro: Usu√°rio n√£o identificado. Tente recarregar a p√°gina.\", \"error\");\r\n            return;\r\n        }\r\n        // Valida√ß√£o b√°sica de datas (formato YYYY-MM-DD)\r\n        const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n        if (startDate && !dateRegex.test(startDate)) {\r\n            showToast('Data de in√≠cio inv√°lida. Use o formato YYYY-MM-DD.', 'error');\r\n            return;\r\n        }\r\n        if (deadline && !dateRegex.test(deadline)) {\r\n            showToast('Data de t√©rmino inv√°lida. Use o formato YYYY-MM-DD.', 'error');\r\n            return;\r\n        }\r\n\r\n        // 1. Create Theme Object\r\n        const newThemeId = crypto.randomUUID();\r\n        const newTheme: Theme = {\r\n            id: newThemeId,\r\n            title,\r\n            color,\r\n            createdAt: Date.now(),\r\n            priority: _priority,\r\n            icon: _icon,\r\n            imageUrl: _imageUrl,\r\n            startDate,\r\n            deadline,\r\n            category: category || 'study', // Default to study\r\n            subthemes: []\r\n        };\r\n\r\n        // 2. Create Subthemes Objects\r\n        const newSubthemes: Subtheme[] = subthemesInit.map((s, idx) => {\r\n            const { introDate, status, reviews } = calculateInitialSubthemeState(startDate, idx, s.difficulty);\r\n\r\n            return {\r\n                id: crypto.randomUUID(),\r\n                theme_id: newThemeId,\r\n                title: s.title,\r\n                status,\r\n                introductionDate: introDate,\r\n                reviews: reviews,\r\n                sessions: [],\r\n                durationMinutes: s.duration,\r\n                difficulty: s.difficulty,\r\n                order_index: idx\r\n            };\r\n        });\r\n\r\n        newTheme.subthemes = newSubthemes;\r\n\r\n        // 3. Optimistic Update with Auto-Activation\r\n        try {\r\n            setThemes(prev => {\r\n                const allThemes = [...prev, newTheme];\r\n                // Try to activate immediately if possible\r\n                const today = SRSService.getToday();\r\n                const result = SRSService.processDailyUpdates(allThemes, today);\r\n                return result ? result.updatedThemes : allThemes;\r\n            });\r\n        } catch (e) {\r\n            logger.error('Erro ao processar atualiza√ß√µes di√°rias:', e);\r\n            // Reverte a inser√ß√£o do tema rec√©m criado\r\n            setThemes(prev => prev.filter(t => t.id !== newThemeId));\r\n            showToast('Erro ao criar tema.', 'error');\r\n            return;\r\n        }\r\n\r\n        // 4. Queue Sync\r\n        // Add Theme\r\n        const themeOpId = crypto.randomUUID();\r\n        const { subthemes: _subthemes, ...themeData } = newTheme;\r\n\r\n        SyncQueueService.enqueue({\r\n            id: themeOpId,\r\n            type: 'ADD',\r\n            table: 'themes',\r\n            data: { ...themeData, user_id: user.id }\r\n        });\r\n\r\n        // Add Subthemes (Queue individually)\r\n        newSubthemes.forEach((st, idx) => {\r\n            const { durationMinutes, ...stData } = st;\r\n            SyncQueueService.enqueue({\r\n                type: 'ADD',\r\n                table: 'subthemes',\r\n                dependentOn: themeOpId,\r\n                data: { ...stData, duration_minutes: durationMinutes, user_id: user.id, order_index: idx }\r\n            });\r\n        });\r\n\r\n        const todayStr = format(new Date(), 'yyyy-MM-dd');\r\n        if (startDate && startDate > todayStr) {\r\n            const startDateObj = new Date(startDate + 'T00:00:00');\r\n            if (!isNaN(startDateObj.getTime())) {\r\n                showToast(`Tema agendado para iniciar em ${format(startDateObj, 'dd/MM')}!`, \"success\");\r\n            } else {\r\n                showToast('Data de in√≠cio inv√°lida.', 'error');\r\n            }\r\n        } else {\r\n            showToast(\"Tema criado com sucesso!\", \"success\");\r\n        }\r\n    };\r\n\r\n\r\n    const updateTheme = async (id: string, updates: Partial<Theme>) => {\r\n        if (!user) return;\r\n        setThemes(prev => prev.map(t => t.id === id ? { ...t, ...updates } : t));\r\n\r\n        SyncQueueService.enqueue({\r\n            type: 'UPDATE',\r\n            table: 'themes',\r\n            data: { id, ...updates, user_id: user.id }\r\n        });\r\n    };\r\n\r\n    const addSubtheme = async (themeId: string, title: string, duration?: number) => {\r\n        if (!user) return;\r\n        const newSub: Subtheme = {\r\n            id: crypto.randomUUID(),\r\n            theme_id: themeId,\r\n            title,\r\n            status: 'queue',\r\n            reviews: [],\r\n            sessions: [],\r\n            durationMinutes: duration,\r\n        };\r\n\r\n        setThemes(prev => prev.map(t => t.id === themeId ? { ...t, subthemes: [...t.subthemes, newSub] } : t));\r\n\r\n        const { durationMinutes: _durationMinutes, ...subData } = newSub;\r\n        SyncQueueService.enqueue({\r\n            type: 'ADD',\r\n            table: 'subthemes',\r\n            data: { ...subData, duration_minutes: duration, user_id: user.id }\r\n        });\r\n    };\r\n\r\n    const deleteSubtheme = async (themeId: string, subthemeId: string) => {\r\n        setThemes(prev => prev.map(t => t.id === themeId ? { ...t, subthemes: t.subthemes.filter(st => st.id !== subthemeId) } : t));\r\n        if (user) {\r\n            SyncQueueService.enqueue({\r\n                type: 'DELETE',\r\n                table: 'subthemes',\r\n                data: { id: subthemeId, user_id: user.id }\r\n            });\r\n        }\r\n    };\r\n\r\n    // Delete a theme and all its subthemes, ensuring no leftover data\r\n    const deleteTheme = async (themeId: string) => {\r\n        const previous = [...themes];\r\n        const theme = themes.find(t => t.id === themeId);\r\n        const subIds = theme?.subthemes.map(st => st.id) ?? [];\r\n        // Optimistic UI removal\r\n        setThemes(prev => prev.filter(t => t.id !== themeId));\r\n        showToast('Tema exclu√≠do com sucesso!', 'success');\r\n        // Enfileirar exclus√µes em uma √∫nica opera√ß√£o at√¥mica\r\n        try {\r\n            if (user) {\r\n                // Excluir tema\r\n                SyncQueueService.enqueue({\r\n                    type: 'DELETE',\r\n                    table: 'themes',\r\n                    data: { id: themeId, user_id: user.id }\r\n                });\r\n                // Excluir subtemas associados\r\n                subIds.forEach(subId => {\r\n                    SyncQueueService.enqueue({\r\n                        type: 'DELETE',\r\n                        table: 'subthemes',\r\n                        data: { id: subId, user_id: user.id }\r\n                    });\r\n                });\r\n            }\r\n        } catch (e) {\r\n            logger.error('Erro ao excluir tema ou subtemas:', e);\r\n            // Reverte UI caso algo falhe\r\n            setThemes(previous);\r\n            showToast('Erro ao excluir tema.', 'error');\r\n        }\r\n    };\r\n\r\n    const completeReview = async (\r\n        subthemeId: string,\r\n        reviewNumber: number = 0,\r\n        type: 'review' | 'intro' = 'review',\r\n        difficulty: 'easy' | 'medium' | 'hard' = 'medium',\r\n        summary?: string\r\n    ) => {\r\n        if (!user) return;\r\n\r\n        // PRIORIDADE M√ÅXIMA: Bloquear dias futuros\r\n        const now = new Date();\r\n        const todayStr = format(now, 'yyyy-MM-dd');\r\n\r\n        // Centralize subtheme lookup\r\n        const allSubthemes = themes.flatMap(t => t.subthemes);\r\n        const subtheme = allSubthemes.find(st => st.id === subthemeId);\r\n\r\n        if (!subtheme) return;\r\n\r\n        // Check the specific dates\r\n        if (type === 'review') {\r\n            const review = subtheme.reviews.find(r => r.number === reviewNumber);\r\n            if (review && review.date > todayStr) {\r\n                showToast(\"Voc√™ n√£o pode concluir revis√µes de dias futuros!\", \"error\");\r\n                return;\r\n            }\r\n        } else if (type === 'intro') {\r\n            if (subtheme.introductionDate && subtheme.introductionDate > todayStr) {\r\n                showToast(\"Voc√™ n√£o pode iniciar estudos agendados para o futuro!\", \"error\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        let xpAwarded = 0;\r\n        let targetSubtheme: Subtheme | null = null;\r\n\r\n        if (type === 'intro') {\r\n            const updatedThemes = themes.map(t => ({\r\n                ...t,\r\n                subthemes: t.subthemes.map(st => {\r\n                    if (st.id === subthemeId) {\r\n                        const updated: Subtheme = {\r\n                            ...st,\r\n                            status: 'active' as const,\r\n                            introductionDate: format(new Date(), 'yyyy-MM-dd')\r\n                        };\r\n\r\n                        // Adicionar resumo para introdu√ß√£o\r\n                        const currentSummaries = st.summaries || [];\r\n                        updated.summaries = addCompletionSummary(\r\n                            currentSummaries,\r\n                            summary || `Introdu√ß√£o ao tema conclu√≠da em ${format(new Date(), 'dd/MM/yyyy \\'√†s\\' HH:mm')}`,\r\n                            'study',\r\n                            { id: st.id, type: 'theme', title: st.title }\r\n                        );\r\n\r\n                        targetSubtheme = updated;\r\n                        return updated;\r\n                    }\r\n                    return st;\r\n                })\r\n            }));\r\n            setThemes(updatedThemes);\r\n            xpAwarded = XP_VALUES.INTRO;\r\n        } else {\r\n            const { updatedThemes, awarded } = SRSService.completeReview(themes, subthemeId, reviewNumber, difficulty);\r\n            if (awarded) {\r\n                // Adicionar resumo para revis√£o\r\n                const themesWithSummary = updatedThemes.map(t => ({\r\n                    ...t,\r\n                    subthemes: t.subthemes.map(st => {\r\n                        if (st.id === subthemeId) {\r\n                            const currentSummaries = st.summaries || [];\r\n                            const updatedSt = {\r\n                                ...st,\r\n                                summaries: addReviewSummary(\r\n                                    currentSummaries,\r\n                                    reviewNumber,\r\n                                    summary || `Revis√£o espaciada ${reviewNumber} conclu√≠da com dificuldade ${difficulty === 'easy' ? 'f√°cil' : difficulty === 'hard' ? 'dif√≠cil' : 'm√©dia'}`,\r\n                                    'study',\r\n                                    { id: st.id, type: 'theme', title: st.title }\r\n                                )\r\n                            };\r\n                            targetSubtheme = updatedSt;\r\n                            return updatedSt;\r\n                        }\r\n                        return st;\r\n                    })\r\n                }));\r\n\r\n                setThemes(themesWithSummary);\r\n                xpAwarded = XP_VALUES.REVIEW;\r\n            }\r\n        }\r\n\r\n        if (targetSubtheme) {\r\n            const finalSubtheme = targetSubtheme as Subtheme;\r\n\r\n            // Add summary to the specific review if provided\r\n            if (summary && type === 'review') {\r\n                finalSubtheme.reviews = finalSubtheme.reviews.map(r =>\r\n                    r.number === reviewNumber ? { ...r, summary } : r\r\n                );\r\n            }\r\n\r\n            SyncQueueService.enqueue({\r\n                type: 'UPDATE',\r\n                table: 'subthemes',\r\n                data: {\r\n                    id: subthemeId,\r\n                    reviews: finalSubtheme.reviews,\r\n                    status: finalSubtheme.status,\r\n                    introductionDate: finalSubtheme.introductionDate,\r\n                    summaries: finalSubtheme.summaries,\r\n                    user_id: user.id\r\n                }\r\n            });\r\n        }\r\n\r\n        if (xpAwarded > 0) {\r\n            awardXP(xpAwarded);\r\n            playSFX('success');\r\n            updateStats({ reviewsCompleted: (gamification.stats?.reviewsCompleted || 0) + 1 });\r\n            celebrate();\r\n        }\r\n    };\r\n\r\n    const updateSubthemeContent = async (subthemeId: string, content: string) => {\r\n        if (!user) return;\r\n        // Valida√ß√£o de conte√∫do vazio\r\n        if (!content.trim()) {\r\n            showToast('Conte√∫do vazio n√£o pode ser salvo.', 'error');\r\n            return;\r\n        }\r\n        // Optimistic Update\r\n        setThemes(prev => prev.map(t => {\r\n            const found = t.subthemes.some(st => st.id === subthemeId);\r\n            if (found) {\r\n                return {\r\n                    ...t,\r\n                    subthemes: t.subthemes.map(st => st.id === subthemeId ? { ...st, text_content: content } : st)\r\n                };\r\n            }\r\n            return t;\r\n        }));\r\n\r\n        // Sync Queue\r\n        SyncQueueService.enqueue({\r\n            type: 'UPDATE',\r\n            table: 'subthemes',\r\n            data: {\r\n                id: subthemeId,\r\n                text_content: content,\r\n                user_id: user.id\r\n            }\r\n        });\r\n    };\r\n\r\n    return {\r\n        themes,\r\n        setThemes,\r\n        addTheme,\r\n        deleteTheme,\r\n        updateTheme,\r\n        addSubtheme,\r\n        deleteSubtheme,\r\n        completeReview,\r\n        updateSubthemeContent\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\layouts\\MainLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Suspense' is defined but never used.","line":1,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'lazy' is defined but never used.","line":1,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Zap' is defined but never used.","line":3,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Sparkles' is defined but never used.","line":4,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Flame' is defined but never used.","line":5,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":10},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has unnecessary dependencies: 'goals', 'projects', 'tasks', and 'themes'. Either exclude them or remove the dependency array.","line":69,"column":8,"nodeType":"ArrayExpression","endLine":69,"endColumn":57,"suggestions":[{"desc":"Update the dependencies array to be: [getEventsForDay]","fix":{"range":[2865,2914],"text":"[getEventsForDay]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\luizf\\antigraty\\study-panel\\src\\layouts\\MainLayout.tsx:96:13\n  94 |     useEffect(() => {\n  95 |         if (activeFocus) {\n> 96 |             setIsMobileMenuOpen(false);\n     |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  97 |         }\n  98 |     }, [activeFocus]);\n  99 |","line":96,"column":13,"nodeType":null,"endLine":96,"endColumn":32}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, Suspense, lazy } from 'react';\r\nimport {\r\n    Zap, // Keep if used (actually CheckSquare/Target etc might still be used if passed as props? No, logic moved.)\r\n    Sparkles, // Check usages\r\n    Flame\r\n} from 'lucide-react';\r\n// Removing format, ptBR as well if unused\r\nimport { cn } from '../lib/utils';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useStudy } from '../context/StudyContext';\r\nimport { usePomodoroContext } from '../context/PomodoroContext'; // Added import\r\nimport { useAudio } from '../context/AudioContext';\r\nimport { LayoutModals } from '../components/layout/LayoutModals';\r\nimport { useLayoutModals } from '../hooks/useLayoutModals';\r\nimport { Sidebar } from '../components/layout/Sidebar';\r\nimport { Header } from '../components/layout/Header';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useCalendarEvents } from '../features/calendar/hooks/useCalendarEvents';\r\nimport { useProjectContext } from '../context/ProjectProvider';\r\nimport { MobileBottomNav } from '../components/layout/MobileBottomNav';\r\nimport { InstallPWAHint } from '../components/InstallPWAHint';\r\nimport { GlobalActionBar } from '../components/layout/GlobalActionBar';\r\nimport { PomodoroWidget } from '../features/pomodoro/PomodoroWidget';\r\nimport { useDevice } from '../hooks/useDevice';\r\nimport { OfflineIndicator } from '../components/ui/OfflineIndicator';\r\n\r\n\r\ninterface MainLayoutProps {\r\n    children: React.ReactNode;\r\n    isSummaryModalOpen: boolean;\r\n    setIsSummaryModalOpen: (isOpen: boolean) => void;\r\n    isMissionModalOpen: boolean;\r\n    setIsMissionModalOpen: (isOpen: boolean) => void;\r\n}\r\n\r\n\r\n// ...\r\n\r\nexport const MainLayout: React.FC<MainLayoutProps> = ({\r\n    children,\r\n    isSummaryModalOpen,\r\n    setIsSummaryModalOpen,\r\n    isMissionModalOpen,\r\n    setIsMissionModalOpen\r\n}) => {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n\r\n    // Derive activeTab from URL\r\n    // e.g. /dashboard -> dashboard, / -> dashboard\r\n    const path = location.pathname.substring(1);\r\n    const activeTab = path || 'dashboard';\r\n\r\n    const onTabChange = (tab: string) => {\r\n        navigate(`/${tab}`);\r\n    };\r\n\r\n    const { activeFocus, syncStatus, zenMode, toggleZenMode, clearSyncQueue, themes, tasks, goals } = useStudy();\r\n    const { projects } = useProjectContext();\r\n    const { user, logout } = useAuth();\r\n    const { isIOS, isPWA, safeAreaTopClass, safeAreaBottomClass } = useDevice();\r\n    const [time, setTime] = useState(new Date());\r\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n\r\n    // --- MISSION & PROJECT COUNTS ---\r\n    const { getEventsForDay } = useCalendarEvents({ themes, tasks, goals, projects });\r\n    const todayEvents = React.useMemo(() => {\r\n        return getEventsForDay(new Date());\r\n    }, [themes, tasks, goals, projects, getEventsForDay]);\r\n\r\n    const missionCount = React.useMemo(() => {\r\n        const pendingTasks = todayEvents.tasks.filter(t => t.status === 'pending').length;\r\n        const pendingGoals = todayEvents.goals.filter(g => !g.isCompletedToday).length;\r\n        const pendingReviews = todayEvents.reviews.filter(r => r.status !== 'completed').length;\r\n        const pendingIntros = todayEvents.intros.length;\r\n        return pendingTasks + pendingGoals + pendingReviews + pendingIntros;\r\n    }, [todayEvents]);\r\n\r\n    const projectCount = React.useMemo(() => {\r\n        // Count goals that are linked to themes of category 'project'\r\n        const themeProjectIds = themes.filter(t => t.category === 'project').map(t => t.id);\r\n        const linkedGoalsCount = goals.filter(g => g.relatedThemeId && themeProjectIds.includes(g.relatedThemeId)).length;\r\n\r\n        const standaloneProjectsCount = projects.length;\r\n        return linkedGoalsCount + standaloneProjectsCount;\r\n    }, [themes, goals, projects]);\r\n\r\n    // Use Layout Modals Hook\r\n    const modals = useLayoutModals(!!activeFocus, setIsSummaryModalOpen, isMissionModalOpen, setIsMissionModalOpen);\r\n\r\n    // Auto-close overlaying UI when Focus Mode starts (logic moved to hook mostly, but sidebar/mobilemenu manual handling might be needed if not in hook)\r\n    // Hook handles: summary, mission, task, goal, theme, sidebar.\r\n    // We still have MobileMenu here.\r\n    useEffect(() => {\r\n        if (activeFocus) {\r\n            setIsMobileMenuOpen(false);\r\n        }\r\n    }, [activeFocus]);\r\n\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setTime(new Date()), 1000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    // Scroll Detection for Header\r\n    const mainRef = useRef<HTMLDivElement>(null);\r\n    const [isHeaderVisible, setIsHeaderVisible] = useState(true);\r\n    const lastScrollY = useRef(0);\r\n\r\n    useEffect(() => {\r\n        const handleScroll = () => {\r\n            const currentScrollY = mainRef.current?.scrollTop || 0;\r\n\r\n            // Header only visible at the very top to avoid clashing with sticky subtitles/calendar\r\n            if (currentScrollY < 10) {\r\n                setIsHeaderVisible(true);\r\n            } else if (currentScrollY > lastScrollY.current + 50) {\r\n                // Large down scroll always hides\r\n                setIsHeaderVisible(false);\r\n            } else if (currentScrollY < lastScrollY.current - 100) {\r\n                // Only show on significant up-scroll if we want that, \r\n                // but user asked to \"oculte o de cima\", so we'll keep it hidden except at top.\r\n                setIsHeaderVisible(false);\r\n            }\r\n\r\n            lastScrollY.current = currentScrollY;\r\n        };\r\n\r\n        const mainElement = mainRef.current;\r\n        if (mainElement) {\r\n            mainElement.addEventListener('scroll', handleScroll, { passive: true });\r\n        }\r\n\r\n        return () => {\r\n            if (mainElement) {\r\n                mainElement.removeEventListener('scroll', handleScroll);\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    const { settings: pomoSettings, isActive, mode } = usePomodoroContext();\r\n    const { startAudio, stopAudio, isPlaying } = useAudio();\r\n\r\n    // Auto-start/stop audio based on Pomodoro state\r\n    const prevIsActive = useRef(isActive);\r\n    useEffect(() => {\r\n        // DISABLED: Auto-start audio - users can manually enable in Pomodoro widget\r\n        // if (isActive && mode === 'focus' && !prevIsActive.current) {\r\n        //     startAudio();\r\n        // }\r\n        // When focus session stops (isActive goes from true to false)\r\n        if (!isActive && prevIsActive.current && isPlaying) {\r\n            stopAudio();\r\n        }\r\n        prevIsActive.current = isActive;\r\n    }, [isActive, mode, startAudio, stopAudio, isPlaying]);\r\n\r\n    const isStrictFocus = pomoSettings.strictMode && isActive && mode === 'focus';\r\n    const showSidebar = (!zenMode && !isStrictFocus) && (modals.state.isSidebarOpen || window.innerWidth >= 768);\r\n\r\n    return (\r\n        <div className=\"flex h-screen bg-slate-950 text-slate-100 overflow-hidden relative\" style={{ scrollbarGutter: 'stable' }}>\r\n\r\n            {/* Sidebar Desktop */}\r\n            <Sidebar\r\n                activeTab={activeTab}\r\n                onTabChange={onTabChange}\r\n                zenMode={zenMode}\r\n                user={user}\r\n                logout={logout}\r\n                showSidebar={showSidebar}\r\n            />\r\n\r\n            {/* Main Content */}\r\n            <div className=\"flex-1 flex flex-col h-full overflow-hidden relative\">\r\n                {/* Header */}\r\n                <Header\r\n                    isPWA={isPWA}\r\n                    isIOS={isIOS}\r\n                    safeAreaTopClass={safeAreaTopClass}\r\n                    isHeaderVisible={isHeaderVisible}\r\n                    isMobileMenuOpen={isMobileMenuOpen}\r\n                    setIsMobileMenuOpen={setIsMobileMenuOpen}\r\n                    zenMode={zenMode}\r\n                    toggleZenMode={toggleZenMode}\r\n                    setIsMissionModalOpen={modals.actions.setIsMissionModalOpen} // Use action from hook\r\n                    setIsSummaryModalOpen={setIsSummaryModalOpen}\r\n                    setIsTaskModalOpen={modals.actions.setIsTaskModalOpen} // Use action from hook\r\n                    setIsSidebarOpen={modals.actions.setIsSidebarOpen}\r\n                    setIsThemeModalOpen={modals.actions.setIsThemeModalOpen}\r\n                    syncStatus={syncStatus}\r\n                    clearSyncQueue={clearSyncQueue}\r\n                    time={time}\r\n                    user={user}\r\n                    onTabChange={onTabChange}\r\n                    logout={logout}\r\n                    missionCount={missionCount}\r\n                    projectCount={projectCount}\r\n                />\r\n\r\n                {/* Modals */}\r\n                <LayoutModals\r\n                    modals={modals}\r\n                    isSummaryModalOpen={isSummaryModalOpen}\r\n                    setIsSummaryModalOpen={setIsSummaryModalOpen}\r\n                    zenMode={zenMode}\r\n                />\r\n\r\n\r\n\r\n                {/* Scrollable Area */}\r\n                <main\r\n                    ref={mainRef}\r\n                    className={cn(\r\n                        \"flex-1 overflow-y-scroll custom-scrollbar overscroll-none px-4 md:px-8 relative\",\r\n                        isPWA && isIOS ? \"pt-24 pb-32\" : \"pt-20 pb-24 md:pb-8\", // Adjust usage padding\r\n                        safeAreaBottomClass // Ensure content doesn't get cut by home bar\r\n                    )}\r\n                >\r\n                    {/* Zen Mode Backdrop Override */}\r\n                    {zenMode && <div className=\"fixed inset-0 bg-slate-950/20 backdrop-grayscale pointer-events-none z-0\" />}\r\n\r\n                    <div className=\"max-w-6xl mx-auto w-full relative z-10 h-full flex flex-col\">\r\n                        {children}\r\n                    </div>\r\n                </main>\r\n\r\n                {/* Mobile Bottom Navigation (Visible only on mobile) */}\r\n                <div className={cn(\"md:hidden\", safeAreaBottomClass)}>\r\n                    <MobileBottomNav\r\n                        activeTab={activeTab}\r\n                        onTabChange={onTabChange}\r\n                        onOpenMission={() => modals.actions.setIsMissionModalOpen(true)}\r\n                        missionCount={missionCount}\r\n                    />\r\n                </div>\r\n\r\n                {/* Hints */}\r\n                <InstallPWAHint />\r\n\r\n                <GlobalActionBar />\r\n                <PomodoroWidget />\r\n                <OfflineIndicator />\r\n\r\n            </div >\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\imageOptimizer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\srs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\lib\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\pages\\LandingPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":8,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":8,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'y2' is assigned a value but never used.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":13}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { motion, useScroll, useTransform } from 'framer-motion';\r\n// Note: App.tsx uses simple state 'activeTab' inside AppContent, but top level Auth render is binary (Login or App).\r\n// We will need to adjust App.tsx to support Landing -> Login routing. For now, let's build the component.\r\n\r\n// Icons\r\nimport {\r\n    Zap, Brain, Shield, Rocket, Check, ArrowRight,\r\n    Layout, Calendar, Target, Github, Instagram, Twitter\r\n} from 'lucide-react';\r\n\r\nexport const LandingPage = ({ onGetStarted }: { onGetStarted: () => void }) => {\r\n\r\n    // Scroll Parallax\r\n    const { scrollY } = useScroll();\r\n    const y1 = useTransform(scrollY, [0, 500], [0, 200]);\r\n    const y2 = useTransform(scrollY, [0, 500], [0, -150]);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-950 font-sans text-slate-100 overflow-x-hidden selection:bg-blue-500/30\">\r\n\r\n            {/* --- Navbar --- */}\r\n            <nav className=\"fixed top-0 w-full z-50 bg-slate-950/80 backdrop-blur-md border-b border-slate-800/50\">\r\n                <div className=\"max-w-7xl mx-auto px-6 h-20 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center shadow-lg shadow-blue-500/20\">\r\n                            <span className=\"text-xl\">‚ö°</span>\r\n                        </div>\r\n                        <span className=\"font-bold text-xl tracking-tight\">Revis√£o <span className=\"text-blue-400\">PRO</span></span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-6\">\r\n                        <button onClick={onGetStarted} className=\"hidden md:block text-slate-300 hover:text-white font-medium transition-colors\">Entrar</button>\r\n                        <button\r\n                            onClick={onGetStarted}\r\n                            className=\"bg-white text-slate-950 px-6 py-2.5 rounded-full font-bold hover:bg-blue-50 transition-all shadow-lg hover:shadow-blue-500/20\"\r\n                        >\r\n                            Come√ßar Gr√°tis\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* --- Hero Section --- */}\r\n            <section className=\"relative pt-32 pb-32 md:pt-48 md:pb-48 overflow-hidden\">\r\n                {/* Background FX */}\r\n                <div className=\"absolute inset-0 pointer-events-none\">\r\n                    <div className=\"absolute top-0 left-1/4 w-[500px] h-[500px] bg-blue-600/20 blur-[120px] rounded-full mix-blend-screen animate-pulse\" />\r\n                    <div className=\"absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-purple-600/10 blur-[120px] rounded-full mix-blend-screen\" />\r\n                    <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 mix-blend-overlay\" />\r\n                </div>\r\n\r\n                <div className=\"max-w-7xl mx-auto px-6 relative z-10 text-center\">\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ duration: 0.8 }}\r\n                    >\r\n                        <span className=\"inline-block px-4 py-1.5 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 font-bold text-sm mb-6 tracking-wide\">\r\n                            üöÄ V 1.0 DISPON√çVEL AGORA\r\n                        </span>\r\n                        <h1 className=\"text-5xl md:text-7xl font-black text-white tracking-tight mb-8 leading-[1.1]\">\r\n                            Estude Menos. <br />\r\n                            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500\">\r\n                                Aprenda 10x Mais.\r\n                            </span>\r\n                        </h1>\r\n                        <p className=\"text-xl text-slate-400 max-w-2xl mx-auto mb-10 leading-relaxed\">\r\n                            A √∫nica plataforma que une <strong>Repeti√ß√£o Espa√ßada (SRS)</strong>, Gamifica√ß√£o Avan√ßada e Organiza√ß√£o em uma interface premiada.\r\n                        </p>\r\n\r\n                        <div className=\"flex flex-col md:flex-row items-center justify-center gap-4\">\r\n                            <button\r\n                                onClick={onGetStarted}\r\n                                className=\"w-full md:w-auto px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white rounded-2xl font-bold text-lg shadow-xl shadow-blue-500/25 transition-all hover:scale-105 flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Rocket className=\"w-5 h-5\" />\r\n                                Criar Conta Gratuita\r\n                            </button>\r\n                            <a href=\"#features\" className=\"w-full md:w-auto px-8 py-4 bg-slate-800/50 hover:bg-slate-800 text-white rounded-2xl font-bold text-lg border border-slate-800/50 transition-all flex items-center justify-center gap-2\">\r\n                                Saber Mais\r\n                            </a>\r\n                        </div>\r\n                    </motion.div>\r\n                </div>\r\n\r\n                {/* Hero UI Mockup */}\r\n                <motion.div\r\n                    style={{ y: y1 }}\r\n                    className=\"mt-20 max-w-6xl mx-auto px-6\"\r\n                >\r\n                    <div className=\"relative rounded-3xl border border-slate-800/50 bg-slate-900/50 backdrop-blur-xl shadow-2xl overflow-hidden aspect-video group\">\r\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-transparent to-purple-500/5\" />\r\n                        {/* Placeholder for App Screenshot */}\r\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                            <div className=\"text-center\">\r\n                                <span className=\"text-6xl mb-4 block\">‚ö°</span>\r\n                                <p className=\"text-slate-500 font-mono text-sm\">Interface do Painel Principal</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Fake UI Elements for \"feeling\" */}\r\n                        <div className=\"absolute top-8 left-8 right-8 bottom-8 border border-slate-800/50 rounded-2xl p-6 grid grid-cols-12 gap-6 opacity-50\">\r\n                            <div className=\"col-span-3 bg-slate-900/40 rounded-xl h-full\" />\r\n                            <div className=\"col-span-9 space-y-6\">\r\n                                <div className=\"h-32 bg-gradient-to-r from-blue-900/20 to-indigo-900/20 rounded-xl\" />\r\n                                <div className=\"grid grid-cols-3 gap-6\">\r\n                                    <div className=\"h-40 bg-slate-900/40 rounded-xl\" />\r\n                                    <div className=\"h-40 bg-slate-900/40 rounded-xl\" />\r\n                                    <div className=\"h-40 bg-slate-900/40 rounded-xl\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n            </section>\r\n\r\n            {/* --- Features Grid --- */}\r\n            <section id=\"features\" className=\"py-32 bg-slate-950 relative\">\r\n                <div className=\"max-w-7xl mx-auto px-6\">\r\n                    <div className=\"text-center mb-24\">\r\n                        <h2 className=\"text-3xl md:text-5xl font-black text-white mb-6\">Tudo que voc√™ precisa.</h2>\r\n                        <p className=\"text-slate-400 text-lg\">Esque√ßa planilhas e apps complicados.</p>\r\n                    </div>\r\n\r\n                    <div className=\"grid md:grid-cols-3 gap-8\">\r\n                        <FeatureCard\r\n                            icon={<Brain className=\"w-8 h-8 text-pink-400\" />}\r\n                            title=\"SRS Inteligente\"\r\n                            desc=\"O algoritmo agenda suas revis√µes automaticamente (1, 7, 15, 30 dias). Nunca mais esque√ßa o que estudou.\"\r\n                        />\r\n                        <FeatureCard\r\n                            icon={<Zap className=\"w-8 h-8 text-amber-400\" />}\r\n                            title=\"Gamifica√ß√£o Real\"\r\n                            desc=\"Ganhe XP, suba de n√≠vel e desbloqueie conquistas. Estudar vira um jogo viciante.\"\r\n                        />\r\n                        <FeatureCard\r\n                            icon={<Layout className=\"w-8 h-8 text-emerald-400\" />}\r\n                            title=\"Organiza√ß√£o Visual\"\r\n                            desc=\"Temas, subtemas e mat√©rias organizados em um painel lindo e intuitivo.\"\r\n                        />\r\n                        <FeatureCard\r\n                            icon={<Target className=\"w-8 h-8 text-blue-400\" />}\r\n                            title=\"Metas & H√°bitos\"\r\n                            desc=\"Defina objetivos claros e acompanhe seu progresso di√°rio com gr√°ficos detalhados.\"\r\n                        />\r\n                        <FeatureCard\r\n                            icon={<Calendar className=\"w-8 h-8 text-purple-400\" />}\r\n                            title=\"Agenda Autom√°tica\"\r\n                            desc=\"Saiba exatamente o que revisar hoje. O sistema monta seu cronograma sozinho.\"\r\n                        />\r\n                        <FeatureCard\r\n                            icon={<Shield className=\"w-8 h-8 text-red-400\" />}\r\n                            title=\"Modo Zen\"\r\n                            desc=\"Bloqueie distra√ß√µes e foque no conte√∫do com nosso timer Pomodoro integrado.\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* --- CTA Section --- */}\r\n            <section className=\"py-32 relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-blue-900/20\" />\r\n                <div className=\"absolute inset-0 bg-gradient-to-b from-slate-950 via-transparent to-slate-950\" />\r\n\r\n                <div className=\"max-w-4xl mx-auto px-6 relative z-10 text-center\">\r\n                    <h2 className=\"text-4xl md:text-6xl font-black text-white mb-8\">\r\n                        Pronto para evoluir?\r\n                    </h2>\r\n                    <p className=\"text-xl text-slate-300 mb-12\">\r\n                        Junte-se a usu√°rios que j√° transformaram sua rotina de estudos.\r\n                        Acesso completo e gratuito.\r\n                    </p>\r\n                    <button\r\n                        onClick={onGetStarted}\r\n                        className=\"px-10 py-5 bg-white text-slate-950 rounded-2xl font-black text-xl hover:scale-105 transition-transform shadow-2xl shadow-white/20\"\r\n                    >\r\n                        Come√ßar Agora\r\n                    </button>\r\n                    <p className=\"mt-6 text-slate-500 text-sm\">N√£o requer cart√£o de cr√©dito ‚Ä¢ 100% Gratuito</p>\r\n                </div>\r\n            </section>\r\n\r\n            {/* --- Footer --- */}\r\n            <footer className=\"py-12 border-t border-slate-800/50 bg-slate-950\">\r\n                <div className=\"max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                    <div className=\"flex items-center gap-2 opacity-50\">\r\n                        <span className=\"text-lg\">‚ö°</span>\r\n                        <span className=\"font-bold\">Revis√£o PRO</span>\r\n                    </div>\r\n                    <div className=\"text-slate-500 text-sm\">\r\n                        ¬© 2024 Study Panel. Constru√≠do com ‚ù§Ô∏è para estudantes.\r\n                    </div>\r\n                    <div className=\"flex gap-6\">\r\n                        <SocialIcon icon={<Twitter className=\"w-5 h-5\" />} />\r\n                        <SocialIcon icon={<Instagram className=\"w-5 h-5\" />} />\r\n                        <SocialIcon icon={<Github className=\"w-5 h-5\" />} />\r\n                    </div>\r\n                </div>\r\n            </footer>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst FeatureCard = ({ icon, title, desc }: { icon: any, title: string, desc: string }) => (\r\n    <div className=\"p-8 rounded-3xl bg-slate-900/40 border border-slate-800/50 hover:border-slate-800/50 hover:bg-white/10 transition-all group\">\r\n        <div className=\"mb-6 p-4 rounded-2xl bg-slate-950 w-fit group-hover:scale-110 transition-transform\">\r\n            {icon}\r\n        </div>\r\n        <h3 className=\"text-xl font-bold text-white mb-3\">{title}</h3>\r\n        <p className=\"text-slate-400 leading-relaxed\">{desc}</p>\r\n    </div>\r\n);\r\n\r\nconst SocialIcon = ({ icon }: { icon: any }) => (\r\n    <a href=\"#\" className=\"text-slate-500 hover:text-white transition-colors\">\r\n        {icon}\r\n    </a>\r\n)\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\pages\\Privacy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\pages\\SummaryDemo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\pages\\Terms.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\pwa.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\schemas\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\GamificationService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subDays' is defined but never used.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { GamificationService } from './GamificationService';\r\nimport { format, subDays } from 'date-fns';\r\n\r\ndescribe('GamificationService', () => {\r\n    beforeEach(() => {\r\n        vi.useFakeTimers();\r\n    });\r\n\r\n    afterEach(() => {\r\n        vi.useRealTimers();\r\n    });\r\n\r\n    it('should provide initial state with level 1', () => {\r\n        const state = GamificationService.getInitialState();\r\n        expect(state.level.level).toBe(1);\r\n        expect(state.level.totalXp).toBe(0);\r\n        expect(state.streak.current).toBe(1);\r\n    });\r\n\r\n    describe('awardXP', () => {\r\n        it('should increment current and total XP', () => {\r\n            const state = GamificationService.getInitialState();\r\n            const { newState } = GamificationService.awardXP(state, 100);\r\n\r\n            expect(newState.level.currentXp).toBe(100);\r\n            expect(newState.level.totalXp).toBe(100);\r\n        });\r\n\r\n        it('should level up when reaching nextLevelXp', () => {\r\n            const state = GamificationService.getInitialState();\r\n            // Initial nextLevelXp is 500\r\n            const { newState } = GamificationService.awardXP(state, 550);\r\n\r\n            expect(newState.level.level).toBe(2);\r\n            expect(newState.level.currentXp).toBe(50);\r\n            expect(newState.level.nextLevelXp).toBeGreaterThan(500);\r\n        });\r\n\r\n        it('should clamp negative XP', () => {\r\n            const state = GamificationService.getInitialState();\r\n            const { newState } = GamificationService.awardXP(state, -100);\r\n\r\n            expect(newState.level.currentXp).toBe(0);\r\n            expect(newState.level.totalXp).toBe(0);\r\n        });\r\n\r\n        it('should increment streak if awarding XP on a new day (yesterday was last login)', () => {\r\n            const today = new Date(2025, 0, 2);\r\n            const yesterday = new Date(2025, 0, 1);\r\n\r\n            vi.setSystemTime(today);\r\n            const state = GamificationService.getInitialState();\r\n            state.streak.lastLoginDate = format(yesterday, 'yyyy-MM-dd');\r\n            state.stats.lastXpDate = format(yesterday, 'yyyy-MM-dd');\r\n\r\n            const { newState } = GamificationService.awardXP(state, 100);\r\n\r\n            expect(newState.streak.current).toBe(2);\r\n            expect(newState.streak.lastLoginDate).toBe(format(today, 'yyyy-MM-dd'));\r\n        });\r\n\r\n        it('should reset streak if awarding XP after more than 1 day of gap', () => {\r\n            const today = new Date(2025, 0, 5);\r\n            const longAgo = new Date(2025, 0, 1);\r\n\r\n            vi.setSystemTime(today);\r\n            const state = GamificationService.getInitialState();\r\n            state.streak.current = 5;\r\n            state.streak.lastLoginDate = format(longAgo, 'yyyy-MM-dd');\r\n            state.stats.lastXpDate = format(longAgo, 'yyyy-MM-dd');\r\n\r\n            const { newState } = GamificationService.awardXP(state, 100);\r\n\r\n            expect(newState.streak.current).toBe(1);\r\n        });\r\n    });\r\n\r\n    describe('achievements', () => {\r\n        it('should unlock \"Primeiros Passos\" when total XP reaches 100', () => {\r\n            const state = GamificationService.getInitialState();\r\n            const { newState, newUnlock } = GamificationService.awardXP(state, 120);\r\n\r\n            expect(newUnlock?.id).toBe('first_steps');\r\n            expect(newState.achievements.some(a => a.id === 'first_steps')).toBe(true);\r\n        });\r\n\r\n        it('should not unlock same achievement twice', () => {\r\n            const state = GamificationService.getInitialState();\r\n            const { newState: state1 } = GamificationService.awardXP(state, 120);\r\n            const { newState: state2, newUnlock } = GamificationService.awardXP(state1, 20);\r\n\r\n            expect(newUnlock).toBeNull();\r\n            expect(state2.achievements.length).toBe(1);\r\n        });\r\n\r\n        it('should unlock streak achievements', () => {\r\n            const today = new Date(2025, 0, 3);\r\n            const yesterday = new Date(2025, 0, 2);\r\n            vi.setSystemTime(today);\r\n\r\n            const state = GamificationService.getInitialState();\r\n            state.streak.current = 2; // Almost there\r\n            state.streak.lastLoginDate = format(yesterday, 'yyyy-MM-dd');\r\n            state.stats.lastXpDate = format(yesterday, 'yyyy-MM-dd');\r\n\r\n            const { newState } = GamificationService.awardXP(state, 10);\r\n\r\n            expect(newState.streak.current).toBe(3);\r\n            expect(newState.achievements.some(a => a.id === 'streak_3')).toBe(true);\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\GamificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GameStreak' is defined but never used.","line":2,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UserLevel' is defined but never used.","line":2,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":79}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { format, subDays } from 'date-fns';\r\nimport type { Achievement, GameStreak, GamificationState, GameStats, UserLevel } from '../types/gamification';\r\nimport { ACHIEVEMENTS_LIST } from '../config/gamification';\r\n\r\nexport class GamificationService {\r\n    static getToday(): string {\r\n        return format(new Date(), 'yyyy-MM-dd');\r\n    }\r\n\r\n    static getInitialState(): GamificationState {\r\n        return {\r\n            level: { level: 1, currentXp: 0, nextLevelXp: 500, totalXp: 0 },\r\n            streak: { current: 1, max: 1, lastLoginDate: this.getToday() },\r\n            achievements: [],\r\n            stats: {\r\n                reviewsCompleted: 0,\r\n                tasksCompleted: 0,\r\n                goalsCompleted: 0,\r\n                habitsCompleted: 0,\r\n                totalFocusMinutes: 0,\r\n                dailyXp: 0,\r\n                lastXpDate: this.getToday(),\r\n                dailyHistory: {}\r\n            }\r\n        };\r\n    }\r\n\r\n    static checkAchievements(currentStats: GameStats, currentLevel: number, currentStreak: number, currentAchievements: Achievement[]): Achievement[] {\r\n        const unlocked: Achievement[] = [];\r\n\r\n        ACHIEVEMENTS_LIST.forEach(config => {\r\n            // Skip if already unlocked\r\n            if (currentAchievements && currentAchievements.some(a => a.id === config.id)) return;\r\n\r\n            let conditionMet = false;\r\n            const { type, target } = config.condition;\r\n\r\n            switch (type) {\r\n                case 'xp':\r\n                    // We don't have total XP in stats easily accessible without full state, \r\n                    // but usually 'xp' achievements are checked against level or total.\r\n                    // For safety, let's assume 'xp' target means Total XP here or just ignore if data missing\r\n                    // Actually, let's map 'xp' to Level checks for simplicity or remove XP achievements if vague.\r\n                    // Or check external stat if we had it.\r\n                    // Implementation Detail: We'll skip 'xp' here and rely on awardXP checking it.\r\n                    break;\r\n                case 'reviews':\r\n                    conditionMet = currentStats.reviewsCompleted >= target;\r\n                    break;\r\n                case 'tasks':\r\n                    conditionMet = currentStats.tasksCompleted >= target;\r\n                    break;\r\n                case 'streak':\r\n                    conditionMet = currentStreak >= target;\r\n                    break;\r\n            }\r\n\r\n            if (conditionMet) {\r\n                unlocked.push({\r\n                    ...config,\r\n                    unlockedAt: new Date().toISOString()\r\n                });\r\n            }\r\n        });\r\n\r\n        return unlocked;\r\n    }\r\n\r\n    static updateStats(state: GamificationState, updates: Partial<GameStats>): { newState: GamificationState, newUnlock: Achievement | null } {\r\n        const today = this.getToday();\r\n        const currentStats = { ...state.stats };\r\n\r\n        // Daily XP Reset\r\n        if (currentStats.lastXpDate !== today) {\r\n            currentStats.dailyXp = 0;\r\n            currentStats.lastXpDate = today;\r\n        }\r\n\r\n        const newStats = { ...currentStats, ...updates };\r\n        if (!newStats.dailyHistory) newStats.dailyHistory = {};\r\n\r\n        const newUnlocks = this.checkAchievements(newStats, state.level.level, state.streak?.current || 1, state.achievements || []);\r\n\r\n        return {\r\n            newState: {\r\n                ...state,\r\n                stats: newStats,\r\n                achievements: [...(state.achievements || []), ...newUnlocks]\r\n            },\r\n            newUnlock: newUnlocks.length > 0 ? newUnlocks[0] : null\r\n        };\r\n    }\r\n\r\n    static checkStreak(state: GamificationState): { newState: GamificationState, newUnlock: Achievement | null } {\r\n        const today = this.getToday();\r\n        const streak = { ...state.streak };\r\n        const yesterday = format(subDays(new Date(), 1), 'yyyy-MM-dd');\r\n\r\n        // Check if already updated today\r\n        if (streak.lastLoginDate === today) {\r\n            return { newState: state, newUnlock: null };\r\n        }\r\n\r\n        // Logic\r\n        if (streak.lastLoginDate === yesterday) {\r\n            streak.current += 1;\r\n            streak.max = Math.max(streak.current, streak.max);\r\n        } else {\r\n            // Only reset if it's strictly older than yesterday (missed a day)\r\n            // If it's empty/null (new user), we treat as 1\r\n            streak.current = 1;\r\n        }\r\n        streak.lastLoginDate = today;\r\n\r\n        // Reset Daily Stats\r\n        const stats = { ...state.stats };\r\n        if (stats.lastXpDate !== today) {\r\n            stats.dailyXp = 0;\r\n            stats.lastXpDate = today;\r\n        }\r\n\r\n        // Check Achievements (e.g. 7 day streak)\r\n        const newUnlocks = this.checkAchievements(stats, state.level.level, streak.current, state.achievements || []);\r\n\r\n        return {\r\n            newState: {\r\n                ...state,\r\n                streak,\r\n                stats,\r\n                achievements: [...(state.achievements || []), ...newUnlocks]\r\n            },\r\n            newUnlock: newUnlocks.length > 0 ? newUnlocks[0] : null\r\n        };\r\n    }\r\n\r\n    static awardXP(state: GamificationState, amount: number): { newState: GamificationState, newUnlock: Achievement | null } {\r\n        // 1. First ensure streak/day is up to date\r\n        const { newState: stateWithStreak, newUnlock: streakUnlock } = this.checkStreak(state);\r\n\r\n        let { level, currentXp, nextLevelXp, totalXp } = stateWithStreak.level;\r\n        const currentStats = { ...stateWithStreak.stats };\r\n\r\n        currentXp += amount;\r\n        totalXp += amount;\r\n\r\n        // Prevent negative XP (Clamping)\r\n        if (currentXp < 0) currentXp = 0;\r\n        if (totalXp < 0) totalXp = 0;\r\n\r\n        currentStats.dailyXp += amount;\r\n\r\n        // Level Up Checking\r\n        if (currentXp >= nextLevelXp) {\r\n            currentXp -= nextLevelXp;\r\n            level += 1;\r\n            nextLevelXp = Math.floor(nextLevelXp * 1.2); // Balanced curve\r\n        }\r\n\r\n        const newUnlocks = this.checkAchievements(currentStats, level, stateWithStreak.streak.current, stateWithStreak.achievements || []);\r\n\r\n        // Combine unlocks (Streak unlock + XP unlock)\r\n        const allUnlocks = [...newUnlocks];\r\n        if (streakUnlock) allUnlocks.push(streakUnlock);\r\n\r\n        // Also check XP specific achievements\r\n        ACHIEVEMENTS_LIST.filter(a => a.condition.type === 'xp').forEach(a => {\r\n            if (!stateWithStreak.achievements?.some(ex => ex.id === a.id) && totalXp >= a.condition.target) {\r\n                if (!allUnlocks.some(u => u.id === a.id)) {\r\n                    allUnlocks.push({ ...a, unlockedAt: new Date().toISOString() });\r\n                }\r\n            }\r\n        });\r\n\r\n        return {\r\n            newState: {\r\n                ...stateWithStreak,\r\n                level: { level, currentXp, nextLevelXp, totalXp },\r\n                stats: currentStats,\r\n                achievements: [...(stateWithStreak.achievements || []), ...allUnlocks]\r\n            },\r\n            newUnlock: allUnlocks.length > 0 ? allUnlocks[0] : null\r\n        };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\NotificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\SRSService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'addDays' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":4,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { SRSService } from './SRSService';\r\nimport type { Theme, Subtheme, Review } from '../types';\r\nimport { addDays, format } from 'date-fns';\r\n\r\ndescribe('SRSService', () => {\r\n    // Helper to create mock themes\r\n    const createMockTheme = (subthemes: Subtheme[] = []): Theme => ({\r\n        id: 'theme-1',\r\n        title: 'Test Theme',\r\n        icon: 'test',\r\n        imageUrl: 'test',\r\n        color: 'blue',\r\n        priority: 'medium',\r\n        createdAt: Date.now(),\r\n        subthemes\r\n    });\r\n\r\n    const createMockSubtheme = (id: string, status: 'queue' | 'active' | 'completed' = 'queue', reviews: Review[] = []): Subtheme => ({\r\n        id,\r\n        // theme_id removed as it is not part of Subtheme interface based on lint error\r\n        title: `Subtheme ${id}`,\r\n        status,\r\n        reviews,\r\n        introductionDate: status === 'active' ? '2025-01-01' : undefined\r\n    });\r\n\r\n    beforeEach(() => {\r\n        // Reset time before each test\r\n        vi.useFakeTimers();\r\n    });\r\n\r\n    afterEach(() => {\r\n        vi.useRealTimers();\r\n    });\r\n\r\n    describe('processDailyUpdates', () => {\r\n        it('should activate the first queued subtheme if nothing was introduced today', () => {\r\n            // Mock Today: 2025-01-01\r\n            const today = new Date(2025, 0, 1);\r\n            vi.setSystemTime(today);\r\n            const todayStr = '2025-01-01';\r\n\r\n            const sub1 = createMockSubtheme('sub-1', 'queue');\r\n            const sub2 = createMockSubtheme('sub-2', 'queue');\r\n            const themes = [createMockTheme([sub1, sub2])];\r\n\r\n            const result = SRSService.processDailyUpdates(themes, '2024-12-31');\r\n\r\n            expect(result).not.toBeNull();\r\n            expect(result?.processedDate).toBe(todayStr);\r\n\r\n            const updatedSub1 = result?.updatedThemes[0].subthemes[0];\r\n            expect(updatedSub1?.status).toBe('active');\r\n            expect(updatedSub1?.introductionDate).toBe(todayStr);\r\n            expect(updatedSub1?.reviews.length).toBe(5); // 5 Standard intervals\r\n\r\n            // Check first review date (Offset 1 day)\r\n            // If today is 2025-01-01, review 1 should be 2025-01-02\r\n            expect(updatedSub1?.reviews[0].date).toBe('2025-01-02');\r\n\r\n            // Sub 2 should remain queued\r\n            expect(result?.updatedThemes[0].subthemes[1].status).toBe('queue');\r\n        });\r\n\r\n        it('should NOT activate anything if a subtheme was already introduced today', () => {\r\n            const today = new Date(2025, 0, 1);\r\n            vi.setSystemTime(today);\r\n            const todayStr = '2025-01-01';\r\n\r\n            // Subtheme already active introduced today\r\n            const sub1 = createMockSubtheme('sub-1', 'active');\r\n            sub1.introductionDate = todayStr;\r\n            const sub2 = createMockSubtheme('sub-2', 'queue');\r\n\r\n            const themes = [createMockTheme([sub1, sub2])];\r\n\r\n            const result = SRSService.processDailyUpdates(themes, '2024-12-31');\r\n\r\n            // Should return null (no updates needed) or just date update if date was old?\r\n            // The service returns null if today matches OR hasIntroToday.\r\n            // If hasIntroToday but lastProcessed is old, it returns themes unchanged but new date.\r\n\r\n            expect(result).not.toBeNull();\r\n            expect(result?.updatedThemes).toEqual(themes); // Content check, not reference\r\n            expect(result?.processedDate).toBe(todayStr);\r\n        });\r\n\r\n        it('should calculate correct intervals [1, 2, 4, 8, 15]', () => {\r\n            const today = new Date(2025, 0, 1);\r\n            vi.setSystemTime(today);\r\n\r\n            const sub1 = createMockSubtheme('sub-1', 'queue');\r\n            const themes = [createMockTheme([sub1])];\r\n\r\n            const result = SRSService.processDailyUpdates(themes, '2024-12-31');\r\n            const reviews = result?.updatedThemes[0].subthemes[0].reviews;\r\n\r\n            if (!reviews) throw new Error('Reviews not created');\r\n\r\n            // Expected Dates based on 2025-01-01 (acumulative)\r\n            // +1  -> 2025-01-02\r\n            // +2  -> 2025-01-04\r\n            // +4  -> 2025-01-08\r\n            // +8  -> 2025-01-16\r\n            // +15 -> 2025-01-31\r\n\r\n            expect(reviews[0].date).toBe('2025-01-02');\r\n            expect(reviews[1].date).toBe('2025-01-04');\r\n            expect(reviews[2].date).toBe('2025-01-08');\r\n            expect(reviews[3].date).toBe('2025-01-16');\r\n            expect(reviews[4].date).toBe('2025-01-31');\r\n        });\r\n\r\n        it('should handle leap years correctly (Feb 2024)', () => {\r\n            // Feb 28, 2024 (Leap year)\r\n            const date = new Date(2024, 1, 28);\r\n            vi.setSystemTime(date);\r\n\r\n            const sub1 = createMockSubtheme('sub-leap', 'queue');\r\n            const themes = [createMockTheme([sub1])];\r\n\r\n            const result = SRSService.processDailyUpdates(themes, '2024-02-27');\r\n            const reviews = result?.updatedThemes[0].subthemes[0].reviews;\r\n\r\n            if (!reviews) throw new Error('Reviews not created');\r\n\r\n            // Today is 2024-02-28\r\n            // +1 day -> 2024-02-29 (Leap day)\r\n            // +3 days -> 2024-03-02\r\n            expect(reviews[0].date).toBe('2024-02-29');\r\n            expect(reviews[1].date).toBe('2024-03-02');\r\n        });\r\n\r\n        it('should only activate one subtheme per day even across multiple themes', () => {\r\n            const today = new Date(2025, 0, 1);\r\n            vi.setSystemTime(today);\r\n\r\n            const theme1 = createMockTheme([createMockSubtheme('t1-s1', 'queue')]);\r\n            const theme2 = createMockTheme([createMockSubtheme('t2-s1', 'queue')]);\r\n            theme2.id = 'theme-2';\r\n\r\n            const result = SRSService.processDailyUpdates([theme1, theme2], '2024-12-31');\r\n\r\n            const updatedTheme1 = result?.updatedThemes.find(t => t.id === 'theme-1');\r\n            const updatedTheme2 = result?.updatedThemes.find(t => t.id === 'theme-2');\r\n\r\n            // Only one should be active\r\n            const activeCount =\r\n                (updatedTheme1?.subthemes.filter(s => s.status === 'active').length || 0) +\r\n                (updatedTheme2?.subthemes.filter(s => s.status === 'active').length || 0);\r\n\r\n            expect(activeCount).toBe(1);\r\n        });\r\n    });\r\n\r\n    describe('completeReview', () => {\r\n        it('should mark review as completed', () => {\r\n            const today = new Date(2025, 0, 2); // Review day\r\n            vi.setSystemTime(today);\r\n            const todayStr = '2025-01-02';\r\n\r\n            const review1: Review = { number: 1, date: todayStr, status: 'pending' };\r\n            const sub1 = createMockSubtheme('sub-1', 'active', [review1]);\r\n            const themes = [createMockTheme([sub1])];\r\n\r\n            const { updatedThemes, awarded } = SRSService.completeReview(themes, 'sub-1', 1);\r\n\r\n            expect(awarded).toBe(true);\r\n            const updatedSub = updatedThemes[0].subthemes[0];\r\n            expect(updatedSub.reviews[0].status).toBe('completed');\r\n        });\r\n\r\n        it('should NOT complete future reviews', () => {\r\n            const today = new Date(2025, 0, 1); // Before review day\r\n            vi.setSystemTime(today);\r\n\r\n            const review1: Review = { number: 1, date: '2025-01-02', status: 'pending' };\r\n            const sub1 = createMockSubtheme('sub-1', 'active', [review1]);\r\n            const themes = [createMockTheme([sub1])];\r\n\r\n            const { updatedThemes, awarded } = SRSService.completeReview(themes, 'sub-1', 1);\r\n\r\n            expect(awarded).toBe(false);\r\n            expect(updatedThemes[0].subthemes[0].reviews[0].status).toBe('pending');\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\SRSService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'parseISO' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":35}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { addDays, format, parseISO } from 'date-fns';\r\nimport type { Theme, Subtheme, Review } from '../types';\r\n\r\nexport class SRSService {\r\n    // Default intervals (in days) from the previous review\r\n    // Review 1: +1d (Day 1)\r\n    // Review 2: +2d (Day 3)\r\n    // Review 3: +4d (Day 7)\r\n    // Review 4: +8d (Day 15)\r\n    // Review 5: +15d (Day 30)\r\n    private static DEFAULT_STEP_INTERVALS = [1, 2, 4, 8, 15];\r\n\r\n    static getToday(): string {\r\n        return format(new Date(), 'yyyy-MM-dd');\r\n    }\r\n\r\n    /**\r\n     * Calculates the next interval based on difficulty and current step\r\n     * Logic:\r\n     * - Hard: Step interval * 0.8 (min 1 day increase)\r\n     * - Medium: Step interval * 1.0 (standard)\r\n     * - Easy: Step interval * 1.5\r\n     */\r\n    static calculateNextInterval(stepIndex: number, difficulty: 'easy' | 'medium' | 'hard' = 'medium'): number {\r\n        const base = this.DEFAULT_STEP_INTERVALS[stepIndex] || 15;\r\n\r\n        switch (difficulty) {\r\n            case 'easy': return Math.ceil(base * 1.8);\r\n            case 'hard': return Math.max(1, Math.floor(base * 0.7));\r\n            default: return base;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates subtheme activation logic\r\n     */\r\n    static processDailyUpdates(themes: Theme[], lastProcessedDate: string): { updatedThemes: Theme[], processedDate: string } | null {\r\n        const today = this.getToday();\r\n        const hasIntroToday = themes.some(t =>\r\n            t.subthemes.some(st => st.introductionDate === today)\r\n        );\r\n\r\n        if (hasIntroToday && lastProcessedDate === today) return null;\r\n\r\n        let activated = false;\r\n        const updatedThemes = themes.map(theme => {\r\n            if (activated || hasIntroToday) return theme;\r\n\r\n            const queueIndex = theme.subthemes.findIndex(st => st.status === 'queue');\r\n            if (queueIndex !== -1) {\r\n                const subtheme = theme.subthemes[queueIndex];\r\n\r\n                // Initial reviews generation (standard medium)\r\n                let lastDate = new Date();\r\n                const reviews: Review[] = this.DEFAULT_STEP_INTERVALS.map((interval, idx) => {\r\n                    lastDate = addDays(lastDate, interval);\r\n                    return {\r\n                        number: idx + 1,\r\n                        date: format(lastDate, 'yyyy-MM-dd'),\r\n                        status: 'pending'\r\n                    };\r\n                });\r\n\r\n                const updatedSubtheme: Subtheme = {\r\n                    ...subtheme,\r\n                    status: 'active',\r\n                    introductionDate: today,\r\n                    reviews: reviews\r\n                };\r\n\r\n                const newSubthemes = [...theme.subthemes];\r\n                newSubthemes[queueIndex] = updatedSubtheme;\r\n\r\n                activated = true;\r\n                return { ...theme, subthemes: newSubthemes };\r\n            }\r\n            return theme;\r\n        });\r\n\r\n        if (activated || lastProcessedDate !== today) {\r\n            return { updatedThemes: updatedThemes, processedDate: today };\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Completes a review and intelligently reschedules subsequent ones\r\n     */\r\n    static completeReview(\r\n        themes: Theme[],\r\n        subthemeId: string,\r\n        reviewNumber: number,\r\n        difficulty: 'easy' | 'medium' | 'hard' = 'medium'\r\n    ): { updatedThemes: Theme[], awarded: boolean } {\r\n        const today = new Date();\r\n        let awarded = false;\r\n\r\n        const updatedThemes = themes.map(t => ({\r\n            ...t,\r\n            subthemes: t.subthemes.map(st => {\r\n                if (st.id !== subthemeId) return st;\r\n\r\n                const reviewIdx = st.reviews.findIndex(r => r.number === reviewNumber);\r\n                if (reviewIdx === -1) return st;\r\n\r\n                // 0. Date check: Only allow completing if date is today or earlier\r\n                const review = st.reviews[reviewIdx];\r\n                if (review.date > format(today, 'yyyy-MM-dd')) return st;\r\n\r\n                const newReviews = [...st.reviews];\r\n\r\n                // 1. Mark current as completed\r\n                newReviews[reviewIdx] = {\r\n                    ...newReviews[reviewIdx],\r\n                    status: 'completed',\r\n                    completedAt: today.toISOString(),\r\n                    difficulty: difficulty\r\n                };\r\n                awarded = true;\r\n\r\n                // 2. Reschedule SUBSEQUENT reviews if any\r\n                // We take the current completion date as the new anchor\r\n                let anchorDate = today;\r\n\r\n                for (let i = reviewIdx + 1; i < newReviews.length; i++) {\r\n                    // Calculate next interval based on the difficulty of the JUST completed review\r\n                    // But wait, it's more expressive if we only apply difficulty to the IMMEDIATE next one\r\n                    // and subsequent ones keep their standard relative distance?\r\n                    // Actually, let's apply a \"shifted\" schedule.\r\n\r\n                    const nextInterval = this.calculateNextInterval(i, i === reviewIdx + 1 ? difficulty : 'medium');\r\n                    anchorDate = addDays(anchorDate, nextInterval);\r\n\r\n                    newReviews[i] = {\r\n                        ...newReviews[i],\r\n                        date: format(anchorDate, 'yyyy-MM-dd')\r\n                    };\r\n                }\r\n\r\n                const allDone = newReviews.every(r => r.status === 'completed');\r\n                return {\r\n                    ...st,\r\n                    reviews: newReviews,\r\n                    status: allDone ? 'completed' : st.status\r\n                };\r\n            })\r\n        }));\r\n\r\n        return { updatedThemes, awarded };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\SyncQueueService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\SyncQueueService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SupabaseError' is defined but never used.","line":4,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":47,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":220,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":220,"endColumn":47}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '../lib/supabase';\r\nimport { SyncService } from './SyncService';\r\nimport { syncLogger } from '../utils/logger';\r\nimport type { DbPayload, PartialDbPayload, SyncStatus, SupabaseError } from '../types/sync';\r\n\r\nexport interface SyncOp {\r\n    id: string; // Unique ID for the operation\r\n    type: 'ADD' | 'UPDATE' | 'DELETE';\r\n    table: 'themes' | 'tasks' | 'goals' | 'subthemes' | 'profiles';\r\n    data: PartialDbPayload; // Partial payload for flexibility\r\n    timestamp: number;\r\n    retryCount: number;\r\n    lastError?: string;\r\n    nextRetryTime?: number;\r\n    dependentOn?: string;\r\n}\r\n\r\nconst QUEUE_STORAGE_KEY = 'sync_queue_v1';\r\nconst QUEUE_VERSION = 'v2'; // Bump to invalidate old queues\r\nconst MAX_RETRIES = 5;\r\nconst MAX_QUEUE_SIZE = 100; // Prevent unbounded growth\r\n\r\nexport class SyncQueueService {\r\n    private static queue: SyncOp[] = [];\r\n    private static isProcessing = false;\r\n    private static statusListeners: ((status: 'synced' | 'syncing' | 'offline' | 'error') => void)[] = [];\r\n\r\n    // --- Queue Management ---\r\n\r\n    static loadQueue() {\r\n        const saved = localStorage.getItem(QUEUE_STORAGE_KEY);\r\n        const savedVersion = localStorage.getItem('sync_queue_version');\r\n\r\n        // Version Check: If version mismatch, nuke the queue to prevent stuck poison pills\r\n        if (savedVersion !== QUEUE_VERSION) {\r\n            syncLogger.info(\"Version mismatch or first run. Clearing old queue.\");\r\n            this.clearQueue();\r\n            localStorage.setItem('sync_queue_version', QUEUE_VERSION);\r\n            return;\r\n        }\r\n\r\n        if (saved) {\r\n            try {\r\n                this.queue = JSON.parse(saved);\r\n                // Sanitize: Remove potentially corrupted ops with null data\r\n                this.queue = this.queue.filter(op => op && op.data);\r\n            } catch (e) {\r\n                this.queue = [];\r\n            }\r\n        }\r\n    }\r\n\r\n    static saveQueue() {\r\n        localStorage.setItem(QUEUE_STORAGE_KEY, JSON.stringify(this.queue));\r\n        this.notifyStatus();\r\n    }\r\n\r\n    static clearQueue() {\r\n        this.queue = [];\r\n        this.saveQueue();\r\n    }\r\n\r\n    static enqueue(op: Omit<SyncOp, 'id' | 'timestamp' | 'retryCount'> & { id?: string }) {\r\n        const operation: SyncOp = {\r\n            ...op,\r\n            id: op.id || crypto.randomUUID(),\r\n            timestamp: Date.now(),\r\n            retryCount: 0\r\n        };\r\n\r\n        // Enforce max queue size to prevent memory issues\r\n        if (this.queue.length >= MAX_QUEUE_SIZE) {\r\n            syncLogger.warn(`Queue size limit (${MAX_QUEUE_SIZE}) reached. Dropping oldest operation.`);\r\n            this.queue.shift(); // Remove oldest to make space\r\n        }\r\n\r\n        this.queue.push(operation);\r\n        this.saveQueue();\r\n        this.processQueue(); // Try to process immediately\r\n    }\r\n\r\n    // --- Processing ---\r\n\r\n    static removeDependentOps(parentId: string) {\r\n        // Filter out any operations that depend on the failed parentId\r\n        const initialLength = this.queue.length;\r\n        this.queue = this.queue.filter(op => op.dependentOn !== parentId);\r\n        if (this.queue.length !== initialLength) {\r\n            this.saveQueue();\r\n        }\r\n    }\r\n\r\n    private static isFatalError(error: { message?: string, code?: string }): boolean {\r\n        // Check for common fatal Supabase/Postgres errors\r\n        // 23505: Unique violation (already exists) - We should probably assume success or skip\r\n        // 23503: Foreign key violation (parent doesn't exist) - If parent creation failed, this is fatal.\r\n        // 400: Bad Request (Validation failed)\r\n        // 401: Unauthorized (RLS) - Maybe not fatal if token refreshes? But often is.\r\n        // 409: Conflict\r\n\r\n        const msg = error.message || '';\r\n        const code = error.code || '';\r\n\r\n        if (code === '23505') return true; // Unique violation\r\n        if (code === '23503') return true; // FK violation\r\n        if (code === '42P01') return true; // Undefined table\r\n        if (code === '42703') return true; // Undefined column (e.g. user_id in subthemes)\r\n        if (msg.includes('duplicate key value')) return true;\r\n        if (msg.includes('violates foreign key constraint')) return true;\r\n        if (msg.includes('Could not find the')) return true; // Schema cache error\r\n\r\n        return false;\r\n    }\r\n\r\n    static async processQueue() {\r\n        if (this.isProcessing) return;\r\n        if (this.queue.length === 0) {\r\n            this.notifyStatus();\r\n            return;\r\n        }\r\n\r\n        if (!navigator.onLine) {\r\n            this.notifyStatus();\r\n            return;\r\n        }\r\n\r\n        this.isProcessing = true;\r\n        this.notifyStatus();\r\n\r\n        // üöÄ BATCH PROCESSING: Group operations by table and type for efficiency\r\n        const processedOps: string[] = [];\r\n\r\n        try {\r\n            // Group operations by table and type\r\n            const groupedOps = new Map<string, SyncOp[]>();\r\n\r\n            for (const op of SyncQueueService.queue) {\r\n                // Check Backoff\r\n                if (op.nextRetryTime && Date.now() < op.nextRetryTime) {\r\n                    continue; // Skip this op for now\r\n                }\r\n\r\n                const key = `${op.table}_${op.type}`;\r\n                if (!groupedOps.has(key)) {\r\n                    groupedOps.set(key, []);\r\n                }\r\n                groupedOps.get(key)!.push(op);\r\n            }\r\n\r\n            // Process each group as a batch\r\n            for (const [key, ops] of groupedOps.entries()) {\r\n                if (ops.length === 0) continue;\r\n\r\n                const [table, type] = key.split('_') as [string, 'ADD' | 'UPDATE' | 'DELETE'];\r\n\r\n                try {\r\n                    if (type === 'ADD' && ops.length > 1) {\r\n                        // Batch INSERT\r\n                        const payloads = ops.map(op => SyncQueueService.cleanPayload(SyncQueueService.preparePayload(op.table, op.data as any)));\r\n                        const result = await supabase.from(table).insert(payloads);\r\n\r\n                        if (result?.error) {\r\n                            throw { message: result.error.message, code: result.error.code };\r\n                        }\r\n\r\n                        // Mark all as processed\r\n                        ops.forEach(op => processedOps.push(op.id));\r\n                    } else {\r\n                        // Process individually (UPDATE and DELETE, or single ADD)\r\n                        for (const op of ops) {\r\n                            await SyncQueueService.executeOp(op);\r\n                            processedOps.push(op.id);\r\n                        }\r\n                    }\r\n                } catch (error: any) {\r\n                    syncLogger.error(`Batch failed for ${key}:`, error);\r\n\r\n                    // Handle errors for the batch\r\n                    for (const op of ops) {\r\n                        if (SyncQueueService.isFatalError(error)) {\r\n                            syncLogger.warn(`Fatal error for op ${op.id}. Dropping.`);\r\n                            processedOps.push(op.id);\r\n                            SyncQueueService.removeDependentOps(op.id);\r\n                        } else {\r\n                            op.retryCount++;\r\n                            op.lastError = error.message || 'Unknown error';\r\n\r\n                            if (op.retryCount >= MAX_RETRIES) {\r\n                                processedOps.push(op.id);\r\n                                SyncQueueService.removeDependentOps(op.id);\r\n                            } else {\r\n                                // üöÄ OPTIMIZED: Linear backoff instead of exponential\r\n                                const delay = Math.min(500 * op.retryCount, 5000);\r\n                                op.nextRetryTime = Date.now() + delay;\r\n\r\n                                // Schedule retry\r\n                                setTimeout(() => SyncQueueService.processQueue(), delay);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Remove processed ops from queue\r\n            this.queue = this.queue.filter(op => !processedOps.includes(op.id));\r\n            this.saveQueue();\r\n\r\n        } catch (error) {\r\n            syncLogger.error('Queue processing error:', error);\r\n        }\r\n\r\n        this.isProcessing = false;\r\n        this.notifyStatus();\r\n    }\r\n\r\n    // Helper to strip undefined values so partial updates work\r\n    private static cleanPayload(payload: Record<string, any>) {\r\n        if (!payload) return {};\r\n        return Object.fromEntries(\r\n            Object.entries(payload).filter(([_, v]) => v !== undefined)\r\n        );\r\n    }\r\n\r\n    static async executeOp(op: SyncOp) {\r\n        // üöÄ OPTIMIZED: Removed redundant conflict check\r\n        // Let Supabase handle conflicts naturally with updated_at and RLS\r\n\r\n        let result;\r\n\r\n        if (op.type === 'ADD') {\r\n            const payload = SyncQueueService.cleanPayload(SyncQueueService.preparePayload(op.table, op.data as any));\r\n            result = await supabase.from(op.table).insert(payload);\r\n        } else if (op.type === 'UPDATE') {\r\n            const rawPayload = SyncQueueService.preparePayload(op.table, op.data as any);\r\n            const payload = SyncQueueService.cleanPayload(rawPayload);\r\n\r\n            // Don't update ID or created_at usually\r\n            delete payload.id;\r\n            delete payload.created_at;\r\n            // Always update 'updated_at' to now if not present? Supabase might handle it.\r\n\r\n            result = await supabase.from(op.table).update(payload).eq('id', op.data.id);\r\n        } else if (op.type === 'DELETE') {\r\n            syncLogger.debug(`Executing DELETE for ${op.table} ID: ${op.data.id}`);\r\n            result = await supabase.from(op.table).delete().eq('id', op.data.id);\r\n\r\n            // üõ°Ô∏è Enhanced DELETE validation\r\n            if (result?.error) {\r\n                syncLogger.error(`DELETE failed for ${op.table} ID: ${op.data.id}`, result.error);\r\n                throw { message: result.error.message, code: result.error.code };\r\n            }\r\n\r\n            // Verify deletion actually happened by checking affected rows\r\n            if (result && result.status && result.status !== 204 && result.status !== 200) {\r\n                syncLogger.error(`DELETE returned unexpected status ${result.status} for ${op.table} ID: ${op.data.id}`);\r\n                throw { message: `DELETE failed with status ${result.status}`, code: 'DELETE_STATUS_ERR' };\r\n            }\r\n\r\n            syncLogger.debug(`DELETE successful for ${op.table} ID: ${op.data.id}`);\r\n        }\r\n\r\n        // Final error check\r\n        if (result?.error) {\r\n            throw { message: result.error.message, code: result.error.code };\r\n        }\r\n    }\r\n\r\n    // Helper to map generic types to DB columns using SyncService\r\n    private static preparePayload(table: string, data: DbPayload): any {\r\n        if (!data) return {}; // Guard against null data passed to mappers\r\n        // We reuse SyncService static methods if possible\r\n\r\n        switch (table) {\r\n            case 'tasks': return SyncService.mapTaskToDb(data as any);\r\n            case 'goals': return SyncService.mapGoalToDb(data as any);\r\n            case 'themes': return SyncService.mapThemeToDb(data as any);\r\n            case 'subthemes': return SyncService.mapSubthemeToDb(data as any);\r\n            case 'profiles': return data;\r\n            default: return data;\r\n        }\r\n    }\r\n\r\n    // --- Status ---\r\n\r\n    static getStatus(): 'synced' | 'syncing' | 'offline' | 'error' {\r\n        if (!navigator.onLine) return 'offline';\r\n        // Only show 'error' if we've retried multiple times (persistent failure)\r\n        // Transient failures (retryCount <= 3) will show as 'syncing'\r\n        if (this.queue.some(op => op.retryCount > 3)) return 'error';\r\n        if (this.queue.length > 0 || this.isProcessing) return 'syncing';\r\n        return 'synced';\r\n    }\r\n\r\n    static subscribe(listener: (status: SyncStatus) => void) {\r\n        this.statusListeners.push(listener);\r\n        listener(this.getStatus());\r\n        return () => {\r\n            this.statusListeners = this.statusListeners.filter(l => l !== listener);\r\n        };\r\n    }\r\n\r\n    private static notifyStatus() {\r\n        const s = this.getStatus();\r\n        this.statusListeners.forEach(l => l(s));\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\services\\SyncService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'supabase' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":116,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '../lib/supabase';\r\nimport type { Task, Goal, Theme, Subtheme } from '../types';\r\n\r\nexport interface SyncItem {\r\n    id: string;\r\n    table: string;\r\n    action: 'insert' | 'update' | 'delete';\r\n    data: any;\r\n    priority: number;\r\n    attempts: number;\r\n    lastAttempt?: number;\r\n}\r\n\r\nexport class SyncService {\r\n    private queue: SyncItem[] = [];\r\n    private isProcessing = false;\r\n    private maxAttempts = 5;\r\n    private storageKey = 'sync_queue_v2';\r\n\r\n    constructor() {\r\n        this.loadQueue();\r\n        if (typeof window !== 'undefined') {\r\n            window.addEventListener('online', () => this.processQueue());\r\n        }\r\n    }\r\n\r\n    // --- Static Mappers (Restored for SyncQueueService) ---\r\n\r\n    static mapTaskToDb(task: Task & { user_id?: string }) {\r\n        return {\r\n            id: task.id,\r\n            title: task.title,\r\n            type: task.type,\r\n            status: task.status,\r\n            priority: task.priority,\r\n            date: task.date,\r\n            start_date: task.startDate,\r\n            end_date: task.endDate,\r\n            recurrence: task.recurrence,\r\n            image_url: task.imageUrl,\r\n            duration_minutes: task.durationMinutes,\r\n            time_spent: task.timeSpent,\r\n            completion_history: task.completionHistory,\r\n            sessions: task.sessions,\r\n            summaries: task.summaries,\r\n            user_id: task.user_id\r\n        };\r\n    }\r\n\r\n    static mapGoalToDb(goal: Goal & { user_id?: string }) {\r\n        return {\r\n            id: goal.id,\r\n            title: goal.title,\r\n            type: goal.type,\r\n            category: goal.category,\r\n            progress: goal.progress,\r\n            priority: goal.priority,\r\n            deadline: goal.deadline,\r\n            image_url: goal.imageUrl,\r\n            duration_minutes: goal.durationMinutes,\r\n            time_spent: goal.timeSpent,\r\n            completion_history: goal.completionHistory,\r\n            checklist: goal.checklist,\r\n            summaries: goal.summaries,\r\n            user_id: goal.user_id,\r\n            related_theme_id: goal.relatedThemeId,\r\n            is_habit: goal.isHabit,\r\n            start_date: goal.startDate,\r\n            recurrence: goal.recurrence\r\n        };\r\n    }\r\n\r\n    static mapThemeToDb(theme: Theme & { user_id?: string }) {\r\n        return {\r\n            id: theme.id,\r\n            title: theme.title,\r\n            icon: theme.icon,\r\n            color: theme.color,\r\n            category: theme.category,\r\n            start_date: theme.startDate,\r\n            deadline: theme.deadline,\r\n            notification_time: theme.notificationTime,\r\n            image_url: theme.imageUrl,\r\n            priority: theme.priority,\r\n            summaries: theme.summaries,\r\n            user_id: theme.user_id\r\n        };\r\n    }\r\n\r\n    static mapSubthemeToDb(sub: Subtheme & { theme_id?: string; user_id?: string }) {\r\n        return {\r\n            id: sub.id,\r\n            theme_id: sub.theme_id,\r\n            title: sub.title,\r\n            status: sub.status,\r\n            introduction_date: sub.introductionDate,\r\n            reviews: sub.reviews,\r\n            duration_minutes: sub.durationMinutes,\r\n            time_spent: sub.timeSpent,\r\n            difficulty: sub.difficulty,\r\n            text_content: sub.text_content,\r\n            summaries: sub.summaries,\r\n            user_id: sub.user_id,\r\n            order_index: sub.order_index\r\n        };\r\n    }\r\n\r\n    // --- Instance Methods for New Resilient Sync (to be integrated or used by SyncQueueService) ---\r\n\r\n    private loadQueue() {\r\n        if (typeof localStorage === 'undefined') return;\r\n        const saved = localStorage.getItem(this.storageKey);\r\n        if (saved) {\r\n            try {\r\n                this.queue = JSON.parse(saved);\r\n            } catch (e) {\r\n                this.queue = [];\r\n            }\r\n        }\r\n    }\r\n\r\n    private saveQueue() {\r\n        if (typeof localStorage === 'undefined') return;\r\n        localStorage.setItem(this.storageKey, JSON.stringify(this.queue));\r\n    }\r\n\r\n    async enqueue(item: Omit<SyncItem, 'attempts' | 'lastAttempt'>) {\r\n        this.queue.push({ ...item, attempts: 0 });\r\n        this.saveQueue();\r\n        this.processQueue();\r\n    }\r\n\r\n    private async processQueue() {\r\n        if (this.isProcessing || this.queue.length === 0 || !navigator.onLine) return;\r\n        this.isProcessing = true;\r\n        // Logic for processing queue would go here if we used this instance\r\n        this.isProcessing = false;\r\n    }\r\n}\r\n\r\nexport const syncService = new SyncService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\types\\GoalItem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\types\\gamification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\types\\summary-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\types\\sync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\__tests__\\exportData.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\__tests__\\logger.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\celebration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\csvExport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\dateHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\deletedItemsBlacklist.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\exportData.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":76,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Utility functions for data export and import\r\n */\r\n\r\nexport interface BackupData {\r\n    timestamp: string;\r\n    profile?: any;\r\n    settings?: any;\r\n    themes: any[];\r\n    tasks: any[];\r\n    goals: any[];\r\n    gamification: any;\r\n    zenMode?: boolean;\r\n}\r\n\r\n/**\r\n * Export all data to JSON file\r\n */\r\nexport const exportToJSON = (data: BackupData): void => {\r\n    const blob = new Blob([JSON.stringify(data, null, 2)], {\r\n        type: 'application/json'\r\n    });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `study-panel-backup-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n};\r\n\r\n/**\r\n * Validate imported backup data structure\r\n */\r\nexport const validateBackupData = (data: any): { valid: boolean; error?: string } => {\r\n    // Check if it's a valid object\r\n    if (typeof data !== 'object' || data === null) {\r\n        return { valid: false, error: 'Arquivo inv√°lido: n√£o √© um objeto JSON' };\r\n    }\r\n\r\n    // Check for required fields\r\n    const requiredFields = ['themes', 'tasks', 'goals', 'gamification'];\r\n    for (const field of requiredFields) {\r\n        if (!(field in data)) {\r\n            return { valid: false, error: `Arquivo inv√°lido: campo \"${field}\" n√£o encontrado` };\r\n        }\r\n    }\r\n\r\n    // Check if arrays are actually arrays\r\n    if (!Array.isArray(data.themes)) {\r\n        return { valid: false, error: 'Arquivo inv√°lido: \"themes\" n√£o √© um array' };\r\n    }\r\n    if (!Array.isArray(data.tasks)) {\r\n        return { valid: false, error: 'Arquivo inv√°lido: \"tasks\" n√£o √© um array' };\r\n    }\r\n    if (!Array.isArray(data.goals)) {\r\n        return { valid: false, error: 'Arquivo inv√°lido: \"goals\" n√£o √© um array' };\r\n    }\r\n\r\n    return { valid: true };\r\n};\r\n\r\n/**\r\n * Read and parse JSON file\r\n */\r\nexport const readJSONFile = (file: File): Promise<any> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (e) => {\r\n            try {\r\n                const text = e.target?.result as string;\r\n                const data = JSON.parse(text);\r\n                resolve(data);\r\n            } catch (error) {\r\n                reject(new Error('Erro ao ler o arquivo: JSON inv√°lido'));\r\n            }\r\n        };\r\n\r\n        reader.onerror = () => {\r\n            reject(new Error('Erro ao ler o arquivo'));\r\n        };\r\n\r\n        reader.readAsText(file);\r\n    });\r\n};\r\n\r\n/**\r\n * Format file size for display\r\n */\r\nexport const formatFileSize = (bytes: number): string => {\r\n    if (bytes < 1024) return bytes + ' B';\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\icalExport.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'type' is defined but never used.","line":7,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":58}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Task, Goal } from '../types';\r\nimport { format, parseISO } from 'date-fns';\r\n\r\n/**\r\n * Generate iCal format string for tasks/goals\r\n */\r\nexport const generateiCal = (items: (Task | Goal)[], type: 'task' | 'goal'): string => {\r\n    const events = items.map(item => {\r\n        const isTask = 'type' in item && (item.type === 'day' || item.type === 'period');\r\n        const startDate = isTask ? (item as Task).date || (item as Task).startDate : (item as Goal).startDate;\r\n        const endDate = isTask ? (item as Task).endDate : (item as Goal).deadline;\r\n\r\n        if (!startDate) return null;\r\n\r\n        const start = parseISO(startDate);\r\n        const end = endDate ? parseISO(endDate) : start;\r\n\r\n        // Format: YYYYMMDDTHHMMSSZ\r\n        const formatDate = (date: Date) => {\r\n            return format(date, \"yyyyMMdd'T'HHmmss'Z'\");\r\n        };\r\n\r\n        const summary = item.title.replace(/\\n/g, ' ');\r\n        const description = ('summary' in item ? item.summary : '') || '';\r\n        const uid = `${item.id}@studypanel.app`;\r\n\r\n        return `BEGIN:VEVENT\r\nUID:${uid}\r\nDTSTAMP:${formatDate(new Date())}\r\nDTSTART:${formatDate(start)}\r\nDTEND:${formatDate(end)}\r\nSUMMARY:${summary}\r\nDESCRIPTION:${description.replace(/\\n/g, '\\\\n')}\r\nSTATUS:${'status' in item && item.status === 'completed' ? 'COMPLETED' : 'CONFIRMED'}\r\nEND:VEVENT`;\r\n    }).filter(Boolean);\r\n\r\n    const calendar = `BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//Study Panel//Study Management App//EN\r\nCALSCALE:GREGORIAN\r\nMETHOD:PUBLISH\r\n${events.join('\\n')}\r\nEND:VCALENDAR`;\r\n\r\n    return calendar;\r\n};\r\n\r\n/**\r\n * Download iCal file\r\n */\r\nexport const downloadiCal = (icalContent: string, filename: string) => {\r\n    const blob = new Blob([icalContent], { type: 'text/calendar;charset=utf-8' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `${filename}.ics`);\r\n    link.style.visibility = 'hidden';\r\n\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\summaries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\utils\\webVitals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\luizf\\antigraty\\study-panel\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]